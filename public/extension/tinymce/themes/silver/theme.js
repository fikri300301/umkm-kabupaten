!function(){"use strict";var typeOf=function(x){var t=typeof x;return null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},isType$1=function(type){return function(value){return typeOf(value)===type}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$1=function(t){return function(a){return t===a}},isString=isType$1("string"),isObject=isType$1("object"),isArray=isType$1("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),isArrayOf=function(value,pred){if(isArray(value)){for(var i=0,len=value.length;i<len;++i)if(!pred(value[i]))return!1;return!0}return!1},noop=function(){},noarg=function(f){return function(){return f()}},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},compose1=function(fbc,fab){return function(a){return fbc(fab(a))}},constant$1=function(value){return function(){return value}},identity$1=function(x){return x},tripleEquals=function(a,b){return a===b};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var not=function(f){return function(t){return!f(t)}},die=function(msg){return function(){throw new Error(msg)}},never=constant$1(!1),always=constant$1(!0),global$g=tinymce.util.Tools.resolve("tinymce.ThemeManager"),__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var i=0,l=from.length,ar;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var none=function(){return NONE},NONE={fold:function(n,_s){return n()},isSome:never,isNone:always,getOr:id=identity$1,getOrThunk:call=function(thunk){return thunk()},getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant$1(null),getOrUndefined:constant$1(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:function(){return none()},toArray:function(){return[]},toString:constant$1("none()")},call,id,me,some=function(a){var constant_a=constant$1(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return me},from$1=function(value){return null==value?NONE:some(value)},Optional={some:some,none:none,from:from$1},nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},indexOf=function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)},contains$2=function(xs,x){return rawIndexOf(xs,x)>-1},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x;if(pred(xs[i],i))return!0}return!1},range$2=function(num,f){for(var r=[],i=0;i<num;i++)r.push(f(i));return r},chunk$1=function(array,size){for(var r=[],i=0;i<array.length;i+=size){var s=nativeSlice.call(array,i,i+size);r.push(s)}return r},map$2=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each$1=function(xs,f){for(var i=0,len=xs.length;i<len;i++){var x;f(xs[i],i)}},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){var x;f(xs[i],i)}},partition$3=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i],arr;(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter$2=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,(function(x,i){acc=f(acc,x,i)})),acc},foldl=function(xs,f,acc){return each$1(xs,(function(x,i){acc=f(acc,x,i)})),acc},findUntil=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find$5=function(xs,pred){return findUntil(xs,pred,never)},findIndex$1=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x;if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind$3=function(xs,f){return flatten(map$2(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x;if(!0!==pred(xs[i],i))return!1}return!0},reverse=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r},difference=function(a1,a2){return filter$2(a1,(function(x){return!contains$2(a2,x)}))},mapToObject=function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},pure$2=function(x){return[x]},sort=function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get$f=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get$f(xs,0)},last$2=function(xs){return get$f(xs,xs.length-1)},from=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x;f(obj[i],i)}},map$1=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},objAcc=function(r){return function(x,i){r[i]=x}},internalFilter=function(obj,pred,onTrue,onFalse){var r={};return each(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})),r},filter$1=function(obj,pred){var t={};return internalFilter(obj,pred,objAcc(t),noop),t},mapToArray=function(obj,f){var r=[];return each(obj,(function(value,name){r.push(f(value,name))})),r},find$4=function(obj,pred){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x=obj[i];if(pred(x,i,obj))return Optional.some(x)}return Optional.none()},values=function(obj){return mapToArray(obj,identity$1)},get$e=function(obj,key){return has$2(obj,key)?Optional.from(obj[key]):Optional.none()},has$2=function(obj,key){return hasOwnProperty.call(obj,key)},hasNonNullableKey=function(obj,key){return has$2(obj,key)&&void 0!==obj[key]&&null!==obj[key]},is$1=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lhs.exists((function(left){return comparator(left,rhs)}))},equals=function(lhs,rhs,comparator){return void 0===comparator&&(comparator=tripleEquals),lift2(lhs,rhs,comparator).getOr(lhs.isNone()&&rhs.isNone())},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},sequence=function(arr){for(var r=[],i=0;i<arr.length;i++){var x=arr[i];if(!x.isSome())return Optional.none();r.push(x.getOrDie())}return Optional.some(r)},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},lift3=function(oa,ob,oc,f){return oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()},mapFrom=function(a,f){return null!=a?Optional.some(f(a)):Optional.none()},someIf=function(b,a){return b?Optional.some(a):Optional.none()},addToEnd=function(str,suffix){return str+suffix},removeFromStart=function(str,numChars){return str.substring(numChars)},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},removeLeading=function(str,prefix){return startsWith(str,prefix)?removeFromStart(str,prefix.length):str},ensureTrailing=function(str,suffix){return endsWith(str,suffix)?str:addToEnd(str,suffix)},contains$1=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return checkRange(str,prefix,0)},endsWith=function(str,suffix){return checkRange(str,suffix,str.length-suffix.length)},blank,trim$1=function(r){return function(s){return s.replace(r,"")}}(/^\s+|\s+$/g),isNotEmpty=function(s){return s.length>0},isEmpty=function(s){return!isNotEmpty(s)},isSupported$1=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},fromHtml$2=function(html,scope){var doc,div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(div.childNodes[0])},fromTag=function(tag,scope){var doc,node=(scope||document).createElement(tag);return fromDom(node)},fromText=function(text,scope){var doc,node=(scope||document).createTextNode(text);return fromDom(node)},fromDom=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},fromPoint,SugarElement={fromHtml:fromHtml$2,fromTag:fromTag,fromText:fromText,fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}};"undefined"!=typeof window?window:Function("return this;")();var DOCUMENT=9,DOCUMENT_FRAGMENT=11,ELEMENT=1,TEXT=3,name$2=function(element){var r;return element.dom.nodeName.toLowerCase()},type=function(element){return element.dom.nodeType},isType=function(t){return function(element){return type(element)===t}},isElement$2=isType(1),isText$1=isType(3),isDocument=isType(9),isDocumentFragment=isType(11),cached=function(f){var called=!1,r;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},DeviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant$1(isiPad),isiPhone:constant$1(isiPhone),isTablet:constant$1(isTablet),isPhone:constant$1(isPhone),isTouch:constant$1(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant$1(iOSwebview),isDesktop:constant$1(isDesktop)}},firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},find$3=function(regexes,agent){var r=firstMatch(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu$d(group(1),group(2))},detect$4=function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown$3():find$3(versionRegexes,cleanedAgent)},unknown$3=function(){return nu$d(0,0)},nu$d=function(major,minor){return{major:major,minor:minor}},Version={nu:nu$d,detect:detect$4,unknown:unknown$3},detectBrowser$1=function(browsers,userAgentData){return findMap(userAgentData.brands,(function(uaBrand){var lcBrand=uaBrand.brand.toLowerCase();return find$5(browsers,(function(browser){var _a;return lcBrand===(null===(_a=browser.brand)||void 0===_a?void 0:_a.toLowerCase())})).map((function(info){return{current:info.name,version:Version.nu(parseInt(uaBrand.version,10),0)}}))}))},detect$3=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find$5(candidates,(function(candidate){return candidate.search(agent)}))},detectBrowser=function(browsers,userAgent){return detect$3(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}}))},detectOs=function(oses,userAgent){return detect$3(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}}))},normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$1(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant$1(browsers),oses:constant$1(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",unknown$2=function(){return nu$c({current:void 0,version:Version.unknown()})},nu$c=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current:current,version:version,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}},Browser={unknown:unknown$2,nu:nu$c,edge:constant$1(edge),chrome:constant$1(chrome),ie:constant$1(ie),opera:constant$1(opera),firefox:constant$1(firefox),safari:constant$1(safari)},windows="Windows",ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",unknown$1=function(){return nu$b({current:void 0,version:Version.unknown()})},nu$b=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current:current,version:version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}},OperatingSystem={unknown:unknown$1,nu:nu$b,windows:constant$1(windows),ios:constant$1(ios),android:constant$1(android),linux:constant$1(linux),osx:constant$1(osx),solaris:constant$1(solaris),freebsd:constant$1(freebsd),chromeos:constant$1(chromeos)},detect$2,PlatformDetection_detect=function(userAgent,userAgentDataOpt,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=userAgentDataOpt.bind((function(userAgentData){return detectBrowser$1(browsers,userAgentData)})).orThunk((function(){return detectBrowser(browsers,userAgent)})).fold(Browser.unknown,Browser.nu),os=detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType;return{browser:browser,os:os,deviceType:DeviceType(os,browser,userAgent,mediaMatch)}},mediaMatch=function(query){return window.matchMedia(query).matches},platform=cached((function(){return PlatformDetection_detect(navigator.userAgent,Optional.from(navigator.userAgentData),mediaMatch)})),detect$1=function(){return platform()},compareDocumentPosition=function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)},documentPositionContainedBy=function(a,b){return compareDocumentPosition(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY)},is=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},all$3=function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map$2(base.querySelectorAll(selector),SugarElement.fromDom)},one=function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)},eq=function(e1,e2){return e1.dom===e2.dom},regularContains=function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)},ieContains=function(e1,e2){return documentPositionContainedBy(e1.dom,e2.dom)},contains=function(e1,e2){return detect$1().browser.isIE()?ieContains(e1,e2):regularContains(e1,e2)},owner$4=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument(dos)?dos:owner$4(dos)},documentElement=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement)},defaultView=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},parentNode=function(element){return parent(element)},offsetParent=function(element){return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},children=function(element){return map$2(element.dom.childNodes,SugarElement.fromDom)},child$2=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},firstChild=function(element){return child$2(element,0)},spot=function(element,offset){return{element:element,offset:offset}},leaf=function(element,offset){var cs=children(element);return cs.length>0&&offset<cs.length?spot(cs[offset],0):spot(element,offset)},isShadowRoot=function(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported=constant$1(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getContentContainer=function(dos){return isShadowRoot(dos)?dos:SugarElement.fromDom(documentOrOwner(dos).dom.body)},isInShadowRoot=function(e){return getShadowRoot(e).isSome()},getShadowRoot=function(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},getOriginalEventTarget=function(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement$2(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},inBody=function(element){var dom=isText$1(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),compose1(inBody,getShadowHost))},body=function(){return getBody(SugarElement.fromDom(document))},getBody=function(doc){var b=doc.dom.body;if(null==b)throw new Error("Body is not available yet");return SugarElement.fromDom(b)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set$8=function(element,key,value){rawSet(element.dom,key,value)},setAll$1=function(element,attrs){var dom=element.dom;each(attrs,(function(v,k){rawSet(dom,k,v)}))},get$d=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$d(element,key))},has$1=function(element,key){var dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)},remove$7=function(element,key){element.dom.removeAttribute(key)},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported$1(dom)&&dom.style.setProperty(property,value)},internalRemove=function(dom,property){isSupported$1(dom)&&dom.style.removeProperty(property)},set$7=function(element,property,value){var dom=element.dom;internalSet(dom,property,value)},setAll=function(element,css){var dom=element.dom;each(css,(function(v,k){internalSet(dom,k,v)}))},setOptions=function(element,css){var dom=element.dom;each(css,(function(v,k){v.fold((function(){internalRemove(dom,k)}),(function(value){internalSet(dom,k,value)}))}))},get$c=function(element,property){var dom=element.dom,styles,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},getAllRaw=function(element){var css={},dom=element.dom;if(isSupported$1(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},isValidValue=function(tag,property,value){var element=SugarElement.fromTag(tag),style;return set$7(element,property,value),getRaw(element,property).isSome()},remove$6=function(element,property){var dom=element.dom;internalRemove(dom,property),is$1(getOpt(element,"style").map(trim$1),"")&&remove$7(element,"style")},reflow=function(e){return e.dom.offsetWidth},Dimension=function(name,getOffset){var set,get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$c(element,name);return parseFloat(css)||0}return r},getOuter,aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$c(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)},max=function(element,value,properties){var cumulativeInclusions=aggregate(element,properties),absoluteMax;return value>cumulativeInclusions?value-cumulativeInclusions:0};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported$1(dom)&&(dom.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:max}},api$3=Dimension("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),get$b=function(element){return api$3.get(element)},getOuter$2=function(element){return api$3.getOuter(element)},setMax$1=function(element,value){var inclusions=["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"],absMax=api$3.max(element,value,inclusions);set$7(element,"max-height",absMax+"px")},r$1=function(left,top){var translate;return{left:left,top:top,translate:function(x,y){return r$1(left+x,top+y)}}},SugarPosition=r$1,boxPosition=function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)},firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},absolute$3=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport$1(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)},viewport$1=function(element){var dom=element.dom,doc,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?boxPosition(dom):SugarPosition(0,0)},api$2=Dimension("width",(function(element){return element.dom.offsetWidth})),set$6=function(element,h){return api$2.set(element,h)},get$a=function(element){return api$2.get(element)},getOuter$1=function(element){return api$2.getOuter(element)},setMax=function(element,value){var inclusions=["margin-left","border-left-width","padding-left","padding-right","border-right-width","margin-right"],absMax=api$2.max(element,value,inclusions);set$7(element,"max-width",absMax+"px")},mkEvent=function(target,x,y,stop,prevent,kill,raw){return{target:target,x:x,y:y,stop:stop,prevent:prevent,kill:kill,raw:raw}},fromRawEvent$1=function(rawEvent){var target=SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target)),stop=function(){return rawEvent.stopPropagation()},prevent=function(){return rawEvent.preventDefault()},kill=compose(prevent,stop);return mkEvent(target,rawEvent.clientX,rawEvent.clientY,stop,prevent,kill,rawEvent)},handle=function(filter,handler){return function(rawEvent){filter(rawEvent)&&handler(fromRawEvent$1(rawEvent))}},binder=function(element,event,filter,handler,useCapture){var wrapped=handle(filter,handler);return element.dom.addEventListener(event,wrapped,useCapture),{unbind:curry(unbind,element,event,wrapped,useCapture)}},bind$2=function(element,event,filter,handler){return binder(element,event,filter,handler,!1)},capture$1=function(element,event,filter,handler){return binder(element,event,filter,handler,!0)},unbind=function(element,event,handler,useCapture){element.dom.removeEventListener(event,handler,useCapture)},before$2=function(marker,element){var parent$1;parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after$2=function(marker,element){var sibling;nextSibling(marker).fold((function(){var parent$1;parent(marker).each((function(v){append$2(v,element)}))}),(function(v){before$2(v,element)}))},prepend$1=function(parent,element){var firstChild$1;firstChild(parent).fold((function(){append$2(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append$2=function(parent,element){parent.dom.appendChild(element.dom)},appendAt=function(parent,element,index){child$2(parent,index).fold((function(){append$2(parent,element)}),(function(v){before$2(v,element)}))},before$1=function(marker,elements){each$1(elements,(function(x){before$2(marker,x)}))},append$1=function(parent,elements){each$1(elements,(function(x){append$2(parent,x)}))},empty=function(element){element.dom.textContent="",each$1(children(element),(function(rogue){remove$5(rogue)}))},remove$5=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var children$1=children(wrapper);children$1.length>0&&before$1(wrapper,children$1),remove$5(wrapper)},get$9=function(_DOC){var doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=function(x,y,_DOC){var doc,win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},get$8=function(_win){var win=void 0===_win?window:_win;return detect$1().browser.isFirefox()?Optional.none():Optional.from(win.visualViewport)},bounds$1=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},getBounds$3=function(_win){var win=void 0===_win?window:_win,doc=win.document,scroll=get$9(SugarElement.fromDom(doc));return get$8(win).fold((function(){var html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds$1(scroll.left,scroll.top,width,height)}),(function(visualViewport){return bounds$1(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)}))},walkUp=function(navigation,doc){var frame;return navigation.view(doc).fold(constant$1([]),(function(f){var parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}))},pathTo=function(element,navigation){var d=navigation.owner(element),paths=walkUp(navigation,d);return Optional.some(paths)},view=function(doc){var _a,element;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner$3=function(element){return owner$4(element)},Navigation=Object.freeze({__proto__:null,view:view,owner:owner$3}),find$2=function(element){var doc=SugarElement.fromDom(document),scroll=get$9(doc),path;return pathTo(element,Navigation).fold(curry(absolute$3,element),(function(frames){var offset=viewport$1(element),r=foldr(frames,(function(b,a){var loc=viewport$1(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)}))},pointed=function(point,width,height){return{point:point,width:width,height:height}},rect=function(x,y,width,height){return{x:x,y:y,width:width,height:height}},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},box$1=function(element){var xy=absolute$3(element),w=getOuter$1(element),h=getOuter$2(element);return bounds(xy.left,xy.top,w,h)},absolute$2=function(element){var position=find$2(element),width=getOuter$1(element),height=getOuter$2(element);return bounds(position.left,position.top,width,height)},win=function(){return getBounds$3(window)},value$3=function(o){var or=function(_opt){return value$3(o)},orThunk=function(_f){return value$3(o)},map=function(f){return value$3(f(o))},mapError=function(_f){return value$3(o)},each=function(f){f(o)},bind=function(f){return f(o)},fold=function(_,onValue){return onValue(o)},exists=function(f){return f(o)},forall=function(f){return f(o)},toOptional=function(){return Optional.some(o)};return{isValue:always,isError:never,getOr:constant$1(o),getOrThunk:constant$1(o),getOrDie:constant$1(o),or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:each,bind:bind,exists:exists,forall:forall,toOptional:toOptional}},error$1=function(message){var getOrThunk,getOrDie,or,orThunk,map,mapError,bind,fold;return{isValue:never,isError:always,getOr:identity$1,getOrThunk:function(f){return f()},getOrDie:function(){return die(String(message))()},or:identity$1,orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error$1(message)},mapError:function(f){return error$1(f(message))},each:noop,bind:function(_f){return error$1(message)},exists:never,forall:always,toOptional:Optional.none}},fromOption=function(opt,err){return opt.fold((function(){return error$1(err)}),value$3)},Result={value:value$3,error:error$1,fromOption:fromOption},SimpleResultType;!function(SimpleResultType){SimpleResultType[SimpleResultType.Error=0]="Error",SimpleResultType[SimpleResultType.Value=1]="Value"}(SimpleResultType||(SimpleResultType={}));var fold$1=function(res,onError,onValue){return res.stype===SimpleResultType.Error?onError(res.serror):onValue(res.svalue)},partition$2,mapError,map,bind$1,bindError,svalue=function(v){return{stype:SimpleResultType.Value,svalue:v}},serror=function(e){return{stype:SimpleResultType.Error,serror:e}},toResult$1,fromResult$1,SimpleResult_fromResult=function(res){return res.fold(serror,svalue)},SimpleResult_toResult=function(res){return fold$1(res,Result.error,Result.value)},SimpleResult_svalue=svalue,SimpleResult_partition=function(results){var values=[],errors=[];return each$1(results,(function(obj){fold$1(obj,(function(err){return errors.push(err)}),(function(val){return values.push(val)}))})),{values:values,errors:errors}},SimpleResult_serror=serror,SimpleResult_bind=function(res,f){return res.stype===SimpleResultType.Value?f(res.svalue):res},SimpleResult_bindError=function(res,f){return res.stype===SimpleResultType.Error?f(res.serror):res},SimpleResult_map=function(res,f){return res.stype===SimpleResultType.Value?{stype:SimpleResultType.Value,svalue:f(res.svalue)}:res},SimpleResult_mapError=function(res,f){return res.stype===SimpleResultType.Error?{stype:SimpleResultType.Error,serror:f(res.serror)}:res},SimpleResult_fold=fold$1,field$2=function(key,newKey,presence,prop){return{tag:"field",key:key,newKey:newKey,presence:presence,prop:prop}},customField$1=function(newKey,instantiator){return{tag:"custom",newKey:newKey,instantiator:instantiator}},fold=function(value,ifField,ifCustom){switch(value.tag){case"field":return ifField(value.key,value.newKey,value.presence,value.prop);case"custom":return ifCustom(value.newKey,value.instantiator)}},shallow$1=function(old,nu){return nu},deep,baseMerge=function(merger){return function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)has$2(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}},deepMerge=baseMerge((function(old,nu){var bothObjects;return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu})),merge$1=baseMerge(shallow$1),required$2=function(){return{tag:"required",process:{}}},defaultedThunk=function(fallbackThunk){return{tag:"defaultedThunk",process:fallbackThunk}},defaulted$1=function(fallback){return defaultedThunk(constant$1(fallback))},asOption=function(){return{tag:"option",process:{}}},mergeWithThunk=function(baseThunk){return{tag:"mergeWithThunk",process:baseThunk}},mergeWith=function(base){return mergeWithThunk(constant$1(base))},mergeValues$1=function(values,base){return values.length>0?SimpleResult_svalue(deepMerge(base,merge$1.apply(void 0,values))):SimpleResult_svalue(base)},mergeErrors$1=function(errors){return compose(SimpleResult_serror,flatten)(errors)},consolidateObj,consolidateArr,ResultCombine_consolidateObj=function(objects,base){var partition=SimpleResult_partition(objects);return partition.errors.length>0?mergeErrors$1(partition.errors):mergeValues$1(partition.values,base)},ResultCombine_consolidateArr=function(objects){var partitions=SimpleResult_partition(objects);return partitions.errors.length>0?mergeErrors$1(partitions.errors):SimpleResult_svalue(partitions.values)},formatObj=function(input){return isObject(input)&&keys(input).length>100?" removed due to size":JSON.stringify(input,null,2)},formatErrors=function(errors){var es=errors.length>10?errors.slice(0,10).concat([{path:[],getErrorInfo:constant$1("... (only showing first ten failures)")}]):errors;return map$2(es,(function(e){return"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()}))},nu$a=function(path,getErrorInfo){return SimpleResult_serror([{path:path,getErrorInfo:getErrorInfo}])},missingRequired=function(path,key,obj){return nu$a(path,(function(){return'Could not find valid *required* value for "'+key+'" in '+formatObj(obj)}))},missingKey=function(path,key){return nu$a(path,(function(){return'Choice schema did not contain choice key: "'+key+'"'}))},missingBranch=function(path,branches,branch){return nu$a(path,(function(){return'The chosen schema: "'+branch+'" did not exist in branches: '+formatObj(branches)}))},unsupportedFields=function(path,unsupported){return nu$a(path,(function(){return"There are unsupported fields: ["+unsupported.join(", ")+"] specified"}))},custom=function(path,err){return nu$a(path,constant$1(err))},value$2=function(validator){var extract,toString;return{extract:function(path,val){return SimpleResult_bindError(validator(val),(function(err){return custom(path,err)}))},toString:constant$1("val")}},anyValue$1=value$2(SimpleResult_svalue),requiredAccess=function(path,obj,key,bundle){return get$e(obj,key).fold((function(){return missingRequired(path,key,obj)}),bundle)},fallbackAccess=function(obj,key,fallback,bundle){var v;return bundle(get$e(obj,key).getOrThunk((function(){return fallback(obj)})))},optionAccess=function(obj,key,bundle){return bundle(get$e(obj,key))},optionDefaultedAccess=function(obj,key,fallback,bundle){var opt;return bundle(get$e(obj,key).map((function(val){return!0===val?fallback(obj):val})))},extractField=function(field,path,obj,key,prop){var bundle=function(av){return prop.extract(path.concat([key]),av)},bundleAsOption=function(optValue){return optValue.fold((function(){return SimpleResult_svalue(Optional.none())}),(function(ov){var result=prop.extract(path.concat([key]),ov);return SimpleResult_map(result,Optional.some)}))};switch(field.tag){case"required":return requiredAccess(path,obj,key,bundle);case"defaultedThunk":return fallbackAccess(obj,key,field.process,bundle);case"option":return optionAccess(obj,key,bundleAsOption);case"defaultedOptionThunk":return optionDefaultedAccess(obj,key,field.process,bundleAsOption);case"mergeWithThunk":return fallbackAccess(obj,key,constant$1({}),(function(v){var result=deepMerge(field.process(obj),v);return bundle(result)}))}},extractFields=function(path,obj,fields){for(var success={},errors=[],_i=0,fields_1=fields;_i<fields_1.length;_i++){var field=fields_1[_i];fold(field,(function(key,newKey,presence,prop){var result=extractField(presence,path,obj,key,prop);SimpleResult_fold(result,(function(err){errors.push.apply(errors,err)}),(function(res){success[newKey]=res}))}),(function(newKey,instantiator){success[newKey]=instantiator(obj)}))}return errors.length>0?SimpleResult_serror(errors):SimpleResult_svalue(success)},valueThunk=function(getDelegate){var extract,toString;return{extract:function(path,val){return getDelegate().extract(path,val)},toString:function(){return getDelegate().toString()}}},getSetKeys=function(obj){return keys(filter$1(obj,isNonNullable))},objOfOnly=function(fields){var delegate=objOf(fields),fieldNames=foldr(fields,(function(acc,value){return fold(value,(function(key){var _a;return deepMerge(acc,((_a={})[key]=!0,_a))}),constant$1(acc))}),{}),extract;return{extract:function(path,o){var keys=isBoolean(o)?[]:getSetKeys(o),extra=filter$2(keys,(function(k){return!hasNonNullableKey(fieldNames,k)}));return 0===extra.length?delegate.extract(path,o):unsupportedFields(path,extra)},toString:delegate.toString}},objOf=function(values){var extract,toString;return{extract:function(path,o){return extractFields(path,o,values)},toString:function(){var fieldStrings;return"obj{\n"+map$2(values,(function(value){return fold(value,(function(key,_okey,_presence,prop){return key+" -> "+prop.toString()}),(function(newKey,_instantiator){return"state("+newKey+")"}))})).join("\n")+"}"}}},arrOf=function(prop){var extract,toString;return{extract:function(path,array){var results=map$2(array,(function(a,i){return prop.extract(path.concat(["["+i+"]"]),a)}));return ResultCombine_consolidateArr(results)},toString:function(){return"array("+prop.toString()+")"}}},oneOf=function(props){var extract,toString;return{extract:function(path,val){for(var errors=[],_i=0,props_1=props;_i<props_1.length;_i++){var prop,res=props_1[_i].extract(path,val);if(res.stype===SimpleResultType.Value)return res;errors.push(res)}return ResultCombine_consolidateArr(errors)},toString:function(){return"oneOf("+map$2(props,(function(prop){return prop.toString()})).join(", ")+")"}}},setOf$1=function(validator,prop){var validateKeys=function(path,keys){return arrOf(value$2(validator)).extract(path,keys)},extract,toString;return{extract:function(path,o){var keys$1=keys(o),validatedKeys=validateKeys(path,keys$1);return SimpleResult_bind(validatedKeys,(function(validKeys){var schema=map$2(validKeys,(function(vk){return field$2(vk,vk,{tag:"required",process:{}},prop)}));return objOf(schema).extract(path,o)}))},toString:function(){return"setOf("+prop.toString()+")"}}},thunk=function(_desc,processor){var getP=cached(processor),extract,toString;return{extract:function(path,val){return getP().extract(path,val)},toString:function(){return getP().toString()}}},arrOfObj=compose(arrOf,objOf),anyValue=constant$1(anyValue$1),typedValue=function(validator,expectedType){return value$2((function(a){var actualType=typeof a;return validator(a)?SimpleResult_svalue(a):SimpleResult_serror("Expected type: "+expectedType+" but got: "+actualType)}))},number=typedValue(isNumber,"number"),string=typedValue(isString,"string"),boolean=typedValue(isBoolean,"boolean"),functionProcessor=typedValue(isFunction,"function"),isPostMessageable=function(val){if(Object(val)!==val)return!0;switch({}.toString.call(val).slice(8,-1)){case"Boolean":case"Number":case"String":case"Date":case"RegExp":case"Blob":case"FileList":case"ImageData":case"ImageBitmap":case"ArrayBuffer":return!0;case"Array":case"Object":return Object.keys(val).every((function(prop){return isPostMessageable(val[prop])}));default:return!1}},postMessageable=value$2((function(a){return isPostMessageable(a)?SimpleResult_svalue(a):SimpleResult_serror("Expected value to be acceptable for sending via postMessage")})),chooseFrom=function(path,input,branches,ch){var fields;return get$e(branches,ch).fold((function(){return missingBranch(path,branches,ch)}),(function(vp){return vp.extract(path.concat(["branch: "+ch]),input)}))},choose$2=function(key,branches){var extract,toString;return{extract:function(path,input){var choice;return get$e(input,key).fold((function(){return missingKey(path,key)}),(function(chosen){return chooseFrom(path,input,branches,chosen)}))},toString:function(){return"chooseOn("+key+"). Possible values: "+keys(branches)}}},arrOfVal=function(){return arrOf(anyValue$1)},valueOf=function(validator){return value$2((function(v){return validator(v).fold(SimpleResult_serror,SimpleResult_svalue)}))},setOf=function(validator,prop){return setOf$1((function(v){return SimpleResult_fromResult(validator(v))}),prop)},extractValue=function(label,prop,obj){var res=prop.extract([label],obj);return SimpleResult_mapError(res,(function(errs){return{input:obj,errors:errs}}))},asRaw=function(label,prop,obj){return SimpleResult_toResult(extractValue(label,prop,obj))},getOrDie=function(extraction){return extraction.fold((function(errInfo){throw new Error(formatError(errInfo))}),identity$1)},asRawOrDie$1=function(label,prop,obj){return getOrDie(asRaw(label,prop,obj))},formatError=function(errInfo){return"Errors: \n"+formatErrors(errInfo.errors).join("\n")+"\n\nInput object: "+formatObj(errInfo.input)},choose$1=function(key,branches){return choose$2(key,map$1(branches,objOf))},thunkOf=function(desc,schema){return thunk(desc,schema)},field$1=field$2,customField=customField$1,validateEnum=function(values){return valueOf((function(value){return contains$2(values,value)?Result.value(value):Result.error('Unsupported value: "'+value+'", choose one of "'+values.join(", ")+'".')}))},required$1=function(key){return field$1(key,key,{tag:"required",process:{}},anyValue())},requiredOf=function(key,schema){return field$1(key,key,{tag:"required",process:{}},schema)},requiredNumber=function(key){return requiredOf(key,number)},requiredString=function(key){return requiredOf(key,string)},requiredStringEnum=function(key,values){return field$1(key,key,{tag:"required",process:{}},validateEnum(values))},requiredBoolean=function(key){return requiredOf(key,boolean)},requiredFunction=function(key){return requiredOf(key,functionProcessor)},forbid=function(key,message){return field$1(key,key,{tag:"option",process:{}},value$2((function(_v){return SimpleResult_serror("The field: "+key+" is forbidden. "+message)})))},requiredObjOf=function(key,objSchema){return field$1(key,key,{tag:"required",process:{}},objOf(objSchema))},requiredArrayOfObj=function(key,objFields){return field$1(key,key,{tag:"required",process:{}},arrOfObj(objFields))},requiredArrayOf=function(key,schema){return field$1(key,key,{tag:"required",process:{}},arrOf(schema))},option=function(key){return field$1(key,key,{tag:"option",process:{}},anyValue())},optionOf=function(key,schema){return field$1(key,key,{tag:"option",process:{}},schema)},optionNumber=function(key){return optionOf(key,number)},optionString=function(key){return optionOf(key,string)},optionFunction=function(key){return optionOf(key,functionProcessor)},optionArrayOf=function(key,schema){return optionOf(key,arrOf(schema))},optionObjOf=function(key,objSchema){return optionOf(key,objOf(objSchema))},optionObjOfOnly=function(key,objSchema){return optionOf(key,objOfOnly(objSchema))},defaulted=function(key,fallback){return field$1(key,key,defaulted$1(fallback),anyValue())},defaultedOf=function(key,fallback,schema){return field$1(key,key,defaulted$1(fallback),schema)},defaultedNumber=function(key,fallback){return defaultedOf(key,fallback,number)},defaultedString=function(key,fallback){return defaultedOf(key,fallback,string)},defaultedStringEnum=function(key,fallback,values){return defaultedOf(key,fallback,validateEnum(values))},defaultedBoolean=function(key,fallback){return defaultedOf(key,fallback,boolean)},defaultedFunction=function(key,fallback){return defaultedOf(key,fallback,functionProcessor)},defaultedPostMsg=function(key,fallback){return defaultedOf(key,fallback,postMessageable)},defaultedArrayOf=function(key,fallback,schema){return defaultedOf(key,fallback,arrOf(schema))},defaultedObjOf=function(key,fallback,objSchema){return defaultedOf(key,fallback,objOf(objSchema))},Cell=function(initial){var value=initial,get,set;return{get:function(){return value},set:function(v){value=v}}},generate$7,Adt_generate=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each$1(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches),allReqd;if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains$2(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}})),adt};Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var partition$1=function(results){var errors=[],values=[];return each$1(results,(function(result){result.fold((function(err){errors.push(err)}),(function(value){values.push(value)}))})),{errors:errors,values:values}},exclude$1=function(obj,fields){var r={};return each(obj,(function(v,k){contains$2(fields,k)||(r[k]=v)})),r},wrap$2=function(key,value){var _a;return(_a={})[key]=value,_a},wrapAll$1=function(keyvalues){var r={};return each$1(keyvalues,(function(kv){r[kv.key]=kv.value})),r},exclude=function(obj,fields){return exclude$1(obj,fields)},wrap$1=function(key,value){return wrap$2(key,value)},wrapAll=function(keyvalues){return wrapAll$1(keyvalues)},mergeValues=function(values,base){return 0===values.length?Result.value(base):Result.value(deepMerge(base,merge$1.apply(void 0,values)))},mergeErrors=function(errors){return Result.error(flatten(errors))},consolidate=function(objs,base){var partitions=partition$1(objs);return partitions.errors.length>0?mergeErrors(partitions.errors):mergeValues(partitions.values,base)},ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},ancestor$2=function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()},closest$4=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((function(){return stop(scope)?Optional.none():ancestor$2(scope,transform,stop)}))},isSource=function(component,simulatedEvent){return eq(component.element,simulatedEvent.event.target)},defaultEventHandler={can:always,abort:never,run:noop},nu$9=function(parts){if(!hasNonNullableKey(parts,"can")&&!hasNonNullableKey(parts,"abort")&&!hasNonNullableKey(parts,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(parts,null,2)+" does not have can, abort, or run!");return __assign(__assign({},defaultEventHandler),parts)},all$2=function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,(function(acc,handler){return acc&&f(handler).apply(void 0,args)}),!0)}},any=function(handlers,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return foldl(handlers,(function(acc,handler){return acc||f(handler).apply(void 0,args)}),!1)}},read$2=function(handler){return isFunction(handler)?{can:always,abort:never,run:handler}:handler},fuse$1=function(handlers){var can,abort,run;return{can:all$2(handlers,(function(handler){return handler.can})),abort:any(handlers,(function(handler){return handler.abort})),run:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];each$1(handlers,(function(handler){handler.run.apply(void 0,args)}))}}},constant=constant$1,touchstart=constant("touchstart"),touchmove=constant("touchmove"),touchend=constant("touchend"),touchcancel=constant("touchcancel"),mousedown=constant("mousedown"),mousemove=constant("mousemove"),mouseout=constant("mouseout"),mouseup=constant("mouseup"),mouseover=constant("mouseover"),focusin=constant("focusin"),focusout=constant("focusout"),keydown=constant("keydown"),keyup=constant("keyup"),input=constant("input"),change=constant("change"),click=constant("click"),transitioncancel=constant("transitioncancel"),transitionend=constant("transitionend"),transitionstart=constant("transitionstart"),selectstart=constant("selectstart"),prefixName=function(name){return constant$1("alloy."+name)},alloy={tap:prefixName("tap")},focus$4=prefixName("focus"),postBlur=prefixName("blur.post"),postPaste=prefixName("paste.post"),receive=prefixName("receive"),execute$5=prefixName("execute"),focusItem=prefixName("focus.item"),tap=alloy.tap,longpress=prefixName("longpress"),sandboxClose=prefixName("sandbox.close"),typeaheadCancel=prefixName("typeahead.cancel"),systemInit=prefixName("system.init"),documentTouchmove=prefixName("system.touchmove"),documentTouchend=prefixName("system.touchend"),windowScroll=prefixName("system.scroll"),windowResize=prefixName("system.resize"),attachedToDom=prefixName("system.attached"),detachedFromDom=prefixName("system.detached"),dismissRequested=prefixName("system.dismissRequested"),repositionRequested=prefixName("system.repositionRequested"),focusShifted=prefixName("focusmanager.shifted"),slotVisibility=prefixName("slotcontainer.visibility"),changeTab=prefixName("change.tab"),dismissTab=prefixName("dismiss.tab"),highlight$1=prefixName("highlight"),dehighlight$1=prefixName("dehighlight"),emit=function(component,event){dispatchWith(component,component.element,event,{})},emitWith=function(component,event,properties){dispatchWith(component,component.element,event,properties)},emitExecute=function(component){emit(component,execute$5())},dispatch=function(component,target,event){dispatchWith(component,target,event,{})},dispatchWith=function(component,target,event,properties){var data=__assign({target:target},properties);component.getSystem().triggerEvent(event,target,data)},dispatchEvent=function(component,target,event,simulatedEvent){component.getSystem().triggerEvent(event,target,simulatedEvent.event)},derive$2=function(configs){return wrapAll(configs)},abort=function(name,predicate){return{key:name,value:nu$9({abort:predicate})}},can=function(name,predicate){return{key:name,value:nu$9({can:predicate})}},preventDefault=function(name){return{key:name,value:nu$9({run:function(component,simulatedEvent){simulatedEvent.event.prevent()}})}},run$1=function(name,handler){return{key:name,value:nu$9({run:handler})}},runActionExtra=function(name,action,extra){return{key:name,value:nu$9({run:function(component,simulatedEvent){action.apply(void 0,[component,simulatedEvent].concat(extra))}})}},runOnName=function(name){return function(handler){return run$1(name,handler)}},runOnSourceName=function(name){return function(handler){return{key:name,value:nu$9({run:function(component,simulatedEvent){isSource(component,simulatedEvent)&&handler(component,simulatedEvent)}})}}},redirectToUid=function(name,uid){return run$1(name,(function(component,simulatedEvent){component.getSystem().getByUid(uid).each((function(redirectee){dispatchEvent(redirectee,redirectee.element,name,simulatedEvent)}))}))},redirectToPart=function(name,detail,partName){var uid=detail.partUids[partName];return redirectToUid(name,uid)},runWithTarget=function(name,f){return run$1(name,(function(component,simulatedEvent){var ev=simulatedEvent.event,target=component.getSystem().getByDom(ev.target).getOrThunk((function(){var closest;return closest$4(ev.target,(function(el){return component.getSystem().getByDom(el).toOptional()}),never).getOr(component)}));f(component,target,simulatedEvent)}))},cutter=function(name){return run$1(name,(function(component,simulatedEvent){simulatedEvent.cut()}))},stopper=function(name){return run$1(name,(function(component,simulatedEvent){simulatedEvent.stop()}))},runOnSource=function(name,f){return runOnSourceName(name)(f)},runOnAttached=runOnSourceName(attachedToDom()),runOnDetached=runOnSourceName(detachedFromDom()),runOnInit=runOnSourceName(systemInit()),runOnExecute$1=runOnName(execute$5()),fromHtml$1=function(html,scope){var doc,div=(scope||document).createElement("div");return div.innerHTML=html,children(SugarElement.fromDom(div))},get$7=function(element){return element.dom.innerHTML},set$5=function(element,content){var owner,docDom=owner$4(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=fromHtml$1(content,docDom);append$1(fragment,contentElements),empty(element),append$2(element,fragment)},getOuter=function(element){var container=SugarElement.fromTag("div"),clone=SugarElement.fromDom(element.dom.cloneNode(!0));return append$2(container,clone),get$7(container)},clone$1=function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))},shallow=function(original){return clone$1(original,!1)},getHtml=function(element){if(isShadowRoot(element))return"#shadow-root";var clone=shallow(element);return getOuter(clone)},element=function(elem){return getHtml(elem)},isRecursive=function(component,originator,target){return eq(originator,component.element)&&!eq(originator,target)},events$i=derive$2([can(focus$4(),(function(component,simulatedEvent){var event=simulatedEvent.event,originator=event.originator,target=event.target;return!isRecursive(component,originator,target)||(console.warn(focus$4()+" did not get interpreted by the desired target. \nOriginator: "+element(originator)+"\nTarget: "+element(target)+"\nCheck the "+focus$4()+" event handlers"),!1)}))]),DefaultEvents=Object.freeze({__proto__:null,events:events$i}),unique=0,generate$6=function(prefix){var date,time=(new Date).getTime(),random;return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},prefix$1=constant$1("alloy-id-"),idAttr$1=constant$1("data-alloy-id"),prefix=prefix$1(),idAttr=idAttr$1(),write=function(label,elem){var id=generate$6(prefix+label);return writeOnly(elem,id),id},writeOnly=function(elem,uid){Object.defineProperty(elem.dom,idAttr,{value:uid,writable:!0})},read$1=function(elem){var id=isElement$2(elem)?elem.dom[idAttr]:null;return Optional.from(id)},generate$5=function(prefix){return generate$6(prefix)},make$8=identity$1,NoContextApi=function(getComp){var getMessage=function(event){return"The component must be in a context to execute: "+event+(getComp?"\n"+element(getComp().element)+" is not in context.":"")},fail=function(event){return function(){throw new Error(getMessage(event))}},warn=function(event){return function(){console.warn(getMessage(event))}};return{debugInfo:constant$1("fake"),triggerEvent:warn("triggerEvent"),triggerFocus:warn("triggerFocus"),triggerEscape:warn("triggerEscape"),broadcast:warn("broadcast"),broadcastOn:warn("broadcastOn"),broadcastEvent:warn("broadcastEvent"),build:fail("build"),addToWorld:fail("addToWorld"),removeFromWorld:fail("removeFromWorld"),addToGui:fail("addToGui"),removeFromGui:fail("removeFromGui"),getByUid:fail("getByUid"),getByDom:fail("getByDom"),isConnected:never}},singleton$1=NoContextApi(),markAsBehaviourApi=function(f,apiName,apiFunction){var delegate=apiFunction.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:apiName,parameters:cleanParameters(parameters.slice(0,1).concat(parameters.slice(3)))}},f},cleanParameters=function(parameters){return map$2(parameters,(function(p){return endsWith(p,"/*")?p.substring(0,p.length-"/*".length):p}))},markAsExtraApi=function(f,extraName){var delegate=f.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:extraName,parameters:cleanParameters(parameters)}},f},markAsSketchApi=function(f,apiFunction){var delegate=apiFunction.toString(),endIndex=delegate.indexOf(")")+1,openBracketIndex=delegate.indexOf("("),parameters=delegate.substring(openBracketIndex+1,endIndex-1).split(/,\s*/);return f.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:cleanParameters(parameters.slice(1))}},f},premadeTag=generate$6("alloy-premade"),premade$1=function(comp){return wrap$1(premadeTag,comp)},getPremade=function(spec){return get$e(spec,premadeTag)},makeApi=function(f){return markAsSketchApi((function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];return f.apply(void 0,__spreadArray([component.getApis(),component],rest,!1))}),f)},NoState={init:function(){return nu$8({readState:constant$1("No State required")})}},nu$8=function(spec){return spec},generateFrom$1=function(spec,all){var schema=map$2(all,(function(a){return optionObjOf(a.name(),[required$1("config"),defaulted("state",NoState)])})),validated=asRaw("component.behaviours",objOf(schema),spec.behaviours).fold((function(errInfo){throw new Error(formatError(errInfo)+"\nComplete spec:\n"+JSON.stringify(spec,null,2))}),identity$1);return{list:all,data:map$1(validated,(function(optBlobThunk){var output=optBlobThunk.map((function(blob){return{config:blob.config,state:blob.state.init(blob.config)}}));return constant$1(output)}))}},getBehaviours$3=function(bData){return bData.list},getData$2=function(bData){return bData.data},byInnerKey=function(data,tuple){var r={};return each(data,(function(detail,key){each(detail,(function(value,indexKey){var chain=get$e(r,indexKey).getOr([]);r[indexKey]=chain.concat([tuple(key,value)])}))})),r},nu$7=function(s){return{classes:isUndefined(s.classes)?[]:s.classes,attributes:isUndefined(s.attributes)?{}:s.attributes,styles:isUndefined(s.styles)?{}:s.styles}},merge=function(defnA,mod){return __assign(__assign({},defnA),{attributes:__assign(__assign({},defnA.attributes),mod.attributes),styles:__assign(__assign({},defnA.styles),mod.styles),classes:defnA.classes.concat(mod.classes)})},combine$2=function(info,baseMod,behaviours,base){var modsByBehaviour=__assign({},baseMod);each$1(behaviours,(function(behaviour){modsByBehaviour[behaviour.name()]=behaviour.exhibit(info,base)}));var byAspect=byInnerKey(modsByBehaviour,(function(name,modification){return{name:name,modification:modification}})),combineObjects=function(objects){return foldr(objects,(function(b,a){return __assign(__assign({},a.modification),b)}),{})},combinedClasses=foldr(byAspect.classes,(function(b,a){return a.modification.concat(b)}),[]),combinedAttributes=combineObjects(byAspect.attributes),combinedStyles=combineObjects(byAspect.styles);return nu$7({classes:combinedClasses,attributes:combinedAttributes,styles:combinedStyles})},sortKeys=function(label,keyName,array,order){try{var sorted=sort(array,(function(a,b){var aKey=a[keyName],bKey=b[keyName],aIndex=order.indexOf(aKey),bIndex=order.indexOf(bKey);if(-1===aIndex)throw new Error("The ordering for "+label+" does not have an entry for "+aKey+".\nOrder specified: "+JSON.stringify(order,null,2));if(-1===bIndex)throw new Error("The ordering for "+label+" does not have an entry for "+bKey+".\nOrder specified: "+JSON.stringify(order,null,2));return aIndex<bIndex?-1:bIndex<aIndex?1:0}));return Result.value(sorted)}catch(err){return Result.error([err])}},uncurried=function(handler,purpose){return{handler:handler,purpose:purpose}},curried=function(handler,purpose){return{cHandler:handler,purpose:purpose}},curryArgs=function(descHandler,extraArgs){return curried(curry.apply(void 0,[descHandler.handler].concat(extraArgs)),descHandler.purpose)},getCurried=function(descHandler){return descHandler.cHandler},behaviourTuple=function(name,handler){return{name:name,handler:handler}},nameToHandlers=function(behaviours,info){var r={};return each$1(behaviours,(function(behaviour){r[behaviour.name()]=behaviour.handlers(info)})),r},groupByEvents=function(info,behaviours,base){var behaviourEvents=__assign(__assign({},base),nameToHandlers(behaviours,info));return byInnerKey(behaviourEvents,behaviourTuple)},combine$1=function(info,eventOrder,behaviours,base){var byEventName=groupByEvents(info,behaviours,base);return combineGroups(byEventName,eventOrder)},assemble=function(rawHandler){var handler=read$2(rawHandler);return function(component,simulatedEvent){for(var rest=[],_i=2;_i<arguments.length;_i++)rest[_i-2]=arguments[_i];var args=[component,simulatedEvent].concat(rest);handler.abort.apply(void 0,args)?simulatedEvent.stop():handler.can.apply(void 0,args)&&handler.run.apply(void 0,args)}},missingOrderError=function(eventName,tuples){return Result.error(["The event ("+eventName+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(map$2(tuples,(function(c){return c.name})),null,2)])},fuse=function(tuples,eventOrder,eventName){var order=eventOrder[eventName];return order?sortKeys("Event: "+eventName,"name",tuples,order).map((function(sortedTuples){var handlers=map$2(sortedTuples,(function(tuple){return tuple.handler}));return fuse$1(handlers)})):missingOrderError(eventName,tuples)},combineGroups=function(byEventName,eventOrder){var r=mapToArray(byEventName,(function(tuples,eventName){var combined;return(1===tuples.length?Result.value(tuples[0].handler):fuse(tuples,eventOrder,eventName)).map((function(handler){var assembled=assemble(handler),purpose=tuples.length>1?filter$2(eventOrder[eventName],(function(o){return exists(tuples,(function(t){return t.name===o}))})).join(" > "):tuples[0].name;return wrap$1(eventName,uncurried(assembled,purpose))}))}));return consolidate(r,{})},_a$2,baseBehaviour="alloy.base.behaviour",schema$z=objOf([field$1("dom","dom",{tag:"required",process:{}},objOf([required$1("tag"),defaulted("styles",{}),defaulted("classes",[]),defaulted("attributes",{}),option("value"),option("innerHtml")])),required$1("components"),required$1("uid"),defaulted("events",{}),defaulted("apis",{}),field$1("eventOrder","eventOrder",mergeWith((_a$2={},_a$2[execute$5()]=["disabling",baseBehaviour,"toggling","typeaheadevents"],_a$2[focus$4()]=[baseBehaviour,"focusing","keying"],_a$2[systemInit()]=[baseBehaviour,"disabling","toggling","representing"],_a$2[input()]=[baseBehaviour,"representing","streaming","invalidating"],_a$2[detachedFromDom()]=[baseBehaviour,"representing","item-events","tooltipping"],_a$2[mousedown()]=["focusing",baseBehaviour,"item-type-events"],_a$2[touchstart()]=["focusing",baseBehaviour,"item-type-events"],_a$2[mouseover()]=["item-type-events","tooltipping"],_a$2[receive()]=["receiving","reflecting","tooltipping"],_a$2)),anyValue()),option("domModification")]),toInfo=function(spec){return asRaw("custom.definition",schema$z,spec)},toDefinition=function(detail){return __assign(__assign({},detail.dom),{uid:detail.uid,domChildren:map$2(detail.components,(function(comp){return comp.element}))})},toModification=function(detail){return detail.domModification.fold((function(){return nu$7({})}),nu$7)},toEvents=function(info){return info.events},read=function(element,attr){var value=get$d(element,attr);return void 0===value||""===value?[]:value.split(" ")},add$4=function(element,attr,id){var old,nu=read(element,attr).concat([id]);return set$8(element,attr,nu.join(" ")),!0},remove$4=function(element,attr,id){var nu=filter$2(read(element,attr),(function(v){return v!==id}));return nu.length>0?set$8(element,attr,nu.join(" ")):remove$7(element,attr),!1},supports=function(element){return void 0!==element.dom.classList},get$6=function(element){return read(element,"class")},add$3=function(element,clazz){return add$4(element,"class",clazz)},remove$3=function(element,clazz){return remove$4(element,"class",clazz)},add$2=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$3(element,clazz)},cleanClass=function(element){var classList;0===(supports(element)?element.dom.classList:get$6(element)).length&&remove$7(element,"class")},remove$2=function(element,clazz){var classList;supports(element)?element.dom.classList.remove(clazz):remove$3(element,clazz);cleanClass(element)},has=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},add$1=function(element,classes){each$1(classes,(function(x){add$2(element,x)}))},remove$1=function(element,classes){each$1(classes,(function(x){remove$2(element,x)}))},hasAll=function(element,classes){return forall(classes,(function(clazz){return has(element,clazz)}))},get$5=function(element){return element.dom.value},set$4=function(element,value){if(void 0===value)throw new Error("Value.set was undefined");element.dom.value=value},renderToDom=function(definition){var subject=SugarElement.fromTag(definition.tag);setAll$1(subject,definition.attributes),add$1(subject,definition.classes),setAll(subject,definition.styles),definition.innerHtml.each((function(html){return set$5(subject,html)}));var children=definition.domChildren;return append$1(subject,children),definition.value.each((function(value){set$4(subject,value)})),definition.uid,writeOnly(subject,definition.uid),subject},getBehaviours$2=function(spec){var behaviours=get$e(spec,"behaviours").getOr({});return bind$3(keys(behaviours),(function(name){var behaviour=behaviours[name];return isNonNullable(behaviour)?[behaviour.me]:[]}))},generateFrom=function(spec,all){return generateFrom$1(spec,all)},generate$4=function(spec){var all=getBehaviours$2(spec);return generateFrom(spec,all)},getDomDefinition=function(info,bList,bData){var definition=toDefinition(info),infoModification=toModification(info),baseModification={"alloy.base.modification":infoModification},modification=bList.length>0?combine$2(bData,baseModification,bList,definition):infoModification;return merge(definition,modification)},getEvents=function(info,bList,bData){var baseEvents={"alloy.base.behaviour":toEvents(info)};return combine$1(bData,info.eventOrder,bList,baseEvents).getOrDie()},build$2=function(spec){var getMe=function(){return me},systemApi=Cell(singleton$1),info=getOrDie(toInfo(spec)),bBlob=generate$4(spec),bList=getBehaviours$3(bBlob),bData=getData$2(bBlob),modDefinition=getDomDefinition(info,bList,bData),item=renderToDom(modDefinition),events=getEvents(info,bList,bData),subcomponents=Cell(info.components),connect=function(newApi){systemApi.set(newApi)},disconnect=function(){systemApi.set(NoContextApi(getMe))},syncComponents=function(){var children$1=children(item),subs=bind$3(children$1,(function(child){return systemApi.get().getByDom(child).fold((function(){return[]}),pure$2)}));subcomponents.set(subs)},config=function(behaviour){var b=bData,f;return(isFunction(b[behaviour.name()])?b[behaviour.name()]:function(){throw new Error("Could not find "+behaviour.name()+" in "+JSON.stringify(spec,null,2))})()},hasConfigured=function(behaviour){return isFunction(bData[behaviour.name()])},getApis=function(){return info.apis},readState=function(behaviourName){return bData[behaviourName]().map((function(b){return b.state.readState()})).getOr("not enabled")},me={uid:spec.uid,getSystem:systemApi.get,config:config,hasConfigured:hasConfigured,spec:spec,readState:readState,getApis:getApis,connect:connect,disconnect:disconnect,element:item,syncComponents:syncComponents,components:subcomponents.get,events:events};return me},buildSubcomponents=function(spec){var components=get$e(spec,"components").getOr([]);return map$2(components,build$1)},buildFromSpec=function(userSpec){var _a=make$8(userSpec),specEvents=_a.events,spec=__rest(_a,["events"]),components=buildSubcomponents(spec),completeSpec=__assign(__assign({},spec),{events:__assign(__assign({},DefaultEvents),specEvents),components:components});return Result.value(build$2(completeSpec))},text=function(textContent){var element=SugarElement.fromText(textContent);return external$2({element:element})},external$2=function(spec){var extSpec=asRawOrDie$1("external.component",objOfOnly([required$1("element"),option("uid")]),spec),systemApi=Cell(NoContextApi()),connect=function(newApi){systemApi.set(newApi)},disconnect=function(){systemApi.set(NoContextApi((function(){return me})))},uid=extSpec.uid.getOrThunk((function(){return generate$5("external")}));writeOnly(extSpec.element,uid);var me={uid:uid,getSystem:systemApi.get,config:Optional.none,hasConfigured:never,connect:connect,disconnect:disconnect,getApis:function(){return{}},element:extSpec.element,spec:spec,readState:constant$1("No state"),syncComponents:noop,components:constant$1([]),events:{}};return premade$1(me)},uids=generate$5,isSketchSpec$1=function(spec){return has$2(spec,"uid")},build$1=function(spec){return getPremade(spec).getOrThunk((function(){var userSpecWithUid=isSketchSpec$1(spec)?spec:__assign({uid:uids("")},spec);return buildFromSpec(userSpecWithUid).getOrDie()}))},premade=premade$1;function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var ancestor$1=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest$3=function(scope,predicate,isRoot){var is;return ClosestOrAncestor((function(s,test){return test(s)}),ancestor$1,scope,predicate,isRoot)},child$1=function(scope,predicate){var pred=function(node){return predicate(SugarElement.fromDom(node))},result;return find$5(scope.dom.childNodes,pred).map(SugarElement.fromDom)},descendant$1=function(scope,predicate){var descend=function(node){for(var i=0;i<node.childNodes.length;i++){var child_1=SugarElement.fromDom(node.childNodes[i]);if(predicate(child_1))return Optional.some(child_1);var res=descend(node.childNodes[i]);if(res.isSome())return res}return Optional.none()};return descend(scope.dom)},closest$2=function(scope,predicate,isRoot){return closest$3(scope,predicate,isRoot).isSome()},ancestor=function(scope,selector,isRoot){return ancestor$1(scope,(function(e){return is(e,selector)}),isRoot)},child=function(scope,selector){return child$1(scope,(function(e){return is(e,selector)}))},descendant=function(scope,selector){return one(selector,scope)},closest$1=function(scope,selector,isRoot){var is$1;return ClosestOrAncestor((function(element,selector){return is(element,selector)}),ancestor,scope,selector,isRoot)},find$1=function(queryElem){var dependent;return closest$3(queryElem,(function(elem){if(!isElement$2(elem))return!1;var id=get$d(elem,"id");return void 0!==id&&id.indexOf("aria-owns")>-1})).bind((function(dep){var id=get$d(dep,"id"),dos=getRootNode(dep);return descendant(dos,'[aria-owns="'+id+'"]')}))},manager=function(){var ariaId=generate$6("aria-owns"),link,unlink;return{id:ariaId,link:function(elem){set$8(elem,"aria-owns",ariaId)},unlink:function(elem){remove$7(elem,"aria-owns")}}},isAriaPartOf=function(component,queryElem){return find$1(queryElem).exists((function(owner){return isPartOf$1(component,owner)}))},isPartOf$1=function(component,queryElem){return closest$2(queryElem,(function(el){return eq(el,component.element)}),never)||isAriaPartOf(component,queryElem)},unknown="unknown",EventConfiguration;!function(EventConfiguration){EventConfiguration[EventConfiguration.STOP=0]="STOP",EventConfiguration[EventConfiguration.NORMAL=1]="NORMAL",EventConfiguration[EventConfiguration.LOGGING=2]="LOGGING"}(EventConfiguration||(EventConfiguration={}));var eventConfig=Cell({}),makeEventLogger=function(eventName,initialTarget){var sequence=[],startTime=(new Date).getTime();return{logEventCut:function(_name,target,purpose){sequence.push({outcome:"cut",target:target,purpose:purpose})},logEventStopped:function(_name,target,purpose){sequence.push({outcome:"stopped",target:target,purpose:purpose})},logNoParent:function(_name,target,purpose){sequence.push({outcome:"no-parent",target:target,purpose:purpose})},logEventNoHandlers:function(_name,target){sequence.push({outcome:"no-handlers-left",target:target})},logEventResponse:function(_name,target,purpose){sequence.push({outcome:"response",purpose:purpose,target:target})},write:function(){var finishTime=(new Date).getTime();contains$2(["mousemove","mouseover","mouseout",systemInit()],eventName)||console.log(eventName,{event:eventName,time:finishTime-startTime,target:initialTarget.dom,sequence:map$2(sequence,(function(s){return contains$2(["cut","stopped","response"],s.outcome)?"{"+s.purpose+"} "+s.outcome+" at ("+element(s.target)+")":s.outcome}))})}}},processEvent=function(eventName,initialTarget,f){var status;switch(get$e(eventConfig.get(),eventName).orThunk((function(){var patterns=keys(eventConfig.get());return findMap(patterns,(function(p){return eventName.indexOf(p)>-1?Optional.some(eventConfig.get()[p]):Optional.none()}))})).getOr(EventConfiguration.NORMAL)){case EventConfiguration.NORMAL:return f(noLogger());case EventConfiguration.LOGGING:var logger=makeEventLogger(eventName,initialTarget),output=f(logger);return logger.write(),output;case EventConfiguration.STOP:return!0}},path=["alloy/data/Fields","alloy/debugging/Debugging"],getTrace=function(){var err=new Error;if(void 0!==err.stack){var lines=err.stack.split("\n");return find$5(lines,(function(line){return line.indexOf("alloy")>0&&!exists(path,(function(p){return line.indexOf(p)>-1}))})).getOr(unknown)}return unknown},ignoreEvent,monitorEvent=function(eventName,initialTarget,f){return processEvent(eventName,initialTarget,f)},noLogger=constant$1({logEventCut:noop,logEventStopped:noop,logNoParent:noop,logEventNoHandlers:noop,logEventResponse:noop,write:noop}),menuFields=constant$1([required$1("menu"),required$1("selectedMenu")]),itemFields=constant$1([required$1("item"),required$1("selectedItem")]);constant$1(objOf(itemFields().concat(menuFields())));var itemSchema$3=constant$1(objOf(itemFields())),_initSize=requiredObjOf("initSize",[required$1("numColumns"),required$1("numRows")]),itemMarkers=function(){return requiredOf("markers",itemSchema$3())},tieredMenuMarkers=function(){return requiredObjOf("markers",[required$1("backgroundMenu")].concat(menuFields()).concat(itemFields()))},markers$1=function(required){return requiredObjOf("markers",map$2(required,required$1))},onPresenceHandler=function(label,fieldName,presence){return getTrace(),field$1(fieldName,fieldName,presence,valueOf((function(f){return Result.value((function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f.apply(void 0,args)}))})))},onHandler=function(fieldName){return onPresenceHandler("onHandler",fieldName,defaulted$1(noop))},onKeyboardHandler=function(fieldName){return onPresenceHandler("onKeyboardHandler",fieldName,defaulted$1(Optional.none))},onStrictHandler=function(fieldName){return onPresenceHandler("onHandler",fieldName,{tag:"required",process:{}})},onStrictKeyboardHandler=function(fieldName){return onPresenceHandler("onKeyboardHandler",fieldName,{tag:"required",process:{}})},output$1=function(name,value){return customField(name,constant$1(value))},snapshot=function(name){return customField(name,identity$1)},initSize=constant$1(_initSize),nu$6=function(x,y,bubble,direction,placement,boundsRestriction,labelPrefix,alwaysFit){return void 0===alwaysFit&&(alwaysFit=!1),{x:x,y:y,bubble:bubble,direction:direction,placement:placement,restriction:boundsRestriction,label:labelPrefix+"-"+placement,alwaysFit:alwaysFit}},adt$a=Adt_generate([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),cata$2=function(subject,southeast,southwest,northeast,northwest,south,north,east,west){return subject.fold(southeast,southwest,northeast,northwest,south,north,east,west)},cataVertical=function(subject,south,middle,north){return subject.fold(south,south,north,north,south,north,middle,middle)},cataHorizontal=function(subject,east,middle,west){return subject.fold(east,west,east,west,middle,middle,east,west)},southeast$3=adt$a.southeast,southwest$3=adt$a.southwest,northeast$3=adt$a.northeast,northwest$3=adt$a.northwest,south$3=adt$a.south,north$3=adt$a.north,east$3=adt$a.east,west$3=adt$a.west,cycleBy=function(value,delta,min,max){var r=value+delta;return r>max?min:r<min?max:r},clamp$1=function(value,min,max){return Math.min(Math.max(value,min),max)},getRestriction=function(anchor,restriction){switch(restriction){case 1:return anchor.x;case 0:return anchor.x+anchor.width;case 2:return anchor.y;case 3:return anchor.y+anchor.height}},boundsRestriction=function(anchor,restrictions){return mapToObject(["left","right","top","bottom"],(function(dir){return get$e(restrictions,dir).map((function(restriction){return getRestriction(anchor,restriction)}))}))},adjustBounds=function(bounds$1,restriction,bubbleOffset){var applyRestriction=function(dir,current){return restriction[dir].map((function(pos){var isVerticalAxis="top"===dir||"bottom"===dir,offset=isVerticalAxis?bubbleOffset.top:bubbleOffset.left,comparator,newPos=("left"===dir||"top"===dir?Math.max:Math.min)(pos,current)+offset;return isVerticalAxis?clamp$1(newPos,bounds$1.y,bounds$1.bottom):clamp$1(newPos,bounds$1.x,bounds$1.right)})).getOr(current)},adjustedLeft=applyRestriction("left",bounds$1.x),adjustedTop=applyRestriction("top",bounds$1.y),adjustedRight=applyRestriction("right",bounds$1.right),adjustedBottom=applyRestriction("bottom",bounds$1.bottom);return bounds(adjustedLeft,adjustedTop,adjustedRight-adjustedLeft,adjustedBottom-adjustedTop)},labelPrefix$2="layout",eastX$1=function(anchor){return anchor.x},middleX$1=function(anchor,element){return anchor.x+anchor.width/2-element.width/2},westX$1=function(anchor,element){return anchor.x+anchor.width-element.width},northY$2=function(anchor,element){return anchor.y-element.height},southY$2=function(anchor){return anchor.y+anchor.height},centreY$1=function(anchor,element){return anchor.y+anchor.height/2-element.height/2},eastEdgeX$1=function(anchor){return anchor.x+anchor.width},westEdgeX$1=function(anchor,element){return anchor.x-element.width},southeast$2=function(anchor,element,bubbles){return nu$6(eastX$1(anchor),southY$2(anchor),bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:1,top:3}),"layout")},southwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),southY$2(anchor),bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:0,top:3}),"layout")},northeast$2=function(anchor,element,bubbles){return nu$6(eastX$1(anchor),northY$2(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:1,bottom:2}),"layout")},northwest$2=function(anchor,element,bubbles){return nu$6(westX$1(anchor,element),northY$2(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:0,bottom:2}),"layout")},north$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),northY$2(anchor,element),bubbles.north(),north$3(),"north",boundsRestriction(anchor,{bottom:2}),"layout")},south$2=function(anchor,element,bubbles){return nu$6(middleX$1(anchor,element),southY$2(anchor),bubbles.south(),south$3(),"south",boundsRestriction(anchor,{top:3}),"layout")},east$2=function(anchor,element,bubbles){return nu$6(eastEdgeX$1(anchor),centreY$1(anchor,element),bubbles.east(),east$3(),"east",boundsRestriction(anchor,{left:0}),"layout")},west$2=function(anchor,element,bubbles){return nu$6(westEdgeX$1(anchor,element),centreY$1(anchor,element),bubbles.west(),west$3(),"west",boundsRestriction(anchor,{right:1}),"layout")},all$1=function(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2,east$2,west$2]},allRtl$1=function(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2,east$2,west$2]},aboveOrBelow=function(){return[northeast$2,northwest$2,southeast$2,southwest$2,north$2,south$2]},aboveOrBelowRtl=function(){return[northwest$2,northeast$2,southwest$2,southeast$2,north$2,south$2]},belowOrAbove=function(){return[southeast$2,southwest$2,northeast$2,northwest$2,south$2,north$2]},belowOrAboveRtl=function(){return[southwest$2,southeast$2,northwest$2,northeast$2,south$2,north$2]},chooseChannels=function(channels,message){return message.universal?channels:filter$2(channels,(function(ch){return contains$2(message.channels,ch)}))},events$h=function(receiveConfig){return derive$2([run$1(receive(),(function(component,message){var channelMap=receiveConfig.channels,channels=keys(channelMap),receivingData=message,targetChannels=chooseChannels(channels,receivingData);each$1(targetChannels,(function(ch){var channelInfo=channelMap[ch],channelSchema=channelInfo.schema,data=asRawOrDie$1("channel["+ch+"] data\nReceiver: "+element(component.element),channelSchema,receivingData.data);channelInfo.onReceive(component,data)}))}))])},ActiveReceiving=Object.freeze({__proto__:null,events:events$h}),ReceivingSchema=[requiredOf("channels",setOf(Result.value,objOfOnly([onStrictHandler("onReceive"),defaulted("schema",anyValue())])))],executeEvent=function(bConfig,bState,executor){return runOnExecute$1((function(component){executor(component,bConfig,bState)}))},loadEvent=function(bConfig,bState,f){return runOnInit((function(component,_simulatedEvent){f(component,bConfig,bState)}))},create$8=function(schema,name,active,apis,extra,state){var configSchema=objOfOnly(schema),schemaSchema=optionObjOf(name,[optionObjOfOnly("config",schema)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state)},createModes$1=function(modes,name,active,apis,extra,state){var configSchema=modes,schemaSchema=optionObjOf(name,[optionOf("config",modes)]);return doCreate(configSchema,schemaSchema,name,active,apis,extra,state)},wrapApi=function(bName,apiFunction,apiName){var f;return markAsBehaviourApi((function(component){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var args=[component].concat(rest);return component.config({name:constant$1(bName)}).fold((function(){throw new Error("We could not find any behaviour configuration for: "+bName+". Using API: "+apiName)}),(function(info){var rest=Array.prototype.slice.call(args,1);return apiFunction.apply(void 0,[component,info.config,info.state].concat(rest))}))}),apiName,apiFunction)},revokeBehaviour=function(name){return{key:name,value:void 0}},doCreate=function(configSchema,schemaSchema,name,active,apis,extra,state){var getConfig=function(info){return hasNonNullableKey(info,name)?info[name]():Optional.none()},wrappedApis=map$1(apis,(function(apiF,apiName){return wrapApi(name,apiF,apiName)})),wrappedExtra=map$1(extra,(function(extraF,extraName){return markAsExtraApi(extraF,extraName)})),me=__assign(__assign(__assign({},wrappedExtra),wrappedApis),{revoke:curry(revokeBehaviour,name),config:function(spec){var prepared=asRawOrDie$1(name+"-config",configSchema,spec);return{key:name,value:{config:prepared,me:me,configAsRaw:cached((function(){return asRawOrDie$1(name+"-config",configSchema,spec)})),initialConfig:spec,state:state}}},schema:constant$1(schemaSchema),exhibit:function(info,base){return lift2(getConfig(info),get$e(active,"exhibit"),(function(behaviourInfo,exhibitor){return exhibitor(base,behaviourInfo.config,behaviourInfo.state)})).getOrThunk((function(){return nu$7({})}))},name:constant$1(name),handlers:function(info){return getConfig(info).map((function(behaviourInfo){var getEvents;return get$e(active,"events").getOr((function(){return{}}))(behaviourInfo.config,behaviourInfo.state)})).getOr({})}});return me},derive$1=function(capabilities){return wrapAll(capabilities)},simpleSchema=objOfOnly([required$1("fields"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),create$7=function(data){var value=asRawOrDie$1("Creating behaviour: "+data.name,simpleSchema,data);return create$8(value.fields,value.name,value.active,value.apis,value.extra,value.state)},modeSchema=objOfOnly([required$1("branchKey"),required$1("branches"),required$1("name"),defaulted("active",{}),defaulted("apis",{}),defaulted("state",NoState),defaulted("extra",{})]),createModes=function(data){var value=asRawOrDie$1("Creating behaviour: "+data.name,modeSchema,data);return createModes$1(choose$1(value.branchKey,value.branches),value.name,value.active,value.apis,value.extra,value.state)},revoke=constant$1(void 0),Receiving=create$7({fields:ReceivingSchema,name:"receiving",active:ActiveReceiving}),exhibit$6=function(base,posConfig){return nu$7({classes:[],styles:posConfig.useFixed()?{}:{position:"relative"}})},ActivePosition=Object.freeze({__proto__:null,exhibit:exhibit$6}),getDocument=function(){return SugarElement.fromDom(document)},focus$3=function(element){return element.dom.focus()},blur$1=function(element){return element.dom.blur()},hasFocus=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},active=function(root){return void 0===root&&(root=getDocument()),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},search=function(element){return active(getRootNode(element)).filter((function(e){return element.dom.contains(e.dom)}))},preserve$1=function(f,container){var dos=getRootNode(container),refocus=active(dos).bind((function(focused){var hasFocus=function(elem){return eq(focused,elem)};return hasFocus(container)?Optional.some(container):descendant$1(container,hasFocus)})),result=f(container);return refocus.each((function(oldFocus){active(dos).filter((function(newFocus){return eq(newFocus,oldFocus)})).fold((function(){focus$3(oldFocus)}),noop)})),result},NuPositionCss=function(position,left,top,right,bottom){var toPx=function(num){return num+"px"};return{position:position,left:left.map(toPx),top:top.map(toPx),right:right.map(toPx),bottom:bottom.map(toPx)}},toOptions=function(position){return __assign(__assign({},position),{position:Optional.some(position.position)})},applyPositionCss=function(element,position){setOptions(element,toOptions(position))},adt$9=Adt_generate([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),positionWithDirection=function(posName,decision,x,y,width,height){var decisionRect=decision.rect,decisionX=decisionRect.x-x,decisionY=decisionRect.y-y,decisionWidth,decisionHeight,decisionRight=width-(decisionX+decisionRect.width),decisionBottom=height-(decisionY+decisionRect.height),left=Optional.some(decisionX),top=Optional.some(decisionY),right=Optional.some(decisionRight),bottom=Optional.some(decisionBottom),none=Optional.none();return cata$2(decision.direction,(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,none,top,right,none)}),(function(){return NuPositionCss(posName,left,none,none,bottom)}),(function(){return NuPositionCss(posName,none,none,right,bottom)}),(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,left,none,none,bottom)}),(function(){return NuPositionCss(posName,left,top,none,none)}),(function(){return NuPositionCss(posName,none,top,right,none)}))},reposition=function(origin,decision){return origin.fold((function(){var decisionRect=decision.rect;return NuPositionCss("absolute",Optional.some(decisionRect.x),Optional.some(decisionRect.y),Optional.none(),Optional.none())}),(function(x,y,width,height){return positionWithDirection("absolute",decision,x,y,width,height)}),(function(x,y,width,height){return positionWithDirection("fixed",decision,x,y,width,height)}))},toBox=function(origin,element){var rel=curry(find$2,element),position=origin.fold(rel,rel,(function(){var scroll=get$9();return find$2(element).translate(-scroll.left,-scroll.top)})),width=getOuter$1(element),height=getOuter$2(element);return bounds(position.left,position.top,width,height)},viewport=function(origin,getBounds){return getBounds.fold((function(){return origin.fold(win,win,bounds)}),(function(b){return origin.fold(b,b,(function(){var bounds$1=b(),pos=translate$2(origin,bounds$1.x,bounds$1.y);return bounds(pos.left,pos.top,bounds$1.width,bounds$1.height)}))}))},translate$2=function(origin,x,y){var pos=SugarPosition(x,y),removeScroll=function(){var outerScroll=get$9();return pos.translate(-outerScroll.left,-outerScroll.top)};return origin.fold(constant$1(pos),constant$1(pos),removeScroll)},cata$1=function(subject,onNone,onRelative,onFixed){return subject.fold(onNone,onRelative,onFixed)};adt$9.none;var relative$1=adt$9.relative,fixed$1=adt$9.fixed,anchor=function(anchorBox,origin){return{anchorBox:anchorBox,origin:origin}},box=function(anchorBox,origin){return anchor(anchorBox,origin)},placementAttribute="data-alloy-placement",setPlacement$1=function(element,placement){set$8(element,placementAttribute,placement)},getPlacement=function(element){return getOpt(element,placementAttribute)},reset$2=function(element){return remove$7(element,placementAttribute)},adt$8=Adt_generate([{fit:["reposition"]},{nofit:["reposition","visibleW","visibleH","isVisible"]}]),determinePosition=function(box,bounds){var boundsX=bounds.x,boundsY=bounds.y,boundsRight=bounds.right,boundsBottom=bounds.bottom,x=box.x,y=box.y,right=box.right,bottom=box.bottom,width=box.width,height=box.height,xInBounds,yInBounds,originInBounds,rightInBounds,bottomInBounds,sizeInBounds,visibleW,visibleH;return{originInBounds:x>=boundsX&&x<=boundsRight&&(y>=boundsY&&y<=boundsBottom),sizeInBounds:right<=boundsRight&&right>=boundsX&&(bottom<=boundsBottom&&bottom>=boundsY),visibleW:Math.min(width,x>=boundsX?boundsRight-x:right-boundsX),visibleH:Math.min(height,y>=boundsY?boundsBottom-y:bottom-boundsY)}},calcReposition=function(box,bounds$1){var boundsX=bounds$1.x,boundsY=bounds$1.y,boundsRight=bounds$1.right,boundsBottom=bounds$1.bottom,x=box.x,y=box.y,width=box.width,height=box.height,maxX=Math.max(boundsX,boundsRight-width),maxY=Math.max(boundsY,boundsBottom-height),restrictedX=clamp$1(x,boundsX,maxX),restrictedY=clamp$1(y,boundsY,maxY),restrictedWidth=Math.min(restrictedX+width,boundsRight)-restrictedX,restrictedHeight=Math.min(restrictedY+height,boundsBottom)-restrictedY;return bounds(restrictedX,restrictedY,restrictedWidth,restrictedHeight)},calcMaxSizes=function(direction,box,bounds){var upAvailable=constant$1(box.bottom-bounds.y),downAvailable=constant$1(bounds.bottom-box.y),maxHeight=cataVertical(direction,downAvailable,downAvailable,upAvailable),westAvailable=constant$1(box.right-bounds.x),eastAvailable=constant$1(bounds.right-box.x),maxWidth;return{maxWidth:cataHorizontal(direction,eastAvailable,eastAvailable,westAvailable),maxHeight:maxHeight}},attempt=function(candidate,width,height,bounds$1){var bubble=candidate.bubble,bubbleOffset=bubble.offset,adjustedBounds=adjustBounds(bounds$1,candidate.restriction,bubbleOffset),newX=candidate.x+bubbleOffset.left,newY=candidate.y+bubbleOffset.top,box=bounds(newX,newY,width,height),_a=determinePosition(box,adjustedBounds),originInBounds=_a.originInBounds,sizeInBounds=_a.sizeInBounds,visibleW=_a.visibleW,visibleH=_a.visibleH,fits=originInBounds&&sizeInBounds,fittedBox=fits?box:calcReposition(box,adjustedBounds),isPartlyVisible=fittedBox.width>0&&fittedBox.height>0,_b=calcMaxSizes(candidate.direction,fittedBox,bounds$1),maxWidth=_b.maxWidth,maxHeight,reposition={rect:fittedBox,maxHeight:_b.maxHeight,maxWidth:maxWidth,direction:candidate.direction,placement:candidate.placement,classes:{on:bubble.classesOn,off:bubble.classesOff},layout:candidate.label,testY:newY};return fits||candidate.alwaysFit?adt$8.fit(reposition):adt$8.nofit(reposition,visibleW,visibleH,isPartlyVisible)},attempts=function(element,candidates,anchorBox,elementBox,bubbles,bounds){var panelWidth=elementBox.width,panelHeight=elementBox.height,attemptBestFit=function(layout,reposition,visibleW,visibleH,isVisible){var next=layout(anchorBox,elementBox,bubbles,element,bounds),attemptLayout=attempt(next,panelWidth,panelHeight,bounds);return attemptLayout.fold(constant$1(attemptLayout),(function(newReposition,newVisibleW,newVisibleH,newIsVisible){var improved;return(isVisible===newIsVisible?newVisibleH>visibleH||newVisibleW>visibleW:!isVisible&&newIsVisible)?attemptLayout:adt$8.nofit(reposition,visibleW,visibleH,isVisible)}))},abc;return foldl(candidates,(function(b,a){var bestNext=curry(attemptBestFit,a);return b.fold(constant$1(b),bestNext)}),adt$8.nofit({rect:anchorBox,maxHeight:elementBox.height,maxWidth:elementBox.width,direction:southeast$3(),placement:"southeast",classes:{on:[],off:[]},layout:"none",testY:anchorBox.y},-1,-1,!1)).fold(identity$1,identity$1)},singleton=function(doRevoke){var subject=Cell(Optional.none()),revoke=function(){return subject.get().each(doRevoke)},clear,isSet,get,set;return{clear:function(){revoke(),subject.set(Optional.none())},isSet:function(){return subject.get().isSome()},get:function(){return subject.get()},set:function(s){revoke(),subject.set(Optional.some(s))}}},destroyable=function(){return singleton((function(s){return s.destroy()}))},unbindable=function(){return singleton((function(s){return s.unbind()}))},api$1=function(){var subject=destroyable(),run=function(f){return subject.get().each(f)};return __assign(__assign({},subject),{run:run})},value$1=function(){var subject=singleton(noop),on=function(f){return subject.get().each(f)};return __assign(__assign({},subject),{on:on})},filter=always,bind=function(element,event,handler){return bind$2(element,event,filter,handler)},capture=function(element,event,handler){return capture$1(element,event,filter,handler)},fromRawEvent=fromRawEvent$1,properties=["top","bottom","right","left"],timerAttr="data-alloy-transition-timer",isTransitioning$1=function(element,transition){return hasAll(element,transition.classes)},shouldApplyTransitionCss=function(transition,decision,lastPlacement){return lastPlacement.exists((function(placer){var mode=transition.mode;return"all"===mode||placer[mode]!==decision[mode]}))},hasChanges=function(position,intermediate){var round=function(value){return parseFloat(value).toFixed(3)};return find$4(intermediate,(function(value,key){var newValue=position[key].map(round),val=value.map(round);return!equals(newValue,val)})).isSome()},getTransitionDuration=function(element){var get=function(name){var style=get$c(element,name),times=isString(style)?style.split(/\s*,\s*/):[];return filter$2(times,isNotEmpty)},parse=function(value){if(isString(value)&&/^[\d.]+/.test(value)){var num=parseFloat(value);return endsWith(value,"ms")?num:1e3*num}return 0},delay=get("transition-delay"),duration=get("transition-duration");return foldl(duration,(function(acc,dur,i){var time=parse(delay[i])+parse(dur);return Math.max(acc,time)}),0)},setupTransitionListeners=function(element,transition){var transitionEnd=unbindable(),transitionCancel=unbindable(),timer,isSourceTransition=function(e){var _a,pseudoElement=null!==(_a=e.raw.pseudoElement)&&void 0!==_a?_a:"";return eq(e.target,element)&&isEmpty(pseudoElement)&&contains$2(properties,e.raw.propertyName)},transitionDone=function(e){if(isNullable(e)||isSourceTransition(e)){transitionEnd.clear(),transitionCancel.clear();var type=null==e?void 0:e.raw.type;(isNullable(type)||type===transitionend())&&(clearTimeout(timer),remove$7(element,timerAttr),remove$1(element,transition.classes))}},transitionStarted=function(){transitionEnd.set(bind(element,transitionend(),transitionDone)),transitionCancel.set(bind(element,transitioncancel(),transitionDone))};if("ontransitionstart"in element.dom)var transitionStart_1=bind(element,transitionstart(),(function(e){isSourceTransition(e)&&(transitionStart_1.unbind(),transitionStarted())}));else transitionStarted();var duration=getTransitionDuration(element);requestAnimationFrame((function(){timer=setTimeout(transitionDone,duration+17),set$8(element,timerAttr,timer)}))},startTransitioning=function(element,transition){add$1(element,transition.classes),getOpt(element,timerAttr).each((function(timerId){clearTimeout(parseInt(timerId,10)),remove$7(element,timerAttr)})),setupTransitionListeners(element,transition)},applyTransitionCss=function(element,origin,position,transition,decision,lastPlacement){var shouldTransition=shouldApplyTransitionCss(transition,decision,lastPlacement);if(shouldTransition||isTransitioning$1(element,transition)){set$7(element,"position",position.position);var rect=toBox(origin,element),intermediatePosition_1=reposition(origin,__assign(__assign({},decision),{rect:rect})),intermediateCssOptions=mapToObject(properties,(function(prop){return intermediatePosition_1[prop]}));hasChanges(position,intermediateCssOptions)&&(setOptions(element,intermediateCssOptions),shouldTransition&&startTransitioning(element,transition),reflow(element))}else remove$1(element,transition.classes)},elementSize=function(p){return{width:getOuter$1(p),height:getOuter$2(p)}},layout=function(anchorBox,element,bubbles,options){remove$6(element,"max-height"),remove$6(element,"max-width");var elementBox=elementSize(element);return attempts(element,options.preference,anchorBox,elementBox,bubbles,options.bounds)},setClasses=function(element,decision){var classInfo=decision.classes;remove$1(element,classInfo.off),add$1(element,classInfo.on)},setHeight=function(element,decision,options){var maxHeightFunction;(0,options.maxHeightFunction)(element,decision.maxHeight)},setWidth=function(element,decision,options){var maxWidthFunction;(0,options.maxWidthFunction)(element,decision.maxWidth)},position$2=function(element,decision,options){var positionCss=reposition(options.origin,decision);options.transition.each((function(transition){applyTransitionCss(element,options.origin,positionCss,transition,decision,options.lastPlacement)})),applyPositionCss(element,positionCss)},setPlacement=function(element,decision){setPlacement$1(element,decision.placement)},setMaxHeight=function(element,maxHeight){setMax$1(element,Math.floor(maxHeight))},anchored=constant$1((function(element,available){setMaxHeight(element,available),setAll(element,{"overflow-x":"hidden","overflow-y":"auto"})})),expandable$1=constant$1((function(element,available){setMaxHeight(element,available)})),defaultOr=function(options,key,dephault){return void 0===options[key]?dephault:options[key]},simple=function(anchor,element,bubble,layouts,lastPlacement,getBounds,overrideOptions,transition){var maxHeightFunction=defaultOr(overrideOptions,"maxHeightFunction",anchored()),maxWidthFunction=defaultOr(overrideOptions,"maxWidthFunction",noop),anchorBox=anchor.anchorBox,origin=anchor.origin,options={bounds:viewport(origin,getBounds),origin:origin,preference:layouts,maxHeightFunction:maxHeightFunction,maxWidthFunction:maxWidthFunction,lastPlacement:lastPlacement,transition:transition};return go(anchorBox,element,bubble,options)},go=function(anchorBox,element,bubble,options){var decision=layout(anchorBox,element,bubble,options);return position$2(element,decision,options),setPlacement(element,decision),setClasses(element,decision),setHeight(element,decision,options),setWidth(element,decision,options),{layout:decision.layout,placement:decision.placement}},allAlignments=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right","inset"],nu$5=function(xOffset,yOffset,classes,insetModifier){void 0===insetModifier&&(insetModifier=1);var insetXOffset=xOffset*insetModifier,insetYOffset=yOffset*insetModifier,getClasses=function(prop){return get$e(classes,prop).getOr([])},make=function(xDelta,yDelta,alignmentsOn){var alignmentsOff=difference(allAlignments,alignmentsOn);return{offset:SugarPosition(xDelta,yDelta),classesOn:bind$3(alignmentsOn,getClasses),classesOff:bind$3(alignmentsOff,getClasses)}};return{southeast:function(){return make(-xOffset,yOffset,["top","alignLeft"])},southwest:function(){return make(xOffset,yOffset,["top","alignRight"])},south:function(){return make(-xOffset/2,yOffset,["top","alignCentre"])},northeast:function(){return make(-xOffset,-yOffset,["bottom","alignLeft"])},northwest:function(){return make(xOffset,-yOffset,["bottom","alignRight"])},north:function(){return make(-xOffset/2,-yOffset,["bottom","alignCentre"])},east:function(){return make(xOffset,-yOffset/2,["valignCentre","left"])},west:function(){return make(-xOffset,-yOffset/2,["valignCentre","right"])},insetNortheast:function(){return make(insetXOffset,insetYOffset,["top","alignLeft","inset"])},insetNorthwest:function(){return make(-insetXOffset,insetYOffset,["top","alignRight","inset"])},insetNorth:function(){return make(-insetXOffset/2,insetYOffset,["top","alignCentre","inset"])},insetSoutheast:function(){return make(insetXOffset,-insetYOffset,["bottom","alignLeft","inset"])},insetSouthwest:function(){return make(-insetXOffset,-insetYOffset,["bottom","alignRight","inset"])},insetSouth:function(){return make(-insetXOffset/2,-insetYOffset,["bottom","alignCentre","inset"])},insetEast:function(){return make(-insetXOffset,-insetYOffset/2,["valignCentre","right","inset"])},insetWest:function(){return make(insetXOffset,-insetYOffset/2,["valignCentre","left","inset"])}}},fallback=function(){return nu$5(0,0,{})},nu$4=identity$1,onDirection=function(isLtr,isRtl){return function(element){return"rtl"===getDirection(element)?isRtl:isLtr}},getDirection=function(element){return"rtl"===get$c(element,"direction")?"rtl":"ltr"},AttributeValue;!function(AttributeValue){AttributeValue.TopToBottom="toptobottom",AttributeValue.BottomToTop="bottomtotop"}(AttributeValue||(AttributeValue={}));var Attribute="data-alloy-vertical-dir",isBottomToTopDir=function(el){return closest$2(el,(function(current){return isElement$2(current)&&get$d(current,"data-alloy-vertical-dir")===AttributeValue.BottomToTop}))},schema$y=function(){return optionObjOf("layouts",[required$1("onLtr"),required$1("onRtl"),option("onBottomLtr"),option("onBottomRtl")])},get$4=function(elem,info,defaultLtr,defaultRtl,defaultBottomLtr,defaultBottomRtl,dirElement){var isBottomToTop=dirElement.map(isBottomToTopDir).getOr(!1),customLtr=info.layouts.map((function(ls){return ls.onLtr(elem)})),customRtl=info.layouts.map((function(ls){return ls.onRtl(elem)})),ltr=isBottomToTop?info.layouts.bind((function(ls){return ls.onBottomLtr.map((function(f){return f(elem)}))})).or(customLtr).getOr(defaultBottomLtr):customLtr.getOr(defaultLtr),rtl=isBottomToTop?info.layouts.bind((function(ls){return ls.onBottomRtl.map((function(f){return f(elem)}))})).or(customRtl).getOr(defaultBottomRtl):customRtl.getOr(defaultRtl),f;return onDirection(ltr,rtl)(elem)},placement$4=function(component,anchorInfo,origin){var hotspot=anchorInfo.hotspot,anchorBox=toBox(origin,hotspot.element),layouts=get$4(component.element,anchorInfo,belowOrAbove(),belowOrAboveRtl(),aboveOrBelow(),aboveOrBelowRtl(),Optional.some(anchorInfo.hotspot.element));return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}))},HotspotAnchor=[required$1("hotspot"),option("bubble"),defaulted("overrides",{}),schema$y(),output$1("placement",placement$4)],placement$3=function(component,anchorInfo,origin){var pos=translate$2(origin,anchorInfo.x,anchorInfo.y),anchorBox=bounds(pos.left,pos.top,anchorInfo.width,anchorInfo.height),layouts=get$4(component.element,anchorInfo,all$1(),allRtl$1(),all$1(),allRtl$1(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble,overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()}))},MakeshiftAnchor=[required$1("x"),required$1("y"),defaulted("height",0),defaulted("width",0),defaulted("bubble",fallback()),defaulted("overrides",{}),schema$y(),output$1("placement",placement$3)],adt$7=Adt_generate([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),toFixed=function(pos){return pos.fold(identity$1,(function(point,scrollLeft,scrollTop){return point.translate(-scrollLeft,-scrollTop)}))},toAbsolute=function(pos){return pos.fold(identity$1,identity$1)},sum=function(points){return foldl(points,(function(b,a){return b.translate(a.left,a.top)}),SugarPosition(0,0))},sumAsFixed=function(positions){var points=map$2(positions,toFixed);return sum(points)},sumAsAbsolute=function(positions){var points=map$2(positions,toAbsolute);return sum(points)},screen=adt$7.screen,absolute$1=adt$7.absolute,getOffset=function(component,origin,anchorInfo){var win=defaultView(anchorInfo.root).dom,hasSameOwner=function(frame){var frameOwner=owner$4(frame),compOwner=owner$4(component.element);return eq(frameOwner,compOwner)};return Optional.from(win.frameElement).map(SugarElement.fromDom).filter(hasSameOwner).map(absolute$3)},getRootPoint=function(component,origin,anchorInfo){var doc=owner$4(component.element),outerScroll=get$9(doc),offset=getOffset(component,origin,anchorInfo).getOr(outerScroll);return absolute$1(offset,outerScroll.left,outerScroll.top)},getBox=function(left,top,width,height){var point=screen(SugarPosition(left,top));return Optional.some(pointed(point,width,height))},calcNewAnchor=function(optBox,rootPoint,anchorInfo,origin,elem){return optBox.map((function(box){var points=[rootPoint,box.point],topLeft=cata$1(origin,(function(){return sumAsAbsolute(points)}),(function(){return sumAsAbsolute(points)}),(function(){return sumAsFixed(points)})),anchorBox=rect(topLeft.left,topLeft.top,box.width,box.height),layoutsLtr=anchorInfo.showAbove?aboveOrBelow():belowOrAbove(),layoutsRtl=anchorInfo.showAbove?aboveOrBelowRtl():belowOrAboveRtl(),layouts=get$4(elem,anchorInfo,layoutsLtr,layoutsRtl,layoutsLtr,layoutsRtl,Optional.none());return nu$4({anchorBox:anchorBox,bubble:anchorInfo.bubble.getOr(fallback()),overrides:anchorInfo.overrides,layouts:layouts,placer:Optional.none()})}))},placement$2=function(component,anchorInfo,origin){var rootPoint=getRootPoint(component,origin,anchorInfo);return anchorInfo.node.filter(inBody).bind((function(target){var rect=target.dom.getBoundingClientRect(),nodeBox=getBox(rect.left,rect.top,rect.width,rect.height),elem=anchorInfo.node.getOr(component.element);return calcNewAnchor(nodeBox,rootPoint,anchorInfo,origin,elem)}))},NodeAnchor=[required$1("node"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",placement$2)],zeroWidth="\ufeff",nbsp="",create$6,SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt$6=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),cata=function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart$1=function(situ){return situ.fold(identity$1,identity$1,identity$1)},before,on$1,after$1,Situ_before=adt$6.before,Situ_on=adt$6.on,Situ_after=adt$6.after,Situ_cata=cata,Situ_getStart=getStart$1,adt$5=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),exactFromRange=function(simRange){return adt$5.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getStart=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ_getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})},domRange,relative,exact,getWin,range$1,SimSelection={domRange:adt$5.domRange,relative:adt$5.relative,exact:adt$5.exact,exactFromRange:exactFromRange,getWin:function(selection){var start=getStart(selection);return defaultView(start)},range:SimRange_create},setStart=function(rng,situ){situ.fold((function(e){rng.setStartBefore(e.dom)}),(function(e,o){rng.setStart(e.dom,o)}),(function(e){rng.setStartAfter(e.dom)}))},setFinish=function(rng,situ){situ.fold((function(e){rng.setEndBefore(e.dom)}),(function(e,o){rng.setEnd(e.dom,o)}),(function(e){rng.setEndAfter(e.dom)}))},relativeToNative=function(win,startSitu,finishSitu){var range=win.document.createRange();return setStart(range,startSitu),setFinish(range,finishSitu),range},exactToNative=function(win,start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},toRect=function(rect){return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height}},getFirstRect$1=function(rng){var rects=rng.getClientRects(),rect=rects.length>0?rects[0]:rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none()},getBounds$2=function(rng){var rect=rng.getBoundingClientRect();return rect.width>0||rect.height>0?Optional.some(rect).map(toRect):Optional.none()},adt$4=Adt_generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),fromRange=function(win,type,range){return type(SugarElement.fromDom(range.startContainer),range.startOffset,SugarElement.fromDom(range.endContainer),range.endOffset)},getRanges=function(win,selection){return selection.match({domRange:function(rng){return{ltr:constant$1(rng),rtl:Optional.none}},relative:function(startSitu,finishSitu){return{ltr:cached((function(){return relativeToNative(win,startSitu,finishSitu)})),rtl:cached((function(){return Optional.some(relativeToNative(win,finishSitu,startSitu))}))}},exact:function(start,soffset,finish,foffset){return{ltr:cached((function(){return exactToNative(win,start,soffset,finish,foffset)})),rtl:cached((function(){return Optional.some(exactToNative(win,finish,foffset,start,soffset))}))}}})},doDiagnose=function(win,ranges){var rng=ranges.ltr(),reversed;return rng.collapsed?ranges.rtl().filter((function(rev){return!1===rev.collapsed})).map((function(rev){return adt$4.rtl(SugarElement.fromDom(rev.endContainer),rev.endOffset,SugarElement.fromDom(rev.startContainer),rev.startOffset)})).getOrThunk((function(){return fromRange(win,adt$4.ltr,rng)})):fromRange(win,adt$4.ltr,rng)},diagnose=function(win,selection){var ranges=getRanges(win,selection);return doDiagnose(win,ranges)},asLtrRange=function(win,selection){var diagnosis;return diagnose(win,selection).match({ltr:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},rtl:function(start,soffset,finish,foffset){var rng=win.document.createRange();return rng.setStart(finish.dom,foffset),rng.setEnd(start.dom,soffset),rng}})};adt$4.ltr,adt$4.rtl;var NodeValue=function(is,name){var get=function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()},set;return{get:get,getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}},api=NodeValue(isText$1,"text"),get$3=function(element){return api.get(element)},getOption=function(element){return api.getOption(element)},getEnd=function(element){return"img"===name$2(element)?1:getOption(element).fold((function(){return children(element).length}),(function(v){return v.length}))},isTextNodeWithCursorPosition=function(el){return getOption(el).filter((function(text){return 0!==text.trim().length||text.indexOf("")>-1})).isSome()},elementsWithCursorPosition=["img","br"],isCursorPosition=function(elem){var hasCursorPosition;return isTextNodeWithCursorPosition(elem)||contains$2(elementsWithCursorPosition,name$2(elem))},last$1=function(element){return descendantRtl(element,isCursorPosition)},descendantRtl=function(scope,predicate){var descend=function(element){for(var children$1=children(element),i=children$1.length-1;i>=0;i--){var child=children$1[i];if(predicate(child))return Optional.some(child);var res=descend(child);if(res.isSome())return res}return Optional.none()};return descend(scope)},descendants=function(scope,selector){return all$3(selector,scope)},makeRange=function(start,soffset,finish,foffset){var doc,rng=owner$4(start).dom.createRange();return rng.setStart(start.dom,soffset),rng.setEnd(finish.dom,foffset),rng},after=function(start,soffset,finish,foffset){var r=makeRange(start,soffset,finish,foffset),same=eq(start,finish)&&soffset===foffset;return r.collapsed&&!same},getNativeSelection=function(win){return Optional.from(win.getSelection())},readRange=function(selection){if(selection.rangeCount>0){var firstRng=selection.getRangeAt(0),lastRng=selection.getRangeAt(selection.rangeCount-1);return Optional.some(SimRange_create(SugarElement.fromDom(firstRng.startContainer),firstRng.startOffset,SugarElement.fromDom(lastRng.endContainer),lastRng.endOffset))}return Optional.none()},doGetExact=function(selection){if(null===selection.anchorNode||null===selection.focusNode)return readRange(selection);var anchor=SugarElement.fromDom(selection.anchorNode),focus_1=SugarElement.fromDom(selection.focusNode);return after(anchor,selection.anchorOffset,focus_1,selection.focusOffset)?Optional.some(SimRange_create(anchor,selection.anchorOffset,focus_1,selection.focusOffset)):readRange(selection)},getExact=function(win){return getNativeSelection(win).filter((function(sel){return sel.rangeCount>0})).bind(doGetExact)},getFirstRect=function(win,selection){var rng=asLtrRange(win,selection);return getFirstRect$1(rng)},getBounds$1=function(win,selection){var rng=asLtrRange(win,selection);return getBounds$2(rng)},point$1=function(element,offset){return{element:element,offset:offset}},descendOnce$1=function(element,offset){var children$1=children(element);if(0===children$1.length)return point$1(element,offset);if(offset<children$1.length)return point$1(children$1[offset],0);var last=children$1[children$1.length-1],len=isText$1(last)?get$3(last).length:children(last).length;return point$1(last,len)},descendOnce=function(element,offset){return isText$1(element)?point$1(element,offset):descendOnce$1(element,offset)},getAnchorSelection=function(win,anchorInfo){var getSelection;return anchorInfo.getSelection.getOrThunk((function(){return function(){return getExact(win)}}))().map((function(sel){var modStart=descendOnce(sel.start,sel.soffset),modFinish=descendOnce(sel.finish,sel.foffset);return SimSelection.range(modStart.element,modStart.offset,modFinish.element,modFinish.offset)}))},placement$1=function(component,anchorInfo,origin){var win=defaultView(anchorInfo.root).dom,rootPoint=getRootPoint(component,origin,anchorInfo),selectionBox=getAnchorSelection(win,anchorInfo).bind((function(sel){var optRect;return getBounds$1(win,SimSelection.exactFromRange(sel)).orThunk((function(){var x=SugarElement.fromText("\ufeff");before$2(sel.start,x);var rect=getFirstRect(win,SimSelection.exact(x,0,x,1));return remove$5(x),rect})).bind((function(rawRect){return getBox(rawRect.left,rawRect.top,rawRect.width,rawRect.height)}))})),targetElement,elem=getAnchorSelection(win,anchorInfo).bind((function(sel){return isElement$2(sel.start)?Optional.some(sel.start):parentNode(sel.start)})).getOr(component.element);return calcNewAnchor(selectionBox,rootPoint,anchorInfo,origin,elem)},SelectionAnchor=[option("getSelection"),required$1("root"),option("bubble"),schema$y(),defaulted("overrides",{}),defaulted("showAbove",!1),output$1("placement",placement$1)],labelPrefix$1="link-layout",eastX=function(anchor){return anchor.x+anchor.width},westX=function(anchor,element){return anchor.x-element.width},northY$1=function(anchor,element){return anchor.y-element.height+anchor.height},southY$1=function(anchor){return anchor.y},southeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),southY$1(anchor),bubbles.southeast(),southeast$3(),"southeast",boundsRestriction(anchor,{left:0,top:2}),"link-layout")},southwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),southY$1(anchor),bubbles.southwest(),southwest$3(),"southwest",boundsRestriction(anchor,{right:1,top:2}),"link-layout")},northeast$1=function(anchor,element,bubbles){return nu$6(eastX(anchor),northY$1(anchor,element),bubbles.northeast(),northeast$3(),"northeast",boundsRestriction(anchor,{left:0,bottom:3}),"link-layout")},northwest$1=function(anchor,element,bubbles){return nu$6(westX(anchor,element),northY$1(anchor,element),bubbles.northwest(),northwest$3(),"northwest",boundsRestriction(anchor,{right:1,bottom:3}),"link-layout")},all=function(){return[southeast$1,southwest$1,northeast$1,northwest$1]},allRtl=function(){return[southwest$1,southeast$1,northwest$1,northeast$1]},placement=function(component,submenuInfo,origin){var anchorBox=toBox(origin,submenuInfo.item.element),layouts=get$4(component.element,submenuInfo,all(),allRtl(),all(),allRtl(),Optional.none());return Optional.some(nu$4({anchorBox:anchorBox,bubble:fallback(),overrides:submenuInfo.overrides,layouts:layouts,placer:Optional.none()}))},SubmenuAnchor=[required$1("item"),schema$y(),defaulted("overrides",{}),output$1("placement",placement)],AnchorSchema=choose$1("type",{selection:SelectionAnchor,node:NodeAnchor,hotspot:HotspotAnchor,submenu:SubmenuAnchor,makeshift:MakeshiftAnchor}),TransitionSchema=[requiredArrayOf("classes",string),defaultedStringEnum("mode","all",["all","layout","placement"])],PositionSchema=[defaulted("useFixed",never),option("getBounds")],PlacementSchema=[requiredOf("anchor",AnchorSchema),optionObjOf("transition",TransitionSchema)],getFixedOrigin=function(){var html=document.documentElement;return fixed$1(0,0,html.clientWidth,html.clientHeight)},getRelativeOrigin=function(component){var position=absolute$3(component.element),bounds=component.element.dom.getBoundingClientRect();return relative$1(position.left,position.top,bounds.width,bounds.height)},place=function(component,origin,anchoring,getBounds,placee,lastPlace,transition){var anchor=box(anchoring.anchorBox,origin);return simple(anchor,placee.element,anchoring.bubble,anchoring.layouts,lastPlace,getBounds,anchoring.overrides,transition)},position$1=function(component,posConfig,posState,placee,placementSpec){positionWithin(component,posConfig,posState,placee,placementSpec,Optional.none())},positionWithin=function(component,posConfig,posState,placee,placementSpec,boxElement){var boundsBox=boxElement.map(box$1);return positionWithinBounds(component,posConfig,posState,placee,placementSpec,boundsBox)},positionWithinBounds=function(component,posConfig,posState,placee,placementSpec,bounds){var placeeDetail=asRawOrDie$1("placement.info",objOf(PlacementSchema),placementSpec),anchorage=placeeDetail.anchor,element=placee.element,placeeState=posState.get(placee.uid);preserve$1((function(){set$7(element,"position","fixed");var oldVisibility=getRaw(element,"visibility");set$7(element,"visibility","hidden");var origin=posConfig.useFixed()?getFixedOrigin():getRelativeOrigin(component),placer=anchorage.placement,getBounds=bounds.map(constant$1).or(posConfig.getBounds);placer(component,anchorage,origin).each((function(anchoring){var doPlace,newState=anchoring.placer.getOr(place)(component,origin,anchoring,getBounds,placee,placeeState,placeeDetail.transition);posState.set(placee.uid,newState)})),oldVisibility.fold((function(){remove$6(element,"visibility")}),(function(vis){set$7(element,"visibility",vis)})),getRaw(element,"left").isNone()&&getRaw(element,"top").isNone()&&getRaw(element,"right").isNone()&&getRaw(element,"bottom").isNone()&&is$1(getRaw(element,"position"),"fixed")&&remove$6(element,"position")}),element)},getMode=function(component,pConfig,_pState){return pConfig.useFixed()?"fixed":"absolute"},reset$1=function(component,pConfig,posState,placee){var element=placee.element;each$1(["position","left","right","top","bottom"],(function(prop){return remove$6(element,prop)})),reset$2(element),posState.clear(placee.uid)},PositionApis=Object.freeze({__proto__:null,position:position$1,positionWithin:positionWithin,positionWithinBounds:positionWithinBounds,getMode:getMode,reset:reset$1}),init$g=function(){var state={},set,get,clear;return nu$8({readState:function(){return state},clear:function(id){isNonNullable(id)?delete state[id]:state={}},set:function(id,data){state[id]=data},get:function(id){return get$e(state,id)}})},PositioningState=Object.freeze({__proto__:null,init:init$g}),Positioning=create$7({fields:PositionSchema,name:"positioning",active:ActivePosition,apis:PositionApis,state:PositioningState}),fireDetaching=function(component){emit(component,detachedFromDom());var children=component.components();each$1(children,fireDetaching)},fireAttaching=function(component){var children=component.components();each$1(children,fireAttaching),emit(component,attachedToDom())},attach$1=function(parent,child){append$2(parent.element,child.element)},detachChildren$1=function(component){each$1(component.components(),(function(childComp){return remove$5(childComp.element)})),empty(component.element),component.syncComponents()},replaceChildren=function(component,newChildren){var subs=component.components();detachChildren$1(component);var deleted=difference(subs,newChildren);each$1(deleted,(function(comp){fireDetaching(comp),component.getSystem().removeFromWorld(comp)})),each$1(newChildren,(function(childComp){childComp.getSystem().isConnected()?attach$1(component,childComp):(component.getSystem().addToWorld(childComp),attach$1(component,childComp),inBody(component.element)&&fireAttaching(childComp)),component.syncComponents()}))},attach=function(parent,child){attachWith(parent,child,append$2)},attachWith=function(parent,child,insertion){parent.getSystem().addToWorld(child),insertion(parent.element,child.element),inBody(parent.element)&&fireAttaching(child),parent.syncComponents()},doDetach=function(component){fireDetaching(component),remove$5(component.element),component.getSystem().removeFromWorld(component)},detach=function(component){var parent$1=parent(component.element).bind((function(p){return component.getSystem().getByDom(p).toOptional()}));doDetach(component),parent$1.each((function(p){p.syncComponents()}))},detachChildren=function(component){var subs=component.components();each$1(subs,doDetach),empty(component.element),component.syncComponents()},attachSystem=function(element,guiSystem){attachSystemWith(element,guiSystem,append$2)},attachSystemAfter=function(element,guiSystem){attachSystemWith(element,guiSystem,after$2)},attachSystemWith=function(element,guiSystem,inserter){inserter(element,guiSystem.element);var children$1=children(guiSystem.element);each$1(children$1,(function(child){guiSystem.getByDom(child).each(fireAttaching)}))},detachSystem=function(guiSystem){var children$1=children(guiSystem.element);each$1(children$1,(function(child){guiSystem.getByDom(child).each(fireDetaching)})),remove$5(guiSystem.element)},rebuild=function(sandbox,sConfig,sState,data){sState.get().each((function(_data){detachChildren(sandbox)}));var point=sConfig.getAttachPoint(sandbox);attach(point,sandbox);var built=sandbox.getSystem().build(data);return attach(sandbox,built),sState.set(built),built},open$1=function(sandbox,sConfig,sState,data){var newState=rebuild(sandbox,sConfig,sState,data);return sConfig.onOpen(sandbox,newState),newState},setContent=function(sandbox,sConfig,sState,data){return sState.get().map((function(){return rebuild(sandbox,sConfig,sState,data)}))},openWhileCloaked=function(sandbox,sConfig,sState,data,transaction){cloak(sandbox,sConfig),open$1(sandbox,sConfig,sState,data),transaction(),decloak(sandbox,sConfig)},close$1=function(sandbox,sConfig,sState){sState.get().each((function(data){detachChildren(sandbox),detach(sandbox),sConfig.onClose(sandbox,data),sState.clear()}))},isOpen$1=function(_sandbox,_sConfig,sState){return sState.isOpen()},isPartOf=function(sandbox,sConfig,sState,queryElem){return isOpen$1(sandbox,sConfig,sState)&&sState.get().exists((function(data){return sConfig.isPartOf(sandbox,data,queryElem)}))},getState$2=function(_sandbox,_sConfig,sState){return sState.get()},store=function(sandbox,cssKey,attr,newValue){getRaw(sandbox.element,cssKey).fold((function(){remove$7(sandbox.element,attr)}),(function(v){set$8(sandbox.element,attr,v)})),set$7(sandbox.element,cssKey,newValue)},restore=function(sandbox,cssKey,attr){getOpt(sandbox.element,attr).fold((function(){return remove$6(sandbox.element,cssKey)}),(function(oldValue){return set$7(sandbox.element,cssKey,oldValue)}))},cloak=function(sandbox,sConfig,_sState){var sink=sConfig.getAttachPoint(sandbox);set$7(sandbox.element,"position",Positioning.getMode(sink)),store(sandbox,"visibility",sConfig.cloakVisibilityAttr,"hidden")},hasPosition=function(element){return exists(["top","left","right","bottom"],(function(pos){return getRaw(element,pos).isSome()}))},decloak=function(sandbox,sConfig,_sState){hasPosition(sandbox.element)||remove$6(sandbox.element,"position"),restore(sandbox,"visibility",sConfig.cloakVisibilityAttr)},SandboxApis=Object.freeze({__proto__:null,cloak:cloak,decloak:decloak,open:open$1,openWhileCloaked:openWhileCloaked,close:close$1,isOpen:isOpen$1,isPartOf:isPartOf,getState:getState$2,setContent:setContent}),events$g=function(sandboxConfig,sandboxState){return derive$2([run$1(sandboxClose(),(function(sandbox,_simulatedEvent){close$1(sandbox,sandboxConfig,sandboxState)}))])},ActiveSandbox=Object.freeze({__proto__:null,events:events$g}),SandboxSchema=[onHandler("onOpen"),onHandler("onClose"),required$1("isPartOf"),required$1("getAttachPoint"),defaulted("cloakVisibilityAttr","data-precloak-visibility")],init$f=function(){var contents=value$1(),readState=constant$1("not-implemented");return nu$8({readState:readState,isOpen:contents.isSet,clear:contents.clear,set:contents.set,get:contents.get})},SandboxState,Sandboxing=create$7({fields:SandboxSchema,name:"sandboxing",active:ActiveSandbox,apis:SandboxApis,state:Object.freeze({__proto__:null,init:init$f})}),dismissPopups=constant$1("dismiss.popups"),repositionPopups=constant$1("reposition.popups"),mouseReleased=constant$1("mouse.released"),schema$x=objOfOnly([defaulted("isExtraPart",never),optionObjOf("fireEventInstead",[defaulted("event",dismissRequested())])]),receivingChannel$1=function(rawSpec){var _a,detail=asRawOrDie$1("Dismissal",schema$x,rawSpec);return(_a={})[dismissPopups()]={schema:objOfOnly([required$1("target")]),onReceive:function(sandbox,data){var isPart;Sandboxing.isOpen(sandbox)&&(Sandboxing.isPartOf(sandbox,data.target)||detail.isExtraPart(sandbox,data.target)||detail.fireEventInstead.fold((function(){return Sandboxing.close(sandbox)}),(function(fe){return emit(sandbox,fe.event)})))}},_a},schema$w=objOfOnly([optionObjOf("fireEventInstead",[defaulted("event",repositionRequested())]),requiredFunction("doReposition")]),receivingChannel=function(rawSpec){var _a,detail=asRawOrDie$1("Reposition",schema$w,rawSpec);return(_a={})[repositionPopups()]={onReceive:function(sandbox){Sandboxing.isOpen(sandbox)&&detail.fireEventInstead.fold((function(){return detail.doReposition(sandbox)}),(function(fe){return emit(sandbox,fe.event)}))}},_a},onLoad$5=function(component,repConfig,repState){repConfig.store.manager.onLoad(component,repConfig,repState)},onUnload$2=function(component,repConfig,repState){repConfig.store.manager.onUnload(component,repConfig,repState)},setValue$3=function(component,repConfig,repState,data){repConfig.store.manager.setValue(component,repConfig,repState,data)},getValue$3=function(component,repConfig,repState){return repConfig.store.manager.getValue(component,repConfig,repState)},getState$1=function(component,repConfig,repState){return repState},RepresentApis=Object.freeze({__proto__:null,onLoad:onLoad$5,onUnload:onUnload$2,setValue:setValue$3,getValue:getValue$3,getState:getState$1}),events$f=function(repConfig,repState){var es=repConfig.resetOnDom?[runOnAttached((function(comp,_se){onLoad$5(comp,repConfig,repState)})),runOnDetached((function(comp,_se){onUnload$2(comp,repConfig,repState)}))]:[loadEvent(repConfig,repState,onLoad$5)];return derive$2(es)},ActiveRepresenting=Object.freeze({__proto__:null,events:events$f}),memory$1=function(){var data=Cell(null),readState=function(){return{mode:"memory",value:data.get()}},isNotSet=function(){return null===data.get()},clear=function(){data.set(null)};return nu$8({set:data.set,get:data.get,isNotSet:isNotSet,clear:clear,readState:readState})},manual=function(){var readState;return nu$8({readState:noop})},dataset=function(){var dataByValue=Cell({}),dataByText=Cell({}),readState,clear,lookup,update;return nu$8({readState:function(){return{mode:"dataset",dataByValue:dataByValue.get(),dataByText:dataByText.get()}},lookup:function(itemString){return get$e(dataByValue.get(),itemString).orThunk((function(){return get$e(dataByText.get(),itemString)}))},update:function(items){var currentDataByValue=dataByValue.get(),currentDataByText=dataByText.get(),newDataByValue={},newDataByText={};each$1(items,(function(item){newDataByValue[item.value]=item,get$e(item,"meta").each((function(meta){get$e(meta,"text").each((function(text){newDataByText[text]=item}))}))})),dataByValue.set(__assign(__assign({},currentDataByValue),newDataByValue)),dataByText.set(__assign(__assign({},currentDataByText),newDataByText))},clear:function(){dataByValue.set({}),dataByText.set({})}})},init$e=function(spec){return spec.store.manager.state(spec)},RepresentState=Object.freeze({__proto__:null,memory:memory$1,dataset:dataset,manual:manual,init:init$e}),setValue$2=function(component,repConfig,repState,data){var store=repConfig.store;repState.update([data]),store.setValue(component,data),repConfig.onSetValue(component,data)},getValue$2=function(component,repConfig,repState){var store=repConfig.store,key=store.getDataKey(component);return repState.lookup(key).getOrThunk((function(){return store.getFallbackEntry(key)}))},onLoad$4=function(component,repConfig,repState){var store;repConfig.store.initialValue.each((function(data){setValue$2(component,repConfig,repState,data)}))},onUnload$1=function(component,repConfig,repState){repState.clear()},DatasetStore=[option("initialValue"),required$1("getFallbackEntry"),required$1("getDataKey"),required$1("setValue"),output$1("manager",{setValue:setValue$2,getValue:getValue$2,onLoad:onLoad$4,onUnload:onUnload$1,state:dataset})],getValue$1=function(component,repConfig,_repState){return repConfig.store.getValue(component)},setValue$1=function(component,repConfig,_repState,data){repConfig.store.setValue(component,data),repConfig.onSetValue(component,data)},onLoad$3=function(component,repConfig,_repState){repConfig.store.initialValue.each((function(data){repConfig.store.setValue(component,data)}))},ManualStore=[required$1("getValue"),defaulted("setValue",noop),option("initialValue"),output$1("manager",{setValue:setValue$1,getValue:getValue$1,onLoad:onLoad$3,onUnload:noop,state:NoState.init})],setValue=function(component,repConfig,repState,data){repState.set(data),repConfig.onSetValue(component,data)},getValue=function(component,repConfig,repState){return repState.get()},onLoad$2=function(component,repConfig,repState){repConfig.store.initialValue.each((function(initVal){repState.isNotSet()&&repState.set(initVal)}))},onUnload=function(component,repConfig,repState){repState.clear()},MemoryStore=[option("initialValue"),output$1("manager",{setValue:setValue,getValue:getValue,onLoad:onLoad$2,onUnload:onUnload,state:memory$1})],RepresentSchema=[defaultedOf("store",{mode:"memory"},choose$1("mode",{memory:MemoryStore,manual:ManualStore,dataset:DatasetStore})),onHandler("onSetValue"),defaulted("resetOnDom",!1)],Representing=create$7({fields:RepresentSchema,name:"representing",active:ActiveRepresenting,apis:RepresentApis,extra:{setValueFrom:function(component,source){var value=Representing.getValue(source);Representing.setValue(component,value)}},state:RepresentState}),field=function(name,forbidden){return defaultedObjOf(name,{},map$2(forbidden,(function(f){return forbid(f.name(),"Cannot configure "+f.name()+" for "+name)})).concat([customField("dump",identity$1)]))},get$2=function(data){return data.dump},augment=function(data,original){return __assign(__assign({},derive$1(original)),data.dump)},SketchBehaviours_field=field,SketchBehaviours_augment=augment,SketchBehaviours_get=get$2,_placeholder="placeholder",adt$3=Adt_generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),isSubstituted=function(spec){return has$2(spec,"uiType")},subPlaceholder=function(owner,detail,compSpec,placeholders){return owner.exists((function(o){return o!==compSpec.owner}))?adt$3.single(!0,constant$1(compSpec)):get$e(placeholders,compSpec.name).fold((function(){throw new Error("Unknown placeholder component: "+compSpec.name+"\nKnown: ["+keys(placeholders)+"]\nNamespace: "+owner.getOr("none")+"\nSpec: "+JSON.stringify(compSpec,null,2))}),(function(newSpec){return newSpec.replace()}))},scan=function(owner,detail,compSpec,placeholders){return isSubstituted(compSpec)&&compSpec.uiType===_placeholder?subPlaceholder(owner,detail,compSpec,placeholders):adt$3.single(!1,constant$1(compSpec))},substitute=function(owner,detail,compSpec,placeholders){var base;return scan(owner,detail,compSpec,placeholders).fold((function(req,valueThunk){var value=isSubstituted(compSpec)?valueThunk(detail,compSpec.config,compSpec.validated):valueThunk(detail),childSpecs=get$e(value,"components").getOr([]),substituted=bind$3(childSpecs,(function(c){return substitute(owner,detail,c,placeholders)}));return[__assign(__assign({},value),{components:substituted})]}),(function(req,valuesThunk){if(isSubstituted(compSpec)){var values=valuesThunk(detail,compSpec.config,compSpec.validated),preprocessor;return compSpec.validated.preprocess.getOr(identity$1)(values)}return valuesThunk(detail)}))},substituteAll=function(owner,detail,components,placeholders){return bind$3(components,(function(c){return substitute(owner,detail,c,placeholders)}))},oneReplace=function(label,replacements){var called=!1,used=function(){return called},replace=function(){if(called)throw new Error("Trying to use the same placeholder more than once: "+label);return called=!0,replacements},required=function(){return replacements.fold((function(req,_){return req}),(function(req,_){return req}))};return{name:constant$1(label),required:required,used:used,replace:replace}},substitutePlaces=function(owner,detail,components,placeholders){var ps=map$1(placeholders,(function(ph,name){return oneReplace(name,ph)})),outcome=substituteAll(owner,detail,components,ps);return each(ps,(function(p){if(!1===p.used()&&p.required())throw new Error("Placeholder: "+p.name()+" was not found in components list\nNamespace: "+owner.getOr("none")+"\nComponents: "+JSON.stringify(detail.components,null,2))})),outcome},single$2=adt$3.single,multiple=adt$3.multiple,placeholder=constant$1(_placeholder),adt$2=Adt_generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),fFactory=defaulted("factory",{sketch:identity$1}),fSchema=defaulted("schema",[]),fName=required$1("name"),fPname=field$1("pname","pname",defaultedThunk((function(typeSpec){return"<alloy."+generate$6(typeSpec.name)+">"})),anyValue()),fGroupSchema=customField("schema",(function(){return[option("preprocess")]})),fDefaults=defaulted("defaults",constant$1({})),fOverrides=defaulted("overrides",constant$1({})),requiredSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]),externalSpec=objOf([fFactory,fSchema,fName,fDefaults,fOverrides]),optionalSpec=objOf([fFactory,fSchema,fName,fPname,fDefaults,fOverrides]),groupSpec=objOf([fFactory,fGroupSchema,fName,required$1("unit"),fPname,fDefaults,fOverrides]),asNamedPart=function(part){return part.fold(Optional.some,Optional.none,Optional.some,Optional.some)},name$1=function(part){var get=function(data){return data.name};return part.fold(get,get,get,get)},asCommon=function(part){return part.fold(identity$1,identity$1,identity$1,identity$1)},convert=function(adtConstructor,partSchema){return function(spec){var data=asRawOrDie$1("Converting part type",partSchema,spec);return adtConstructor(data)}},required=convert(adt$2.required,requiredSpec),external$1=convert(adt$2.external,externalSpec),optional=convert(adt$2.optional,optionalSpec),group=convert(adt$2.group,groupSpec),original=constant$1("entirety"),PartType=Object.freeze({__proto__:null,required:required,external:external$1,optional:optional,group:group,asNamedPart:asNamedPart,name:name$1,asCommon:asCommon,original:original}),combine=function(detail,data,partSpec,partValidated){return deepMerge(data.defaults(detail,partSpec,partValidated),partSpec,{uid:detail.partUids[data.name]},data.overrides(detail,partSpec,partValidated))},subs=function(owner,detail,parts){var internals={},externals={};return each$1(parts,(function(part){part.fold((function(data){internals[data.pname]=single$2(!0,(function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))}))}),(function(data){var partSpec=detail.parts[data.name];externals[data.name]=constant$1(data.factory.sketch(combine(detail,data,partSpec[original()]),partSpec))}),(function(data){internals[data.pname]=single$2(!1,(function(detail,partSpec,partValidated){return data.factory.sketch(combine(detail,data,partSpec,partValidated))}))}),(function(data){internals[data.pname]=multiple(!0,(function(detail,_partSpec,_partValidated){var units=detail[data.name];return map$2(units,(function(u){return data.factory.sketch(deepMerge(data.defaults(detail,u,_partValidated),u,data.overrides(detail,u)))}))}))}))})),{internals:constant$1(internals),externals:constant$1(externals)}},generate$3=function(owner,parts){var r={};return each$1(parts,(function(part){asNamedPart(part).each((function(np){var g=doGenerateOne(owner,np.pname);r[np.name]=function(config){var validated=asRawOrDie$1("Part: "+np.name+" in "+owner,objOf(np.schema),config);return __assign(__assign({},g),{config:config,validated:validated})}}))})),r},doGenerateOne=function(owner,pname){return{uiType:placeholder(),owner:owner,name:pname}},generateOne$1=function(owner,pname,config){return{uiType:placeholder(),owner:owner,name:pname,config:config,validated:{}}},schemas=function(parts){return bind$3(parts,(function(part){return part.fold(Optional.none,Optional.some,Optional.none,Optional.none).map((function(data){return requiredObjOf(data.name,data.schema.concat([snapshot(original())]))})).toArray()}))},names=function(parts){return map$2(parts,name$1)},substitutes=function(owner,detail,parts){return subs(owner,detail,parts)},components$1=function(owner,detail,internals){return substitutePlaces(Optional.some(owner),detail,detail.components,internals)},getPart=function(component,detail,partKey){var uid=detail.partUids[partKey];return component.getSystem().getByUid(uid).toOptional()},getPartOrDie=function(component,detail,partKey){return getPart(component,detail,partKey).getOrDie("Could not find part: "+partKey)},getParts=function(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,(function(pk){r[pk]=constant$1(system.getByUid(uids[pk]))})),r},getAllParts=function(component,detail){var system=component.getSystem();return map$1(detail.partUids,(function(pUid,_k){return constant$1(system.getByUid(pUid))}))},getAllPartNames=function(detail){return keys(detail.partUids)},getPartsOrDie=function(component,detail,partKeys){var r={},uids=detail.partUids,system=component.getSystem();return each$1(partKeys,(function(pk){r[pk]=constant$1(system.getByUid(uids[pk]).getOrDie())})),r},defaultUids=function(baseUid,partTypes){var partNames=names(partTypes);return wrapAll(map$2(partNames,(function(pn){return{key:pn,value:baseUid+"-"+pn}})))},defaultUidsSchema=function(partTypes){return field$1("partUids","partUids",mergeWithThunk((function(spec){return defaultUids(spec.uid,partTypes)})),anyValue())},AlloyParts=Object.freeze({__proto__:null,generate:generate$3,generateOne:generateOne$1,schemas:schemas,names:names,substitutes:substitutes,components:components$1,defaultUids:defaultUids,defaultUidsSchema:defaultUidsSchema,getAllParts:getAllParts,getAllPartNames:getAllPartNames,getPart:getPart,getPartOrDie:getPartOrDie,getParts:getParts,getPartsOrDie:getPartsOrDie}),base=function(partSchemas,partUidsSchemas){var ps;return(partSchemas.length>0?[requiredObjOf("parts",partSchemas)]:[]).concat([required$1("uid"),defaulted("dom",{}),defaulted("components",[]),snapshot("originalSpec"),defaulted("debug.sketcher",{})]).concat(partUidsSchemas)},asRawOrDie=function(label,schema,spec,partSchemas,partUidsSchemas){var baseS=base(partSchemas,partUidsSchemas);return asRawOrDie$1(label+" [SpecSchema]",objOfOnly(baseS.concat(schema)),spec)},single$1=function(owner,schema,factory,spec){var specWithUid=supplyUid(spec),detail;return factory(asRawOrDie(owner,schema,specWithUid,[],[]),specWithUid)},composite$1=function(owner,schema,partTypes,factory,spec){var specWithUid=supplyUid(spec),partSchemas=schemas(partTypes),partUidsSchema=defaultUidsSchema(partTypes),detail=asRawOrDie(owner,schema,specWithUid,partSchemas,[partUidsSchema]),subs=substitutes(owner,detail,partTypes),components;return factory(detail,components$1(owner,detail,subs.internals()),specWithUid,subs.externals())},hasUid=function(spec){return has$2(spec,"uid")},supplyUid=function(spec){return hasUid(spec)?spec:__assign(__assign({},spec),{uid:generate$5("uid")})},isSketchSpec=function(spec){return void 0!==spec.uid},singleSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),defaulted("apis",{}),defaulted("extraApis",{})]),compositeSchema=objOfOnly([required$1("name"),required$1("factory"),required$1("configFields"),required$1("partFields"),defaulted("apis",{}),defaulted("extraApis",{})]),single=function(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,singleSchema,rawConfig),sketch=function(spec){return single$1(config.name,config.configFields,config.factory,spec)},apis=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,(function(f,k){return markAsExtraApi(f,k)}));return __assign(__assign({name:config.name,configFields:config.configFields,sketch:sketch},apis),extraApis)},composite=function(rawConfig){var config=asRawOrDie$1("Sketcher for "+rawConfig.name,compositeSchema,rawConfig),sketch=function(spec){return composite$1(config.name,config.configFields,config.partFields,config.factory,spec)},parts=generate$3(config.name,config.partFields),apis=map$1(config.apis,makeApi),extraApis=map$1(config.extraApis,(function(f,k){return markAsExtraApi(f,k)}));return __assign(__assign({name:config.name,partFields:config.partFields,configFields:config.configFields,sketch:sketch,parts:parts},apis),extraApis)},inside=function(target){return"input"===name$2(target)&&"radio"!==get$d(target,"type")||"textarea"===name$2(target)},getCurrent=function(component,composeConfig,_composeState){return composeConfig.find(component)},ComposeApis=Object.freeze({__proto__:null,getCurrent:getCurrent}),ComposeSchema=[required$1("find")],Composing=create$7({fields:ComposeSchema,name:"composing",apis:ComposeApis}),nativeDisabled=["input","button","textarea","select"],onLoad$1=function(component,disableConfig,disableState){var f;(disableConfig.disabled()?disable$1:enable$1)(component,disableConfig)},hasNative=function(component,config){return!0===config.useNative&&contains$2(nativeDisabled,name$2(component.element))},nativeIsDisabled=function(component){return has$1(component.element,"disabled")},nativeDisable=function(component){set$8(component.element,"disabled","disabled")},nativeEnable=function(component){remove$7(component.element,"disabled")},ariaIsDisabled=function(component){return"true"===get$d(component.element,"aria-disabled")},ariaDisable=function(component){set$8(component.element,"aria-disabled","true")},ariaEnable=function(component){set$8(component.element,"aria-disabled","false")},disable$1=function(component,disableConfig,_disableState){var f;disableConfig.disableClass.each((function(disableClass){add$2(component.element,disableClass)})),(hasNative(component,disableConfig)?nativeDisable:ariaDisable)(component),disableConfig.onDisabled(component)},enable$1=function(component,disableConfig,_disableState){var f;disableConfig.disableClass.each((function(disableClass){remove$2(component.element,disableClass)})),(hasNative(component,disableConfig)?nativeEnable:ariaEnable)(component),disableConfig.onEnabled(component)},isDisabled=function(component,disableConfig){return hasNative(component,disableConfig)?nativeIsDisabled(component):ariaIsDisabled(component)},set$3=function(component,disableConfig,disableState,disabled){var f;(disabled?disable$1:enable$1)(component,disableConfig)},DisableApis=Object.freeze({__proto__:null,enable:enable$1,disable:disable$1,isDisabled:isDisabled,onLoad:onLoad$1,set:set$3}),exhibit$5=function(base,disableConfig){return nu$7({classes:disableConfig.disabled()?disableConfig.disableClass.toArray():[]})},events$e=function(disableConfig,disableState){return derive$2([abort(execute$5(),(function(component,_simulatedEvent){return isDisabled(component,disableConfig)})),loadEvent(disableConfig,disableState,onLoad$1)])},ActiveDisable=Object.freeze({__proto__:null,exhibit:exhibit$5,events:events$e}),DisableSchema=[defaultedFunction("disabled",never),defaulted("useNative",!0),option("disableClass"),onHandler("onDisabled"),onHandler("onEnabled")],Disabling=create$7({fields:DisableSchema,name:"disabling",active:ActiveDisable,apis:DisableApis}),dehighlightAllExcept=function(component,hConfig,hState,skip){var highlighted=descendants(component.element,"."+hConfig.highlightClass);each$1(highlighted,(function(h){exists(skip,(function(skipComp){return skipComp.element===h}))||(remove$2(h,hConfig.highlightClass),component.getSystem().getByDom(h).each((function(target){hConfig.onDehighlight(component,target),emit(target,dehighlight$1())})))}))},dehighlightAll=function(component,hConfig,hState){return dehighlightAllExcept(component,hConfig,hState,[])},dehighlight=function(component,hConfig,hState,target){isHighlighted(component,hConfig,hState,target)&&(remove$2(target.element,hConfig.highlightClass),hConfig.onDehighlight(component,target),emit(target,dehighlight$1()))},highlight=function(component,hConfig,hState,target){dehighlightAllExcept(component,hConfig,hState,[target]),isHighlighted(component,hConfig,hState,target)||(add$2(target.element,hConfig.highlightClass),hConfig.onHighlight(component,target),emit(target,highlight$1()))},highlightFirst=function(component,hConfig,hState){getFirst(component,hConfig).each((function(firstComp){highlight(component,hConfig,hState,firstComp)}))},highlightLast=function(component,hConfig,hState){getLast(component,hConfig).each((function(lastComp){highlight(component,hConfig,hState,lastComp)}))},highlightAt=function(component,hConfig,hState,index){getByIndex(component,hConfig,hState,index).fold((function(err){throw err}),(function(firstComp){highlight(component,hConfig,hState,firstComp)}))},highlightBy=function(component,hConfig,hState,predicate){var candidates=getCandidates(component,hConfig),targetComp;find$5(candidates,predicate).each((function(c){highlight(component,hConfig,hState,c)}))},isHighlighted=function(component,hConfig,hState,queryTarget){return has(queryTarget.element,hConfig.highlightClass)},getHighlighted=function(component,hConfig,_hState){return descendant(component.element,"."+hConfig.highlightClass).bind((function(e){return component.getSystem().getByDom(e).toOptional()}))},getByIndex=function(component,hConfig,hState,index){var items=descendants(component.element,"."+hConfig.itemClass);return Optional.from(items[index]).fold((function(){return Result.error(new Error("No element found with index "+index))}),component.getSystem().getByDom)},getFirst=function(component,hConfig,_hState){return descendant(component.element,"."+hConfig.itemClass).bind((function(e){return component.getSystem().getByDom(e).toOptional()}))},getLast=function(component,hConfig,_hState){var items=descendants(component.element,"."+hConfig.itemClass),last;return(items.length>0?Optional.some(items[items.length-1]):Optional.none()).bind((function(c){return component.getSystem().getByDom(c).toOptional()}))},getDelta$2=function(component,hConfig,hState,delta){var items=descendants(component.element,"."+hConfig.itemClass),current;return findIndex$1(items,(function(item){return has(item,hConfig.highlightClass)})).bind((function(selected){var dest=cycleBy(selected,delta,0,items.length-1);return component.getSystem().getByDom(items[dest]).toOptional()}))},getPrevious=function(component,hConfig,hState){return getDelta$2(component,hConfig,hState,-1)},getNext=function(component,hConfig,hState){return getDelta$2(component,hConfig,hState,1)},getCandidates=function(component,hConfig,_hState){var items=descendants(component.element,"."+hConfig.itemClass);return cat(map$2(items,(function(i){return component.getSystem().getByDom(i).toOptional()})))},HighlightApis=Object.freeze({__proto__:null,dehighlightAll:dehighlightAll,dehighlight:dehighlight,highlight:highlight,highlightFirst:highlightFirst,highlightLast:highlightLast,highlightAt:highlightAt,highlightBy:highlightBy,isHighlighted:isHighlighted,getHighlighted:getHighlighted,getFirst:getFirst,getLast:getLast,getPrevious:getPrevious,getNext:getNext,getCandidates:getCandidates}),HighlightSchema=[required$1("highlightClass"),required$1("itemClass"),onHandler("onHighlight"),onHandler("onDehighlight")],Highlighting=create$7({fields:HighlightSchema,name:"highlighting",apis:HighlightApis}),BACKSPACE=[8],TAB=[9],ENTER=[13],ESCAPE=[27],SPACE=[32],LEFT=[37],UP=[38],RIGHT=[39],DOWN=[40],cyclePrev=function(values,index,predicate){var before=reverse(values.slice(0,index)),after=reverse(values.slice(index+1));return find$5(before.concat(after),predicate)},tryPrev=function(values,index,predicate){var before=reverse(values.slice(0,index));return find$5(before,predicate)},cycleNext=function(values,index,predicate){var before=values.slice(0,index),after=values.slice(index+1);return find$5(after.concat(before),predicate)},tryNext=function(values,index,predicate){var after=values.slice(index+1);return find$5(after,predicate)},inSet=function(keys){return function(event){var raw=event.raw;return contains$2(keys,raw.which)}},and=function(preds){return function(event){return forall(preds,(function(pred){return pred(event)}))}},isShift=function(event){var raw;return!0===event.raw.shiftKey},isControl=function(event){var raw;return!0===event.raw.ctrlKey},isNotShift=not(isShift),rule=function(matches,action){return{matches:matches,classification:action}},choose=function(transitions,event){var transition;return find$5(transitions,(function(t){return t.matches(event)})).map((function(t){return t.classification}))},reportFocusShifting=function(component,prevFocus,newFocus){var noChange;prevFocus.exists((function(p){return newFocus.exists((function(n){return eq(n,p)}))}))||emitWith(component,focusShifted(),{prevFocus:prevFocus,newFocus:newFocus})},dom$2=function(){var get=function(component){return search(component.element)},set=function(component,focusee){var prevFocus=get(component);component.getSystem().triggerFocus(focusee,component.element);var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus)};return{get:get,set:set}},highlights=function(){var get=function(component){return Highlighting.getHighlighted(component).map((function(item){return item.element}))},set=function(component,element){var prevFocus=get(component);component.getSystem().getByDom(element).fold(noop,(function(item){Highlighting.highlight(component,item)}));var newFocus=get(component);reportFocusShifting(component,prevFocus,newFocus)};return{get:get,set:set}},FocusInsideModes;!function(FocusInsideModes){FocusInsideModes.OnFocusMode="onFocus",FocusInsideModes.OnEnterOrSpaceMode="onEnterOrSpace",FocusInsideModes.OnApiMode="onApi"}(FocusInsideModes||(FocusInsideModes={}));var typical=function(infoSchema,stateInit,getKeydownRules,getKeyupRules,optFocusIn){var schema,processKey=function(component,simulatedEvent,getRules,keyingConfig,keyingState){var rules=getRules(component,simulatedEvent,keyingConfig,keyingState);return choose(rules,simulatedEvent.event).bind((function(rule){return rule(component,simulatedEvent,keyingConfig,keyingState)}))},toEvents=function(keyingConfig,keyingState){var onFocusHandler=keyingConfig.focusInside!==FocusInsideModes.OnFocusMode?Optional.none():optFocusIn(keyingConfig).map((function(focusIn){return run$1(focus$4(),(function(component,simulatedEvent){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()}))})),tryGoInsideComponent=function(component,simulatedEvent){var isEnterOrSpace=inSet(SPACE.concat(ENTER))(simulatedEvent.event);keyingConfig.focusInside===FocusInsideModes.OnEnterOrSpaceMode&&isEnterOrSpace&&isSource(component,simulatedEvent)&&optFocusIn(keyingConfig).each((function(focusIn){focusIn(component,keyingConfig,keyingState),simulatedEvent.stop()}))},keyboardEvents=[run$1(keydown(),(function(component,simulatedEvent){processKey(component,simulatedEvent,getKeydownRules,keyingConfig,keyingState).fold((function(){tryGoInsideComponent(component,simulatedEvent)}),(function(_){simulatedEvent.stop()}))})),run$1(keyup(),(function(component,simulatedEvent){processKey(component,simulatedEvent,getKeyupRules,keyingConfig,keyingState).each((function(_){simulatedEvent.stop()}))}))];return derive$2(onFocusHandler.toArray().concat(keyboardEvents))},me={schema:function(){return infoSchema.concat([defaulted("focusManager",dom$2()),defaultedOf("focusInside","onFocus",valueOf((function(val){return contains$2(["onFocus","onEnterOrSpace","onApi"],val)?Result.value(val):Result.error("Invalid value for focusInside")}))),output$1("handler",me),output$1("state",stateInit),output$1("sendFocusIn",optFocusIn)])},processKey:processKey,toEvents:toEvents};return me},create$5=function(cyclicField){var schema=[option("onEscape"),option("onEnter"),defaulted("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),defaulted("firstTabstop",0),defaulted("useTabstopAt",always),option("visibilitySelector")].concat([cyclicField]),isVisible=function(tabbingConfig,element){var target=tabbingConfig.visibilitySelector.bind((function(sel){return closest$1(element,sel)})).getOr(element);return get$b(target)>0},findInitial=function(component,tabbingConfig){var tabstops=descendants(component.element,tabbingConfig.selector),visibles=filter$2(tabstops,(function(elem){return isVisible(tabbingConfig,elem)}));return Optional.from(visibles[tabbingConfig.firstTabstop])},findCurrent=function(component,tabbingConfig){return tabbingConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,tabbingConfig.selector)}))},isTabstop=function(tabbingConfig,element){return isVisible(tabbingConfig,element)&&tabbingConfig.useTabstopAt(element)},focusIn=function(component,tabbingConfig,_tabbingState){findInitial(component,tabbingConfig).each((function(target){tabbingConfig.focusManager.set(component,target)}))},goFromTabstop=function(component,tabstops,stopIndex,tabbingConfig,cycle){return cycle(tabstops,stopIndex,(function(elem){return isTabstop(tabbingConfig,elem)})).fold((function(){return tabbingConfig.cyclic?Optional.some(!0):Optional.none()}),(function(target){return tabbingConfig.focusManager.set(component,target),Optional.some(!0)}))},go=function(component,_simulatedEvent,tabbingConfig,cycle){var tabstops=descendants(component.element,tabbingConfig.selector);return findCurrent(component,tabbingConfig).bind((function(tabstop){var optStopIndex;return findIndex$1(tabstops,curry(eq,tabstop)).bind((function(stopIndex){return goFromTabstop(component,tabstops,stopIndex,tabbingConfig,cycle)}))}))},goBackwards=function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cyclePrev:tryPrev;return go(component,simulatedEvent,tabbingConfig,navigate)},goForwards=function(component,simulatedEvent,tabbingConfig){var navigate=tabbingConfig.cyclic?cycleNext:tryNext;return go(component,simulatedEvent,tabbingConfig,navigate)},execute=function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEnter.bind((function(f){return f(component,simulatedEvent)}))},exit=function(component,simulatedEvent,tabbingConfig){return tabbingConfig.onEscape.bind((function(f){return f(component,simulatedEvent)}))},getKeydownRules=constant$1([rule(and([isShift,inSet(TAB)]),goBackwards),rule(inSet(TAB),goForwards),rule(inSet(ESCAPE),exit),rule(and([isNotShift,inSet(ENTER)]),execute)]),getKeyupRules=constant$1([]);return typical(schema,NoState.init,getKeydownRules,getKeyupRules,(function(){return Optional.some(focusIn)}))},AcyclicType=create$5(customField("cyclic",never)),CyclicType=create$5(customField("cyclic",always)),doDefaultExecute=function(component,_simulatedEvent,focused){return dispatch(component,focused,execute$5()),Optional.some(!0)},defaultExecute=function(component,simulatedEvent,focused){var isComplex;return inside(focused)&&inSet(SPACE)(simulatedEvent.event)?Optional.none():doDefaultExecute(component,simulatedEvent,focused)},stopEventForFirefox=function(_component,_simulatedEvent){return Optional.some(!0)},schema$v=[defaulted("execute",defaultExecute),defaulted("useSpace",!1),defaulted("useEnter",!0),defaulted("useControlEnter",!1),defaulted("useDown",!1)],execute$4=function(component,simulatedEvent,executeConfig){return executeConfig.execute(component,simulatedEvent,component.element)},getKeydownRules$5=function(component,_simulatedEvent,executeConfig,_executeState){var spaceExec=executeConfig.useSpace&&!inside(component.element)?SPACE:[],enterExec=executeConfig.useEnter?ENTER:[],downExec=executeConfig.useDown?DOWN:[],execKeys=spaceExec.concat(enterExec).concat(downExec);return[rule(inSet(execKeys),execute$4)].concat(executeConfig.useControlEnter?[rule(and([isControl,inSet(ENTER)]),execute$4)]:[])},getKeyupRules$5=function(component,_simulatedEvent,executeConfig,_executeState){return executeConfig.useSpace&&!inside(component.element)?[rule(inSet(SPACE),stopEventForFirefox)]:[]},ExecutionType=typical(schema$v,NoState.init,getKeydownRules$5,getKeyupRules$5,(function(){return Optional.none()})),flatgrid$1=function(){var dimensions=value$1(),setGridSize,getNumRows,getNumColumns;return nu$8({readState:function(){return dimensions.get().map((function(d){return{numRows:String(d.numRows),numColumns:String(d.numColumns)}})).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(numRows,numColumns){dimensions.set({numRows:numRows,numColumns:numColumns})},getNumRows:function(){return dimensions.get().map((function(d){return d.numRows}))},getNumColumns:function(){return dimensions.get().map((function(d){return d.numColumns}))}})},init$d=function(spec){return spec.state(spec)},KeyingState=Object.freeze({__proto__:null,flatgrid:flatgrid$1,init:init$d}),useH=function(movement){return function(component,simulatedEvent,config,state){var move=movement(component.element);return use(move,component,simulatedEvent,config,state)}},west$1=function(moveLeft,moveRight){var movement=onDirection(moveLeft,moveRight);return useH(movement)},east$1=function(moveLeft,moveRight){var movement=onDirection(moveRight,moveLeft);return useH(movement)},useV=function(move){return function(component,simulatedEvent,config,state){return use(move,component,simulatedEvent,config,state)}},use=function(move,component,simulatedEvent,config,state){var outcome;return config.focusManager.get(component).bind((function(focused){return move(component.element,focused,config,state)})).map((function(newFocus){return config.focusManager.set(component,newFocus),!0}))},north$1=useV,south$1=useV,move$1=useV,isHidden$1=function(dom){return dom.offsetWidth<=0&&dom.offsetHeight<=0},isVisible=function(element){return!isHidden$1(element.dom)},locate=function(candidates,predicate){return findIndex$1(candidates,predicate).map((function(index){return{index:index,candidates:candidates}}))},locateVisible=function(container,current,selector){var predicate=function(x){return eq(x,current)},candidates=descendants(container,selector),visible=filter$2(candidates,isVisible);return locate(visible,predicate)},findIndex=function(elements,target){return findIndex$1(elements,(function(elem){return eq(target,elem)}))},withGrid=function(values,index,numCols,f){var oldRow,oldColumn;return f(Math.floor(index/numCols),index%numCols).bind((function(address){var newIndex=address.row*numCols+address.column;return newIndex>=0&&newIndex<values.length?Optional.some(values[newIndex]):Optional.none()}))},cycleHorizontal$1=function(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,(function(oldRow,oldColumn){var onLastRow,colsInRow=oldRow===numRows-1?values.length-oldRow*numCols:numCols,newColumn=cycleBy(oldColumn,delta,0,colsInRow-1);return Optional.some({row:oldRow,column:newColumn})}))},cycleVertical$1=function(values,index,numRows,numCols,delta){return withGrid(values,index,numCols,(function(oldRow,oldColumn){var newRow=cycleBy(oldRow,delta,0,numRows-1),onLastRow,colsInRow=newRow===numRows-1?values.length-newRow*numCols:numCols,newCol=clamp$1(oldColumn,0,colsInRow-1);return Optional.some({row:newRow,column:newCol})}))},cycleRight$1=function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,1)},cycleLeft$1=function(values,index,numRows,numCols){return cycleHorizontal$1(values,index,numRows,numCols,-1)},cycleUp$1=function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,-1)},cycleDown$1=function(values,index,numRows,numCols){return cycleVertical$1(values,index,numRows,numCols,1)},schema$u=[required$1("selector"),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("captureTab",!1),initSize()],focusIn$3=function(component,gridConfig,_gridState){descendant(component.element,gridConfig.selector).each((function(first){gridConfig.focusManager.set(component,first)}))},findCurrent$1=function(component,gridConfig){return gridConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,gridConfig.selector)}))},execute$3=function(component,simulatedEvent,gridConfig,_gridState){return findCurrent$1(component,gridConfig).bind((function(focused){return gridConfig.execute(component,simulatedEvent,focused)}))},doMove$2=function(cycle){return function(element,focused,gridConfig,gridState){return locateVisible(element,focused,gridConfig.selector).bind((function(identified){return cycle(identified.candidates,identified.index,gridState.getNumRows().getOr(gridConfig.initSize.numRows),gridState.getNumColumns().getOr(gridConfig.initSize.numColumns))}))}},handleTab=function(_component,_simulatedEvent,gridConfig){return gridConfig.captureTab?Optional.some(!0):Optional.none()},doEscape$1=function(component,simulatedEvent,gridConfig){return gridConfig.onEscape(component,simulatedEvent)},moveLeft$3=doMove$2(cycleLeft$1),moveRight$3=doMove$2(cycleRight$1),moveNorth$1=doMove$2(cycleUp$1),moveSouth$1=doMove$2(cycleDown$1),getKeydownRules$4=constant$1([rule(inSet(LEFT),west$1(moveLeft$3,moveRight$3)),rule(inSet(RIGHT),east$1(moveLeft$3,moveRight$3)),rule(inSet(UP),north$1(moveNorth$1)),rule(inSet(DOWN),south$1(moveSouth$1)),rule(and([isShift,inSet(TAB)]),handleTab),rule(and([isNotShift,inSet(TAB)]),handleTab),rule(inSet(ESCAPE),doEscape$1),rule(inSet(SPACE.concat(ENTER)),execute$3)]),getKeyupRules$4=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),FlatgridType=typical(schema$u,flatgrid$1,getKeydownRules$4,getKeyupRules$4,(function(){return Optional.some(focusIn$3)})),horizontal=function(container,selector,current,delta){var isDisabledButton=function(candidate){return"button"===name$2(candidate)&&"disabled"===get$d(candidate,"disabled")},tryCycle=function(initial,index,candidates){var newIndex=cycleBy(index,delta,0,candidates.length-1);return newIndex===initial?Optional.none():isDisabledButton(candidates[newIndex])?tryCycle(initial,newIndex,candidates):Optional.from(candidates[newIndex])};return locateVisible(container,current,selector).bind((function(identified){var index=identified.index,candidates=identified.candidates;return tryCycle(index,index,candidates)}))},schema$t=[required$1("selector"),defaulted("getInitial",Optional.none),defaulted("execute",defaultExecute),onKeyboardHandler("onEscape"),defaulted("executeOnMove",!1),defaulted("allowVertical",!0)],findCurrent=function(component,flowConfig){return flowConfig.focusManager.get(component).bind((function(elem){return closest$1(elem,flowConfig.selector)}))},execute$2=function(component,simulatedEvent,flowConfig){return findCurrent(component,flowConfig).bind((function(focused){return flowConfig.execute(component,simulatedEvent,focused)}))},focusIn$2=function(component,flowConfig,_state){flowConfig.getInitial(component).orThunk((function(){return descendant(component.element,flowConfig.selector)})).each((function(first){flowConfig.focusManager.set(component,first)}))},moveLeft$2=function(element,focused,info){return horizontal(element,info.selector,focused,-1)},moveRight$2=function(element,focused,info){return horizontal(element,info.selector,focused,1)},doMove$1=function(movement){return function(component,simulatedEvent,flowConfig,flowState){return movement(component,simulatedEvent,flowConfig,flowState).bind((function(){return flowConfig.executeOnMove?execute$2(component,simulatedEvent,flowConfig):Optional.some(!0)}))}},doEscape=function(component,simulatedEvent,flowConfig){return flowConfig.onEscape(component,simulatedEvent)},getKeydownRules$3=function(_component,_se,flowConfig,_flowState){var westMovers=LEFT.concat(flowConfig.allowVertical?UP:[]),eastMovers=RIGHT.concat(flowConfig.allowVertical?DOWN:[]);return[rule(inSet(westMovers),doMove$1(west$1(moveLeft$2,moveRight$2))),rule(inSet(eastMovers),doMove$1(east$1(moveLeft$2,moveRight$2))),rule(inSet(ENTER),execute$2),rule(inSet(SPACE),execute$2),rule(inSet(ESCAPE),doEscape)]},getKeyupRules$3=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),FlowType=typical(schema$t,NoState.init,getKeydownRules$3,getKeyupRules$3,(function(){return Optional.some(focusIn$2)})),toCell=function(matrix,rowIndex,columnIndex){return Optional.from(matrix[rowIndex]).bind((function(row){return Optional.from(row[columnIndex]).map((function(cell){return{rowIndex:rowIndex,columnIndex:columnIndex,cell:cell}}))}))},cycleHorizontal=function(matrix,rowIndex,startCol,deltaCol){var row,colsInRow=matrix[rowIndex].length,newColIndex=cycleBy(startCol,deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex)},cycleVertical=function(matrix,colIndex,startRow,deltaRow){var nextRowIndex=cycleBy(startRow,deltaRow,0,matrix.length-1),colsInNextRow=matrix[nextRowIndex].length,nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex)},moveHorizontal=function(matrix,rowIndex,startCol,deltaCol){var row,colsInRow=matrix[rowIndex].length,newColIndex=clamp$1(startCol+deltaCol,0,colsInRow-1);return toCell(matrix,rowIndex,newColIndex)},moveVertical=function(matrix,colIndex,startRow,deltaRow){var nextRowIndex=clamp$1(startRow+deltaRow,0,matrix.length-1),colsInNextRow=matrix[nextRowIndex].length,nextColIndex=clamp$1(colIndex,0,colsInNextRow-1);return toCell(matrix,nextRowIndex,nextColIndex)},cycleRight=function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,1)},cycleLeft=function(matrix,startRow,startCol){return cycleHorizontal(matrix,startRow,startCol,-1)},cycleUp=function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,-1)},cycleDown=function(matrix,startRow,startCol){return cycleVertical(matrix,startCol,startRow,1)},moveLeft$1=function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,-1)},moveRight$1=function(matrix,startRow,startCol){return moveHorizontal(matrix,startRow,startCol,1)},moveUp$1=function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,-1)},moveDown$1=function(matrix,startRow,startCol){return moveVertical(matrix,startCol,startRow,1)},schema$s=[requiredObjOf("selectors",[required$1("row"),required$1("cell")]),defaulted("cycles",!0),defaulted("previousSelector",Optional.none),defaulted("execute",defaultExecute)],focusIn$1=function(component,matrixConfig,_state){var focused;matrixConfig.previousSelector(component).orThunk((function(){var selectors=matrixConfig.selectors;return descendant(component.element,selectors.cell)})).each((function(cell){matrixConfig.focusManager.set(component,cell)}))},execute$1=function(component,simulatedEvent,matrixConfig){return search(component.element).bind((function(focused){return matrixConfig.execute(component,simulatedEvent,focused)}))},toMatrix=function(rows,matrixConfig){return map$2(rows,(function(row){return descendants(row,matrixConfig.selectors.cell)}))},doMove=function(ifCycle,ifMove){return function(element,focused,matrixConfig){var move=matrixConfig.cycles?ifCycle:ifMove;return closest$1(focused,matrixConfig.selectors.row).bind((function(inRow){var cellsInRow=descendants(inRow,matrixConfig.selectors.cell);return findIndex(cellsInRow,focused).bind((function(colIndex){var allRows=descendants(element,matrixConfig.selectors.row);return findIndex(allRows,inRow).bind((function(rowIndex){var matrix=toMatrix(allRows,matrixConfig);return move(matrix,rowIndex,colIndex).map((function(next){return next.cell}))}))}))}))}},moveLeft=doMove(cycleLeft,moveLeft$1),moveRight=doMove(cycleRight,moveRight$1),moveNorth=doMove(cycleUp,moveUp$1),moveSouth=doMove(cycleDown,moveDown$1),getKeydownRules$2=constant$1([rule(inSet(LEFT),west$1(moveLeft,moveRight)),rule(inSet(RIGHT),east$1(moveLeft,moveRight)),rule(inSet(UP),north$1(moveNorth)),rule(inSet(DOWN),south$1(moveSouth)),rule(inSet(SPACE.concat(ENTER)),execute$1)]),getKeyupRules$2=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),MatrixType=typical(schema$s,NoState.init,getKeydownRules$2,getKeyupRules$2,(function(){return Optional.some(focusIn$1)})),schema$r=[required$1("selector"),defaulted("execute",defaultExecute),defaulted("moveOnTab",!1)],execute=function(component,simulatedEvent,menuConfig){return menuConfig.focusManager.get(component).bind((function(focused){return menuConfig.execute(component,simulatedEvent,focused)}))},focusIn=function(component,menuConfig,_state){descendant(component.element,menuConfig.selector).each((function(first){menuConfig.focusManager.set(component,first)}))},moveUp=function(element,focused,info){return horizontal(element,info.selector,focused,-1)},moveDown=function(element,focused,info){return horizontal(element,info.selector,focused,1)},fireShiftTab=function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveUp)(component,simulatedEvent,menuConfig,menuState):Optional.none()},fireTab=function(component,simulatedEvent,menuConfig,menuState){return menuConfig.moveOnTab?move$1(moveDown)(component,simulatedEvent,menuConfig,menuState):Optional.none()},getKeydownRules$1=constant$1([rule(inSet(UP),move$1(moveUp)),rule(inSet(DOWN),move$1(moveDown)),rule(and([isShift,inSet(TAB)]),fireShiftTab),rule(and([isNotShift,inSet(TAB)]),fireTab),rule(inSet(ENTER),execute),rule(inSet(SPACE),execute)]),getKeyupRules$1=constant$1([rule(inSet(SPACE),stopEventForFirefox)]),MenuType=typical(schema$r,NoState.init,getKeydownRules$1,getKeyupRules$1,(function(){return Optional.some(focusIn)})),schema$q=[onKeyboardHandler("onSpace"),onKeyboardHandler("onEnter"),onKeyboardHandler("onShiftEnter"),onKeyboardHandler("onLeft"),onKeyboardHandler("onRight"),onKeyboardHandler("onTab"),onKeyboardHandler("onShiftTab"),onKeyboardHandler("onUp"),onKeyboardHandler("onDown"),onKeyboardHandler("onEscape"),defaulted("stopSpaceKeyup",!1),option("focusIn")],getKeydownRules,getKeyupRules,SpecialType=typical(schema$q,NoState.init,(function(component,simulatedEvent,specialInfo){return[rule(inSet(SPACE),specialInfo.onSpace),rule(and([isNotShift,inSet(ENTER)]),specialInfo.onEnter),rule(and([isShift,inSet(ENTER)]),specialInfo.onShiftEnter),rule(and([isShift,inSet(TAB)]),specialInfo.onShiftTab),rule(and([isNotShift,inSet(TAB)]),specialInfo.onTab),rule(inSet(UP),specialInfo.onUp),rule(inSet(DOWN),specialInfo.onDown),rule(inSet(LEFT),specialInfo.onLeft),rule(inSet(RIGHT),specialInfo.onRight),rule(inSet(SPACE),specialInfo.onSpace),rule(inSet(ESCAPE),specialInfo.onEscape)]}),(function(component,simulatedEvent,specialInfo){return specialInfo.stopSpaceKeyup?[rule(inSet(SPACE),stopEventForFirefox)]:[]}),(function(specialInfo){return specialInfo.focusIn})),acyclic=AcyclicType.schema(),cyclic=CyclicType.schema(),flow=FlowType.schema(),flatgrid=FlatgridType.schema(),matrix=MatrixType.schema(),execution=ExecutionType.schema(),menu=MenuType.schema(),special=SpecialType.schema(),KeyboardBranches,isFlatgridState=function(keyState){return hasNonNullableKey(keyState,"setGridSize")},Keying=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:acyclic,cyclic:cyclic,flow:flow,flatgrid:flatgrid,matrix:matrix,execution:execution,menu:menu,special:special}),name:"keying",active:{events:function(keyingConfig,keyingState){var handler;return keyingConfig.handler.toEvents(keyingConfig,keyingState)}},apis:{focusIn:function(component,keyConfig,keyState){keyConfig.sendFocusIn(keyConfig).fold((function(){component.getSystem().triggerFocus(component.element,component.element)}),(function(sendFocusIn){sendFocusIn(component,keyConfig,keyState)}))},setGridSize:function(component,keyConfig,keyState,numRows,numColumns){isFlatgridState(keyState)?keyState.setGridSize(numRows,numColumns):console.error("Layout does not support setGridSize")}},state:KeyingState}),set$2=function(component,replaceConfig,replaceState,data){preserve$1((function(){var newChildren=map$2(data,component.getSystem().build);replaceChildren(component,newChildren)}),component.element)},insert=function(component,replaceConfig,insertion,childSpec){var child=component.getSystem().build(childSpec);attachWith(component,child,insertion)},append=function(component,replaceConfig,replaceState,appendee){insert(component,replaceConfig,append$2,appendee)},prepend=function(component,replaceConfig,replaceState,prependee){insert(component,replaceConfig,prepend$1,prependee)},remove=function(component,replaceConfig,replaceState,removee){var children=contents(component),foundChild;find$5(children,(function(child){return eq(removee.element,child.element)})).each(detach)},contents=function(component,_replaceConfig){return component.components()},replaceAt=function(component,replaceConfig,replaceState,replaceeIndex,replacer){var children=contents(component);return Optional.from(children[replaceeIndex]).map((function(replacee){return remove(component,replaceConfig,replaceState,replacee),replacer.each((function(r){insert(component,replaceConfig,(function(p,c){appendAt(p,c,replaceeIndex)}),r)})),replacee}))},replaceBy=function(component,replaceConfig,replaceState,replaceePred,replacer){var children=contents(component);return findIndex$1(children,replaceePred).bind((function(replaceeIndex){return replaceAt(component,replaceConfig,replaceState,replaceeIndex,replacer)}))},ReplaceApis,Replacing=create$7({fields:[],name:"replacing",apis:Object.freeze({__proto__:null,append:append,prepend:prepend,remove:remove,replaceAt:replaceAt,replaceBy:replaceBy,set:set$2,contents:contents})}),events$d=function(name,eventHandlers){var events=derive$2(eventHandlers);return create$7({fields:[required$1("enabled")],name:name,active:{events:constant$1(events)}})},config=function(name,eventHandlers){var me;return{key:name,value:{config:{},me:events$d(name,eventHandlers),configAsRaw:constant$1({}),initialConfig:{},state:NoState}}},focus$2=function(component,focusConfig){focusConfig.ignore||(focus$3(component.element),focusConfig.onFocus(component))},blur=function(component,focusConfig){focusConfig.ignore||blur$1(component.element)},isFocused=function(component){return hasFocus(component.element)},FocusApis=Object.freeze({__proto__:null,focus:focus$2,blur:blur,isFocused:isFocused}),exhibit$4=function(base,focusConfig){var mod=focusConfig.ignore?{}:{attributes:{tabindex:"-1"}};return nu$7(mod)},events$c=function(focusConfig){return derive$2([run$1(focus$4(),(function(component,simulatedEvent){focus$2(component,focusConfig),simulatedEvent.stop()}))].concat(focusConfig.stopMousedown?[run$1(mousedown(),(function(_,simulatedEvent){simulatedEvent.event.prevent()}))]:[]))},ActiveFocus=Object.freeze({__proto__:null,exhibit:exhibit$4,events:events$c}),FocusSchema=[onHandler("onFocus"),defaulted("stopMousedown",!1),defaulted("ignore",!1)],Focusing=create$7({fields:FocusSchema,name:"focusing",active:ActiveFocus,apis:FocusApis}),SetupBehaviourCellState=function(initialState){var init;return{init:function(){var cell=Cell(initialState),get,set,clear,readState;return{get:function(){return cell.get()},set:function(newState){return cell.set(newState)},clear:function(){return cell.set(initialState)},readState:function(){return cell.get()}}}}},updateAriaState=function(component,toggleConfig,toggleState){var ariaInfo=toggleConfig.aria;ariaInfo.update(component,ariaInfo,toggleState.get())},updateClass=function(component,toggleConfig,toggleState){toggleConfig.toggleClass.each((function(toggleClass){toggleState.get()?add$2(component.element,toggleClass):remove$2(component.element,toggleClass)}))},toggle$2=function(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,!toggleState.get())},on=function(component,toggleConfig,toggleState){toggleState.set(!0),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},off=function(component,toggleConfig,toggleState){toggleState.set(!1),updateClass(component,toggleConfig,toggleState),updateAriaState(component,toggleConfig,toggleState)},set$1=function(component,toggleConfig,toggleState,state){var action;(state?on:off)(component,toggleConfig,toggleState)},isOn=function(component,toggleConfig,toggleState){return toggleState.get()},onLoad=function(component,toggleConfig,toggleState){set$1(component,toggleConfig,toggleState,toggleConfig.selected)},ToggleApis=Object.freeze({__proto__:null,onLoad:onLoad,toggle:toggle$2,isOn:isOn,on:on,off:off,set:set$1}),exhibit$3=function(){return nu$7({})},events$b=function(toggleConfig,toggleState){var execute=executeEvent(toggleConfig,toggleState,toggle$2),load=loadEvent(toggleConfig,toggleState,onLoad);return derive$2(flatten([toggleConfig.toggleOnExecute?[execute]:[],[load]]))},ActiveToggle=Object.freeze({__proto__:null,exhibit:exhibit$3,events:events$b}),updatePressed=function(component,ariaInfo,status){set$8(component.element,"aria-pressed",status),ariaInfo.syncWithExpanded&&updateExpanded(component,ariaInfo,status)},updateSelected=function(component,ariaInfo,status){set$8(component.element,"aria-selected",status)},updateChecked=function(component,ariaInfo,status){set$8(component.element,"aria-checked",status)},updateExpanded=function(component,ariaInfo,status){set$8(component.element,"aria-expanded",status)},ToggleSchema=[defaulted("selected",!1),option("toggleClass"),defaulted("toggleOnExecute",!0),defaultedOf("aria",{mode:"none"},choose$1("mode",{pressed:[defaulted("syncWithExpanded",!1),output$1("update",updatePressed)],checked:[output$1("update",updateChecked)],expanded:[output$1("update",updateExpanded)],selected:[output$1("update",updateSelected)],none:[output$1("update",noop)]}))],Toggling=create$7({fields:ToggleSchema,name:"toggling",active:ActiveToggle,apis:ToggleApis,state:SetupBehaviourCellState(!1)}),pointerEvents=function(){var onClick=function(component,simulatedEvent){simulatedEvent.stop(),emitExecute(component)};return[run$1(click(),onClick),run$1(tap(),onClick),cutter(touchstart()),cutter(mousedown())]},events$a=function(optAction){var executeHandler=function(action){return runOnExecute$1((function(component,simulatedEvent){action(component),simulatedEvent.stop()}))};return derive$2(flatten([optAction.map(executeHandler).toArray(),pointerEvents()]))},hoverEvent="alloy.item-hover",focusEvent="alloy.item-focus",onHover=function(item){(search(item.element).isNone()||Focusing.isFocused(item))&&(Focusing.isFocused(item)||Focusing.focus(item),emitWith(item,hoverEvent,{item:item}))},onFocus$1=function(item){emitWith(item,focusEvent,{item:item})},hover=constant$1(hoverEvent),focus$1=constant$1(focusEvent),builder$2=function(detail){return{dom:detail.dom,domModification:__assign(__assign({},detail.domModification),{attributes:__assign(__assign(__assign({role:detail.toggling.isSome()?"menuitemcheckbox":"menuitem"},detail.domModification.attributes),{"aria-haspopup":detail.hasSubmenu}),detail.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:SketchBehaviours_augment(detail.itemBehaviours,[detail.toggling.fold(Toggling.revoke,(function(tConfig){return Toggling.config(__assign({aria:{mode:"checked"}},tConfig))})),Focusing.config({ignore:detail.ignoreFocus,stopMousedown:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"execution"}),Representing.config({store:{mode:"memory",initialValue:detail.data}}),config("item-type-events",__spreadArray(__spreadArray([],pointerEvents(),!0),[run$1(mouseover(),onHover),run$1(focusItem(),Focusing.focus)],!1))]),components:detail.components,eventOrder:detail.eventOrder}},schema$p=[required$1("data"),required$1("components"),required$1("dom"),defaulted("hasSubmenu",!1),option("toggling"),SketchBehaviours_field("itemBehaviours",[Toggling,Focusing,Keying,Representing]),defaulted("ignoreFocus",!1),defaulted("domModification",{}),output$1("builder",builder$2),defaulted("eventOrder",{})],builder$1=function(detail){return{dom:detail.dom,components:detail.components,events:derive$2([stopper(focusItem())])}},schema$o=[required$1("dom"),required$1("components"),output$1("builder",builder$1)],owner$2=constant$1("item-widget"),parts$h=constant$1([required({name:"widget",overrides:function(detail){return{behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(_component){return detail.data},setValue:noop}})])}}})]),builder=function(detail){var subs=substitutes(owner$2(),detail,parts$h()),components=components$1(owner$2(),detail,subs.internals()),focusWidget=function(component){return getPart(component,detail,"widget").map((function(widget){return Keying.focusIn(widget),widget}))},onHorizontalArrow=function(component,simulatedEvent){return inside(simulatedEvent.event.target)?Optional.none():detail.autofocus?(simulatedEvent.setSource(component.element),Optional.none()):Optional.none()};return{dom:detail.dom,components:components,domModification:detail.domModification,events:derive$2([runOnExecute$1((function(component,simulatedEvent){focusWidget(component).each((function(_widget){simulatedEvent.stop()}))})),run$1(mouseover(),onHover),run$1(focusItem(),(function(component,_simulatedEvent){detail.autofocus?focusWidget(component):Focusing.focus(component)}))]),behaviours:SketchBehaviours_augment(detail.widgetBehaviours,[Representing.config({store:{mode:"memory",initialValue:detail.data}}),Focusing.config({ignore:detail.ignoreFocus,onFocus:function(component){onFocus$1(component)}}),Keying.config({mode:"special",focusIn:detail.autofocus?function(component){focusWidget(component)}:revoke(),onLeft:onHorizontalArrow,onRight:onHorizontalArrow,onEscape:function(component,simulatedEvent){return Focusing.isFocused(component)||detail.autofocus?detail.autofocus?(simulatedEvent.setSource(component.element),Optional.none()):Optional.none():(Focusing.focus(component),Optional.some(!0))}})])}},schema$n=[required$1("uid"),required$1("data"),required$1("components"),required$1("dom"),defaulted("autofocus",!1),defaulted("ignoreFocus",!1),SketchBehaviours_field("widgetBehaviours",[Representing,Focusing,Keying]),defaulted("domModification",{}),defaultUidsSchema(parts$h()),output$1("builder",builder)],itemSchema$2=choose$1("type",{widget:schema$n,item:schema$p,separator:schema$o}),configureGrid=function(detail,movementInfo){return{mode:"flatgrid",selector:"."+detail.markers.item,initSize:{numColumns:movementInfo.initSize.numColumns,numRows:movementInfo.initSize.numRows},focusManager:detail.focusManager}},configureMatrix=function(detail,movementInfo){return{mode:"matrix",selectors:{row:movementInfo.rowSelector,cell:"."+detail.markers.item},focusManager:detail.focusManager}},configureMenu=function(detail,movementInfo){return{mode:"menu",selector:"."+detail.markers.item,moveOnTab:movementInfo.moveOnTab,focusManager:detail.focusManager}},parts$g=constant$1([group({factory:{sketch:function(spec){var itemInfo=asRawOrDie$1("menu.spec item",itemSchema$2,spec);return itemInfo.builder(itemInfo)}},name:"items",unit:"item",defaults:function(detail,u){return has$2(u,"uid")?u:__assign(__assign({},u),{uid:generate$5("item")})},overrides:function(detail,u){return{type:u.type,ignoreFocus:detail.fakeFocus,domModification:{classes:[detail.markers.item]}}}})]),schema$m=constant$1([required$1("value"),required$1("items"),required$1("dom"),required$1("components"),defaulted("eventOrder",{}),field("menuBehaviours",[Highlighting,Representing,Composing,Keying]),defaultedOf("movement",{mode:"menu",moveOnTab:!0},choose$1("mode",{grid:[initSize(),output$1("config",configureGrid)],matrix:[output$1("config",configureMatrix),required$1("rowSelector")],menu:[defaulted("moveOnTab",!0),output$1("config",configureMenu)]})),itemMarkers(),defaulted("fakeFocus",!1),defaulted("focusManager",dom$2()),onHandler("onHighlight")]),focus=constant$1("alloy.menu-focus"),make$7=function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.menuBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedItem,itemClass:detail.markers.item,onHighlight:detail.onHighlight}),Representing.config({store:{mode:"memory",initialValue:detail.value}}),Composing.config({find:Optional.some}),Keying.config(detail.movement.config(detail,detail.movement))]),events:derive$2([run$1(focus$1(),(function(menu,simulatedEvent){var event=simulatedEvent.event;menu.getSystem().getByDom(event.target).each((function(item){Highlighting.highlight(menu,item),simulatedEvent.stop(),emitWith(menu,focus(),{menu:menu,item:item})}))})),run$1(hover(),(function(menu,simulatedEvent){var item=simulatedEvent.event.item;Highlighting.highlight(menu,item)}))]),components:components,eventOrder:detail.eventOrder,domModification:{attributes:{role:"menu"}}}},Menu=composite({name:"Menu",configFields:schema$m(),partFields:parts$g(),factory:make$7}),transpose$1=function(obj){return tupleMap(obj,(function(v,k){return{k:v,v:k}}))},trace=function(items,byItem,byMenu,finish){return get$e(byMenu,finish).bind((function(triggerItem){return get$e(items,triggerItem).bind((function(triggerMenu){var rest=trace(items,byItem,byMenu,triggerMenu);return Optional.some([triggerMenu].concat(rest))}))})).getOr([])},generate$2=function(menus,expansions){var items={};each(menus,(function(menuItems,menu){each$1(menuItems,(function(item){items[item]=menu}))}));var byItem=expansions,byMenu=transpose$1(expansions),menuPaths=map$1(byMenu,(function(_triggerItem,submenu){return[submenu].concat(trace(items,byItem,byMenu,submenu))}));return map$1(items,(function(menu){return get$e(menuPaths,menu).getOr([menu])}))},init$c=function(){var expansions=Cell({}),menus=Cell({}),paths=Cell({}),primary=value$1(),directory=Cell({}),clear,isClear,setMenuBuilt,setContents,getTriggeringItem=function(menuValue){return find$4(expansions.get(),(function(v,_k){return v===menuValue}))},getTriggerData=function(menuValue,getItemByValue,path){return getPreparedMenu(menuValue).bind((function(menu){return getTriggeringItem(menuValue).bind((function(triggeringItemValue){return getItemByValue(triggeringItemValue).map((function(triggeredItem){return{triggeredMenu:menu,triggeringItem:triggeredItem,triggeringPath:path}}))}))}))},getTriggeringPath=function(itemValue,getItemByValue){var extraPath=filter$2(lookupItem(itemValue).toArray(),(function(menuValue){return getPreparedMenu(menuValue).isSome()}));return get$e(paths.get(),itemValue).bind((function(path){var revPath=reverse(extraPath.concat(path)),triggers=bind$3(revPath,(function(menuValue,menuIndex){return getTriggerData(menuValue,getItemByValue,revPath.slice(0,menuIndex+1)).fold((function(){return is$1(primary.get(),menuValue)?[]:[Optional.none()]}),(function(data){return[Optional.some(data)]}))}));return sequence(triggers)}))},expand,collapse,refresh,getPreparedMenu=function(menuValue){return lookupMenu(menuValue).bind(extractPreparedMenu)},lookupMenu=function(menuValue){return get$e(menus.get(),menuValue)},lookupItem=function(itemValue){return get$e(expansions.get(),itemValue)},otherMenus,getPrimary,getMenus;return{setMenuBuilt:function(menuName,built){var _a;menus.set(__assign(__assign({},menus.get()),((_a={})[menuName]={type:"prepared",menu:built},_a)))},setContents:function(sPrimary,sMenus,sExpansions,dir){primary.set(sPrimary),expansions.set(sExpansions),menus.set(sMenus),directory.set(dir);var sPaths=generate$2(dir,sExpansions);paths.set(sPaths)},expand:function(itemValue){return get$e(expansions.get(),itemValue).map((function(menu){var current=get$e(paths.get(),itemValue).getOr([]);return[menu].concat(current)}))},refresh:function(itemValue){return get$e(paths.get(),itemValue)},collapse:function(itemValue){return get$e(paths.get(),itemValue).bind((function(path){return path.length>1?Optional.some(path.slice(1)):Optional.none()}))},lookupMenu:lookupMenu,lookupItem:lookupItem,otherMenus:function(path){var menuValues=directory.get();return difference(keys(menuValues),path)},getPrimary:function(){return primary.get().bind(getPreparedMenu)},getMenus:function(){return menus.get()},clear:function(){expansions.set({}),menus.set({}),paths.set({}),primary.clear()},isClear:function(){return primary.get().isNone()},getTriggeringPath:getTriggeringPath}},extractPreparedMenu=function(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()},LayeredState={init:init$c,extractPreparedMenu:extractPreparedMenu},make$6=function(detail,_rawUiSpec){var submenuParentItems=value$1(),buildMenus=function(container,primaryName,menus){return map$1(menus,(function(spec,name){var makeSketch=function(){return Menu.sketch(__assign(__assign({},spec),{value:name,markers:detail.markers,fakeFocus:detail.fakeFocus,onHighlight:detail.onHighlight,focusManager:detail.fakeFocus?highlights():dom$2()}))};return name===primaryName?{type:"prepared",menu:container.getSystem().build(makeSketch())}:{type:"notbuilt",nbMenu:makeSketch}}))},layeredState=LayeredState.init(),setup=function(container){var componentMap=buildMenus(container,detail.data.primary,detail.data.menus),directory=toDirectory();return layeredState.setContents(detail.data.primary,componentMap,detail.data.expansions,directory),layeredState.getPrimary()},getItemValue=function(item){return Representing.getValue(item).value},getItemByValue=function(_container,menus,itemValue){return findMap(menus,(function(menu){if(!menu.getSystem().isConnected())return Optional.none();var candidates=Highlighting.getCandidates(menu);return find$5(candidates,(function(c){return getItemValue(c)===itemValue}))}))},toDirectory=function(_container){return map$1(detail.data.menus,(function(data,_menuName){return bind$3(data.items,(function(item){return"separator"===item.type?[]:[item.data.value]}))}))},setActiveMenu=function(container,menu){Highlighting.highlight(container,menu),Highlighting.getHighlighted(menu).orThunk((function(){return Highlighting.getFirst(menu)})).each((function(item){dispatch(container,item.element,focusItem())}))},getMenus=function(state,menuValues){return cat(map$2(menuValues,(function(mv){return state.lookupMenu(mv).bind((function(prep){return"prepared"===prep.type?Optional.some(prep.menu):Optional.none()}))})))},closeOthers=function(container,state,path){var others=getMenus(state,state.otherMenus(path));each$1(others,(function(o){remove$1(o.element,[detail.markers.backgroundMenu]),detail.stayInDom||Replacing.remove(container,o)}))},getSubmenuParents=function(container){return submenuParentItems.get().getOrThunk((function(){var r={},items=descendants(container.element,"."+detail.markers.item),parentItems=filter$2(items,(function(i){return"true"===get$d(i,"aria-haspopup")}));return each$1(parentItems,(function(i){container.getSystem().getByDom(i).each((function(itemComp){var key=getItemValue(itemComp);r[key]=itemComp}))})),submenuParentItems.set(r),r}))},updateAriaExpansions=function(container,path){var parentItems=getSubmenuParents(container);each(parentItems,(function(v,k){var expanded=contains$2(path,k);set$8(v.element,"aria-expanded",expanded)}))},updateMenuPath=function(container,state,path){return Optional.from(path[0]).bind((function(latestMenuName){return state.lookupMenu(latestMenuName).bind((function(menuPrep){if("notbuilt"===menuPrep.type)return Optional.none();var activeMenu=menuPrep.menu,rest=getMenus(state,path.slice(1));return each$1(rest,(function(r){add$2(r.element,detail.markers.backgroundMenu)})),inBody(activeMenu.element)||Replacing.append(container,premade(activeMenu)),remove$1(activeMenu.element,[detail.markers.backgroundMenu]),setActiveMenu(container,activeMenu),closeOthers(container,state,path),Optional.some(activeMenu)}))}))},ExpandHighlightDecision;!function(ExpandHighlightDecision){ExpandHighlightDecision[ExpandHighlightDecision.HighlightSubmenu=0]="HighlightSubmenu",ExpandHighlightDecision[ExpandHighlightDecision.HighlightParent=1]="HighlightParent"}(ExpandHighlightDecision||(ExpandHighlightDecision={}));var buildIfRequired=function(container,menuName,menuPrep){if("notbuilt"===menuPrep.type){var menu=container.getSystem().build(menuPrep.nbMenu());return layeredState.setMenuBuilt(menuName,menu),menu}return menuPrep.menu},expandRight=function(container,item,decision){if(void 0===decision&&(decision=ExpandHighlightDecision.HighlightSubmenu),item.hasConfigured(Disabling)&&Disabling.isDisabled(item))return Optional.some(item);var value=getItemValue(item);return layeredState.expand(value).bind((function(path){return updateAriaExpansions(container,path),Optional.from(path[0]).bind((function(menuName){return layeredState.lookupMenu(menuName).bind((function(activeMenuPrep){var activeMenu=buildIfRequired(container,menuName,activeMenuPrep);return inBody(activeMenu.element)||Replacing.append(container,premade(activeMenu)),detail.onOpenSubmenu(container,item,activeMenu,reverse(path)),decision===ExpandHighlightDecision.HighlightSubmenu?(Highlighting.highlightFirst(activeMenu),updateMenuPath(container,layeredState,path)):(Highlighting.dehighlightAll(activeMenu),Optional.some(item))}))}))}))},collapseLeft=function(container,item){var value=getItemValue(item);return layeredState.collapse(value).bind((function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path).map((function(activeMenu){return detail.onCollapseMenu(container,item,activeMenu),activeMenu}))}))},updateView=function(container,item){var value=getItemValue(item);return layeredState.refresh(value).bind((function(path){return updateAriaExpansions(container,path),updateMenuPath(container,layeredState,path)}))},onRight=function(container,item){return inside(item.element)?Optional.none():expandRight(container,item,ExpandHighlightDecision.HighlightSubmenu)},onLeft=function(container,item){return inside(item.element)?Optional.none():collapseLeft(container,item)},onEscape=function(container,item){return collapseLeft(container,item).orThunk((function(){return detail.onEscape(container,item).map((function(){return container}))}))},keyOnItem=function(f){return function(container,simulatedEvent){return closest$1(simulatedEvent.getSource(),"."+detail.markers.item).bind((function(target){return container.getSystem().getByDom(target).toOptional().bind((function(item){return f(container,item).map(always)}))}))}},events=derive$2([run$1(focus(),(function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;layeredState.lookupItem(getItemValue(item)).each((function(){var menu=simulatedEvent.event.menu;Highlighting.highlight(sandbox,menu);var value=getItemValue(simulatedEvent.event.item);layeredState.refresh(value).each((function(path){return closeOthers(sandbox,layeredState,path)}))}))})),runOnExecute$1((function(component,simulatedEvent){var target=simulatedEvent.event.target;component.getSystem().getByDom(target).each((function(item){var itemValue;0===getItemValue(item).indexOf("collapse-item")&&collapseLeft(component,item),expandRight(component,item,ExpandHighlightDecision.HighlightSubmenu).fold((function(){detail.onExecute(component,item)}),noop)}))})),runOnAttached((function(container,_simulatedEvent){setup(container).each((function(primary){Replacing.append(container,premade(primary)),detail.onOpenMenu(container,primary),detail.highlightImmediately&&setActiveMenu(container,primary)}))}))].concat(detail.navigateOnHover?[run$1(hover(),(function(sandbox,simulatedEvent){var item=simulatedEvent.event.item;updateView(sandbox,item),expandRight(sandbox,item,ExpandHighlightDecision.HighlightParent),detail.onHover(sandbox,item)}))]:[])),getActiveItem=function(container){return Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted)},collapseMenuApi,highlightPrimary,extractMenuFromContainer=function(container){return Optional.from(container.components()[0]).filter((function(comp){return"menu"===get$d(comp.element,"role")}))},repositionMenus,apis={collapseMenu:function(container){getActiveItem(container).each((function(currentItem){collapseLeft(container,currentItem)}))},highlightPrimary:function(container){layeredState.getPrimary().each((function(primary){setActiveMenu(container,primary)}))},repositionMenus:function(container){var maybeActivePrimary;layeredState.getPrimary().bind((function(primary){return getActiveItem(container).bind((function(currentItem){var itemValue=getItemValue(currentItem),allMenus=values(layeredState.getMenus()),preparedMenus=cat(map$2(allMenus,LayeredState.extractPreparedMenu));return layeredState.getTriggeringPath(itemValue,(function(v){return getItemByValue(container,preparedMenus,v)}))})).map((function(triggeringPath){return{primary:primary,triggeringPath:triggeringPath}}))})).fold((function(){extractMenuFromContainer(container).each((function(primaryMenu){detail.onRepositionMenu(container,primaryMenu,[])}))}),(function(_a){var primary=_a.primary,triggeringPath=_a.triggeringPath;detail.onRepositionMenu(container,primary,triggeringPath)}))}};return{uid:detail.uid,dom:detail.dom,markers:detail.markers,behaviours:augment(detail.tmenuBehaviours,[Keying.config({mode:"special",onRight:keyOnItem(onRight),onLeft:keyOnItem(onLeft),onEscape:keyOnItem(onEscape),focusIn:function(container,_keyInfo){layeredState.getPrimary().each((function(primary){dispatch(container,primary.element,focusItem())}))}}),Highlighting.config({highlightClass:detail.markers.selectedMenu,itemClass:detail.markers.menu}),Composing.config({find:function(container){return Highlighting.getHighlighted(container)}}),Replacing.config({})]),eventOrder:detail.eventOrder,apis:apis,events:events}},collapseItem$1=constant$1("collapse-item"),tieredData=function(primary,menus,expansions){return{primary:primary,menus:menus,expansions:expansions}},singleData=function(name,menu){return{primary:name,menus:wrap$1(name,menu),expansions:{}}},collapseItem=function(text){return{value:generate$6(collapseItem$1()),meta:{text:text}}},tieredMenu=single({name:"TieredMenu",configFields:[onStrictKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape"),onStrictHandler("onOpenMenu"),onStrictHandler("onOpenSubmenu"),onHandler("onRepositionMenu"),onHandler("onCollapseMenu"),defaulted("highlightImmediately",!0),requiredObjOf("data",[required$1("primary"),required$1("menus"),required$1("expansions")]),defaulted("fakeFocus",!1),onHandler("onHighlight"),onHandler("onHover"),tieredMenuMarkers(),required$1("dom"),defaulted("navigateOnHover",!0),defaulted("stayInDom",!1),field("tmenuBehaviours",[Keying,Highlighting,Composing,Replacing]),defaulted("eventOrder",{})],apis:{collapseMenu:function(apis,tmenu){apis.collapseMenu(tmenu)},highlightPrimary:function(apis,tmenu){apis.highlightPrimary(tmenu)},repositionMenus:function(apis,tmenu){apis.repositionMenus(tmenu)}},factory:make$6,extraApis:{tieredData:tieredData,singleData:singleData,collapseItem:collapseItem}}),makeMenu=function(detail,menuSandbox,placementSpec,menuSpec,getBounds){var lazySink=function(){return detail.lazySink(menuSandbox)},layouts="horizontal"===menuSpec.type?{layouts:{onLtr:function(){return belowOrAbove()},onRtl:function(){return belowOrAboveRtl()}}}:{},isFirstTierSubmenu=function(triggeringPaths){return 2===triggeringPaths.length},getSubmenuLayouts=function(triggeringPaths){return isFirstTierSubmenu(triggeringPaths)?layouts:{}};return tieredMenu.sketch({dom:{tag:"div"},data:menuSpec.data,markers:menuSpec.menu.markers,highlightImmediately:menuSpec.menu.highlightImmediately,onEscape:function(){return Sandboxing.close(menuSandbox),detail.onEscape.map((function(handler){return handler(menuSandbox)})),Optional.some(!0)},onExecute:function(){return Optional.some(!0)},onOpenMenu:function(tmenu,menu){Positioning.positionWithinBounds(lazySink().getOrDie(),menu,placementSpec,getBounds())},onOpenSubmenu:function(tmenu,item,submenu,triggeringPaths){var sink=lazySink().getOrDie();Positioning.position(sink,submenu,{anchor:__assign({type:"submenu",item:item},getSubmenuLayouts(triggeringPaths))})},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=lazySink().getOrDie();Positioning.positionWithinBounds(sink,primaryMenu,placementSpec,getBounds()),each$1(submenuTriggers,(function(st){var submenuLayouts=getSubmenuLayouts(st.triggeringPath);Positioning.position(sink,st.triggeredMenu,{anchor:__assign({type:"submenu",item:st.triggeringItem},submenuLayouts)})}))}})},factory$m=function(detail,spec){var isPartOfRelated=function(sandbox,queryElem){var related;return detail.getRelated(sandbox).exists((function(rel){return isPartOf$1(rel,queryElem)}))},setContent,showAt=function(sandbox,thing,placementSpec){showWithin(sandbox,thing,placementSpec,Optional.none())},showWithin=function(sandbox,thing,placementSpec,boxElement){showWithinBounds(sandbox,thing,placementSpec,(function(){return boxElement.map((function(elem){return box$1(elem)}))}))},showWithinBounds=function(sandbox,thing,placementSpec,getBounds){var sink=detail.lazySink(sandbox).getOrDie();Sandboxing.openWhileCloaked(sandbox,thing,(function(){return Positioning.positionWithinBounds(sink,sandbox,placementSpec,getBounds())})),Representing.setValue(sandbox,Optional.some({mode:"position",config:placementSpec,getBounds:getBounds}))},showMenuAt=function(sandbox,placementSpec,menuSpec){showMenuWithinBounds(sandbox,placementSpec,menuSpec,Optional.none)},showMenuWithinBounds=function(sandbox,placementSpec,menuSpec,getBounds){var menu=makeMenu(detail,sandbox,placementSpec,menuSpec,getBounds);Sandboxing.open(sandbox,menu),Representing.setValue(sandbox,Optional.some({mode:"menu",menu:menu}))},hide,getContent,reposition=function(sandbox){Sandboxing.isOpen(sandbox)&&Representing.getValue(sandbox).each((function(state){switch(state.mode){case"menu":Sandboxing.getState(sandbox).each(tieredMenu.repositionMenus);break;case"position":var sink=detail.lazySink(sandbox).getOrDie();Positioning.positionWithinBounds(sink,sandbox,state.config,state.getBounds())}}))},apis={setContent:function(sandbox,thing){Sandboxing.setContent(sandbox,thing)},showAt:showAt,showWithin:showWithin,showWithinBounds:showWithinBounds,showMenuAt:showMenuAt,showMenuWithinBounds:showMenuWithinBounds,hide:function(sandbox){Sandboxing.isOpen(sandbox)&&(Representing.setValue(sandbox,Optional.none()),Sandboxing.close(sandbox))},getContent:function(sandbox){return Sandboxing.getState(sandbox)},reposition:reposition,isOpen:Sandboxing.isOpen};return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.inlineBehaviours,[Sandboxing.config({isPartOf:function(sandbox,data,queryElem){return isPartOf$1(data,queryElem)||isPartOfRelated(sandbox,queryElem)},getAttachPoint:function(sandbox){return detail.lazySink(sandbox).getOrDie()},onOpen:function(sandbox){detail.onShow(sandbox)},onClose:function(sandbox){detail.onHide(sandbox)}}),Representing.config({store:{mode:"memory",initialValue:Optional.none()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:spec.isExtraPart},detail.fireDismissalEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})))),receivingChannel(__assign(__assign({},detail.fireRepositionEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})),{doReposition:reposition})))})]),eventOrder:detail.eventOrder,apis:apis}},InlineView=single({name:"InlineView",configFields:[required$1("lazySink"),onHandler("onShow"),onHandler("onHide"),optionFunction("onEscape"),field("inlineBehaviours",[Sandboxing,Representing,Receiving]),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),optionObjOf("fireRepositionEventInstead",[defaulted("event",repositionRequested())]),defaulted("getRelated",Optional.none),defaulted("isExtraPart",never),defaulted("eventOrder",Optional.none)],factory:factory$m,apis:{showAt:function(apis,component,anchor,thing){apis.showAt(component,anchor,thing)},showWithin:function(apis,component,anchor,thing,boxElement){apis.showWithin(component,anchor,thing,boxElement)},showWithinBounds:function(apis,component,anchor,thing,bounds){apis.showWithinBounds(component,anchor,thing,bounds)},showMenuAt:function(apis,component,anchor,menuSpec){apis.showMenuAt(component,anchor,menuSpec)},showMenuWithinBounds:function(apis,component,anchor,menuSpec,bounds){apis.showMenuWithinBounds(component,anchor,menuSpec,bounds)},hide:function(apis,component){apis.hide(component)},isOpen:function(apis,component){return apis.isOpen(component)},getContent:function(apis,component){return apis.getContent(component)},setContent:function(apis,component,thing){apis.setContent(component,thing)},reposition:function(apis,component){apis.reposition(component)}}}),labelPrefix="layout-inset",westEdgeX=function(anchor){return anchor.x},middleX=function(anchor,element){return anchor.x+anchor.width/2-element.width/2},eastEdgeX=function(anchor,element){return anchor.x+anchor.width-element.width},northY=function(anchor){return anchor.y},southY=function(anchor,element){return anchor.y+anchor.height-element.height},centreY=function(anchor,element){return anchor.y+anchor.height/2-element.height/2},southwest=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),southY(anchor,element),bubbles.insetSouthwest(),northwest$3(),"southwest",boundsRestriction(anchor,{right:0,bottom:3}),labelPrefix)},southeast=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),southY(anchor,element),bubbles.insetSoutheast(),northeast$3(),"southeast",boundsRestriction(anchor,{left:1,bottom:3}),labelPrefix)},northwest=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),northY(anchor),bubbles.insetNorthwest(),southwest$3(),"northwest",boundsRestriction(anchor,{right:0,top:2}),labelPrefix)},northeast=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),northY(anchor),bubbles.insetNortheast(),southeast$3(),"northeast",boundsRestriction(anchor,{left:1,top:2}),labelPrefix)},north=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),northY(anchor),bubbles.insetNorth(),south$3(),"north",boundsRestriction(anchor,{top:2}),labelPrefix)},south=function(anchor,element,bubbles){return nu$6(middleX(anchor,element),southY(anchor,element),bubbles.insetSouth(),north$3(),"south",boundsRestriction(anchor,{bottom:3}),labelPrefix)},east=function(anchor,element,bubbles){return nu$6(eastEdgeX(anchor,element),centreY(anchor,element),bubbles.insetEast(),west$3(),"east",boundsRestriction(anchor,{right:0}),labelPrefix)},west=function(anchor,element,bubbles){return nu$6(westEdgeX(anchor),centreY(anchor,element),bubbles.insetWest(),east$3(),"west",boundsRestriction(anchor,{left:1}),labelPrefix)},lookupPreserveLayout=function(lastPlacement){switch(lastPlacement){case"north":return north;case"northeast":return northeast;case"northwest":return northwest;case"south":return south;case"southeast":return southeast;case"southwest":return southwest;case"east":return east;case"west":return west}},preserve=function(anchor,element,bubbles,placee,bounds){var layout;return getPlacement(placee).map(lookupPreserveLayout).getOr(north)(anchor,element,bubbles,placee,bounds)},lookupFlippedLayout=function(lastPlacement){switch(lastPlacement){case"north":return south;case"northeast":return southeast;case"northwest":return southwest;case"south":return north;case"southeast":return northeast;case"southwest":return northwest;case"east":return west;case"west":return east}},flip$2=function(anchor,element,bubbles,placee,bounds){var layout;return getPlacement(placee).map(lookupFlippedLayout).getOr(north)(anchor,element,bubbles,placee,bounds)},global$f=tinymce.util.Tools.resolve("tinymce.util.Delay"),factory$l,Button=single({name:"Button",factory:function(detail){var events=events$a(detail.action),tag=detail.dom.tag,lookupAttr=function(attr){return get$e(detail.dom,"attributes").bind((function(attrs){return get$e(attrs,attr)}))},getModAttributes=function(){if("button"===tag){var type=lookupAttr("type").getOr("button"),roleAttrs=lookupAttr("role").map((function(role){return{role:role}})).getOr({});return __assign({type:type},roleAttrs)}var role;return{role:lookupAttr("role").getOr("button")}};return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events,behaviours:SketchBehaviours_augment(detail.buttonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:getModAttributes()},eventOrder:detail.eventOrder}},configFields:[defaulted("uid",void 0),required$1("dom"),defaulted("components",[]),SketchBehaviours_field("buttonBehaviours",[Focusing,Keying]),option("action"),option("role"),defaulted("eventOrder",{})]}),record=function(spec){var uid=isSketchSpec(spec)&&hasNonNullableKey(spec,"uid")?spec.uid:generate$5("memento"),get,getOpt,asSpec;return{get:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).getOrDie()},getOpt:function(anyInSystem){return anyInSystem.getSystem().getByUid(uid).toOptional()},asSpec:function(){return __assign(__assign({},spec),{uid:uid})}}},global$e=tinymce.util.Tools.resolve("tinymce.util.I18n"),rtlTransform={indent:!0,outdent:!0,"table-insert-column-after":!0,"table-insert-column-before":!0,"paste-column-after":!0,"paste-column-before":!0,"unordered-list":!0,"list-bull-circle":!0,"list-bull-default":!0,"list-bull-square":!0},defaultIconName="temporary-placeholder",defaultIcon=function(icons){return function(){return get$e(icons,defaultIconName).getOr("!not found!")}},getIconName=function(name,icons){var lcName=name.toLowerCase();if(global$e.isRtl()){var rtlName=ensureTrailing(lcName,"-rtl");return has$2(icons,rtlName)?rtlName:lcName}return lcName},lookupIcon=function(name,icons){return get$e(icons,getIconName(name,icons))},get$1=function(name,iconProvider){var icons=iconProvider();return lookupIcon(name,icons).getOrThunk(defaultIcon(icons))},getOr=function(name,iconProvider,fallbackIcon){var icons=iconProvider();return lookupIcon(name,icons).or(fallbackIcon).getOrThunk(defaultIcon(icons))},needsRtlTransform=function(iconName){return!!global$e.isRtl()&&has$2(rtlTransform,iconName)},addFocusableBehaviour=function(){return config("add-focusable",[runOnAttached((function(comp){child(comp.element,"svg").each((function(svg){return set$8(svg,"focusable","false")}))}))])},renderIcon$2=function(spec,iconName,icons,fallbackIcon){var _a,_b,rtlIconClasses=needsRtlTransform(iconName)?["tox-icon--flip"]:[],iconHtml=get$e(icons,getIconName(iconName,icons)).or(fallbackIcon).getOrThunk(defaultIcon(icons));return{dom:{tag:spec.tag,attributes:null!==(_a=spec.attributes)&&void 0!==_a?_a:{},classes:spec.classes.concat(rtlIconClasses),innerHtml:iconHtml},behaviours:derive$1(__spreadArray(__spreadArray([],null!==(_b=spec.behaviours)&&void 0!==_b?_b:[],!0),[addFocusableBehaviour()],!1))}},render$3=function(iconName,spec,iconProvider,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),renderIcon$2(spec,iconName,iconProvider(),fallbackIcon)},renderFirst=function(iconNames,spec,iconProvider){var icons=iconProvider(),iconName=find$5(iconNames,(function(name){return has$2(icons,getIconName(name,icons))}));return renderIcon$2(spec,iconName.getOr(defaultIconName),icons,Optional.none())},notificationIconMap={success:"checkmark",error:"warning",err:"error",warning:"warning",warn:"warning",info:"info"},factory$k,Notification=single({name:"Notification",factory:function(detail){var memBannerText=record({dom:{tag:"p",innerHtml:detail.translationProvider(detail.text)},behaviours:derive$1([Replacing.config({})])}),renderPercentBar=function(percent){return{dom:{tag:"div",classes:["tox-bar"],attributes:{style:"width: "+percent+"%"}}}},renderPercentText=function(percent){return{dom:{tag:"div",classes:["tox-text"],innerHtml:percent+"%"}}},memBannerProgress=record({dom:{tag:"div",classes:detail.progress?["tox-progress-bar","tox-progress-indicator"]:["tox-progress-bar"]},components:[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(0)]},renderPercentText(0)],behaviours:derive$1([Replacing.config({})])}),updateProgress,updateText,apis={updateProgress:function(comp,percent){comp.getSystem().isConnected()&&memBannerProgress.getOpt(comp).each((function(progress){Replacing.set(progress,[{dom:{tag:"div",classes:["tox-bar-container"]},components:[renderPercentBar(percent)]},renderPercentText(percent)])}))},updateText:function(comp,text$1){if(comp.getSystem().isConnected()){var banner=memBannerText.get(comp);Replacing.set(banner,[text(text$1)])}}},iconChoices=flatten([detail.icon.toArray(),detail.level.toArray(),detail.level.bind((function(level){return Optional.from(notificationIconMap[level])})).toArray()]),memButton=record(Button.sketch({dom:{tag:"button",classes:["tox-notification__dismiss","tox-button","tox-button--naked","tox-button--icon"]},components:[render$3("close",{tag:"div",classes:["tox-icon"],attributes:{"aria-label":detail.translationProvider("Close")}},detail.iconProvider)],action:function(comp){detail.onAction(comp)}})),notificationIconSpec,notificationBodySpec,components=[renderFirst(iconChoices,{tag:"div",classes:["tox-notification__icon"]},detail.iconProvider),{dom:{tag:"div",classes:["tox-notification__body"]},components:[memBannerText.asSpec()],behaviours:derive$1([Replacing.config({})])}];return{uid:detail.uid,dom:{tag:"div",attributes:{role:"alert"},classes:detail.level.map((function(level){return["tox-notification","tox-notification--in","tox-notification--"+level]})).getOr(["tox-notification","tox-notification--in"])},behaviours:derive$1([Focusing.config({}),config("notification-events",[run$1(focusin(),(function(comp){memButton.getOpt(comp).each(Focusing.focus)}))])]),components:components.concat(detail.progress?[memBannerProgress.asSpec()]:[]).concat(detail.closeButton?[memButton.asSpec()]:[]),apis:apis}},configFields:[option("level"),required$1("progress"),required$1("icon"),required$1("onAction"),required$1("text"),required$1("iconProvider"),required$1("translationProvider"),defaultedBoolean("closeButton",!0)],apis:{updateProgress:function(apis,comp,percent){apis.updateProgress(comp,percent)},updateText:function(apis,comp,text){apis.updateText(comp,text)}}});function NotificationManagerImpl(editor,extras,uiMothership){var sharedBackstage=extras.backstage.shared,getLayoutDirection=function(rel){switch(rel){case"bc-bc":return south;case"tc-tc":return north;case"tc-bc":return north$2;case"bc-tc":default:return south$2}},reposition,open,close,getArgs;return{open:function(settings,closeCallback){var hideCloseButton=!settings.closeButton&&settings.timeout&&(settings.timeout>0||settings.timeout<0),close=function(){closeCallback(),InlineView.hide(notificationWrapper)},notification=build$1(Notification.sketch({text:settings.text,level:contains$2(["success","error","warning","warn","info"],settings.type)?settings.type:void 0,progress:!0===settings.progressBar,icon:Optional.from(settings.icon),closeButton:!hideCloseButton,onAction:close,iconProvider:sharedBackstage.providers.icons,translationProvider:sharedBackstage.providers.translate})),notificationWrapper=build$1(InlineView.sketch(__assign({dom:{tag:"div",classes:["tox-notifications-container"]},lazySink:sharedBackstage.getSink,fireDismissalEventInstead:{}},sharedBackstage.header.isPositionedAtTop()?{}:{fireRepositionEventInstead:{}})));uiMothership.add(notificationWrapper),settings.timeout>0&&global$f.setTimeout((function(){close()}),settings.timeout);var getBounds=function(){var contentArea=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),win$1=win(),x=clamp$1(win$1.x,contentArea.x,contentArea.right),y=clamp$1(win$1.y,contentArea.y,contentArea.bottom),right=Math.max(contentArea.right,win$1.right),bottom=Math.max(contentArea.bottom,win$1.bottom);return Optional.some(bounds(x,y,right-x,bottom-y))};return{close:close,moveTo:function(x,y){InlineView.showAt(notificationWrapper,premade(notification),{anchor:{type:"makeshift",x:x,y:y}})},moveRel:function(element,rel){var notificationSpec=premade(notification),anchorOverrides={maxHeightFunction:expandable$1()};if("banner"!==rel&&isNonNullable(element)){var layoutDirection_1=getLayoutDirection(rel),nodeAnchor={type:"node",root:body(),node:Optional.some(SugarElement.fromDom(element)),overrides:anchorOverrides,layouts:{onRtl:function(){return[layoutDirection_1]},onLtr:function(){return[layoutDirection_1]}}};InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:nodeAnchor},getBounds)}else{var anchor=__assign(__assign({},sharedBackstage.anchors.banner()),{overrides:anchorOverrides});InlineView.showWithinBounds(notificationWrapper,notificationSpec,{anchor:anchor},getBounds)}},text:function(nuText){Notification.updateText(notification,nuText)},settings:settings,getEl:function(){return notification.element.dom},progressBar:{value:function(percent){Notification.updateProgress(notification,percent)}}}},close:function(notification){notification.close()},reposition:function(notifications){notifications.length>0&&each$1(notifications,(function(notification,index){0===index?notification.moveRel(null,"banner"):notification.moveRel(notifications[index-1].getEl(),"bc-tc")}))},getArgs:function(notification){return notification.settings}}}var first=function(fn,rate){var timer=null,cancel,throttle;return{cancel:function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];isNull(timer)&&(timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate))}}},last=function(fn,rate){var timer=null,cancel=function(){isNull(timer)||(clearTimeout(timer),timer=null)},throttle=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];cancel(),timer=setTimeout((function(){timer=null,fn.apply(null,args)}),rate)};return{cancel:cancel,throttle:throttle}},global$d=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),isBoundary=function(dom,node){return dom.isBlock(node)||contains$2(["BR","IMG","HR","INPUT"],node.nodeName)||"false"===dom.getContentEditable(node)},repeatLeft=function(dom,node,offset,process,rootNode){var search=global$d(dom,(function(node){return isBoundary(dom,node)}));return Optional.from(search.backwards(node,offset,process,rootNode))},autocompleteSelector="[data-mce-autocompleter]",create$4=function(editor,range){return detect(SugarElement.fromDom(editor.selection.getNode())).getOrThunk((function(){var wrapper=SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>',editor.getDoc());return append$2(wrapper,SugarElement.fromDom(range.extractContents())),range.insertNode(wrapper.dom),parent(wrapper).each((function(elm){return elm.dom.normalize()})),last$1(wrapper).map((function(last){editor.selection.setCursorLocation(last.dom,getEnd(last))})),wrapper}))},detect=function(elm){return closest$1(elm,autocompleteSelector)},isValidTextRange=function(rng){return rng.collapsed&&3===rng.startContainer.nodeType},getText=function(rng){return rng.toString().replace(/\u00A0/g," ").replace(/\uFEFF/g,"")},isWhitespace=function(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)},stripTriggerChar=function(text,triggerCh){return text.substring(triggerCh.length)},findChar=function(text,index,ch){var i;for(i=index-1;i>=0;i--){var char=text.charAt(i);if(isWhitespace(char))return Optional.none();if(char===ch)break}return Optional.some(i)},findStart=function(dom,initRange,ch,minChars){if(void 0===minChars&&(minChars=0),!isValidTextRange(initRange))return Optional.none();var findTriggerChIndex=function(element,offset,text){return findChar(text,offset,ch).getOr(offset)},root=dom.getParent(initRange.startContainer,dom.isBlock)||dom.getRoot();return repeatLeft(dom,initRange.startContainer,initRange.startOffset,findTriggerChIndex,root).bind((function(spot){var range=initRange.cloneRange();if(range.setStart(spot.container,spot.offset),range.setEnd(initRange.endContainer,initRange.endOffset),range.collapsed)return Optional.none();var text=getText(range),triggerCharIndex;return 0!==text.lastIndexOf(ch)||stripTriggerChar(text,ch).length<minChars?Optional.none():Optional.some({text:stripTriggerChar(text,ch),range:range,triggerChar:ch})}))},getContext=function(dom,initRange,ch,minChars){return void 0===minChars&&(minChars=0),detect(SugarElement.fromDom(initRange.startContainer)).fold((function(){return findStart(dom,initRange,ch,minChars)}),(function(elm){var range=dom.createRng();range.selectNode(elm.dom);var text=getText(range);return Optional.some({range:range,text:stripTriggerChar(text,ch),triggerChar:ch})}))},setup$e,AutocompleterEditorEvents_setup=function(api,editor){editor.on("keypress compositionend",api.onKeypress.throttle),editor.on("remove",api.onKeypress.cancel);var redirectKeyToItem=function(item,e){emitWith(item,keydown(),{raw:e})};editor.on("keydown",(function(e){var getItem=function(){return api.getView().bind(Highlighting.getHighlighted)};8===e.which&&api.onKeypress.throttle(e),api.isActive()&&(27===e.which&&api.cancelIfNecessary(),api.isMenuOpen()?13===e.which?(getItem().each(emitExecute),e.preventDefault()):40===e.which?(getItem().fold((function(){api.getView().each(Highlighting.highlightFirst)}),(function(item){redirectKeyToItem(item,e)})),e.preventDefault(),e.stopImmediatePropagation()):37!==e.which&&38!==e.which&&39!==e.which||getItem().each((function(item){redirectKeyToItem(item,e),e.preventDefault(),e.stopImmediatePropagation()})):13!==e.which&&38!==e.which&&40!==e.which||api.cancelIfNecessary())})),editor.on("NodeChange",(function(e){api.isActive()&&!api.isProcessingAction()&&detect(SugarElement.fromDom(e.element)).isNone()&&api.cancelIfNecessary()}))},global$c=tinymce.util.Tools.resolve("tinymce.util.Promise"),point=function(container,offset){return{container:container,offset:offset}},isText=function(node){return 3===node.nodeType},isElement$1=function(node){return 1===node.nodeType},toLast=function(node){if(isText(node))return point(node,node.data.length);var children=node.childNodes;return children.length>0?toLast(children[children.length-1]):point(node,children.length)},toLeaf=function(node,offset){var children=node.childNodes;return children.length>0&&offset<children.length?toLeaf(children[offset],0):children.length>0&&isElement$1(node)&&children.length===offset?toLast(children[children.length-1]):point(node,offset)},isPreviousCharContent=function(dom,leaf){return repeatLeft(dom,leaf.container,leaf.offset,(function(element,offset){return 0===offset?-1:offset}),dom.getRoot()).filter((function(spot){var char=spot.container.data.charAt(spot.offset-1);return!isWhitespace(char)})).isSome()},isStartOfWord=function(dom){return function(rng){var leaf=toLeaf(rng.startContainer,rng.startOffset);return!isPreviousCharContent(dom,leaf)}},getTriggerContext=function(dom,initRange,database){return findMap(database.triggerChars,(function(ch){return getContext(dom,initRange,ch)}))},lookup$2=function(editor,getDatabase){var database=getDatabase(),rng=editor.selection.getRng();return getTriggerContext(editor.dom,rng,database).bind((function(context){return lookupWithContext(editor,getDatabase,context)}))},lookupWithContext=function(editor,getDatabase,context,fetchOptions){void 0===fetchOptions&&(fetchOptions={});var database=getDatabase(),rng,startText=editor.selection.getRng().startContainer.nodeValue,autocompleters=filter$2(database.lookupByChar(context.triggerChar),(function(autocompleter){return context.text.length>=autocompleter.minChars&&autocompleter.matches.getOrThunk((function(){return isStartOfWord(editor.dom)}))(context.range,startText,context.text)}));if(0===autocompleters.length)return Optional.none();var lookupData=global$c.all(map$2(autocompleters,(function(ac){var fetchResult;return ac.fetch(context.text,ac.maxResults,fetchOptions).then((function(results){return{matchText:context.text,items:results,columns:ac.columns,onAction:ac.onAction,highlightOn:ac.highlightOn}}))})));return Optional.some({lookupData:lookupData,context:context})},separatorMenuItemSchema=objOf([requiredString("type"),optionString("text")]),createSeparatorMenuItem=function(spec){return asRaw("separatormenuitem",separatorMenuItemSchema,spec)},autocompleterItemSchema=objOf([defaulted("type","autocompleteitem"),defaulted("active",!1),defaulted("disabled",!1),defaulted("meta",{}),requiredString("value"),optionString("text"),optionString("icon")]),autocompleterSchema=objOf([requiredString("type"),requiredString("ch"),defaultedNumber("minChars",1),defaulted("columns",1),defaultedNumber("maxResults",10),optionFunction("matches"),requiredFunction("fetch"),requiredFunction("onAction"),defaultedArrayOf("highlightOn",[],string)]),createSeparatorItem=function(spec){return asRaw("Autocompleter.Separator",separatorMenuItemSchema,spec)},createAutocompleterItem=function(spec){return asRaw("Autocompleter.Item",autocompleterItemSchema,spec)},createAutocompleter=function(spec){return asRaw("Autocompleter",autocompleterSchema,spec)},baseToolbarButtonFields=[defaultedBoolean("disabled",!1),optionString("tooltip"),optionString("icon"),optionString("text"),defaultedFunction("onSetup",(function(){return noop}))],toolbarButtonSchema=objOf([requiredString("type"),requiredFunction("onAction")].concat(baseToolbarButtonFields)),createToolbarButton=function(spec){return asRaw("toolbarbutton",toolbarButtonSchema,spec)},baseToolbarToggleButtonFields=[defaultedBoolean("active",!1)].concat(baseToolbarButtonFields),toggleButtonSchema=objOf(baseToolbarToggleButtonFields.concat([requiredString("type"),requiredFunction("onAction")])),createToggleButton=function(spec){return asRaw("ToggleButton",toggleButtonSchema,spec)},contextBarFields=[defaultedFunction("predicate",never),defaultedStringEnum("scope","node",["node","editor"]),defaultedStringEnum("position","selection",["node","selection","line"])],contextButtonFields=baseToolbarButtonFields.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),contextToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted("type","contextformbutton"),defaulted("primary",!1),requiredFunction("onAction"),customField("original",identity$1)]),launchButtonFields=baseToolbarButtonFields.concat([defaulted("type","contextformbutton")]),launchToggleButtonFields=baseToolbarToggleButtonFields.concat([defaulted("type","contextformtogglebutton")]),toggleOrNormal=choose$1("type",{contextformbutton:contextButtonFields,contextformtogglebutton:contextToggleButtonFields}),contextFormSchema=objOf([defaulted("type","contextform"),defaultedFunction("initValue",constant$1("")),optionString("label"),requiredArrayOf("commands",toggleOrNormal),optionOf("launch",choose$1("type",{contextformbutton:launchButtonFields,contextformtogglebutton:launchToggleButtonFields}))].concat(contextBarFields)),createContextForm=function(spec){return asRaw("ContextForm",contextFormSchema,spec)},contextToolbarSchema=objOf([defaulted("type","contexttoolbar"),requiredString("items")].concat(contextBarFields)),createContextToolbar=function(spec){return asRaw("ContextToolbar",contextToolbarSchema,spec)},stringArray=function(a){var all={};return each$1(a,(function(key){all[key]={}})),keys(all)},register$b=function(editor){var popups=editor.ui.registry.getAll().popups,dataset=map$1(popups,(function(popup){return createAutocompleter(popup).fold((function(err){throw new Error(formatError(err))}),identity$1)})),triggerChars=stringArray(mapToArray(dataset,(function(v){return v.ch}))),datasetValues=values(dataset),lookupByChar;return{dataset:dataset,triggerChars:triggerChars,lookupByChar:function(ch){return filter$2(datasetValues,(function(dv){return dv.ch===ch}))}}},ItemResponse;!function(ItemResponse){ItemResponse[ItemResponse.CLOSE_ON_EXECUTE=0]="CLOSE_ON_EXECUTE",ItemResponse[ItemResponse.BUBBLE_TO_SANDBOX=1]="BUBBLE_TO_SANDBOX"}(ItemResponse||(ItemResponse={}));var ItemResponse$1=ItemResponse,navClass="tox-menu-nav__js",selectableClass="tox-collection__item",colorClass="tox-swatch",presetClasses={normal:navClass,color:colorClass},tickedClass="tox-collection__item--enabled",groupHeadingClass="tox-collection__group-heading",iconClass="tox-collection__item-icon",textClass="tox-collection__item-label",accessoryClass="tox-collection__item-accessory",caretClass="tox-collection__item-caret",checkmarkClass="tox-collection__item-checkmark",activeClass="tox-collection__item--active",containerClass="tox-collection__item-container",containerColumnClass="tox-collection__item-container--column",containerRowClass="tox-collection__item-container--row",containerAlignRightClass="tox-collection__item-container--align-right",containerAlignLeftClass="tox-collection__item-container--align-left",containerValignTopClass="tox-collection__item-container--valign-top",containerValignMiddleClass="tox-collection__item-container--valign-middle",containerValignBottomClass="tox-collection__item-container--valign-bottom",classForPreset=function(presets){return get$e(presetClasses,presets).getOr(navClass)},forMenu=function(presets){return"color"===presets?"tox-swatches":"tox-menu"},classes=function(presets){return{backgroundMenu:"tox-background-menu",selectedMenu:"tox-selected-menu",selectedItem:"tox-collection__item--active",hasIcons:"tox-menu--has-icons",menu:forMenu(presets),tieredMenu:"tox-tiered-menu"}},markers=function(presets){var menuClasses=classes(presets);return{backgroundMenu:menuClasses.backgroundMenu,selectedMenu:menuClasses.selectedMenu,menu:menuClasses.menu,selectedItem:menuClasses.selectedItem,item:classForPreset(presets)}},dom$1=function(hasIcons,columns,presets){var menuClasses=classes(presets);return{tag:"div",classes:flatten([[menuClasses.menu,"tox-menu-"+columns+"-column"],hasIcons?[menuClasses.hasIcons]:[]])}},components=[Menu.parts.items({})],part=function(hasIcons,columns,presets){var menuClasses=classes(presets),d;return{dom:{tag:"div",classes:flatten([[menuClasses.tieredMenu]])},markers:markers(presets)}},chunk=function(rowDom,numColumns){return function(items){var chunks=chunk$1(items,numColumns);return map$2(chunks,(function(c){return{dom:rowDom,components:c}}))}},forSwatch=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-swatches-menu"]},components:[{dom:{tag:"div",classes:["tox-swatches"]},components:[Menu.parts.items({preprocess:"auto"!==columns?chunk({tag:"div",classes:["tox-swatches__row"]},columns):identity$1})]}]}},forToolbar=function(columns){return{dom:{tag:"div",classes:["tox-menu","tox-collection","tox-collection--toolbar","tox-collection--toolbar-lg"]},components:[Menu.parts.items({preprocess:chunk({tag:"div",classes:["tox-collection__group"]},columns)})]}},preprocessCollection=function(items,isSeparator){var allSplits=[],currentSplit=[];return each$1(items,(function(item,i){isSeparator(item,i)?(currentSplit.length>0&&allSplits.push(currentSplit),currentSplit=[],has$2(item.dom,"innerHtml")&&currentSplit.push(item)):currentSplit.push(item)})),currentSplit.length>0&&allSplits.push(currentSplit),map$2(allSplits,(function(s){return{dom:{tag:"div",classes:["tox-collection__group"]},components:s}}))},forCollection=function(columns,initItems,_hasIcons){return{dom:{tag:"div",classes:["tox-menu","tox-collection"].concat(1===columns?["tox-collection--list"]:["tox-collection--grid"])},components:[Menu.parts.items({preprocess:function(items){return"auto"!==columns&&columns>1?chunk({tag:"div",classes:["tox-collection__group"]},columns)(items):preprocessCollection(items,(function(_item,i){return"separator"===initItems[i].type}))}})]}},forHorizontalCollection=function(initItems,_hasIcons){return{dom:{tag:"div",classes:["tox-collection","tox-collection--horizontal"]},components:[Menu.parts.items({preprocess:function(items){return preprocessCollection(items,(function(_item,i){return"separator"===initItems[i].type}))}})]}},menuHasIcons=function(xs){return exists(xs,(function(item){return"icon"in item&&void 0!==item.icon}))},handleError=function(error){return console.error(formatError(error)),console.log(error),Optional.none()},createHorizontalPartialMenuWithAlloyItems=function(value,_hasIcons,items,_columns,_presets){var structure=forHorizontalCollection(items);return{value:value,dom:structure.dom,components:structure.components,items:items}},createPartialMenuWithAlloyItems=function(value,hasIcons,items,columns,presets){var structure,structure,structure,structure,structure;return"color"===presets?{value:value,dom:(structure=forSwatch(columns)).dom,components:structure.components,items:items}:"normal"===presets&&"auto"===columns?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"normal"===presets&&1===columns?{value:value,dom:(structure=forCollection(1,items)).dom,components:structure.components,items:items}:"normal"===presets?{value:value,dom:(structure=forCollection(columns,items)).dom,components:structure.components,items:items}:"listpreview"===presets&&"auto"!==columns?{value:value,dom:(structure=forToolbar(columns)).dom,components:structure.components,items:items}:{value:value,dom:dom$1(hasIcons,columns,presets),components:components,items:items}},cardImageFields=[requiredString("type"),requiredString("src"),optionString("alt"),defaultedArrayOf("classes",[],string)],cardImageSchema=objOf(cardImageFields),cardTextFields=[requiredString("type"),requiredString("text"),optionString("name"),defaultedArrayOf("classes",["tox-collection__item-label"],string)],cardTextSchema=objOf(cardTextFields),itemSchema$1=valueThunk((function(){return choose$2("type",{cardimage:cardImageSchema,cardtext:cardTextSchema,cardcontainer:cardContainerSchema})})),cardContainerSchema=objOf([requiredString("type"),defaultedString("direction","horizontal"),defaultedString("align","left"),defaultedString("valign","middle"),requiredArrayOf("items",itemSchema$1)]),commonMenuItemFields=[defaultedBoolean("disabled",!1),optionString("text"),optionString("shortcut"),field$1("value","value",defaultedThunk((function(){return generate$6("menuitem-value")})),anyValue()),defaulted("meta",{})],cardMenuItemSchema=objOf([requiredString("type"),optionString("label"),requiredArrayOf("items",itemSchema$1),defaultedFunction("onSetup",(function(){return noop})),defaultedFunction("onAction",noop)].concat(commonMenuItemFields)),createCardMenuItem=function(spec){return asRaw("cardmenuitem",cardMenuItemSchema,spec)},choiceMenuItemSchema=objOf([requiredString("type"),defaultedBoolean("active",!1),optionString("icon")].concat(commonMenuItemFields)),createChoiceMenuItem=function(spec){return asRaw("choicemenuitem",choiceMenuItemSchema,spec)},baseFields=[requiredString("type"),requiredString("fancytype"),defaultedFunction("onAction",noop)],insertTableFields=[defaulted("initData",{})].concat(baseFields),colorSwatchFields=[defaultedObjOf("initData",{},[defaultedBoolean("allowCustomColors",!0),optionArrayOf("colors",anyValue())])].concat(baseFields),fancyMenuItemSchema=choose$1("fancytype",{inserttable:insertTableFields,colorswatch:colorSwatchFields}),createFancyMenuItem=function(spec){return asRaw("fancymenuitem",fancyMenuItemSchema,spec)},menuItemSchema=objOf([requiredString("type"),defaultedFunction("onSetup",(function(){return noop})),defaultedFunction("onAction",noop),optionString("icon")].concat(commonMenuItemFields)),createMenuItem=function(spec){return asRaw("menuitem",menuItemSchema,spec)},nestedMenuItemSchema=objOf([requiredString("type"),requiredFunction("getSubmenuItems"),defaultedFunction("onSetup",(function(){return noop})),optionString("icon")].concat(commonMenuItemFields)),createNestedMenuItem=function(spec){return asRaw("nestedmenuitem",nestedMenuItemSchema,spec)},toggleMenuItemSchema=objOf([requiredString("type"),optionString("icon"),defaultedBoolean("active",!1),defaultedFunction("onSetup",(function(){return noop})),requiredFunction("onAction")].concat(commonMenuItemFields)),createToggleMenuItem=function(spec){return asRaw("togglemenuitem",toggleMenuItemSchema,spec)},detectSize=function(comp,margin,selectorClass){var descendants$1=descendants(comp.element,"."+selectorClass);if(descendants$1.length>0){var columnLength=findIndex$1(descendants$1,(function(c){var thisTop=c.dom.getBoundingClientRect().top,cTop=descendants$1[0].dom.getBoundingClientRect().top;return Math.abs(thisTop-cTop)>margin})).getOr(descendants$1.length);return Optional.some({numColumns:columnLength,numRows:Math.ceil(descendants$1.length/columnLength)})}return Optional.none()},namedEvents=function(name,handlers){return derive$1([config(name,handlers)])},unnamedEvents=function(handlers){return namedEvents(generate$6("unnamed-events"),handlers)},SimpleBehaviours_namedEvents=namedEvents,SimpleBehaviours_unnamedEvents=unnamedEvents,ExclusivityChannel=generate$6("tooltip.exclusive"),ShowTooltipEvent=generate$6("tooltip.show"),HideTooltipEvent=generate$6("tooltip.hide"),hideAllExclusive=function(component,_tConfig,_tState){component.getSystem().broadcastOn([ExclusivityChannel],{})},setComponents=function(component,tConfig,tState,specs){tState.getTooltip().each((function(tooltip){tooltip.getSystem().isConnected()&&Replacing.set(tooltip,specs)}))},TooltippingApis=Object.freeze({__proto__:null,hideAllExclusive:hideAllExclusive,setComponents:setComponents}),events$9=function(tooltipConfig,state){var hide=function(comp){state.getTooltip().each((function(p){detach(p),tooltipConfig.onHide(comp,p),state.clearTooltip()})),state.clearTimer()},show=function(comp){if(!state.isShowing()){hideAllExclusive(comp);var sink=tooltipConfig.lazySink(comp).getOrDie(),popup=comp.getSystem().build({dom:tooltipConfig.tooltipDom,components:tooltipConfig.tooltipComponents,events:derive$2("normal"===tooltipConfig.mode?[run$1(mouseover(),(function(_){emit(comp,ShowTooltipEvent)})),run$1(mouseout(),(function(_){emit(comp,HideTooltipEvent)}))]:[]),behaviours:derive$1([Replacing.config({})])});state.setTooltip(popup),attach(sink,popup),tooltipConfig.onShow(comp,popup),Positioning.position(sink,popup,{anchor:tooltipConfig.anchor(comp)})}};return derive$2(flatten([[run$1(ShowTooltipEvent,(function(comp){state.resetTimer((function(){show(comp)}),tooltipConfig.delay)})),run$1(HideTooltipEvent,(function(comp){state.resetTimer((function(){hide(comp)}),tooltipConfig.delay)})),run$1(receive(),(function(comp,message){var receivingData=message;receivingData.universal||contains$2(receivingData.channels,ExclusivityChannel)&&hide(comp)})),runOnDetached((function(comp){hide(comp)}))],"normal"===tooltipConfig.mode?[run$1(focusin(),(function(comp){emit(comp,ShowTooltipEvent)})),run$1(postBlur(),(function(comp){emit(comp,HideTooltipEvent)})),run$1(mouseover(),(function(comp){emit(comp,ShowTooltipEvent)})),run$1(mouseout(),(function(comp){emit(comp,HideTooltipEvent)}))]:[run$1(highlight$1(),(function(comp,_se){emit(comp,ShowTooltipEvent)})),run$1(dehighlight$1(),(function(comp){emit(comp,HideTooltipEvent)}))]]))},ActiveTooltipping=Object.freeze({__proto__:null,events:events$9}),TooltippingSchema=[required$1("lazySink"),required$1("tooltipDom"),defaulted("exclusive",!0),defaulted("tooltipComponents",[]),defaulted("delay",300),defaultedStringEnum("mode","normal",["normal","follow-highlight"]),defaulted("anchor",(function(comp){return{type:"hotspot",hotspot:comp,layouts:{onLtr:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2]),onRtl:constant$1([south$2,north$2,southeast$2,northeast$2,southwest$2,northwest$2])}}})),onHandler("onHide"),onHandler("onShow")],init$b=function(){var timer=value$1(),popup=value$1(),clearTimer=function(){timer.on(clearTimeout)},resetTimer=function(f,delay){clearTimer(),timer.set(setTimeout(f,delay))},readState=constant$1("not-implemented");return nu$8({getTooltip:popup.get,isShowing:popup.isSet,setTooltip:popup.set,clearTooltip:popup.clear,clearTimer:clearTimer,resetTimer:resetTimer,readState:readState})},TooltippingState,Tooltipping=create$7({fields:TooltippingSchema,name:"tooltipping",active:ActiveTooltipping,state:Object.freeze({__proto__:null,init:init$b}),apis:TooltippingApis}),escape=function(text){return text.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},global$b=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),global$a=tinymce.util.Tools.resolve("tinymce.EditorManager"),getSkinUrl=function(editor){var skin=editor.getParam("skin"),skinUrl=editor.getParam("skin_url");if(!1!==skin){var skinName=skin||"oxide";skinUrl=skinUrl?editor.documentBaseURI.toAbsolute(skinUrl):global$a.baseURL+"/skins/ui/"+skinName}return skinUrl},isReadOnly=function(editor){return editor.getParam("readonly",!1,"boolean")},isSkinDisabled=function(editor){return!1===editor.getParam("skin")},getHeightSetting=function(editor){return editor.getParam("height",Math.max(editor.getElement().offsetHeight,200))},getWidthSetting=function(editor){return editor.getParam("width",global$b.DOM.getStyle(editor.getElement(),"width"))},getMinWidthSetting=function(editor){return Optional.from(editor.getParam("min_width")).filter(isNumber)},getMinHeightSetting=function(editor){return Optional.from(editor.getParam("min_height")).filter(isNumber)},getMaxWidthSetting=function(editor){return Optional.from(editor.getParam("max_width")).filter(isNumber)},getMaxHeightSetting=function(editor){return Optional.from(editor.getParam("max_height")).filter(isNumber)},getUserStyleFormats=function(editor){return Optional.from(editor.getParam("style_formats")).filter(isArray)},isMergeStyleFormats=function(editor){return editor.getParam("style_formats_merge",!1,"boolean")},getLineHeightFormats=function(editor){return editor.getParam("lineheight_formats","1 1.1 1.2 1.3 1.4 1.5 2","string").split(" ")},getContentLanguages=function(editor){return editor.getParam("content_langs",void 0,"array")},getRemovedMenuItems=function(editor){return editor.getParam("removed_menuitems","")},isMenubarEnabled=function(editor){return!1!==editor.getParam("menubar",!0,"boolean")},isToolbarEnabled=function(editor){var toolbar=editor.getParam("toolbar",!0),isToolbarTrue=!0===toolbar,isToolbarString=isString(toolbar),isToolbarObjectArray=isArray(toolbar)&&toolbar.length>0;return!isMultipleToolbars(editor)&&(isToolbarObjectArray||isToolbarString||isToolbarTrue)},getMultipleToolbarsSetting=function(editor){var toolbars=range$2(9,(function(num){return editor.getParam("toolbar"+(num+1),!1,"string")})),toolbarArray=filter$2(toolbars,(function(toolbar){return"string"==typeof toolbar}));return toolbarArray.length>0?Optional.some(toolbarArray):Optional.none()},isMultipleToolbars=function(editor){return getMultipleToolbarsSetting(editor).fold((function(){var toolbar;return editor.getParam("toolbar",[],"string[]").length>0}),always)},ToolbarMode;!function(ToolbarMode){ToolbarMode.default="wrap",ToolbarMode.floating="floating",ToolbarMode.sliding="sliding",ToolbarMode.scrolling="scrolling"}(ToolbarMode||(ToolbarMode={}));var getToolbarMode=function(editor){return editor.getParam("toolbar_mode","","string")},ToolbarLocation;!function(ToolbarLocation){ToolbarLocation.auto="auto",ToolbarLocation.top="top",ToolbarLocation.bottom="bottom"}(ToolbarLocation||(ToolbarLocation={}));var getToolbarGroups=function(editor){return editor.getParam("toolbar_groups",{},"object")},getToolbarLocation=function(editor){return editor.getParam("toolbar_location",ToolbarLocation.auto,"string")},isToolbarLocationBottom=function(editor){return getToolbarLocation(editor)===ToolbarLocation.bottom},fixedContainerSelector=function(editor){return editor.getParam("fixed_toolbar_container","","string")},fixedToolbarContainerTarget=function(editor){return editor.getParam("fixed_toolbar_container_target")},isToolbarPersist=function(editor){return editor.getParam("toolbar_persist",!1,"boolean")},fixedContainerTarget=function(editor){if(!editor.inline)return Optional.none();var selector=fixedContainerSelector(editor);if(selector.length>0)return descendant(body(),selector);var element=fixedToolbarContainerTarget(editor);return isNonNullable(element)?Optional.some(SugarElement.fromDom(element)):Optional.none()},useFixedContainer=function(editor){return editor.inline&&fixedContainerTarget(editor).isSome()},getUiContainer=function(editor){var fixedContainer;return fixedContainerTarget(editor).getOrThunk((function(){return getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement())))}))},isDistractionFree=function(editor){return editor.inline&&!isMenubarEnabled(editor)&&!isToolbarEnabled(editor)&&!isMultipleToolbars(editor)},isStickyToolbar=function(editor){var isStickyToolbar;return(editor.getParam("toolbar_sticky",!1,"boolean")||editor.inline)&&!useFixedContainer(editor)&&!isDistractionFree(editor)},getStickyToolbarOffset=function(editor){return editor.getParam("toolbar_sticky_offset",0,"number")},isDraggableModal$1=function(editor){return editor.getParam("draggable_modal",!1,"boolean")},getMenus=function(editor){var menu=editor.getParam("menu");return menu?map$1(menu,(function(menu){return __assign(__assign({},menu),{items:menu.items})})):{}},getMenubar=function(editor){return editor.getParam("menubar")},getToolbar=function(editor){return editor.getParam("toolbar",!0)},getFilePickerCallback=function(editor){return editor.getParam("file_picker_callback")},getFilePickerTypes=function(editor){return editor.getParam("file_picker_types")},getFileBrowserCallbackTypes=function(editor){return editor.getParam("file_browser_callback_types")},noTypeaheadUrls=function(editor){return!1===editor.getParam("typeahead_urls")},getAnchorTop=function(editor){return editor.getParam("anchor_top","#top")},getAnchorBottom=function(editor){return editor.getParam("anchor_bottom","#bottom")},getFilePickerValidatorHandler=function(editor){var handler=editor.getParam("file_picker_validator_handler",void 0,"function");return void 0===handler?editor.getParam("filepicker_validator_handler",void 0,"function"):handler},ReadOnlyChannel="silver.readonly",ReadOnlyDataSchema=objOf([requiredBoolean("readonly")]),broadcastReadonly=function(uiComponents,readonly){var outerContainer,target=uiComponents.outerContainer.element;readonly&&(uiComponents.mothership.broadcastOn([dismissPopups()],{target:target}),uiComponents.uiMothership.broadcastOn([dismissPopups()],{target:target})),uiComponents.mothership.broadcastOn([ReadOnlyChannel],{readonly:readonly}),uiComponents.uiMothership.broadcastOn([ReadOnlyChannel],{readonly:readonly})},setupReadonlyModeSwitch=function(editor,uiComponents){editor.on("init",(function(){editor.mode.isReadOnly()&&broadcastReadonly(uiComponents,!0)})),editor.on("SwitchMode",(function(){return broadcastReadonly(uiComponents,editor.mode.isReadOnly())})),isReadOnly(editor)&&editor.setMode("readonly")},receivingConfig=function(){var _a;return Receiving.config({channels:(_a={},_a[ReadOnlyChannel]={schema:ReadOnlyDataSchema,onReceive:function(comp,data){Disabling.set(comp,data.readonly)}},_a)})},item,button,splitButton,toolbarButton,DisablingConfigs_item=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-collection__item--state-disabled"})},DisablingConfigs_button=function(disabled){return Disabling.config({disabled:disabled})},DisablingConfigs_splitButton=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled"})},DisablingConfigs_toolbarButton=function(disabled){return Disabling.config({disabled:disabled,disableClass:"tox-tbtn--disabled",useNative:!1})},runWithApi=function(info,comp){var api=info.getApi(comp);return function(f){f(api)}},onControlAttached=function(info,editorOffCell){return runOnAttached((function(comp){var run;runWithApi(info,comp)((function(api){var onDestroy=info.onSetup(api);isFunction(onDestroy)&&editorOffCell.set(onDestroy)}))}))},onControlDetached=function(getApi,editorOffCell){return runOnDetached((function(comp){return runWithApi(getApi,comp)(editorOffCell.get())}))},_a$1,onMenuItemExecute=function(info,itemResponse){return runOnExecute$1((function(comp,simulatedEvent){runWithApi(info,comp)(info.onAction),info.triggersSubmenu||itemResponse!==ItemResponse$1.CLOSE_ON_EXECUTE||(emit(comp,sandboxClose()),simulatedEvent.stop())}))},menuItemEventOrder=((_a$1={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","item-events"],_a$1),componentRenderPipeline=cat,renderCommonItem=function(spec,structure,itemResponse,providersbackstage){var editorOffCell=Cell(noop);return{type:"item",dom:structure.dom,components:componentRenderPipeline(structure.optComponents),data:spec.data,eventOrder:menuItemEventOrder,hasSubmenu:spec.triggersSubmenu,itemBehaviours:derive$1([config("item-events",[onMenuItemExecute(spec,itemResponse),onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),DisablingConfigs_item((function(){return spec.disabled||providersbackstage.isDisabled()})),receivingConfig(),Replacing.config({})].concat(spec.itemBehaviours))}},buildData=function(source){return{value:source.value,meta:__assign({text:source.text.getOr("")},source.meta)}},global$9=tinymce.util.Tools.resolve("tinymce.Env"),convertText=function(source){var mac={alt:"&#x2325;",ctrl:"&#x2303;",shift:"&#x21E7;",meta:"&#x2318;",access:"&#x2303;&#x2325;"},other={meta:"Ctrl",access:"Shift+Alt"},replace=global$9.mac?mac:other,shortcut=source.split("+"),updated=map$2(shortcut,(function(segment){var search=segment.toLowerCase().trim();return has$2(replace,search)?replace[search]:segment}));return global$9.mac?updated.join(""):updated.join("+")},renderIcon$1=function(name,icons,classes){return void 0===classes&&(classes=[iconClass]),render$3(name,{tag:"div",classes:classes},icons)},renderText=function(text$1){return{dom:{tag:"div",classes:[textClass]},components:[text(global$e.translate(text$1))]}},renderHtml=function(html,classes){return{dom:{tag:"div",classes:classes,innerHtml:html}}},renderStyledText=function(style,text$1){return{dom:{tag:"div",classes:[textClass]},components:[{dom:{tag:style.tag,styles:style.styles},components:[text(global$e.translate(text$1))]}]}},renderShortcut=function(shortcut){return{dom:{tag:"div",classes:[accessoryClass],innerHtml:convertText(shortcut)}}},renderCheckmark=function(icons){return renderIcon$1("checkmark",icons,[checkmarkClass])},renderSubmenuCaret=function(icons){return renderIcon$1("chevron-right",icons,[caretClass])},renderDownwardsCaret=function(icons){return renderIcon$1("chevron-down",icons,[caretClass])},renderContainer=function(container,components){var directionClass="vertical"===container.direction?containerColumnClass:containerRowClass,alignClass="left"===container.align?containerAlignLeftClass:containerAlignRightClass,getValignClass;return{dom:{tag:"div",classes:[containerClass,directionClass,alignClass,function(){switch(container.valign){case"top":return containerValignTopClass;case"middle":return containerValignMiddleClass;case"bottom":return containerValignBottomClass}}()]},components:components}},renderImage=function(src,classes,alt){return{dom:{tag:"img",classes:classes,attributes:{src:src,alt:alt.getOr("")}}}},renderColorStructure=function(item,providerBackstage,fallbackIcon){var colorPickerCommand="custom",removeColorCommand="remove",itemText=item.ariaLabel,itemValue=item.value,iconSvg=item.iconContent.map((function(name){return getOr(name,providerBackstage.icons,fallbackIcon)})),getDom;return{dom:function(){var common=colorClass,icon=iconSvg.getOr(""),attributes,baseDom={tag:"div",attributes:itemText.map((function(text){return{title:providerBackstage.translate(text)}})).getOr({}),classes:[common]};return __assign(__assign({},baseDom),"custom"===itemValue?{tag:"button",classes:__spreadArray(__spreadArray([],baseDom.classes,!0),["tox-swatches__picker-btn"],!1),innerHtml:icon}:"remove"===itemValue?{classes:__spreadArray(__spreadArray([],baseDom.classes,!0),["tox-swatch--remove"],!1),innerHtml:icon}:{attributes:__assign(__assign({},baseDom.attributes),{"data-mce-color":itemValue}),styles:{"background-color":itemValue}})}(),optComponents:[]}},renderItemDomStructure=function(ariaLabel){var domTitle=ariaLabel.map((function(label){return{attributes:{title:global$e.translate(label)}}})).getOr({});return __assign({tag:"div",classes:[navClass,selectableClass]},domTitle)},renderNormalItemStructure=function(info,providersBackstage,renderIcons,fallbackIcon){var iconSpec={tag:"div",classes:[iconClass]},renderIcon=function(iconName){return render$3(iconName,iconSpec,providersBackstage.icons,fallbackIcon)},renderEmptyIcon=function(){return Optional.some({dom:iconSpec})},leftIcon=renderIcons?info.iconContent.map(renderIcon).orThunk(renderEmptyIcon):Optional.none(),checkmark=info.checkMark,textRender=Optional.from(info.meta).fold((function(){return renderText}),(function(meta){return has$2(meta,"style")?curry(renderStyledText,meta.style):renderText})),content=info.htmlContent.fold((function(){return info.textContent.map(textRender)}),(function(html){return Optional.some(renderHtml(html,[textClass]))})),menuItem;return{dom:renderItemDomStructure(info.ariaLabel),optComponents:[leftIcon,content,info.shortcutContent.map(renderShortcut),checkmark,info.caret]}},renderItemStructure=function(info,providersBackstage,renderIcons,fallbackIcon){return void 0===fallbackIcon&&(fallbackIcon=Optional.none()),"color"===info.presets?renderColorStructure(info,providersBackstage,fallbackIcon):renderNormalItemStructure(info,providersBackstage,renderIcons,fallbackIcon)},tooltipBehaviour=function(meta,sharedBackstage){return get$e(meta,"tooltipWorker").map((function(tooltipWorker){return[Tooltipping.config({lazySink:sharedBackstage.getSink,tooltipDom:{tag:"div",classes:["tox-tooltip-worker-container"]},tooltipComponents:[],anchor:function(comp){return{type:"submenu",item:comp,overrides:{maxHeightFunction:expandable$1}}},mode:"follow-highlight",onShow:function(component,_tooltip){tooltipWorker((function(elm){Tooltipping.setComponents(component,[external$2({element:SugarElement.fromDom(elm)})])}))}})]})).getOr([])},encodeText=function(text){return global$b.DOM.encode(text)},replaceText=function(text,matchText){var translated=global$e.translate(text),encoded=encodeText(translated);if(matchText.length>0){var escapedMatchRegex=new RegExp(escape(matchText),"gi");return encoded.replace(escapedMatchRegex,(function(match){return'<span class="tox-autocompleter-highlight">'+match+"</span>"}))}return encoded},renderAutocompleteItem=function(spec,matchText,useText,presets,onItemValueHandler,itemResponse,sharedBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var structure=renderItemStructure({presets:presets,textContent:Optional.none(),htmlContent:useText?spec.text.map((function(text){return replaceText(text,matchText)})):Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:Optional.none(),checkMark:Optional.none(),caret:Optional.none(),value:spec.value},sharedBackstage.providers,renderIcons,spec.icon);return renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:constant$1({}),onAction:function(_api){return onItemValueHandler(spec.value,spec.meta)},onSetup:constant$1(noop),triggersSubmenu:!1,itemBehaviours:tooltipBehaviour(spec.meta,sharedBackstage)},structure,itemResponse,sharedBackstage.providers)},render$2=function(items,extras){return map$2(items,(function(item){switch(item.type){case"cardcontainer":return renderContainer(item,render$2(item.items,extras));case"cardimage":return renderImage(item.src,item.classes,item.alt);case"cardtext":var shouldHighlight,matchText=item.name.exists((function(name){return contains$2(extras.cardText.highlightOn,name)}))?Optional.from(extras.cardText.matchText).getOr(""):"";return renderHtml(replaceText(item.text,matchText),item.classes)}}))},renderCardMenuItem=function(spec,itemResponse,sharedBackstage,extras){var getApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){Disabling.set(component,state),each$1(descendants(component.element,"*"),(function(elm){component.getSystem().getByDom(elm).each((function(comp){comp.hasConfigured(Disabling)&&Disabling.set(comp,state)}))}))}}},structure={dom:renderItemDomStructure(spec.label),optComponents:[Optional.some({dom:{tag:"div",classes:[containerClass,containerRowClass]},components:render$2(spec.items,extras)})]};return renderCommonItem({data:buildData(__assign({text:Optional.none()},spec)),disabled:spec.disabled,getApi:getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:Optional.from(extras.itemBehaviours).getOr([])},structure,itemResponse,sharedBackstage.providers)},renderChoiceItem=function(spec,useText,presets,onItemValueHandler,isSelected,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var getApi=function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},structure=renderItemStructure({presets:presets,textContent:useText?spec.text:Optional.none(),htmlContent:Optional.none(),ariaLabel:spec.text,iconContent:spec.icon,shortcutContent:useText?spec.shortcut:Optional.none(),checkMark:useText?Optional.some(renderCheckmark(providersBackstage.icons)):Optional.none(),caret:Optional.none(),value:spec.value},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:getApi,onAction:function(_api){return onItemValueHandler(spec.value)},onSetup:function(api){return api.setActive(isSelected),noop},triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:!1,selected:spec.active}})},parts$f=generate$3(owner$2(),parts$h()),hexColour=function(value){return{value:value}},shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longformRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,isHexString=function(hex){return shorthandRegex.test(hex)||longformRegex.test(hex)},normalizeHex=function(hex){return removeLeading(hex,"#").toUpperCase()},fromString$1=function(hex){return isHexString(hex)?Optional.some({value:normalizeHex(hex)}):Optional.none()},getLongForm=function(hex){var hexString;return{value:hex.value.replace(shorthandRegex,(function(m,r,g,b){return r+r+g+g+b+b}))}},extractValues=function(hex){var longForm=getLongForm(hex),splitForm=longformRegex.exec(longForm.value);return null===splitForm?["FFFFFF","FF","FF","FF"]:splitForm},toHex=function(component){var hex=component.toString(16);return(1===hex.length?"0"+hex:hex).toUpperCase()},fromRgba=function(rgbaColour){var value=toHex(rgbaColour.red)+toHex(rgbaColour.green)+toHex(rgbaColour.blue);return hexColour(value)},min=Math.min,max=Math.max,round$1=Math.round,rgbRegex=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/,rgbaRegex=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/,rgbaColour=function(red,green,blue,alpha){return{red:red,green:green,blue:blue,alpha:alpha}},isRgbaComponent=function(value){var num=parseInt(value,10);return num.toString()===value&&num>=0&&num<=255},fromHsv=function(hsv){var r,g,b,hue=(hsv.hue||0)%360,saturation=hsv.saturation/100,brightness=hsv.value/100;if(saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0===saturation)return r=g=b=round$1(255*brightness),rgbaColour(r,g,b,1);var side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}return r=round$1(255*(r+match)),g=round$1(255*(g+match)),b=round$1(255*(b+match)),rgbaColour(r,g,b,1)},fromHex=function(hexColour){var result=extractValues(hexColour),red=parseInt(result[1],16),green=parseInt(result[2],16),blue=parseInt(result[3],16);return rgbaColour(red,green,blue,1)},fromStringValues=function(red,green,blue,alpha){var r=parseInt(red,10),g=parseInt(green,10),b=parseInt(blue,10),a=parseFloat(alpha);return rgbaColour(r,g,b,a)},fromString=function(rgbaString){if("transparent"===rgbaString)return Optional.some(rgbaColour(0,0,0,0));var rgbMatch=rgbRegex.exec(rgbaString);if(null!==rgbMatch)return Optional.some(fromStringValues(rgbMatch[1],rgbMatch[2],rgbMatch[3],"1"));var rgbaMatch=rgbaRegex.exec(rgbaString);return null!==rgbaMatch?Optional.some(fromStringValues(rgbaMatch[1],rgbaMatch[2],rgbaMatch[3],rgbaMatch[4])):Optional.none()},toString=function(rgba){return"rgba("+rgba.red+","+rgba.green+","+rgba.blue+","+rgba.alpha+")"},red=rgbaColour(255,0,0,1),fireSkinLoaded$1=function(editor){return editor.fire("SkinLoaded")},fireSkinLoadError$1=function(editor,error){return editor.fire("SkinLoadError",error)},fireResizeEditor=function(editor){return editor.fire("ResizeEditor")},fireResizeContent=function(editor,e){return editor.fire("ResizeContent",e)},fireScrollContent=function(editor,e){return editor.fire("ScrollContent",e)},fireTextColorChange=function(editor,data){return editor.fire("TextColorChange",data)},hsvColour=function(hue,saturation,value){return{hue:hue,saturation:saturation,value:value}},fromRgb=function(rgbaColour){var h=0,s=0,v=0,r=rgbaColour.red/255,g=rgbaColour.green/255,b=rgbaColour.blue/255,minRGB=Math.min(r,Math.min(g,b)),maxRGB=Math.max(r,Math.max(g,b)),d;return minRGB===maxRGB?hsvColour(0,0,100*(v=minRGB)):(h=60*((h=r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/(maxRGB-minRGB)),s=(maxRGB-minRGB)/maxRGB,v=maxRGB,hsvColour(Math.round(h),Math.round(100*s),Math.round(100*v)))},hexToHsv=function(hex){return fromRgb(fromHex(hex))},hsvToHex=function(hsv){return fromRgba(fromHsv(hsv))},anyToHex=function(color){return fromString$1(color).orThunk((function(){return fromString(color).map(fromRgba)})).getOrThunk((function(){var canvas=document.createElement("canvas");canvas.height=1,canvas.width=1;var canvasContext=canvas.getContext("2d");canvasContext.clearRect(0,0,canvas.width,canvas.height),canvasContext.fillStyle="#FFFFFF",canvasContext.fillStyle=color,canvasContext.fillRect(0,0,1,1);var rgba=canvasContext.getImageData(0,0,1,1).data,r=rgba[0],g=rgba[1],b=rgba[2],a=rgba[3];return fromRgba(rgbaColour(r,g,b,a))}))},global$8=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),storageName="tinymce-custom-colors";function ColorCache(max){void 0===max&&(max=10);var storageString=global$8.getItem(storageName),localstorage,prune,cache=function(list){var diff;return max-list.length<0?list.slice(0,max):list}(isString(storageString)?JSON.parse(storageString):[]),add=function(key){indexOf(cache,key).each(remove),cache.unshift(key),cache.length>max&&cache.pop(),global$8.setItem(storageName,JSON.stringify(cache))},remove=function(idx){cache.splice(idx,1)},state;return{add:add,state:function(){return cache.slice(0)}}}var choiceItem="choiceitem",defaultColors=[{type:choiceItem,text:"Light Green",value:"#BFEDD2"},{type:choiceItem,text:"Light Yellow",value:"#FBEEB8"},{type:choiceItem,text:"Light Red",value:"#F8CAC6"},{type:choiceItem,text:"Light Purple",value:"#ECCAFA"},{type:choiceItem,text:"Light Blue",value:"#C2E0F4"},{type:choiceItem,text:"Green",value:"#2DC26B"},{type:choiceItem,text:"Yellow",value:"#F1C40F"},{type:choiceItem,text:"Red",value:"#E03E2D"},{type:choiceItem,text:"Purple",value:"#B96AD9"},{type:choiceItem,text:"Blue",value:"#3598DB"},{type:choiceItem,text:"Dark Turquoise",value:"#169179"},{type:choiceItem,text:"Orange",value:"#E67E23"},{type:choiceItem,text:"Dark Red",value:"#BA372A"},{type:choiceItem,text:"Dark Purple",value:"#843FA1"},{type:choiceItem,text:"Dark Blue",value:"#236FA1"},{type:choiceItem,text:"Light Gray",value:"#ECF0F1"},{type:choiceItem,text:"Medium Gray",value:"#CED4D9"},{type:choiceItem,text:"Gray",value:"#95A5A6"},{type:choiceItem,text:"Dark Gray",value:"#7E8C8D"},{type:choiceItem,text:"Navy Blue",value:"#34495E"},{type:choiceItem,text:"Black",value:"#000000"},{type:choiceItem,text:"White",value:"#ffffff"}],colorCache=ColorCache(10),mapColors=function(colorMap){for(var colors=[],i=0;i<colorMap.length;i+=2)colors.push({text:colorMap[i+1],value:"#"+anyToHex(colorMap[i]).value,type:"choiceitem"});return colors},getColorCols$2=function(editor,defaultCols){return editor.getParam("color_cols",defaultCols,"number")},hasCustomColors$1=function(editor){return!1!==editor.getParam("custom_colors")},getColorMap=function(editor){return editor.getParam("color_map")},getColors$2=function(editor){var unmapped=getColorMap(editor);return void 0!==unmapped?mapColors(unmapped):defaultColors},getCurrentColors=function(){return map$2(colorCache.state(),(function(color){return{type:choiceItem,text:color,value:color}}))},addColor=function(color){colorCache.add(color)},fallbackColor="#000000",getCurrentColor=function(editor,format){var color;return editor.dom.getParents(editor.selection.getStart(),(function(elm){var value;(value=elm.style["forecolor"===format?"color":"background-color"])&&(color=color||value)})),Optional.from(color)},applyFormat=function(editor,format,value){editor.undoManager.transact((function(){editor.focus(),editor.formatter.apply(format,{value:value}),editor.nodeChanged()}))},removeFormat=function(editor,format){editor.undoManager.transact((function(){editor.focus(),editor.formatter.remove(format,{value:null},null,!0),editor.nodeChanged()}))},registerCommands=function(editor){editor.addCommand("mceApplyTextcolor",(function(format,value){applyFormat(editor,format,value)})),editor.addCommand("mceRemoveTextcolor",(function(format){removeFormat(editor,format)}))},calcCols=function(colors){return Math.max(5,Math.ceil(Math.sqrt(colors)))},getColorCols$1=function(editor){var colors=getColors$2(editor),defaultCols=calcCols(colors.length);return getColorCols$2(editor,defaultCols)},getAdditionalColors=function(hasCustom){var type="choiceitem",remove={type:type,text:"Remove color",icon:"color-swatch-remove-color",value:"remove"},custom;return hasCustom?[remove,{type:type,text:"Custom color",icon:"color-picker",value:"custom"}]:[remove]},applyColor=function(editor,format,value,onChoice){var dialog;"custom"===value?colorPickerDialog(editor)((function(colorOpt){colorOpt.each((function(color){addColor(color),editor.execCommand("mceApplyTextcolor",format,color),onChoice(color)}))}),"#000000"):"remove"===value?(onChoice(""),editor.execCommand("mceRemoveTextcolor",format)):(onChoice(value),editor.execCommand("mceApplyTextcolor",format,value))},getColors$1=function(colors,hasCustom){return colors.concat(getCurrentColors().concat(getAdditionalColors(hasCustom)))},getFetch$1=function(colors,hasCustom){return function(callback){callback(getColors$1(colors,hasCustom))}},setIconColor=function(splitButtonApi,name,newColor){var id="forecolor"===name?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color";splitButtonApi.setIconFill(id,newColor)},registerTextColorButton=function(editor,name,format,tooltip,lastColor){editor.ui.registry.addSplitButton(name,{tooltip:tooltip,presets:"color",icon:"forecolor"===name?"text-color":"highlight-bg-color",select:function(value){var optCurrentRgb;return getCurrentColor(editor,format).bind((function(currentRgb){return fromString(currentRgb).map((function(rgba){var currentHex=fromRgba(rgba).value;return contains$1(value.toLowerCase(),currentHex)}))})).getOr(!1)},columns:getColorCols$1(editor),fetch:getFetch$1(getColors$2(editor),hasCustomColors$1(editor)),onAction:function(_splitButtonApi){applyColor(editor,format,lastColor.get(),noop)},onItemAction:function(_splitButtonApi,value){applyColor(editor,format,value,(function(newColor){lastColor.set(newColor),fireTextColorChange(editor,{name:name,color:newColor})}))},onSetup:function(splitButtonApi){setIconColor(splitButtonApi,name,lastColor.get());var handler=function(e){e.name===name&&setIconColor(splitButtonApi,e.name,e.color)};return editor.on("TextColorChange",handler),function(){editor.off("TextColorChange",handler)}}})},registerTextColorMenuItem=function(editor,name,format,text){editor.ui.registry.addNestedMenuItem(name,{text:text,icon:"forecolor"===name?"text-color":"highlight-bg-color",getSubmenuItems:function(){return[{type:"fancymenuitem",fancytype:"colorswatch",onAction:function(data){applyColor(editor,format,data.value,noop)}}]}})},colorPickerDialog=function(editor){return function(callback,value){var isValid=!1,onSubmit=function(api){var data,hex=api.getData().colorpicker;isValid?(callback(Optional.from(hex)),api.close()):editor.windowManager.alert(editor.translate(["Invalid hex color code: {0}",hex]))},onAction=function(_api,details){"hex-valid"===details.name&&(isValid=details.value)},initialData={colorpicker:value};editor.windowManager.open({title:"Color Picker",size:"normal",body:{type:"panel",items:[{type:"colorpicker",name:"colorpicker",label:"Color"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:initialData,onAction:onAction,onSubmit:onSubmit,onClose:noop,onCancel:function(){callback(Optional.none())}})}},register$a=function(editor){registerCommands(editor);var lastForeColor=Cell("#000000"),lastBackColor=Cell("#000000");registerTextColorButton(editor,"forecolor","forecolor","Text color",lastForeColor),registerTextColorButton(editor,"backcolor","hilitecolor","Background color",lastBackColor),registerTextColorMenuItem(editor,"forecolor","forecolor","Text color"),registerTextColorMenuItem(editor,"backcolor","hilitecolor","Background color")},createPartialChoiceMenu=function(value,items,onItemValueHandler,columns,presets,itemResponse,select,providersBackstage){var hasIcons=menuHasIcons(items),presetItemTypes,alloyItems=createChoiceItems(items,onItemValueHandler,columns,"color"!==presets?"normal":"color",itemResponse,select,providersBackstage);return createPartialMenuWithAlloyItems(value,hasIcons,alloyItems,columns,presets)},createChoiceItems=function(items,onItemValueHandler,columns,itemPresets,itemResponse,select,providersBackstage){return cat(map$2(items,(function(item){return"choiceitem"===item.type?createChoiceMenuItem(item).fold(handleError,(function(d){return Optional.some(renderChoiceItem(d,1===columns,itemPresets,onItemValueHandler,select(item.value),itemResponse,providersBackstage,menuHasIcons(items)))})):Optional.none()})))},deriveMenuMovement=function(columns,presets){var menuMarkers=markers(presets),rowClass;return 1===columns?{mode:"menu",moveOnTab:!0}:"auto"===columns?{mode:"grid",selector:"."+menuMarkers.item,initSize:{numColumns:1,numRows:1}}:{mode:"matrix",rowSelector:"."+("color"===presets?"tox-swatches__row":"tox-collection__group")}},deriveCollectionMovement=function(columns,presets){return 1===columns?{mode:"menu",moveOnTab:!1,selector:".tox-collection__item"}:"auto"===columns?{mode:"flatgrid",selector:".tox-collection__item",initSize:{numColumns:1,numRows:1}}:{mode:"matrix",selectors:{row:"color"===presets?".tox-swatches__row":".tox-collection__group",cell:"color"===presets?"."+colorClass:"."+selectableClass}}},renderColorSwatchItem=function(spec,backstage){var items=getColorItems(spec,backstage),columns=backstage.colorinput.getColorCols(),presets="color",menuSpec=createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onAction({value:value})}),columns,"color",ItemResponse$1.CLOSE_ON_EXECUTE,never,backstage.shared.providers),widgetSpec=__assign(__assign({},menuSpec),{markers:markers("color"),movement:deriveMenuMovement(columns,"color")});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget(Menu.sketch(widgetSpec))]}},getColorItems=function(spec,backstage){var useCustomColors=spec.initData.allowCustomColors&&backstage.colorinput.hasCustomColors();return spec.initData.colors.fold((function(){return getColors$1(backstage.colorinput.getColors(),useCustomColors)}),(function(colors){return colors.concat(getAdditionalColors(useCustomColors))}))},cellOverEvent=generate$6("cell-over"),cellExecuteEvent=generate$6("cell-execute"),makeCell=function(row,col,labelId){var _a,emitCellOver=function(c){return emitWith(c,cellOverEvent,{row:row,col:col})},emitExecute=function(c){return emitWith(c,cellExecuteEvent,{row:row,col:col})},onClick=function(c,se){se.stop(),emitExecute(c)};return build$1({dom:{tag:"div",attributes:(_a={role:"button"},_a["aria-labelledby"]=labelId,_a)},behaviours:derive$1([config("insert-table-picker-cell",[run$1(mouseover(),Focusing.focus),run$1(execute$5(),emitExecute),run$1(click(),onClick),run$1(tap(),onClick)]),Toggling.config({toggleClass:"tox-insert-table-picker__selected",toggleOnExecute:!1}),Focusing.config({onFocus:emitCellOver})])})},makeCells=function(labelId,numRows,numCols){for(var cells=[],i=0;i<numRows;i++){for(var row=[],j=0;j<numCols;j++)row.push(makeCell(i,j,labelId));cells.push(row)}return cells},selectCells=function(cells,selectedRow,selectedColumn,numRows,numColumns){for(var i=0;i<numRows;i++)for(var j=0;j<numColumns;j++)Toggling.set(cells[i][j],i<=selectedRow&&j<=selectedColumn)},makeComponents=function(cells){return bind$3(cells,(function(cellRow){return map$2(cellRow,premade)}))},makeLabelText=function(row,col){return text(col+"x"+row)},renderInsertTableMenuItem,fancyMenuItems={inserttable:function(spec){var numRows=10,numColumns=10,sizeLabelId=generate$6("size-label"),cells=makeCells(sizeLabelId,10,10),emptyLabelText=makeLabelText(0,0),memLabel=record({dom:{tag:"span",classes:["tox-insert-table-picker__label"],attributes:{id:sizeLabelId}},components:[emptyLabelText],behaviours:derive$1([Replacing.config({})])});return{type:"widget",data:{value:generate$6("widget-id")},dom:{tag:"div",classes:["tox-fancymenuitem"]},autofocus:!0,components:[parts$f.widget({dom:{tag:"div",classes:["tox-insert-table-picker"]},components:makeComponents(cells).concat(memLabel.asSpec()),behaviours:derive$1([config("insert-table-picker",[runOnAttached((function(c){Replacing.set(memLabel.get(c),[emptyLabelText])})),runWithTarget(cellOverEvent,(function(c,t,e){var _a=e.event,row=_a.row,col=_a.col;selectCells(cells,row,col,10,10),Replacing.set(memLabel.get(c),[makeLabelText(row+1,col+1)])})),runWithTarget(cellExecuteEvent,(function(c,_,e){var _a=e.event,row=_a.row,col=_a.col;spec.onAction({numRows:row+1,numColumns:col+1}),emit(c,sandboxClose())}))]),Keying.config({initSize:{numRows:10,numColumns:10},mode:"flatgrid",selector:'[role="button"]'})])})]}},colorswatch:renderColorSwatchItem},renderFancyMenuItem,renderNestedItem,renderNormalItem,renderSeparatorItem,renderToggleMenuItem,autocomplete=renderAutocompleteItem,separator$3=function(spec){var innerHtml=spec.text.fold((function(){return{}}),(function(text){return{innerHtml:text}}));return{type:"separator",dom:__assign({tag:"div",classes:[selectableClass,groupHeadingClass]},innerHtml),components:[]}},normal=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var getApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},structure=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.none(),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:getApi,disabled:spec.disabled,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage)},nested=function(spec,itemResponse,providersBackstage,renderIcons,downwardsCaret){void 0===renderIcons&&(renderIcons=!0),void 0===downwardsCaret&&(downwardsCaret=!1);var caret=downwardsCaret?renderDownwardsCaret(providersBackstage.icons):renderSubmenuCaret(providersBackstage.icons),getApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},structure=renderItemStructure({presets:"normal",iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,caret:Optional.some(caret),checkMark:Optional.none(),shortcutContent:spec.shortcut},providersBackstage,renderIcons);return renderCommonItem({data:buildData(spec),getApi:getApi,disabled:spec.disabled,onAction:noop,onSetup:spec.onSetup,triggersSubmenu:!0,itemBehaviours:[]},structure,itemResponse,providersBackstage)},toggle$1=function(spec,itemResponse,providersBackstage,renderIcons){void 0===renderIcons&&(renderIcons=!0);var getApi=function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},structure=renderItemStructure({iconContent:spec.icon,textContent:spec.text,htmlContent:Optional.none(),ariaLabel:spec.text,checkMark:Optional.some(renderCheckmark(providersBackstage.icons)),caret:Optional.none(),shortcutContent:spec.shortcut,presets:"normal",meta:spec.meta},providersBackstage,renderIcons);return deepMerge(renderCommonItem({data:buildData(spec),disabled:spec.disabled,getApi:getApi,onAction:spec.onAction,onSetup:spec.onSetup,triggersSubmenu:!1,itemBehaviours:[]},structure,itemResponse,providersBackstage),{toggling:{toggleClass:tickedClass,toggleOnExecute:!1,selected:spec.active}})},fancy=function(spec,backstage){return get$e(fancyMenuItems,spec.fancytype).map((function(render){return render(spec,backstage)}))},card=renderCardMenuItem,FocusMode;!function(FocusMode){FocusMode[FocusMode.ContentFocus=0]="ContentFocus",FocusMode[FocusMode.UiFocus=1]="UiFocus"}(FocusMode||(FocusMode={}));var createMenuItemFromBridge=function(item,itemResponse,backstage,menuHasIcons,isHorizontalMenu){var providersBackstage=backstage.shared.providers,parseForHorizontalMenu=function(menuitem){return isHorizontalMenu?__assign(__assign({},menuitem),{shortcut:Optional.none(),icon:menuitem.text.isSome()?Optional.none():menuitem.icon}):menuitem};switch(item.type){case"menuitem":return createMenuItem(item).fold(handleError,(function(d){return Optional.some(normal(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))}));case"nestedmenuitem":return createNestedMenuItem(item).fold(handleError,(function(d){return Optional.some(nested(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons,isHorizontalMenu))}));case"togglemenuitem":return createToggleMenuItem(item).fold(handleError,(function(d){return Optional.some(toggle$1(parseForHorizontalMenu(d),itemResponse,providersBackstage,menuHasIcons))}));case"separator":return createSeparatorMenuItem(item).fold(handleError,(function(d){return Optional.some(separator$3(d))}));case"fancymenuitem":return createFancyMenuItem(item).fold(handleError,(function(d){return fancy(parseForHorizontalMenu(d),backstage)}));default:return console.error("Unknown item in general menu",item),Optional.none()}},createAutocompleteItems=function(items,matchText,onItemValueHandler,columns,itemResponse,sharedBackstage,highlightOn){var renderText=1===columns,renderIcons=!renderText||menuHasIcons(items);return cat(map$2(items,(function(item){switch(item.type){case"separator":return createSeparatorItem(item).fold(handleError,(function(d){return Optional.some(separator$3(d))}));case"cardmenuitem":return createCardMenuItem(item).fold(handleError,(function(d){return Optional.some(card(__assign(__assign({},d),{onAction:function(api){d.onAction(api),onItemValueHandler(d.value,d.meta)}}),itemResponse,sharedBackstage,{itemBehaviours:tooltipBehaviour(d.meta,sharedBackstage),cardText:{matchText:matchText,highlightOn:highlightOn}}))}));case"autocompleteitem":default:return createAutocompleterItem(item).fold(handleError,(function(d){return Optional.some(autocomplete(d,matchText,renderText,"normal",onItemValueHandler,itemResponse,sharedBackstage,renderIcons))}))}})))},createPartialMenu=function(value,items,itemResponse,backstage,isHorizontalMenu){var hasIcons=menuHasIcons(items),alloyItems=cat(map$2(items,(function(item){var itemHasIcon=function(i){return isHorizontalMenu?!has$2(i,"text"):hasIcons},createItem=function(i){return createMenuItemFromBridge(i,itemResponse,backstage,itemHasIcon(i),isHorizontalMenu)};return"nestedmenuitem"===item.type&&item.getSubmenuItems().length<=0?createItem(__assign(__assign({},item),{disabled:!0})):createItem(item)}))),createPartial;return(isHorizontalMenu?createHorizontalPartialMenuWithAlloyItems:createPartialMenuWithAlloyItems)(value,hasIcons,alloyItems,1,"normal")},createTieredDataFrom=function(partialMenu){return tieredMenu.singleData(partialMenu.value,partialMenu)},createMenuFrom=function(partialMenu,columns,focusMode,presets){var focusManager=focusMode===FocusMode.ContentFocus?highlights():dom$2(),movement=deriveMenuMovement(columns,presets),menuMarkers=markers(presets);return{dom:partialMenu.dom,components:partialMenu.components,items:partialMenu.items,value:partialMenu.value,markers:{selectedItem:menuMarkers.selectedItem,item:menuMarkers.item},movement:movement,fakeFocus:focusMode===FocusMode.ContentFocus,focusManager:focusManager,menuBehaviours:SimpleBehaviours_unnamedEvents("auto"!==columns?[]:[runOnAttached((function(comp,_se){detectSize(comp,4,menuMarkers.item).each((function(_a){var numColumns=_a.numColumns,numRows=_a.numRows;Keying.setGridSize(comp,numRows,numColumns)}))}))])}},register$9,Autocompleter_register=function(editor,sharedBackstage){var activeAutocompleter=value$1(),processingAction=Cell(!1),autocompleter=build$1(InlineView.sketch({dom:{tag:"div",classes:["tox-autocompleter"]},components:[],fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissAutocompleter",[run$1(dismissRequested(),(function(){return cancelIfNecessary()}))])]),lazySink:sharedBackstage.getSink})),isMenuOpen=function(){return InlineView.isOpen(autocompleter)},isActive=function(){return activeAutocompleter.get().isSome()},hideIfNecessary=function(){isActive()&&InlineView.hide(autocompleter)},cancelIfNecessary=function(){if(isActive()){var lastElement=activeAutocompleter.get().map((function(ac){return ac.element}));detect(lastElement.getOr(SugarElement.fromDom(editor.selection.getNode()))).each(unwrap),hideIfNecessary(),activeAutocompleter.clear(),processingAction.set(!1)}},getAutocompleters=cached((function(){return register$b(editor)})),getCombinedItems=function(triggerChar,matches){var columns=findMap(matches,(function(m){return Optional.from(m.columns)})).getOr(1);return bind$3(matches,(function(match){var choices=match.items;return createAutocompleteItems(choices,match.matchText,(function(itemValue,itemMeta){var nr=editor.selection.getRng();getContext(editor.dom,nr,triggerChar).fold((function(){return console.error("Lost context. Cursor probably moved")}),(function(_a){var range=_a.range,autocompleterApi={hide:function(){cancelIfNecessary()},reload:function(fetchOptions){hideIfNecessary(),load(fetchOptions)}};processingAction.set(!0),match.onAction(autocompleterApi,range,itemValue,itemMeta),processingAction.set(!1)}))}),columns,ItemResponse$1.BUBBLE_TO_SANDBOX,sharedBackstage,match.highlightOn)}))},commenceIfNecessary=function(context){if(!isActive()){var wrapper=create$4(editor,context.range);activeAutocompleter.set({triggerChar:context.triggerChar,element:wrapper,matchLength:context.text.length}),processingAction.set(!1)}},display=function(ac,context,lookupData,items){ac.matchLength=context.text.length;var columns=findMap(lookupData,(function(ld){return Optional.from(ld.columns)})).getOr(1);InlineView.showAt(autocompleter,Menu.sketch(createMenuFrom(createPartialMenuWithAlloyItems("autocompleter-value",!0,items,columns,"normal"),columns,FocusMode.ContentFocus,"normal")),{anchor:{type:"node",root:SugarElement.fromDom(editor.getBody()),node:Optional.from(ac.element)}}),InlineView.getContent(autocompleter).each(Highlighting.highlightFirst)},doLookup=function(fetchOptions){return activeAutocompleter.get().map((function(ac){return getContext(editor.dom,editor.selection.getRng(),ac.triggerChar).bind((function(newContext){return lookupWithContext(editor,getAutocompleters,newContext,fetchOptions)}))})).getOrThunk((function(){return lookup$2(editor,getAutocompleters)}))},load=function(fetchOptions){doLookup(fetchOptions).fold(cancelIfNecessary,(function(lookupInfo){commenceIfNecessary(lookupInfo.context),lookupInfo.lookupData.then((function(lookupData){activeAutocompleter.get().map((function(ac){var context=lookupInfo.context;if(ac.triggerChar===context.triggerChar){var combinedItems=getCombinedItems(context.triggerChar,lookupData);combinedItems.length>0?display(ac,context,lookupData,combinedItems):context.text.length-ac.matchLength>=10?cancelIfNecessary():hideIfNecessary()}}))}))}))},onKeypress,autocompleterUiApi={onKeypress:last((function(e){27!==e.which&&load()}),50),cancelIfNecessary:cancelIfNecessary,isMenuOpen:isMenuOpen,isActive:isActive,isProcessingAction:processingAction.get,getView:function(){return InlineView.getContent(autocompleter)}};!1===editor.hasPlugin("rtc")&&AutocompleterEditorEvents_setup(autocompleterUiApi,editor)},closest=function(scope,selector,isRoot){return closest$1(scope,selector,isRoot).isSome()},DelayedFunction=function(fun,delay){var ref=null,schedule,cancel;return{cancel:function(){null!==ref&&(clearTimeout(ref),ref=null)},schedule:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];ref=setTimeout((function(){fun.apply(null,args),ref=null}),delay)}}},SIGNIFICANT_MOVE=5,LONGPRESS_DELAY=400,getTouch=function(event){var raw=event.raw;return void 0===raw.touches||1!==raw.touches.length?Optional.none():Optional.some(raw.touches[0])},isFarEnough=function(touch,data){var distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5},monitor=function(settings){var startData=value$1(),longpressFired=Cell(!1),longpress$1=DelayedFunction((function(event){settings.triggerEvent(longpress(),event),longpressFired.set(!0)}),400),handleTouchstart=function(event){return getTouch(event).each((function(touch){longpress$1.cancel();var data={x:touch.clientX,y:touch.clientY,target:event.target};longpress$1.schedule(event),longpressFired.set(!1),startData.set(data)})),Optional.none()},handleTouchmove=function(event){return longpress$1.cancel(),getTouch(event).each((function(touch){startData.on((function(data){isFarEnough(touch,data)&&startData.clear()}))})),Optional.none()},handleTouchend=function(event){longpress$1.cancel();var isSame=function(data){return eq(data.target,event.target)};return startData.get().filter(isSame).map((function(_data){return longpressFired.get()?(event.prevent(),!1):settings.triggerEvent(tap(),event)}))},handlers=wrapAll([{key:touchstart(),value:handleTouchstart},{key:touchmove(),value:handleTouchmove},{key:touchend(),value:handleTouchend}]),fireIfReady;return{fireIfReady:function(event,type){return get$e(handlers,type).bind((function(handler){return handler(event)}))}}},isDangerous=function(event){var keyEv;return event.raw.which===BACKSPACE[0]&&!contains$2(["input","textarea"],name$2(event.target))&&!closest(event.target,'[contenteditable="true"]')},isFirefox=function(){return detect$1().browser.isFirefox()},bindFocus=function(container,handler){return isFirefox()?capture(container,"focus",handler):bind(container,"focusin",handler)},bindBlur=function(container,handler){return isFirefox()?capture(container,"blur",handler):bind(container,"focusout",handler)},setup$d=function(container,rawSettings){var settings=__assign({stopBackspace:!0},rawSettings),pointerEvents=["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"],tapEvent=monitor(settings),simpleEvents=map$2(pointerEvents.concat(["selectstart","input","contextmenu","change","transitionend","transitioncancel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),(function(type){return bind(container,type,(function(event){var stopped;tapEvent.fireIfReady(event,type).each((function(tapStopped){tapStopped&&event.kill()})),settings.triggerEvent(type,event)&&event.kill()}))})),pasteTimeout=value$1(),onPaste=bind(container,"paste",(function(event){var stopped;tapEvent.fireIfReady(event,"paste").each((function(tapStopped){tapStopped&&event.kill()})),settings.triggerEvent("paste",event)&&event.kill(),pasteTimeout.set(setTimeout((function(){settings.triggerEvent(postPaste(),event)}),0))})),onKeydown=bind(container,"keydown",(function(event){var stopped;settings.triggerEvent("keydown",event)?event.kill():settings.stopBackspace&&isDangerous(event)&&event.prevent()})),onFocusIn=bindFocus(container,(function(event){var stopped;settings.triggerEvent("focusin",event)&&event.kill()})),focusoutTimeout=value$1(),onFocusOut=bindBlur(container,(function(event){var stopped;settings.triggerEvent("focusout",event)&&event.kill(),focusoutTimeout.set(setTimeout((function(){settings.triggerEvent(postBlur(),event)}),0))})),unbind;return{unbind:function(){each$1(simpleEvents,(function(e){e.unbind()})),onKeydown.unbind(),onFocusIn.unbind(),onFocusOut.unbind(),onPaste.unbind(),pasteTimeout.on(clearTimeout),focusoutTimeout.on(clearTimeout)}}},derive=function(rawEvent,rawTarget){var source=get$e(rawEvent,"target").getOr(rawTarget);return Cell(source)},fromSource=function(event,source){var stopper=Cell(!1),cutter=Cell(!1),stop,cut;return{stop:function(){stopper.set(!0)},cut:function(){cutter.set(!0)},isStopped:stopper.get,isCut:cutter.get,event:event,setSource:source.set,getSource:source.get}},fromExternal=function(event){var stopper=Cell(!1),stop;return{stop:function(){stopper.set(!0)},cut:noop,isStopped:stopper.get,isCut:never,event:event,setSource:die("Cannot set source of a broadcasted event"),getSource:die("Cannot get source of a broadcasted event")}},adt$1=Adt_generate([{stopped:[]},{resume:["element"]},{complete:[]}]),doTriggerHandler=function(lookup,eventType,rawEvent,target,source,logger){var handler=lookup(eventType,target),simulatedEvent=fromSource(rawEvent,source);return handler.fold((function(){return logger.logEventNoHandlers(eventType,target),adt$1.complete()}),(function(handlerInfo){var descHandler=handlerInfo.descHandler,eventHandler;return getCurried(descHandler)(simulatedEvent),simulatedEvent.isStopped()?(logger.logEventStopped(eventType,handlerInfo.element,descHandler.purpose),adt$1.stopped()):simulatedEvent.isCut()?(logger.logEventCut(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()):parent(handlerInfo.element).fold((function(){return logger.logNoParent(eventType,handlerInfo.element,descHandler.purpose),adt$1.complete()}),(function(parent){return logger.logEventResponse(eventType,handlerInfo.element,descHandler.purpose),adt$1.resume(parent)}))}))},doTriggerOnUntilStopped=function(lookup,eventType,rawEvent,rawTarget,source,logger){return doTriggerHandler(lookup,eventType,rawEvent,rawTarget,source,logger).fold(always,(function(parent){return doTriggerOnUntilStopped(lookup,eventType,rawEvent,parent,source,logger)}),never)},triggerHandler=function(lookup,eventType,rawEvent,target,logger){var source=derive(rawEvent,target);return doTriggerHandler(lookup,eventType,rawEvent,target,source,logger)},broadcast=function(listeners,rawEvent,_logger){var simulatedEvent=fromExternal(rawEvent);return each$1(listeners,(function(listener){var descHandler=listener.descHandler,handler;getCurried(descHandler)(simulatedEvent)})),simulatedEvent.isStopped()},triggerUntilStopped=function(lookup,eventType,rawEvent,logger){return triggerOnUntilStopped(lookup,eventType,rawEvent,rawEvent.target,logger)},triggerOnUntilStopped=function(lookup,eventType,rawEvent,rawTarget,logger){var source=derive(rawEvent,rawTarget);return doTriggerOnUntilStopped(lookup,eventType,rawEvent,rawTarget,source,logger)},eventHandler=function(element,descHandler){return{element:element,descHandler:descHandler}},broadcastHandler=function(id,handler){return{id:id,descHandler:handler}},EventRegistry=function(){var registry={},registerId,findHandler=function(handlers,elem){return read$1(elem).bind((function(id){return get$e(handlers,id)})).map((function(descHandler){return eventHandler(elem,descHandler)}))},filterByType,find,unregisterId;return{registerId:function(extraArgs,id,events){each(events,(function(v,k){var handlers=void 0!==registry[k]?registry[k]:{};handlers[id]=curryArgs(v,extraArgs),registry[k]=handlers}))},unregisterId:function(id){each(registry,(function(handlersById,_eventName){has$2(handlersById,id)&&delete handlersById[id]}))},filterByType:function(type){return get$e(registry,type).map((function(handlers){return mapToArray(handlers,(function(f,id){return broadcastHandler(id,f)}))})).getOr([])},find:function(isAboveRoot,type,target){return get$e(registry,type).bind((function(handlers){return closest$4(target,(function(elem){return findHandler(handlers,elem)}),isAboveRoot)}))}}},Registry=function(){var events=EventRegistry(),components={},readOrTag=function(component){var elem=component.element;return read$1(elem).getOrThunk((function(){return write("uid-",component.element)}))},failOnDuplicate=function(component,tagId){var conflict=components[tagId];if(conflict!==component)throw new Error('The tagId "'+tagId+'" is already used by: '+element(conflict.element)+"\nCannot use it for: "+element(component.element)+"\nThe conflicting element is"+(inBody(conflict.element)?" ":" not ")+"already in the DOM");unregister(component)},register,unregister=function(component){read$1(component.element).each((function(tagId){delete components[tagId],events.unregisterId(tagId)}))},filter,find,getById;return{find:function(isAboveRoot,type,target){return events.find(isAboveRoot,type,target)},filter:function(type){return events.filterByType(type)},register:function(component){var tagId=readOrTag(component);hasNonNullableKey(components,tagId)&&failOnDuplicate(component,tagId);var extraArgs=[component];events.registerId(extraArgs,tagId,component.events),components[tagId]=component},unregister:unregister,getById:function(id){return get$e(components,id)}}},factory$j,Container=single({name:"Container",factory:function(detail){var _a=detail.dom,attributes=_a.attributes,domWithoutAttributes=__rest(_a,["attributes"]);return{uid:detail.uid,dom:__assign({tag:"div",attributes:__assign({role:"presentation"},attributes)},domWithoutAttributes),components:detail.components,behaviours:get$2(detail.containerBehaviours),events:detail.events,domModification:detail.domModification,eventOrder:detail.eventOrder}},configFields:[defaulted("components",[]),field("containerBehaviours",[]),defaulted("events",{}),defaulted("domModification",{}),defaulted("eventOrder",{})]}),takeover=function(root){var isAboveRoot=function(el){return parent(root.element).fold(always,(function(parent){return eq(el,parent)}))},registry=Registry(),lookup=function(eventName,target){return registry.find(isAboveRoot,eventName,target)},domEvents=setup$d(root.element,{triggerEvent:function(eventName,event){return monitorEvent(eventName,event.target,(function(logger){return triggerUntilStopped(lookup,eventName,event,logger)}))}}),systemApi={debugInfo:constant$1("real"),triggerEvent:function(eventName,target,data){monitorEvent(eventName,target,(function(logger){return triggerOnUntilStopped(lookup,eventName,data,target,logger)}))},triggerFocus:function(target,originator){read$1(target).fold((function(){focus$3(target)}),(function(_alloyId){monitorEvent(focus$4(),target,(function(logger){return triggerHandler(lookup,focus$4(),{originator:originator,kill:noop,prevent:noop,target:target},target,logger),!1}))}))},triggerEscape:function(comp,simulatedEvent){systemApi.triggerEvent("keydown",comp.element,simulatedEvent.event)},getByUid:function(uid){return getByUid(uid)},getByDom:function(elem){return getByDom(elem)},build:build$1,addToGui:function(c){add(c)},removeFromGui:function(c){remove(c)},addToWorld:function(c){addToWorld(c)},removeFromWorld:function(c){removeFromWorld(c)},broadcast:function(message){broadcast$1(message)},broadcastOn:function(channels,message){broadcastOn(channels,message)},broadcastEvent:function(eventName,event){broadcastEvent(eventName,event)},isConnected:always},addToWorld=function(component){component.connect(systemApi),isText$1(component.element)||(registry.register(component),each$1(component.components(),addToWorld),systemApi.triggerEvent(systemInit(),component.element,{target:component.element}))},removeFromWorld=function(component){isText$1(component.element)||(each$1(component.components(),removeFromWorld),registry.unregister(component)),component.disconnect()},add=function(component){attach(root,component)},remove=function(component){detach(component)},destroy=function(){domEvents.unbind(),remove$5(root.element)},broadcastData=function(data){var receivers=registry.filter(receive());each$1(receivers,(function(receiver){var descHandler=receiver.descHandler,handler;getCurried(descHandler)(data)}))},broadcast$1=function(message){broadcastData({universal:!0,data:message})},broadcastOn=function(channels,message){broadcastData({universal:!1,channels:channels,data:message})},broadcastEvent=function(eventName,event){var listeners=registry.filter(eventName);return broadcast(listeners,event)},getByUid=function(uid){return registry.getById(uid).fold((function(){return Result.error(new Error('Could not find component with uid: "'+uid+'" in system.'))}),Result.value)},getByDom=function(elem){var uid=read$1(elem).getOr("not found");return getByUid(uid)};return addToWorld(root),{root:root,element:root.element,destroy:destroy,add:add,remove:remove,getByUid:getByUid,getByDom:getByDom,addToWorld:addToWorld,removeFromWorld:removeFromWorld,broadcast:broadcast$1,broadcastOn:broadcastOn,broadcastEvent:broadcastEvent}},renderBar=function(spec,backstage){return{dom:{tag:"div",classes:["tox-bar","tox-form__controls-h-stack"]},components:map$2(spec.items,backstage.interpreter)}},schema$l=constant$1([defaulted("prefix","form-field"),field("fieldBehaviours",[Composing,Representing])]),parts$e=constant$1([optional({schema:[required$1("dom")],name:"label"}),optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),required({factory:{sketch:function(spec){var excludeFactory=exclude(spec,["factory"]);return spec.factory.sketch(excludeFactory)}},schema:[required$1("factory")],name:"field"})]),factory$i=function(detail,components,_spec,_externals){var behaviours=augment(detail.fieldBehaviours,[Composing.config({find:function(container){return getPart(container,detail,"field")}}),Representing.config({store:{mode:"manual",getValue:function(field){return Composing.getCurrent(field).bind(Representing.getValue)},setValue:function(field,value){Composing.getCurrent(field).each((function(current){Representing.setValue(current,value)}))}}})]),events=derive$2([runOnAttached((function(component,_simulatedEvent){var ps=getParts(component,detail,["label","field","aria-descriptor"]);ps.field().each((function(field){var id=generate$6(detail.prefix);ps.label().each((function(label){set$8(label.element,"for",id),set$8(field.element,"id",id)})),ps["aria-descriptor"]().each((function(descriptor){var descriptorId=generate$6(detail.prefix);set$8(descriptor.element,"id",descriptorId),set$8(field.element,"aria-describedby",descriptorId)}))}))}))]),apis={getField:function(container){return getPart(container,detail,"field")},getLabel:function(container){return getPart(container,detail,"label")}};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:behaviours,events:events,apis:apis}},FormField=composite({name:"FormField",configFields:schema$l(),partFields:parts$e(),factory:factory$i,apis:{getField:function(apis,comp){return apis.getField(comp)},getLabel:function(apis,comp){return apis.getLabel(comp)}}}),exhibit$2=function(base,tabConfig){return nu$7({attributes:wrapAll([{key:tabConfig.tabAttr,value:"true"}])})},ActiveTabstopping=Object.freeze({__proto__:null,exhibit:exhibit$2}),TabstopSchema=[defaulted("tabAttr","data-alloy-tabstop")],Tabstopping=create$7({fields:TabstopSchema,name:"tabstopping",active:ActiveTabstopping}),global$7=tinymce.util.Tools.resolve("tinymce.html.Entities"),renderFormFieldWith=function(pLabel,pField,extraClasses,extraBehaviours){var spec=renderFormFieldSpecWith(pLabel,pField,extraClasses,extraBehaviours);return FormField.sketch(spec)},renderFormField=function(pLabel,pField){return renderFormFieldWith(pLabel,pField,[],[])},renderFormFieldSpecWith=function(pLabel,pField,extraClasses,extraBehaviours){return{dom:renderFormFieldDomWith(extraClasses),components:pLabel.toArray().concat([pField]),fieldBehaviours:derive$1(extraBehaviours)}},renderFormFieldDom=function(){return renderFormFieldDomWith([])},renderFormFieldDomWith=function(extraClasses){return{tag:"div",classes:["tox-form__group"].concat(extraClasses)}},renderLabel$2=function(label,providersBackstage){return FormField.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}})},formChangeEvent=generate$6("form-component-change"),formCloseEvent=generate$6("form-close"),formCancelEvent=generate$6("form-cancel"),formActionEvent=generate$6("form-action"),formSubmitEvent=generate$6("form-submit"),formBlockEvent=generate$6("form-block"),formUnblockEvent=generate$6("form-unblock"),formTabChangeEvent=generate$6("form-tabchange"),formResizeEvent=generate$6("form-resize"),renderCollection=function(spec,providersBackstage){var _a,pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),runOnItem=function(f){return function(comp,se){closest$1(se.event.target,"[data-collection-item-value]").each((function(target){f(comp,se,target,get$d(target,"data-collection-item-value"))}))}},setContents=function(comp,items){var htmlLines=map$2(items,(function(item){var itemText=global$e.translate(item.text),textContent=1===spec.columns?'<div class="tox-collection__item-label">'+itemText+"</div>":"",iconContent='<div class="tox-collection__item-icon">'+item.icon+"</div>",mapItemName={_:" "," - ":" ","-":" "},ariaLabel=itemText.replace(/\_| \- |\-/g,(function(match){return mapItemName[match]})),disabledClass;return'<div class="tox-collection__item'+(providersBackstage.isDisabled()?" tox-collection__item--state-disabled":"")+'" tabindex="-1" data-collection-item-value="'+global$7.encodeAllRaw(item.value)+'" title="'+ariaLabel+'" aria-label="'+ariaLabel+'">'+iconContent+textContent+"</div>"})),chunks="auto"!==spec.columns&&spec.columns>1?chunk$1(htmlLines,spec.columns):[htmlLines],html=map$2(chunks,(function(ch){return'<div class="tox-collection__group">'+ch.join("")+"</div>"}));set$5(comp.element,html.join(""))},onClick=runOnItem((function(comp,se,tgt,itemValue){se.stop(),providersBackstage.isDisabled()||emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})})),collectionEvents=[run$1(mouseover(),runOnItem((function(comp,se,tgt){focus$3(tgt)}))),run$1(click(),onClick),run$1(tap(),onClick),run$1(focusin(),runOnItem((function(comp,se,tgt){descendant(comp.element,"."+activeClass).each((function(currentActive){remove$2(currentActive,activeClass)})),add$2(tgt,activeClass)}))),run$1(focusout(),runOnItem((function(comp){descendant(comp.element,"."+activeClass).each((function(currentActive){remove$2(currentActive,activeClass)}))}))),runOnExecute$1(runOnItem((function(comp,se,tgt,itemValue){emitWith(comp,formActionEvent,{name:spec.name,value:itemValue})})))],iterCollectionItems=function(comp,applyAttributes){return map$2(descendants(comp.element,".tox-collection__item"),applyAttributes)},pField=FormField.parts.field({dom:{tag:"div",classes:["tox-collection"].concat(1!==spec.columns?["tox-collection--grid"]:["tox-collection--list"])},components:[],factory:{sketch:identity$1},behaviours:derive$1([Disabling.config({disabled:providersBackstage.isDisabled,onDisabled:function(comp){iterCollectionItems(comp,(function(childElm){add$2(childElm,"tox-collection__item--state-disabled"),set$8(childElm,"aria-disabled",!0)}))},onEnabled:function(comp){iterCollectionItems(comp,(function(childElm){remove$2(childElm,"tox-collection__item--state-disabled"),remove$7(childElm,"aria-disabled")}))}}),receivingConfig(),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:[]},onSetValue:function(comp,items){setContents(comp,items),"auto"===spec.columns&&detectSize(comp,5,"tox-collection__item").each((function(_a){var numRows=_a.numRows,numColumns=_a.numColumns;Keying.setGridSize(comp,numRows,numColumns)})),emit(comp,formResizeEvent)}}),Tabstopping.config({}),Keying.config(deriveCollectionMovement(spec.columns,"normal")),config("collection-events",collectionEvents)]),eventOrder:(_a={},_a[execute$5()]=["disabling","alloy.base.behaviour","collection-events"],_a)}),extraClasses;return renderFormFieldWith(pLabel,pField,["tox-form__group--collection"],[])},schema$k=constant$1([option("data"),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("tag","input"),defaulted("inputClasses",[]),onHandler("onSetValue"),defaulted("styles",{}),defaulted("eventOrder",{}),field("inputBehaviours",[Representing,Focusing]),defaulted("selectOnFocus",!0)]),focusBehaviours=function(detail){return derive$1([Focusing.config({onFocus:detail.selectOnFocus?function(component){var input=component.element,value=get$5(input);input.dom.setSelectionRange(0,value.length)}:noop})])},behaviours=function(detail){return __assign(__assign({},focusBehaviours(detail)),augment(detail.inputBehaviours,[Representing.config({store:__assign(__assign({mode:"manual"},detail.data.map((function(data){return{initialValue:data}})).getOr({})),{getValue:function(input){return get$5(input.element)},setValue:function(input,data){var current;get$5(input.element)!==data&&set$4(input.element,data)}}),onSetValue:detail.onSetValue})]))},dom=function(detail){return{tag:detail.tag,attributes:__assign({type:"text"},detail.inputAttributes),styles:detail.inputStyles,classes:detail.inputClasses}},factory$h=function(detail,_spec){return{uid:detail.uid,dom:dom(detail),components:[],behaviours:behaviours(detail),eventOrder:detail.eventOrder}},Input=single({name:"Input",configFields:schema$k(),factory:factory$h}),exports$1={},module={exports:exports$1};!function(define,exports,module,require){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).EphoxContactWrapper=factory()}(this,(function(){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},promise={exports:{}};!function(module){!function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(bind(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn((function(){self._handled||Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn},module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(commonjsGlobal)}(promise);var promisePolyfill=promise.exports,Global,promisePolyfill_1;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||promisePolyfill}}))}(void 0,exports$1,module);var Promise$1=module.exports.boltExport,nu$3=function(baseFn){var data=Optional.none(),callbacks=[],map=function(f){return nu$3((function(nCallback){get((function(data){nCallback(f(data))}))}))},get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},set=function(x){isReady()||(data=Optional.some(x),run(callbacks),callbacks=[])},isReady=function(){return data.isSome()},run=function(cbs){each$1(cbs,call)},call=function(cb){data.each((function(x){setTimeout((function(){cb(x)}),0)}))};return baseFn(set),{get:get,map:map,isReady:isReady}},pure$1=function(a){return nu$3((function(callback){callback(a)}))},LazyValue={nu:nu$3,pure:pure$1},errorReporter=function(err){setTimeout((function(){throw err}),0)},make$5=function(run){var get=function(callback){run().then(callback,errorReporter)},map,bind,anonBind,toLazy,toCached,toPromise;return{map:function(fab){return make$5((function(){return run().then(fab)}))},bind:function(aFutureB){return make$5((function(){return run().then((function(v){return aFutureB(v).toPromise()}))}))},anonBind:function(futureB){return make$5((function(){return run().then((function(){return futureB.toPromise()}))}))},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make$5((function(){return null===cache&&(cache=run()),cache}))},toPromise:run,get:get}},nu$2,pure,Future_nu=function(baseFn){return make$5((function(){return new Promise$1(baseFn)}))},Future_pure=function(a){return make$5((function(){return Promise$1.resolve(a)}))},ariaElements=["input","textarea"],isAriaElement=function(elem){var name=name$2(elem);return contains$2(ariaElements,name)},markValid=function(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);remove$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each((function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!1),notifyInfo.getContainer(component).each((function(container){set$5(container,notifyInfo.validHtml)})),notifyInfo.onValid(component)}))},markInvalid=function(component,invalidConfig,invalidState,text){var elem=invalidConfig.getRoot(component).getOr(component.element);add$2(elem,invalidConfig.invalidClass),invalidConfig.notify.each((function(notifyInfo){isAriaElement(component.element)&&set$8(component.element,"aria-invalid",!0),notifyInfo.getContainer(component).each((function(container){set$5(container,text)})),notifyInfo.onInvalid(component,text)}))},query=function(component,invalidConfig,_invalidState){return invalidConfig.validator.fold((function(){return Future_pure(Result.value(!0))}),(function(validatorInfo){return validatorInfo.validate(component)}))},run=function(component,invalidConfig,invalidState){return invalidConfig.notify.each((function(notifyInfo){notifyInfo.onValidate(component)})),query(component,invalidConfig).map((function(valid){return component.getSystem().isConnected()?valid.fold((function(err){return markInvalid(component,invalidConfig,invalidState,err),Result.error(err)}),(function(v){return markValid(component,invalidConfig),Result.value(v)})):Result.error("No longer in system")}))},isInvalid=function(component,invalidConfig){var elem=invalidConfig.getRoot(component).getOr(component.element);return has(elem,invalidConfig.invalidClass)},InvalidateApis=Object.freeze({__proto__:null,markValid:markValid,markInvalid:markInvalid,query:query,run:run,isInvalid:isInvalid}),events$8=function(invalidConfig,invalidState){return invalidConfig.validator.map((function(validatorInfo){return derive$2([run$1(validatorInfo.onEvent,(function(component){run(component,invalidConfig,invalidState).get(identity$1)}))].concat(validatorInfo.validateOnLoad?[runOnAttached((function(component){run(component,invalidConfig,invalidState).get(noop)}))]:[]))})).getOr({})},ActiveInvalidate=Object.freeze({__proto__:null,events:events$8}),InvalidateSchema=[required$1("invalidClass"),defaulted("getRoot",Optional.none),optionObjOf("notify",[defaulted("aria","alert"),defaulted("getContainer",Optional.none),defaulted("validHtml",""),onHandler("onValid"),onHandler("onInvalid"),onHandler("onValidate")]),optionObjOf("validator",[required$1("validate"),defaulted("onEvent","input"),defaulted("validateOnLoad",!0)])],Invalidating=create$7({fields:InvalidateSchema,name:"invalidating",active:ActiveInvalidate,apis:InvalidateApis,extra:{validation:function(validator){return function(component){var v=Representing.getValue(component);return Future_pure(validator(v))}}}}),getCoupled=function(component,coupleConfig,coupleState,name){return coupleState.getOrCreate(component,coupleConfig,name)},CouplingApis=Object.freeze({__proto__:null,getCoupled:getCoupled}),CouplingSchema=[requiredOf("others",setOf(Result.value,anyValue()))],init$a=function(){var coupled={},getOrCreate=function(component,coupleConfig,name){var available=keys(coupleConfig.others);if(available)return get$e(coupled,name).getOrThunk((function(){var builder,spec=get$e(coupleConfig.others,name).getOrDie("No information found for coupled component: "+name)(component),built=component.getSystem().build(spec);return coupled[name]=built,built}));throw new Error("Cannot find coupled component: "+name+". Known coupled components: "+JSON.stringify(available,null,2))},readState=constant$1({});return nu$8({readState:readState,getOrCreate:getOrCreate})},CouplingState,Coupling=create$7({fields:CouplingSchema,name:"coupling",apis:CouplingApis,state:Object.freeze({__proto__:null,init:init$a})}),suffix=constant$1("sink"),partType$1=constant$1(optional({name:suffix(),overrides:constant$1({dom:{tag:"div"},behaviours:derive$1([Positioning.config({useFixed:always})]),events:derive$2([cutter(keydown()),cutter(mousedown()),cutter(click())])})})),HighlightOnOpen;!function(HighlightOnOpen){HighlightOnOpen[HighlightOnOpen.HighlightFirst=0]="HighlightFirst",HighlightOnOpen[HighlightOnOpen.HighlightNone=1]="HighlightNone"}(HighlightOnOpen||(HighlightOnOpen={}));var getAnchor=function(detail,component){var hotspot=detail.getHotspot(component).getOr(component),type="hotspot",overrides=detail.getAnchorOverrides();return detail.layouts.fold((function(){return{type:type,hotspot:hotspot,overrides:overrides}}),(function(layouts){return{type:type,hotspot:hotspot,overrides:overrides,layouts:layouts}}))},fetch=function(detail,mapFetch,component){var fetcher;return(0,detail.fetch)(component).map(mapFetch)},openF=function(detail,mapFetch,anchor,component,sandbox,externals,highlightOnOpen){var futureData=fetch(detail,mapFetch,component),getLazySink=getSink(component,detail);return futureData.map((function(tdata){return tdata.bind((function(data){return Optional.from(tieredMenu.sketch(__assign(__assign({},externals.menu()),{uid:generate$5(""),data:data,highlightImmediately:highlightOnOpen===HighlightOnOpen.HighlightFirst,onOpenMenu:function(tmenu,menu){var sink=getLazySink().getOrDie();Positioning.position(sink,menu,{anchor:anchor}),Sandboxing.decloak(sandbox)},onOpenSubmenu:function(tmenu,item,submenu){var sink=getLazySink().getOrDie();Positioning.position(sink,submenu,{anchor:{type:"submenu",item:item}}),Sandboxing.decloak(sandbox)},onRepositionMenu:function(tmenu,primaryMenu,submenuTriggers){var sink=getLazySink().getOrDie();Positioning.position(sink,primaryMenu,{anchor:anchor}),each$1(submenuTriggers,(function(st){Positioning.position(sink,st.triggeredMenu,{anchor:{type:"submenu",item:st.triggeringItem}})}))},onEscape:function(){return Focusing.focus(component),Sandboxing.close(sandbox),Optional.some(!0)}})))}))}))},open=function(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen){var anchor=getAnchor(detail,hotspot),processed;return openF(detail,mapFetch,anchor,hotspot,sandbox,externals,highlightOnOpen).map((function(tdata){return tdata.fold((function(){Sandboxing.isOpen(sandbox)&&Sandboxing.close(sandbox)}),(function(data){Sandboxing.cloak(sandbox),Sandboxing.open(sandbox,data),onOpenSync(sandbox)})),sandbox}))},close=function(detail,mapFetch,component,sandbox,_externals,_onOpenSync,_highlightOnOpen){return Sandboxing.close(sandbox),Future_pure(sandbox)},togglePopup=function(detail,mapFetch,hotspot,externals,onOpenSync,highlightOnOpen){var sandbox=Coupling.getCoupled(hotspot,"sandbox"),showing,action;return(Sandboxing.isOpen(sandbox)?close:open)(detail,mapFetch,hotspot,sandbox,externals,onOpenSync,highlightOnOpen)},matchWidth=function(hotspot,container,useMinWidth){var menu=Composing.getCurrent(container).getOr(container),buttonWidth=get$a(hotspot.element);useMinWidth?set$7(menu.element,"min-width",buttonWidth+"px"):set$6(menu.element,buttonWidth)},getSink=function(anyInSystem,sinkDetail){return anyInSystem.getSystem().getByUid(sinkDetail.uid+"-"+suffix()).map((function(internalSink){return function(){return Result.value(internalSink)}})).getOrThunk((function(){return sinkDetail.lazySink.fold((function(){return function(){return Result.error(new Error("No internal sink is specified, nor could an external sink be found"))}}),(function(lazySinkFn){return function(){return lazySinkFn(anyInSystem)}}))}))},doRepositionMenus=function(sandbox){Sandboxing.getState(sandbox).each((function(tmenu){tieredMenu.repositionMenus(tmenu)}))},makeSandbox$1=function(detail,hotspot,extras){var ariaOwner=manager(),onOpen=function(component,menu){var anchor=getAnchor(detail,hotspot);ariaOwner.link(hotspot.element),detail.matchWidth&&matchWidth(anchor.hotspot,menu,detail.useMinWidth),detail.onOpen(anchor,component,menu),void 0!==extras&&void 0!==extras.onOpen&&extras.onOpen(component,menu)},onClose=function(component,menu){ariaOwner.unlink(hotspot.element),void 0!==extras&&void 0!==extras.onClose&&extras.onClose(component,menu)},lazySink=getSink(hotspot,detail);return{dom:{tag:"div",classes:detail.sandboxClasses,attributes:{id:ariaOwner.id,role:"listbox"}},behaviours:SketchBehaviours_augment(detail.sandboxBehaviours,[Representing.config({store:{mode:"memory",initialValue:hotspot}}),Sandboxing.config({onOpen:onOpen,onClose:onClose,isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(hotspot,queryElem)},getAttachPoint:function(){return lazySink().getOrDie()}}),Composing.config({find:function(sandbox){return Sandboxing.getState(sandbox).bind((function(menu){return Composing.getCurrent(menu)}))}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1({isExtraPart:never})),receivingChannel({doReposition:doRepositionMenus}))})])}},repositionMenus=function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox");doRepositionMenus(sandbox)},sandboxFields=function(){return[defaulted("sandboxClasses",[]),SketchBehaviours_field("sandboxBehaviours",[Composing,Receiving,Sandboxing,Representing])]},schema$j=constant$1([required$1("dom"),required$1("fetch"),onHandler("onOpen"),onKeyboardHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),field("dropdownBehaviours",[Toggling,Coupling,Keying,Focusing]),required$1("toggleClass"),defaulted("eventOrder",{}),option("lazySink"),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),option("role")].concat(sandboxFields())),parts$d=constant$1([external$1({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:detail.onExecute}}}),partType$1()]),factory$g=function(detail,components,_spec,externals){var _a,lookupAttr=function(attr){return get$e(detail.dom,"attributes").bind((function(attrs){return get$e(attrs,attr)}))},switchToMenu=function(sandbox){Sandboxing.getState(sandbox).each((function(tmenu){tieredMenu.highlightPrimary(tmenu)}))},action=function(component){var onOpenSync;togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)},apis={expand:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightNone).get(noop)},open:function(comp){Toggling.isOn(comp)||togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},isOpen:Toggling.isOn,close:function(comp){Toggling.isOn(comp)&&togglePopup(detail,identity$1,comp,externals,noop,HighlightOnOpen.HighlightFirst).get(noop)},repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}},triggerExecute=function(comp,_se){return emitExecute(comp),Optional.some(!0)};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.dropdownBehaviours,[Toggling.config({toggleClass:detail.toggleClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:triggerExecute,onEnter:triggerExecute,onDown:function(comp,_se){if(Dropdown.isOpen(comp)){var sandbox=Coupling.getCoupled(comp,"sandbox");switchToMenu(sandbox)}else Dropdown.open(comp);return Optional.some(!0)},onEscape:function(comp,_se){return Dropdown.isOpen(comp)?(Dropdown.close(comp),Optional.some(!0)):Optional.none()}}),Focusing.config({})]),events:events$a(Optional.some(action)),eventOrder:__assign(__assign({},detail.eventOrder),(_a={},_a[execute$5()]=["disabling","toggling","alloy.base.behaviour"],_a)),apis:apis,domModification:{attributes:__assign(__assign({"aria-haspopup":"true"},detail.role.fold((function(){return{}}),(function(role){return{role:role}}))),"button"===detail.dom.tag?{type:lookupAttr("type").getOr("button")}:{})}}},Dropdown=composite({name:"Dropdown",configFields:schema$j(),partFields:parts$d(),factory:factory$g,apis:{open:function(apis,comp){return apis.open(comp)},expand:function(apis,comp){return apis.expand(comp)},close:function(apis,comp){return apis.close(comp)},isOpen:function(apis,comp){return apis.isOpen(comp)},repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),exhibit$1=function(){return nu$7({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})},events$7=function(){return derive$2([abort(selectstart(),always)])},ActiveUnselecting=Object.freeze({__proto__:null,events:events$7,exhibit:exhibit$1}),Unselecting=create$7({fields:[],name:"unselecting",active:ActiveUnselecting}),renderPanelButton=function(spec,sharedBackstage){return Dropdown.sketch({dom:spec.dom,components:spec.components,toggleClass:"mce-active",dropdownBehaviours:derive$1([DisablingConfigs_button(sharedBackstage.providers.isDisabled),receivingConfig(),Unselecting.config({}),Tabstopping.config({})]),layouts:spec.layouts,sandboxClasses:["tox-dialog__popups"],lazySink:sharedBackstage.getSink,fetch:function(comp){return Future_nu((function(callback){return spec.fetch(callback)})).map((function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onItemAction(comp,value)}),spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,never,sharedBackstage.providers),{movement:deriveMenuMovement(spec.columns,spec.presets)})))}))},parts:{menu:part(!1,1,spec.presets)}})},colorInputChangeEvent=generate$6("color-input-change"),colorSwatchChangeEvent=generate$6("color-swatch-change"),colorPickerCancelEvent=generate$6("color-picker-cancel"),renderColorInput=function(spec,sharedBackstage,colorInputBackstage){var pField=FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],onSetValue:function(c){return Invalidating.run(c).get(noop)},inputBehaviours:derive$1([Disabling.config({disabled:sharedBackstage.providers.isDisabled}),receivingConfig(),Tabstopping.config({}),Invalidating.config({invalidClass:"tox-textbox-field-invalid",getRoot:function(comp){return parent(comp.element)},notify:{onValid:function(comp){var val=Representing.getValue(comp);emitWith(comp,colorInputChangeEvent,{color:val})}},validator:{validateOnLoad:!1,validate:function(input){var inputValue=Representing.getValue(input);if(0===inputValue.length)return Future_pure(Result.value(!0));var span=SugarElement.fromTag("span");set$7(span,"background-color",inputValue);var res=getRaw(span,"background-color").fold((function(){return Result.error("blah")}),(function(_){return Result.value(inputValue)}));return Future_pure(res)}}})]),selectOnFocus:!1}),pLabel=spec.label.map((function(label){return renderLabel$2(label,sharedBackstage.providers)})),emitSwatchChange=function(colorBit,value){emitWith(colorBit,colorSwatchChangeEvent,{value:value})},onItemAction=function(comp,value){memColorButton.getOpt(comp).each((function(colorBit){"custom"===value?colorInputBackstage.colorPicker((function(valueOpt){valueOpt.fold((function(){return emit(colorBit,colorPickerCancelEvent)}),(function(value){emitSwatchChange(colorBit,value),addColor(value)}))}),"#ffffff"):emitSwatchChange(colorBit,"remove"===value?"":value)}))},memColorButton=record(renderPanelButton({dom:{tag:"span",attributes:{"aria-label":sharedBackstage.providers.translate("Color swatch")}},layouts:{onRtl:function(){return[southwest$2,southeast$2,south$2]},onLtr:function(){return[southeast$2,southwest$2,south$2]}},components:[],fetch:getFetch$1(colorInputBackstage.getColors(),colorInputBackstage.hasCustomColors()),columns:colorInputBackstage.getColorCols(),presets:"color",onItemAction:onItemAction},sharedBackstage));return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:pLabel.toArray().concat([{dom:{tag:"div",classes:["tox-color-input"]},components:[pField,memColorButton.asSpec()]}]),fieldBehaviours:derive$1([config("form-field-events",[run$1(colorInputChangeEvent,(function(comp,se){memColorButton.getOpt(comp).each((function(colorButton){set$7(colorButton.element,"background-color",se.event.color)})),emitWith(comp,formChangeEvent,{name:spec.name})})),run$1(colorSwatchChangeEvent,(function(comp,se){FormField.getField(comp).each((function(field){Representing.setValue(field,se.event.value),Composing.getCurrent(comp).each(Focusing.focus)}))})),run$1(colorPickerCancelEvent,(function(comp,_se){FormField.getField(comp).each((function(_field){Composing.getCurrent(comp).each(Focusing.focus)}))}))])])})},labelPart=optional({schema:[required$1("dom")],name:"label"}),edgePart=function(name){return optional({name:name+"-edge",overrides:function(detail){var action;return detail.model.manager.edgeActions[name].fold((function(){return{}}),(function(a){return{events:derive$2([runActionExtra(touchstart(),(function(comp,se,d){return a(comp,d)}),[detail]),runActionExtra(mousedown(),(function(comp,se,d){return a(comp,d)}),[detail]),runActionExtra(mousemove(),(function(comp,se,det){det.mouseIsDown.get()&&a(comp,det)}),[detail])])}}))}})},tlEdgePart=edgePart("top-left"),tedgePart=edgePart("top"),trEdgePart=edgePart("top-right"),redgePart=edgePart("right"),brEdgePart=edgePart("bottom-right"),bedgePart=edgePart("bottom"),blEdgePart=edgePart("bottom-left"),ledgePart=edgePart("left"),thumbPart=required({name:"thumb",defaults:constant$1({dom:{styles:{position:"absolute"}}}),overrides:function(detail){return{events:derive$2([redirectToPart(touchstart(),detail,"spectrum"),redirectToPart(touchmove(),detail,"spectrum"),redirectToPart(touchend(),detail,"spectrum"),redirectToPart(mousedown(),detail,"spectrum"),redirectToPart(mousemove(),detail,"spectrum"),redirectToPart(mouseup(),detail,"spectrum")])}}}),spectrumPart=required({schema:[customField("mouseIsDown",(function(){return Cell(!1)}))],name:"spectrum",overrides:function(detail){var modelDetail,model=detail.model.manager,setValueFrom=function(component,simulatedEvent){return model.getValueFromEvent(simulatedEvent).map((function(value){return model.setValueFrom(component,detail,value)}))};return{behaviours:derive$1([Keying.config({mode:"special",onLeft:function(spectrum){return model.onLeft(spectrum,detail)},onRight:function(spectrum){return model.onRight(spectrum,detail)},onUp:function(spectrum){return model.onUp(spectrum,detail)},onDown:function(spectrum){return model.onDown(spectrum,detail)}}),Focusing.config({})]),events:derive$2([run$1(touchstart(),setValueFrom),run$1(touchmove(),setValueFrom),run$1(mousedown(),setValueFrom),run$1(mousemove(),(function(spectrum,se){detail.mouseIsDown.get()&&setValueFrom(spectrum,se)}))])}}}),SliderParts=[labelPart,ledgePart,redgePart,tedgePart,bedgePart,tlEdgePart,trEdgePart,blEdgePart,brEdgePart,thumbPart,spectrumPart],_sliderChangeEvent="slider.change.value",sliderChangeEvent=constant$1(_sliderChangeEvent),isTouchEvent$2=function(evt){return-1!==evt.type.indexOf("touch")},getEventSource=function(simulatedEvent){var evt=simulatedEvent.event.raw;if(isTouchEvent$2(evt)){var touchEvent=evt;return void 0!==touchEvent.touches&&1===touchEvent.touches.length?Optional.some(touchEvent.touches[0]).map((function(t){return SugarPosition(t.clientX,t.clientY)})):Optional.none()}var mouseEvent=evt;return void 0!==mouseEvent.clientX?Optional.some(mouseEvent).map((function(me){return SugarPosition(me.clientX,me.clientY)})):Optional.none()},t="top",r="right",b="bottom",l="left",minX=function(detail){return detail.model.minX},minY=function(detail){return detail.model.minY},min1X=function(detail){return detail.model.minX-1},min1Y=function(detail){return detail.model.minY-1},maxX=function(detail){return detail.model.maxX},maxY=function(detail){return detail.model.maxY},max1X=function(detail){return detail.model.maxX+1},max1Y=function(detail){return detail.model.maxY+1},range=function(detail,max,min){return max(detail)-min(detail)},xRange=function(detail){return range(detail,maxX,minX)},yRange=function(detail){return range(detail,maxY,minY)},halfX=function(detail){return xRange(detail)/2},halfY=function(detail){return yRange(detail)/2},step=function(detail){return detail.stepSize},snap=function(detail){return detail.snapToGrid},snapStart=function(detail){return detail.snapStart},rounded=function(detail){return detail.rounded},hasEdge=function(detail,edgeName){return void 0!==detail[edgeName+"-edge"]},hasLEdge=function(detail){return hasEdge(detail,l)},hasREdge=function(detail){return hasEdge(detail,r)},hasTEdge=function(detail){return hasEdge(detail,t)},hasBEdge=function(detail){return hasEdge(detail,b)},currentValue=function(detail){return detail.model.value.get()},xValue=function(x){return{x:x}},yValue=function(y){return{y:y}},xyValue=function(x,y){return{x:x,y:y}},fireSliderChange$3=function(component,value){emitWith(component,sliderChangeEvent(),{value:value})},setToTLEdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),min1Y(detail)))},setToTEdge=function(edge,detail){fireSliderChange$3(edge,yValue(min1Y(detail)))},setToTEdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),min1Y(detail)))},setToTREdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),min1Y(detail)))},setToREdge=function(edge,detail){fireSliderChange$3(edge,xValue(max1X(detail)))},setToREdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),halfY(detail)))},setToBREdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(max1X(detail),max1Y(detail)))},setToBEdge=function(edge,detail){fireSliderChange$3(edge,yValue(max1Y(detail)))},setToBEdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(halfX(detail),max1Y(detail)))},setToBLEdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),max1Y(detail)))},setToLEdge=function(edge,detail){fireSliderChange$3(edge,xValue(min1X(detail)))},setToLEdgeXY=function(edge,detail){fireSliderChange$3(edge,xyValue(min1X(detail),halfY(detail)))},reduceBy=function(value,min,max,step){return value<min?value:value>max?max:value===min?min-1:Math.max(min,value-step)},increaseBy=function(value,min,max,step){return value>max?value:value<min?min:value===max?max+1:Math.min(max,value+step)},capValue=function(value,min,max){return Math.max(min,Math.min(max,value))},snapValueOf=function(value,min,max,step,snapStart){return snapStart.fold((function(){var initValue=value-min,extraValue=Math.round(initValue/step)*step;return capValue(min+extraValue,min-1,max+1)}),(function(start){var remainder=(value-start)%step,adjustment=Math.round(remainder/step),rawSteps=Math.floor((value-start)/step),maxSteps=Math.floor((max-start)/step),numSteps,r=start+Math.min(maxSteps,rawSteps+adjustment)*step;return Math.max(start,r)}))},findOffsetOf=function(value,min,max){return Math.min(max,Math.max(value,min))-min},findValueOf=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,step=args.step,snap=args.snap,snapStart=args.snapStart,rounded=args.rounded,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,minBound=args.minBound,maxBound=args.maxBound,screenRange=args.screenRange,capMin=hasMinEdge?min-1:min,capMax=hasMaxEdge?max+1:max;if(value<minBound)return capMin;if(value>maxBound)return capMax;var offset=findOffsetOf(value,minBound,maxBound),newValue=capValue(offset/screenRange*range+min,capMin,capMax);return snap&&newValue>=min&&newValue<=max?snapValueOf(newValue,min,max,step,snapStart):rounded?Math.round(newValue):newValue},findOffsetOfValue$2=function(args){var min=args.min,max=args.max,range=args.range,value=args.value,hasMinEdge=args.hasMinEdge,hasMaxEdge=args.hasMaxEdge,maxBound=args.maxBound,maxOffset=args.maxOffset,centerMinEdge=args.centerMinEdge,centerMaxEdge=args.centerMaxEdge;return value<min?hasMinEdge?0:centerMinEdge:value>max?hasMaxEdge?maxBound:centerMaxEdge:(value-min)/range*maxOffset},top="top",right="right",bottom="bottom",left="left",width="width",height="height",getBounds=function(component){return component.element.dom.getBoundingClientRect()},getBoundsProperty=function(bounds,property){return bounds[property]},getMinXBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,left)},getMaxXBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,right)},getMinYBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,top)},getMaxYBounds=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,bottom)},getXScreenRange=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,width)},getYScreenRange=function(component){var bounds=getBounds(component);return getBoundsProperty(bounds,height)},getCenterOffsetOf=function(componentMinEdge,componentMaxEdge,spectrumMinEdge){return(componentMinEdge+componentMaxEdge)/2-spectrumMinEdge},getXCenterOffSetOf=function(component,spectrum){var componentBounds=getBounds(component),spectrumBounds=getBounds(spectrum),componentMinEdge=getBoundsProperty(componentBounds,left),componentMaxEdge=getBoundsProperty(componentBounds,right),spectrumMinEdge=getBoundsProperty(spectrumBounds,left);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge)},getYCenterOffSetOf=function(component,spectrum){var componentBounds=getBounds(component),spectrumBounds=getBounds(spectrum),componentMinEdge=getBoundsProperty(componentBounds,top),componentMaxEdge=getBoundsProperty(componentBounds,bottom),spectrumMinEdge=getBoundsProperty(spectrumBounds,top);return getCenterOffsetOf(componentMinEdge,componentMaxEdge,spectrumMinEdge)},fireSliderChange$2=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$2=function(x){return{x:x}},findValueOfOffset$1=function(spectrum,detail,left){var args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:left,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),maxBound:getMaxXBounds(spectrum),screenRange:getXScreenRange(spectrum)};return findValueOf(args)},setValueFrom$2=function(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value),sliderVal=sliderValue$2(xValue);return fireSliderChange$2(spectrum,sliderVal),xValue},setToMin$2=function(spectrum,detail){var min=minX(detail);fireSliderChange$2(spectrum,sliderValue$2(min))},setToMax$2=function(spectrum,detail){var max=maxX(detail);fireSliderChange$2(spectrum,sliderValue$2(max))},moveBy$2=function(direction,spectrum,detail){var f,xValue=(direction>0?increaseBy:reduceBy)(currentValue(detail).x,minX(detail),maxX(detail),step(detail));return fireSliderChange$2(spectrum,sliderValue$2(xValue)),Optional.some(xValue)},handleMovement$2=function(direction){return function(spectrum,detail){return moveBy$2(direction,spectrum,detail).map(always)}},getValueFromEvent$2=function(simulatedEvent){var pos;return getEventSource(simulatedEvent).map((function(p){return p.left}))},findOffsetOfValue$1=function(spectrum,detail,value,minEdge,maxEdge){var minOffset=0,maxOffset=getXScreenRange(spectrum),centerMinEdge=minEdge.bind((function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))})).getOr(0),centerMaxEdge=maxEdge.bind((function(edge){return Optional.some(getXCenterOffSetOf(edge,spectrum))})).getOr(maxOffset),args={min:minX(detail),max:maxX(detail),range:xRange(detail),value:value,hasMinEdge:hasLEdge(detail),hasMaxEdge:hasREdge(detail),minBound:getMinXBounds(spectrum),minOffset:0,maxBound:getMaxXBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args)},findPositionOfValue$1=function(slider,spectrum,value,minEdge,maxEdge,detail){var offset=findOffsetOfValue$1(spectrum,detail,value,minEdge,maxEdge);return getMinXBounds(spectrum)-getMinXBounds(slider)+offset},setPositionFromValue$2=function(slider,thumb,detail,edges){var value=currentValue(detail),pos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),thumbRadius=get$a(thumb.element)/2;set$7(thumb.element,"left",pos-thumbRadius+"px")},onLeft$2=handleMovement$2(-1),onRight$2=handleMovement$2(1),onUp$2=Optional.none,onDown$2=Optional.none,edgeActions$2={"top-left":Optional.none(),top:Optional.none(),"top-right":Optional.none(),right:Optional.some(setToREdge),"bottom-right":Optional.none(),bottom:Optional.none(),"bottom-left":Optional.none(),left:Optional.some(setToLEdge)},HorizontalModel=Object.freeze({__proto__:null,setValueFrom:setValueFrom$2,setToMin:setToMin$2,setToMax:setToMax$2,findValueOfOffset:findValueOfOffset$1,getValueFromEvent:getValueFromEvent$2,findPositionOfValue:findPositionOfValue$1,setPositionFromValue:setPositionFromValue$2,onLeft:onLeft$2,onRight:onRight$2,onUp:onUp$2,onDown:onDown$2,edgeActions:edgeActions$2}),fireSliderChange$1=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue$1=function(y){return{y:y}},findValueOfOffset=function(spectrum,detail,top){var args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:top,step:step(detail),snap:snap(detail),snapStart:snapStart(detail),rounded:rounded(detail),hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),maxBound:getMaxYBounds(spectrum),screenRange:getYScreenRange(spectrum)};return findValueOf(args)},setValueFrom$1=function(spectrum,detail,value){var yValue=findValueOfOffset(spectrum,detail,value),sliderVal=sliderValue$1(yValue);return fireSliderChange$1(spectrum,sliderVal),yValue},setToMin$1=function(spectrum,detail){var min=minY(detail);fireSliderChange$1(spectrum,sliderValue$1(min))},setToMax$1=function(spectrum,detail){var max=maxY(detail);fireSliderChange$1(spectrum,sliderValue$1(max))},moveBy$1=function(direction,spectrum,detail){var f,yValue=(direction>0?increaseBy:reduceBy)(currentValue(detail).y,minY(detail),maxY(detail),step(detail));return fireSliderChange$1(spectrum,sliderValue$1(yValue)),Optional.some(yValue)},handleMovement$1=function(direction){return function(spectrum,detail){return moveBy$1(direction,spectrum,detail).map(always)}},getValueFromEvent$1=function(simulatedEvent){var pos;return getEventSource(simulatedEvent).map((function(p){return p.top}))},findOffsetOfValue=function(spectrum,detail,value,minEdge,maxEdge){var minOffset=0,maxOffset=getYScreenRange(spectrum),centerMinEdge=minEdge.bind((function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))})).getOr(0),centerMaxEdge=maxEdge.bind((function(edge){return Optional.some(getYCenterOffSetOf(edge,spectrum))})).getOr(maxOffset),args={min:minY(detail),max:maxY(detail),range:yRange(detail),value:value,hasMinEdge:hasTEdge(detail),hasMaxEdge:hasBEdge(detail),minBound:getMinYBounds(spectrum),minOffset:0,maxBound:getMaxYBounds(spectrum),maxOffset:maxOffset,centerMinEdge:centerMinEdge,centerMaxEdge:centerMaxEdge};return findOffsetOfValue$2(args)},findPositionOfValue=function(slider,spectrum,value,minEdge,maxEdge,detail){var offset=findOffsetOfValue(spectrum,detail,value,minEdge,maxEdge);return getMinYBounds(spectrum)-getMinYBounds(slider)+offset},setPositionFromValue$1=function(slider,thumb,detail,edges){var value=currentValue(detail),pos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),thumbRadius=get$b(thumb.element)/2;set$7(thumb.element,"top",pos-thumbRadius+"px")},onLeft$1=Optional.none,onRight$1=Optional.none,onUp$1=handleMovement$1(-1),onDown$1=handleMovement$1(1),edgeActions$1={"top-left":Optional.none(),top:Optional.some(setToTEdge),"top-right":Optional.none(),right:Optional.none(),"bottom-right":Optional.none(),bottom:Optional.some(setToBEdge),"bottom-left":Optional.none(),left:Optional.none()},VerticalModel=Object.freeze({__proto__:null,setValueFrom:setValueFrom$1,setToMin:setToMin$1,setToMax:setToMax$1,findValueOfOffset:findValueOfOffset,getValueFromEvent:getValueFromEvent$1,findPositionOfValue:findPositionOfValue,setPositionFromValue:setPositionFromValue$1,onLeft:onLeft$1,onRight:onRight$1,onUp:onUp$1,onDown:onDown$1,edgeActions:edgeActions$1}),fireSliderChange=function(spectrum,value){emitWith(spectrum,sliderChangeEvent(),{value:value})},sliderValue=function(x,y){return{x:x,y:y}},setValueFrom=function(spectrum,detail,value){var xValue=findValueOfOffset$1(spectrum,detail,value.left),yValue=findValueOfOffset(spectrum,detail,value.top),val=sliderValue(xValue,yValue);return fireSliderChange(spectrum,val),val},moveBy=function(direction,isVerticalMovement,spectrum,detail){var f=direction>0?increaseBy:reduceBy,xValue=isVerticalMovement?currentValue(detail).x:f(currentValue(detail).x,minX(detail),maxX(detail),step(detail)),yValue=isVerticalMovement?f(currentValue(detail).y,minY(detail),maxY(detail),step(detail)):currentValue(detail).y;return fireSliderChange(spectrum,sliderValue(xValue,yValue)),Optional.some(xValue)},handleMovement=function(direction,isVerticalMovement){return function(spectrum,detail){return moveBy(direction,isVerticalMovement,spectrum,detail).map(always)}},setToMin=function(spectrum,detail){var mX=minX(detail),mY=minY(detail);fireSliderChange(spectrum,sliderValue(mX,mY))},setToMax=function(spectrum,detail){var mX=maxX(detail),mY=maxY(detail);fireSliderChange(spectrum,sliderValue(mX,mY))},getValueFromEvent=function(simulatedEvent){return getEventSource(simulatedEvent)},setPositionFromValue=function(slider,thumb,detail,edges){var value=currentValue(detail),xPos=findPositionOfValue$1(slider,edges.getSpectrum(slider),value.x,edges.getLeftEdge(slider),edges.getRightEdge(slider),detail),yPos=findPositionOfValue(slider,edges.getSpectrum(slider),value.y,edges.getTopEdge(slider),edges.getBottomEdge(slider),detail),thumbXRadius=get$a(thumb.element)/2,thumbYRadius=get$b(thumb.element)/2;set$7(thumb.element,"left",xPos-thumbXRadius+"px"),set$7(thumb.element,"top",yPos-thumbYRadius+"px")},onLeft=handleMovement(-1,!1),onRight=handleMovement(1,!1),onUp=handleMovement(-1,!0),onDown=handleMovement(1,!0),edgeActions={"top-left":Optional.some(setToTLEdgeXY),top:Optional.some(setToTEdgeXY),"top-right":Optional.some(setToTREdgeXY),right:Optional.some(setToREdgeXY),"bottom-right":Optional.some(setToBREdgeXY),bottom:Optional.some(setToBEdgeXY),"bottom-left":Optional.some(setToBLEdgeXY),left:Optional.some(setToLEdgeXY)},TwoDModel=Object.freeze({__proto__:null,setValueFrom:setValueFrom,setToMin:setToMin,setToMax:setToMax,getValueFromEvent:getValueFromEvent,setPositionFromValue:setPositionFromValue,onLeft:onLeft,onRight:onRight,onUp:onUp,onDown:onDown,edgeActions:edgeActions}),SliderSchema,sketch$2,Slider=composite({name:"Slider",configFields:[defaulted("stepSize",1),defaulted("onChange",noop),defaulted("onChoose",noop),defaulted("onInit",noop),defaulted("onDragStart",noop),defaulted("onDragEnd",noop),defaulted("snapToGrid",!1),defaulted("rounded",!0),option("snapStart"),requiredOf("model",choose$1("mode",{x:[defaulted("minX",0),defaulted("maxX",100),customField("value",(function(spec){return Cell(spec.mode.minX)})),required$1("getInitialValue"),output$1("manager",HorizontalModel)],y:[defaulted("minY",0),defaulted("maxY",100),customField("value",(function(spec){return Cell(spec.mode.minY)})),required$1("getInitialValue"),output$1("manager",VerticalModel)],xy:[defaulted("minX",0),defaulted("maxX",100),defaulted("minY",0),defaulted("maxY",100),customField("value",(function(spec){return Cell({x:spec.mode.minX,y:spec.mode.minY})})),required$1("getInitialValue"),output$1("manager",TwoDModel)]})),field("sliderBehaviours",[Keying,Representing]),customField("mouseIsDown",(function(){return Cell(!1)}))],partFields:SliderParts,factory:function(detail,components,_spec,_externals){var _a,getThumb=function(component){return getPartOrDie(component,detail,"thumb")},getSpectrum=function(component){return getPartOrDie(component,detail,"spectrum")},getLeftEdge=function(component){return getPart(component,detail,"left-edge")},getRightEdge=function(component){return getPart(component,detail,"right-edge")},getTopEdge=function(component){return getPart(component,detail,"top-edge")},getBottomEdge=function(component){return getPart(component,detail,"bottom-edge")},modelDetail=detail.model,model=modelDetail.manager,refresh=function(slider,thumb){model.setPositionFromValue(slider,thumb,detail,{getLeftEdge:getLeftEdge,getRightEdge:getRightEdge,getTopEdge:getTopEdge,getBottomEdge:getBottomEdge,getSpectrum:getSpectrum})},setValue=function(slider,newValue){modelDetail.value.set(newValue);var thumb=getThumb(slider);refresh(slider,thumb)},changeValue=function(slider,newValue){setValue(slider,newValue);var thumb=getThumb(slider);return detail.onChange(slider,thumb,newValue),Optional.some(!0)},resetToMin=function(slider){model.setToMin(slider,detail)},resetToMax=function(slider){model.setToMax(slider,detail)},choose=function(slider){var fireOnChoose=function(){getPart(slider,detail,"thumb").each((function(thumb){var value=modelDetail.value.get();detail.onChoose(slider,thumb,value)}))},wasDown=detail.mouseIsDown.get();detail.mouseIsDown.set(!1),wasDown&&fireOnChoose()},onDragStart=function(slider,simulatedEvent){simulatedEvent.stop(),detail.mouseIsDown.set(!0),detail.onDragStart(slider,getThumb(slider))},onDragEnd=function(slider,simulatedEvent){simulatedEvent.stop(),detail.onDragEnd(slider,getThumb(slider)),choose(slider)};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.sliderBehaviours,[Keying.config({mode:"special",focusIn:function(slider){return getPart(slider,detail,"spectrum").map(Keying.focusIn).map(always)}}),Representing.config({store:{mode:"manual",getValue:function(_){return modelDetail.value.get()}}}),Receiving.config({channels:(_a={},_a[mouseReleased()]={onReceive:choose},_a)})]),events:derive$2([run$1(sliderChangeEvent(),(function(slider,simulatedEvent){changeValue(slider,simulatedEvent.event.value)})),runOnAttached((function(slider,_simulatedEvent){var getInitial=modelDetail.getInitialValue();modelDetail.value.set(getInitial);var thumb=getThumb(slider);refresh(slider,thumb);var spectrum=getSpectrum(slider);detail.onInit(slider,thumb,spectrum,modelDetail.value.get())})),run$1(touchstart(),onDragStart),run$1(touchend(),onDragEnd),run$1(mousedown(),onDragStart),run$1(mouseup(),onDragEnd)]),apis:{resetToMin:resetToMin,resetToMax:resetToMax,setValue:setValue,refresh:refresh},domModification:{styles:{position:"relative"}}}},apis:{setValue:function(apis,slider,value){apis.setValue(slider,value)},resetToMin:function(apis,slider){apis.resetToMin(slider)},resetToMax:function(apis,slider){apis.resetToMax(slider)},refresh:function(apis,slider){apis.refresh(slider)}}}),fieldsUpdate=generate$6("rgb-hex-update"),sliderUpdate=generate$6("slider-update"),paletteUpdate=generate$6("palette-update"),sliderFactory=function(translate,getClass){var spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:[getClass("hue-slider-spectrum")],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:[getClass("hue-slider-thumb")],attributes:{role:"presentation"}}});return Slider.sketch({dom:{tag:"div",classes:[getClass("hue-slider")],attributes:{role:"presentation"}},rounded:!1,model:{mode:"y",getInitialValue:constant$1({y:0})},components:[spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChange:function(slider,_thumb,value){emitWith(slider,sliderUpdate,{value:value})}})},owner$1="form",schema$i=[field("formBehaviours",[Representing])],getPartName$1=function(name){return"<alloy.field."+name+">"},sketch$1=function(fSpec){var parts=function(){var record=[],field;return{field:function(name,config){return record.push(name),generateOne$1("form",getPartName$1(name),config)},record:constant$1(record)}}(),spec=fSpec(parts),partNames=parts.record(),fieldParts=map$2(partNames,(function(n){return required({name:n,pname:getPartName$1(n)})}));return composite$1("form",schema$i,fieldParts,make$4,spec)},toResult=function(o,e){return o.fold((function(){return Result.error(e)}),Result.value)},make$4=function(detail,components){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.formBehaviours,[Representing.config({store:{mode:"manual",getValue:function(form){var resPs=getAllParts(form,detail);return map$1(resPs,(function(resPThunk,pName){return resPThunk().bind((function(v){var opt=Composing.getCurrent(v);return toResult(opt,new Error("Cannot find a current component to extract the value from for form part '"+pName+"': "+element(v.element)))})).map(Representing.getValue)}))},setValue:function(form,values){each(values,(function(newValue,key){getPart(form,detail,key).each((function(wrapper){Composing.getCurrent(wrapper).each((function(field){Representing.setValue(field,newValue)}))}))}))}}})]),apis:{getField:function(form,key){return getPart(form,detail,key).bind(Composing.getCurrent)}}}},Form={getField:makeApi((function(apis,component,key){return apis.getField(component,key)})),sketch:sketch$1},validInput=generate$6("valid-input"),invalidInput=generate$6("invalid-input"),validatingInput=generate$6("validating-input"),translatePrefix="colorcustom.rgb.",rgbFormFactory=function(translate,getClass,onValidHexx,onInvalidHexx){var invalidation=function(label,isValid){return Invalidating.config({invalidClass:getClass("invalid"),notify:{onValidate:function(comp){emitWith(comp,validatingInput,{type:label})},onValid:function(comp){emitWith(comp,validInput,{type:label,value:Representing.getValue(comp)})},onInvalid:function(comp){emitWith(comp,invalidInput,{type:label,value:Representing.getValue(comp)})}},validator:{validate:function(comp){var value=Representing.getValue(comp),res=isValid(value)?Result.value(!0):Result.error(translate("aria.input.invalid"));return Future_pure(res)},validateOnLoad:!1}})},renderTextField=function(isValid,name,label,description,data){var helptext=translate(translatePrefix+"range"),pLabel,pField,comps=[FormField.parts.label({dom:{tag:"label",innerHtml:label,attributes:{"aria-label":description}}}),FormField.parts.field({data:data,factory:Input,inputAttributes:__assign({type:"text"},"hex"===name?{"aria-live":"polite"}:{}),inputClasses:[getClass("textfield")],inputBehaviours:derive$1([invalidation(name,isValid),Tabstopping.config({})]),onSetValue:function(input){var run;Invalidating.isInvalid(input)&&Invalidating.run(input).get(noop)}})],concats="hex"!==name?[FormField.parts["aria-descriptor"]({text:helptext})]:[],components;return{dom:{tag:"div",attributes:{role:"presentation"}},components:comps.concat(concats)}},copyRgbToHex=function(form,rgba){var hex=fromRgba(rgba);return Form.getField(form,"hex").each((function(hexField){Focusing.isFocused(hexField)||Representing.setValue(form,{hex:hex.value})})),hex},copyRgbToForm=function(form,rgb){var red=rgb.red,green=rgb.green,blue=rgb.blue;Representing.setValue(form,{red:red,green:green,blue:blue})},memPreview=record({dom:{tag:"div",classes:[getClass("rgba-preview")],styles:{"background-color":"white"},attributes:{role:"presentation"}}}),updatePreview=function(anyInSystem,hex){memPreview.getOpt(anyInSystem).each((function(preview){set$7(preview.element,"background-color","#"+hex.value)}))},factory,rgbFormSketcher;return single({factory:function(){var state={red:Cell(Optional.some(255)),green:Cell(Optional.some(255)),blue:Cell(Optional.some(255)),hex:Cell(Optional.some("ffffff"))},copyHexToRgb=function(form,hex){var rgb=fromHex(hex);copyRgbToForm(form,rgb),setValueRgb(rgb)},get=function(prop){return state[prop].get()},set=function(prop,value){state[prop].set(value)},getValueRgb=function(){return get("red").bind((function(red){return get("green").bind((function(green){return get("blue").map((function(blue){return rgbaColour(red,green,blue,1)}))}))}))},setValueRgb=function(rgb){var red=rgb.red,green=rgb.green,blue=rgb.blue;set("red",Optional.some(red)),set("green",Optional.some(green)),set("blue",Optional.some(blue))},onInvalidInput=function(form,simulatedEvent){var data=simulatedEvent.event;"hex"!==data.type?set(data.type,Optional.none()):onInvalidHexx(form)},onValidHex=function(form,value){onValidHexx(form);var hex=hexColour(value);set("hex",Optional.some(value));var rgb=fromHex(hex);copyRgbToForm(form,rgb),setValueRgb(rgb),emitWith(form,fieldsUpdate,{hex:hex}),updatePreview(form,hex)},onValidRgb=function(form,prop,value){var val=parseInt(value,10);set(prop,Optional.some(val)),getValueRgb().each((function(rgb){var hex=copyRgbToHex(form,rgb);emitWith(form,fieldsUpdate,{hex:hex}),updatePreview(form,hex)}))},isHexInputEvent=function(data){return"hex"===data.type},onValidInput=function(form,simulatedEvent){var data=simulatedEvent.event;isHexInputEvent(data)?onValidHex(form,data.value):onValidRgb(form,data.type,data.value)},formPartStrings=function(key){return{label:translate(translatePrefix+key+".label"),description:translate(translatePrefix+key+".description")}},redStrings=formPartStrings("red"),greenStrings=formPartStrings("green"),blueStrings=formPartStrings("blue"),hexStrings=formPartStrings("hex");return deepMerge(Form.sketch((function(parts){return{dom:{tag:"form",classes:[getClass("rgb-form")],attributes:{"aria-label":translate("aria.color.picker")}},components:[parts.field("red",FormField.sketch(renderTextField(isRgbaComponent,"red",redStrings.label,redStrings.description,255))),parts.field("green",FormField.sketch(renderTextField(isRgbaComponent,"green",greenStrings.label,greenStrings.description,255))),parts.field("blue",FormField.sketch(renderTextField(isRgbaComponent,"blue",blueStrings.label,blueStrings.description,255))),parts.field("hex",FormField.sketch(renderTextField(isHexString,"hex",hexStrings.label,hexStrings.description,"ffffff"))),memPreview.asSpec()],formBehaviours:derive$1([Invalidating.config({invalidClass:getClass("form-invalid")}),config("rgb-form-events",[run$1(validInput,onValidInput),run$1(invalidInput,onInvalidInput),run$1(validatingInput,onInvalidInput)])])}})),{apis:{updateHex:function(form,hex){Representing.setValue(form,{hex:hex.value}),copyHexToRgb(form,hex),updatePreview(form,hex)}}})},name:"RgbForm",configFields:[],apis:{updateHex:function(apis,form,hex){apis.updateHex(form,hex)}},extraApis:{}})},paletteFactory=function(_translate,getClass){var spectrumPart=Slider.parts.spectrum({dom:{tag:"canvas",attributes:{role:"presentation"},classes:[getClass("sv-palette-spectrum")]}}),thumbPart=Slider.parts.thumb({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette-thumb")],innerHtml:"<div class="+getClass("sv-palette-inner-thumb")+' role="presentation"></div>'}}),setColour=function(canvas,rgba){var width=canvas.width,height=canvas.height,ctx=canvas.getContext("2d");if(null!==ctx){ctx.fillStyle=rgba,ctx.fillRect(0,0,width,height);var grdWhite=ctx.createLinearGradient(0,0,width,0);grdWhite.addColorStop(0,"rgba(255,255,255,1)"),grdWhite.addColorStop(1,"rgba(255,255,255,0)"),ctx.fillStyle=grdWhite,ctx.fillRect(0,0,width,height);var grdBlack=ctx.createLinearGradient(0,0,0,height);grdBlack.addColorStop(0,"rgba(0,0,0,0)"),grdBlack.addColorStop(1,"rgba(0,0,0,1)"),ctx.fillStyle=grdBlack,ctx.fillRect(0,0,width,height)}},setPaletteHue=function(slider,hue){var canvas=slider.components()[0].element.dom,hsv=hsvColour(hue,100,100),rgba=fromHsv(hsv);setColour(canvas,toString(rgba))},setPaletteThumb=function(slider,hex){var hsv=fromRgb(fromHex(hex));Slider.setValue(slider,{x:hsv.saturation,y:100-hsv.value})},factory,saturationBrightnessPaletteSketcher;return single({factory:function(_detail){var getInitialValue=constant$1({x:0,y:0}),onChange=function(slider,_thumb,value){emitWith(slider,paletteUpdate,{value:value})},onInit=function(_slider,_thumb,spectrum,_value){setColour(spectrum.element.dom,toString(red))},sliderBehaviours=derive$1([Composing.config({find:Optional.some}),Focusing.config({})]);return Slider.sketch({dom:{tag:"div",attributes:{role:"presentation"},classes:[getClass("sv-palette")]},model:{mode:"xy",getInitialValue:getInitialValue},rounded:!1,components:[spectrumPart,thumbPart],onChange:onChange,onInit:onInit,sliderBehaviours:sliderBehaviours})},name:"SaturationBrightnessPalette",configFields:[],apis:{setHue:function(_apis,slider,hue){setPaletteHue(slider,hue)},setThumb:function(_apis,slider,hex){setPaletteThumb(slider,hex)}},extraApis:{}})},makeFactory=function(translate,getClass){var factory=function(detail){var rgbForm=rgbFormFactory(translate,getClass,detail.onValidHex,detail.onInvalidHex),sbPalette=paletteFactory(translate,getClass),hueSliderToDegrees=function(hue){return(100-hue)/100*360},hueDegreesToSlider=function(hue){return 100-hue/360*100},state={paletteRgba:Cell(red),paletteHue:Cell(0)},memSlider=record(sliderFactory(translate,getClass)),memPalette=record(sbPalette.sketch({})),memRgb=record(rgbForm.sketch({})),updatePalette=function(anyInSystem,_hex,hue){memPalette.getOpt(anyInSystem).each((function(palette){sbPalette.setHue(palette,hue)}))},updateFields=function(anyInSystem,hex){memRgb.getOpt(anyInSystem).each((function(form){rgbForm.updateHex(form,hex)}))},updateSlider=function(anyInSystem,_hex,hue){memSlider.getOpt(anyInSystem).each((function(slider){Slider.setValue(slider,{y:hueDegreesToSlider(hue)})}))},updatePaletteThumb=function(anyInSystem,hex){memPalette.getOpt(anyInSystem).each((function(palette){sbPalette.setThumb(palette,hex)}))},updateState=function(hex,hue){var rgba=fromHex(hex);state.paletteRgba.set(rgba),state.paletteHue.set(hue)},runUpdates=function(anyInSystem,hex,hue,updates){updateState(hex,hue),each$1(updates,(function(update){update(anyInSystem,hex,hue)}))},onPaletteUpdate=function(){var updates=[updateFields];return function(form,simulatedEvent){var value=simulatedEvent.event.value,oldHue=state.paletteHue.get(),newHsv=hsvColour(oldHue,value.x,100-value.y),newHex=hsvToHex(newHsv);runUpdates(form,newHex,oldHue,updates)}},onSliderUpdate=function(){var updates=[updatePalette,updateFields];return function(form,simulatedEvent){var hue=hueSliderToDegrees(simulatedEvent.event.value.y),oldRgb=state.paletteRgba.get(),oldHsv=fromRgb(oldRgb),newHsv=hsvColour(hue,oldHsv.saturation,oldHsv.value),newHex=hsvToHex(newHsv);runUpdates(form,newHex,hue,updates)}},onFieldsUpdate=function(){var updates=[updatePalette,updateSlider,updatePaletteThumb];return function(form,simulatedEvent){var hex=simulatedEvent.event.hex,hsv=hexToHsv(hex);runUpdates(form,hex,hsv.hue,updates)}};return{uid:detail.uid,dom:detail.dom,components:[memPalette.asSpec(),memSlider.asSpec(),memRgb.asSpec()],behaviours:derive$1([config("colour-picker-events",[run$1(fieldsUpdate,onFieldsUpdate()),run$1(paletteUpdate,onPaletteUpdate()),run$1(sliderUpdate,onSliderUpdate())]),Composing.config({find:function(comp){return memRgb.getOpt(comp)}}),Keying.config({mode:"acyclic"})])}},colourPickerSketcher;return single({name:"ColourPicker",configFields:[required$1("dom"),defaulted("onValidHex",noop),defaulted("onInvalidHex",noop)],factory:factory})},self$1,memento$1,childAt,ComposingConfigs_self=function(){return Composing.config({find:Optional.some})},ComposingConfigs_memento=function(mem){return Composing.config({find:mem.getOpt})},ComposingConfigs_childAt=function(index){return Composing.config({find:function(comp){return child$2(comp.element,index).bind((function(element){return comp.getSystem().getByDom(element).toOptional()}))}})},english={"colorcustom.rgb.red.label":"R","colorcustom.rgb.red.description":"Red component","colorcustom.rgb.green.label":"G","colorcustom.rgb.green.description":"Green component","colorcustom.rgb.blue.label":"B","colorcustom.rgb.blue.description":"Blue component","colorcustom.rgb.hex.label":"#","colorcustom.rgb.hex.description":"Hex color code","colorcustom.rgb.range":"Range 0 to 255","colorcustom.sb.saturation":"Saturation","colorcustom.sb.brightness":"Brightness","colorcustom.sb.picker":"Saturation and Brightness Picker","colorcustom.sb.palette":"Saturation and Brightness Palette","colorcustom.sb.instructions":"Use arrow keys to select saturation and brightness, on x and y axes","colorcustom.hue.hue":"Hue","colorcustom.hue.slider":"Hue Slider","colorcustom.hue.palette":"Hue Palette","colorcustom.hue.instructions":"Use arrow keys to select a hue","aria.color.picker":"Color Picker","aria.input.invalid":"Invalid input"},getEnglishText=function(key){return english[key]},translate$1=function(key){return getEnglishText(key)},renderColorPicker=function(_spec){var getClass=function(key){return"tox-"+key},colourPickerFactory=makeFactory(translate$1,getClass),onValidHex=function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!0})},onInvalidHex=function(form){emitWith(form,formActionEvent,{name:"hex-valid",value:!1})},memPicker=record(colourPickerFactory.sketch({dom:{tag:"div",classes:[getClass("color-picker-container")],attributes:{role:"presentation"}},onValidHex:onValidHex,onInvalidHex:onInvalidHex}));return{dom:{tag:"div"},components:[memPicker.asSpec()],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(comp){var picker=memPicker.get(comp),optRgbForm,optHex;return Composing.getCurrent(picker).bind((function(rgbForm){var formValues;return Representing.getValue(rgbForm).hex})).map((function(hex){return"#"+hex})).getOr("")},setValue:function(comp,newValue){var pattern,m=/^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/.exec(newValue),picker=memPicker.get(comp),optRgbForm;Composing.getCurrent(picker).fold((function(){console.log("Can not find form")}),(function(rgbForm){Representing.setValue(rgbForm,{hex:Optional.from(m[1]).getOr("")}),Form.getField(rgbForm,"hex").each((function(hexField){emit(hexField,input())}))}))}}}),ComposingConfigs_self()])}},global$6=tinymce.util.Tools.resolve("tinymce.Resource"),isOldCustomEditor=function(spec){return has$2(spec,"init")},renderCustomEditor=function(spec){var editorApi=value$1(),memReplaced=record({dom:{tag:spec.tag}}),initialValue=value$1();return{dom:{tag:"div",classes:["tox-custom-editor"]},behaviours:derive$1([config("custom-editor-events",[runOnAttached((function(component){memReplaced.getOpt(component).each((function(ta){(isOldCustomEditor(spec)?spec.init(ta.element.dom):global$6.load(spec.scriptId,spec.scriptUrl).then((function(init){return init(ta.element.dom,spec.settings)}))).then((function(ea){initialValue.on((function(cvalue){ea.setValue(cvalue)})),initialValue.clear(),editorApi.set(ea)}))}))}))]),Representing.config({store:{mode:"manual",getValue:function(){return editorApi.get().fold((function(){return initialValue.get().getOr("")}),(function(ed){return ed.getValue()}))},setValue:function(component,value){editorApi.get().fold((function(){initialValue.set(value)}),(function(ed){return ed.setValue(value)}))}}}),ComposingConfigs_self()]),components:[memReplaced.asSpec()]}},global$5=tinymce.util.Tools.resolve("tinymce.util.Tools"),processors=objOf([defaulted("preprocess",identity$1),defaulted("postprocess",identity$1)]),memento,withComp=function(optInitialValue,getter,setter){return Representing.config(deepMerge({store:{mode:"manual",getValue:getter,setValue:setter}},optInitialValue.map((function(initialValue){return{store:{initialValue:initialValue}}})).getOr({})))},withElement=function(initialValue,getter,setter){return withComp(initialValue,(function(c){return getter(c.element)}),(function(c,v){return setter(c.element,v)}))},domValue=function(optInitialValue){return withElement(optInitialValue,get$5,set$4)},domHtml=function(optInitialValue){return withElement(optInitialValue,get$7,set$5)},memory,RepresentingConfigs_memento=function(mem,rawProcessors){var ps=asRawOrDie$1("RepresentingConfigs.memento processors",processors,rawProcessors);return Representing.config({store:{mode:"manual",getValue:function(comp){var other=mem.get(comp),rawValue=Representing.getValue(other);return ps.postprocess(rawValue)},setValue:function(comp,rawValue){var newValue=ps.preprocess(rawValue),other=mem.get(comp);Representing.setValue(other,newValue)}}})},RepresentingConfigs_withElement=withElement,RepresentingConfigs_withComp=withComp,RepresentingConfigs_domValue=domValue,RepresentingConfigs_domHtml=domHtml,RepresentingConfigs_memory=function(initialValue){return Representing.config({store:{mode:"memory",initialValue:initialValue}})},defaultImageFileTypes="jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp",filterByExtension=function(files,providersBackstage){var allowedImageFileTypes=global$5.explode(providersBackstage.getSetting("images_file_types",defaultImageFileTypes,"string")),isFileInAllowedTypes=function(file){return exists(allowedImageFileTypes,(function(type){return endsWith(file.name.toLowerCase(),"."+type.toLowerCase())}))};return filter$2(from(files),isFileInAllowedTypes)},renderDropZone=function(spec,providersBackstage){var stopper=function(_,se){se.stop()},sequence=function(actions){return function(comp,se){each$1(actions,(function(a){a(comp,se)}))}},onDrop=function(comp,se){if(!Disabling.isDisabled(comp)){var transferEvent=se.event.raw;handleFiles(comp,transferEvent.dataTransfer.files)}},onSelect=function(component,simulatedEvent){var input=simulatedEvent.event.raw.target;handleFiles(component,input.files)},handleFiles=function(component,files){Representing.setValue(component,filterByExtension(files,providersBackstage)),emitWith(component,formChangeEvent,{name:spec.name})},memInput=record({dom:{tag:"input",attributes:{type:"file",accept:"image/*"},styles:{display:"none"}},behaviours:derive$1([config("input-file-events",[cutter(click()),cutter(tap())])])}),renderField=function(s){return{uid:s.uid,dom:{tag:"div",classes:["tox-dropzone-container"]},behaviours:derive$1([RepresentingConfigs_memory([]),ComposingConfigs_self(),Disabling.config({}),Toggling.config({toggleClass:"dragenter",toggleOnExecute:!1}),config("dropzone-events",[run$1("dragenter",sequence([stopper,Toggling.toggle])),run$1("dragleave",sequence([stopper,Toggling.toggle])),run$1("dragover",stopper),run$1("drop",sequence([stopper,onDrop])),run$1(change(),onSelect)])]),components:[{dom:{tag:"div",classes:["tox-dropzone"],styles:{}},components:[{dom:{tag:"p",innerHtml:providersBackstage.translate("Drop an image here")}},Button.sketch({dom:{tag:"button",innerHtml:providersBackstage.translate("Browse for an image"),styles:{position:"relative"},classes:["tox-button","tox-button--secondary"]},components:[memInput.asSpec()],action:function(comp){var inputComp;memInput.get(comp).element.dom.click()},buttonBehaviours:derive$1([Tabstopping.config({}),DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig()])})]}]}},pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField=FormField.parts.field({factory:{sketch:renderField}});return renderFormFieldWith(pLabel,pField,["tox-form__group--stretched"],[])},renderGrid=function(spec,backstage){return{dom:{tag:"div",classes:["tox-form__grid","tox-form__grid--"+spec.columns+"col"]},components:map$2(spec.items,backstage.interpreter)}},beforeObject=generate$6("alloy-fake-before-tabstop"),afterObject=generate$6("alloy-fake-after-tabstop"),craftWithClasses=function(classes){return{dom:{tag:"div",styles:{width:"1px",height:"1px",outline:"none"},attributes:{tabindex:"0"},classes:classes},behaviours:derive$1([Focusing.config({ignore:!0}),Tabstopping.config({})])}},craft=function(spec){return{dom:{tag:"div",classes:["tox-navobj"]},components:[craftWithClasses([beforeObject]),spec,craftWithClasses([afterObject])],behaviours:derive$1([ComposingConfigs_childAt(1)])}},triggerTab=function(placeholder,shiftKey){emitWith(placeholder,keydown(),{raw:{which:9,shiftKey:shiftKey}})},onFocus=function(container,targetComp){var target=targetComp.element;has(target,beforeObject)?triggerTab(container,!0):has(target,afterObject)&&triggerTab(container,!1)},isPseudoStop=function(element){return closest(element,["."+beforeObject,"."+afterObject].join(","),never)},platformNeedsSandboxing=!(detect$1().browser.isIE()||detect$1().browser.isEdge()),getDynamicSource=function(isSandbox){var cachedValue=Cell("");return{getValue:function(_frameComponent){return cachedValue.get()},setValue:function(frameComponent,html){if(isSandbox)set$8(frameComponent.element,"srcdoc",html);else{set$8(frameComponent.element,"src","javascript:''");var doc=frameComponent.element.dom.contentWindow.document;doc.open(),doc.write(html),doc.close()}cachedValue.set(html)}}},renderIFrame=function(spec,providersBackstage){var isSandbox=platformNeedsSandboxing&&spec.sandboxed,attributes=__assign(__assign({},spec.label.map((function(title){return{title:title}})).getOr({})),isSandbox?{sandbox:"allow-scripts allow-same-origin"}:{}),sourcing=getDynamicSource(isSandbox),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),factory=function(newSpec){return craft({uid:newSpec.uid,dom:{tag:"iframe",attributes:attributes},behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),RepresentingConfigs_withComp(Optional.none(),sourcing.getValue,sourcing.setValue)])})},pField=FormField.parts.field({factory:{sketch:factory}});return renderFormFieldWith(pLabel,pField,["tox-form__group--stretched"],[])},create$3=function(width,height){return resize$3(document.createElement("canvas"),width,height)},clone=function(canvas){var tCanvas=create$3(canvas.width,canvas.height),ctx;return get2dContext(tCanvas).drawImage(canvas,0,0),tCanvas},get2dContext=function(canvas){return canvas.getContext("2d")},resize$3=function(canvas,width,height){return canvas.width=width,canvas.height=height,canvas},getWidth$1=function(image){return image.naturalWidth||image.width},getHeight$1=function(image){return image.naturalHeight||image.height},blobToImage=function(blob){return new Promise$1((function(resolve,reject){var blobUrl=URL.createObjectURL(blob),image=new Image,removeListeners=function(){image.removeEventListener("load",loaded),image.removeEventListener("error",error)},loaded=function(){removeListeners(),resolve(image)},error=function(){removeListeners(),reject("Unable to load data of type "+blob.type+": "+blobUrl)};image.addEventListener("load",loaded),image.addEventListener("error",error),image.src=blobUrl,image.complete&&setTimeout(loaded,0)}))},dataUriToBlobSync=function(uri){var data=uri.split(","),matches=/data:([^;]+)/.exec(data[0]);if(!matches)return Optional.none();for(var mimetype=matches[1],base64=data[1],sliceSize=1024,byteCharacters=atob(base64),bytesLength=byteCharacters.length,slicesCount=Math.ceil(bytesLength/1024),byteArrays=new Array(slicesCount),sliceIndex=0;sliceIndex<slicesCount;++sliceIndex){for(var begin=1024*sliceIndex,end=Math.min(begin+1024,bytesLength),bytes=new Array(end-begin),offset=begin,i=0;offset<end;++i,++offset)bytes[i]=byteCharacters[offset].charCodeAt(0);byteArrays[sliceIndex]=new Uint8Array(bytes)}return Optional.some(new Blob(byteArrays,{type:mimetype}))},dataUriToBlob=function(uri){return new Promise$1((function(resolve,reject){dataUriToBlobSync(uri).fold((function(){reject("uri is not base64: "+uri)}),resolve)}))},canvasToBlob=function(canvas,type,quality){return type=type||"image/png",isFunction(HTMLCanvasElement.prototype.toBlob)?new Promise$1((function(resolve,reject){canvas.toBlob((function(blob){blob?resolve(blob):reject()}),type,quality)})):dataUriToBlob(canvas.toDataURL(type,quality))},canvasToDataURL=function(canvas,type,quality){return type=type||"image/png",canvas.toDataURL(type,quality)},blobToCanvas=function(blob){return blobToImage(blob).then((function(image){revokeImageUrl(image);var canvas=create$3(getWidth$1(image),getHeight$1(image)),context;return get2dContext(canvas).drawImage(image,0,0),canvas}))},blobToDataUri=function(blob){return new Promise$1((function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)}))},revokeImageUrl=function(image){URL.revokeObjectURL(image.src)},create$2=function(getCanvas,blob,uri){var initialType=blob.type,getType=constant$1(initialType),toBlob=function(){return Promise$1.resolve(blob)},toDataURL=constant$1(uri),toBase64,toAdjustedBlob,toAdjustedDataURL=function(type,quality){return getCanvas.then((function(canvas){return canvasToDataURL(canvas,type,quality)}))},toAdjustedBase64=function(type,quality){return toAdjustedDataURL(type,quality).then((function(dataurl){return dataurl.split(",")[1]}))},toCanvas;return{getType:getType,toBlob:toBlob,toDataURL:toDataURL,toBase64:function(){return uri.split(",")[1]},toAdjustedBlob:function(type,quality){return getCanvas.then((function(canvas){return canvasToBlob(canvas,type,quality)}))},toAdjustedDataURL:toAdjustedDataURL,toAdjustedBase64:toAdjustedBase64,toCanvas:function(){return getCanvas.then(clone)}}},fromBlob=function(blob){return blobToDataUri(blob).then((function(uri){return create$2(blobToCanvas(blob),blob,uri)}))},fromCanvas=function(canvas,type){return canvasToBlob(canvas,type).then((function(blob){return create$2(Promise$1.resolve(canvas),blob,canvas.toDataURL())}))},blobToImageResult=function(blob){return fromBlob(blob)},clamp=function(value,min,max){var parsedValue="string"==typeof value?parseFloat(value):value;return parsedValue>max?parsedValue=max:parsedValue<min&&(parsedValue=min),parsedValue},identity=function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],multiply=function(matrix1,matrix2){for(var col=[],out=new Array(25),val,i=0;i<5;i++){for(var j=0;j<5;j++)col[j]=matrix2[j+5*i];for(var j=0;j<5;j++){val=0;for(var k=0;k<5;k++)val+=matrix1[j+5*k]*col[k];out[j+5*i]=val}}return out},adjustContrast=function(matrix,value){var x;return value=clamp(value,-1,1),x=(value*=100)<0?127+value/100*127:127*(x=0===(x=value%1)?DELTA_INDEX[value]:DELTA_INDEX[Math.floor(value)]*(1-x)+DELTA_INDEX[Math.floor(value)+1]*x)+127,multiply(matrix,[x/127,0,0,0,.5*(127-x),0,x/127,0,0,.5*(127-x),0,0,x/127,0,.5*(127-x),0,0,0,1,0,0,0,0,0,1])},adjustBrightness=function(matrix,value){return value=clamp(255*value,-255,255),multiply(matrix,[1,0,0,0,value,0,1,0,0,value,0,0,1,0,value,0,0,0,1,0,0,0,0,0,1])},adjustColors=function(matrix,adjustR,adjustG,adjustB){return adjustR=clamp(adjustR,0,2),adjustG=clamp(adjustG,0,2),adjustB=clamp(adjustB,0,2),multiply(matrix,[adjustR,0,0,0,0,0,adjustG,0,0,0,0,0,adjustB,0,0,0,0,0,1,0,0,0,0,0,1])},colorFilter=function(ir,matrix){return ir.toCanvas().then((function(canvas){return applyColorFilter(canvas,ir.getType(),matrix)}))},applyColorFilter=function(canvas,type,matrix){var context=get2dContext(canvas),applyMatrix,pixels=function(pixelsData,m){for(var r,g,b,a,data=pixelsData.data,m0=m[0],m1=m[1],m2=m[2],m3=m[3],m4=m[4],m5=m[5],m6=m[6],m7=m[7],m8=m[8],m9=m[9],m10=m[10],m11=m[11],m12=m[12],m13=m[13],m14=m[14],m15=m[15],m16=m[16],m17=m[17],m18=m[18],m19=m[19],i=0;i<data.length;i+=4)r=data[i],g=data[i+1],b=data[i+2],a=data[i+3],data[i]=r*m0+g*m1+b*m2+a*m3+m4,data[i+1]=r*m5+g*m6+b*m7+a*m8+m9,data[i+2]=r*m10+g*m11+b*m12+a*m13+m14,data[i+3]=r*m15+g*m16+b*m17+a*m18+m19;return pixelsData}(context.getImageData(0,0,canvas.width,canvas.height),matrix);return context.putImageData(pixels,0,0),fromCanvas(canvas,type)},convoluteFilter=function(ir,matrix){return ir.toCanvas().then((function(canvas){return applyConvoluteFilter(canvas,ir.getType(),matrix)}))},applyConvoluteFilter=function(canvas,type,matrix){var context=get2dContext(canvas),applyMatrix=function(pIn,pOut,aMatrix){for(var clamp=function(value,min,max){return value>max?value=max:value<min&&(value=min),value},side=Math.round(Math.sqrt(aMatrix.length)),halfSide=Math.floor(side/2),rgba=pIn.data,drgba=pOut.data,w=pIn.width,h=pIn.height,y=0;y<h;y++)for(var x=0;x<w;x++){for(var r=0,g=0,b=0,cy=0;cy<side;cy++)for(var cx=0;cx<side;cx++){var scx=clamp(x+cx-halfSide,0,w-1),scy,innerOffset=4*(clamp(y+cy-halfSide,0,h-1)*w+scx),wt=aMatrix[cy*side+cx];r+=rgba[innerOffset]*wt,g+=rgba[innerOffset+1]*wt,b+=rgba[innerOffset+2]*wt}var offset=4*(y*w+x);drgba[offset]=clamp(r,0,255),drgba[offset+1]=clamp(g,0,255),drgba[offset+2]=clamp(b,0,255)}return pOut},pixelsIn=context.getImageData(0,0,canvas.width,canvas.height),pixelsOut=context.getImageData(0,0,canvas.width,canvas.height);return pixelsOut=applyMatrix(pixelsIn,pixelsOut,matrix),context.putImageData(pixelsOut,0,0),fromCanvas(canvas,type)},functionColorFilter=function(colorFn){var filterImpl=function(canvas,type,value){for(var context=get2dContext(canvas),lookup=new Array(256),applyLookup=function(pixelsData,lookupData){for(var data=pixelsData.data,i=0;i<data.length;i+=4)data[i]=lookupData[data[i]],data[i+1]=lookupData[data[i+1]],data[i+2]=lookupData[data[i+2]];return pixelsData},i=0;i<lookup.length;i++)lookup[i]=colorFn(i,value);var pixels=applyLookup(context.getImageData(0,0,canvas.width,canvas.height),lookup);return context.putImageData(pixels,0,0),fromCanvas(canvas,type)};return function(ir,value){return ir.toCanvas().then((function(canvas){return filterImpl(canvas,ir.getType(),value)}))}},complexAdjustableColorFilter=function(matrixAdjustFn){return function(ir,adjust){return colorFilter(ir,matrixAdjustFn([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],adjust))}},basicColorFilter,basicConvolutionFilter=function(kernel){return function(ir){return convoluteFilter(ir,kernel)}},invert$1=function(matrix){return function(ir){return colorFilter(ir,matrix)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0,0,0,0,0,1]),brightness$1=complexAdjustableColorFilter(adjustBrightness),contrast$1=complexAdjustableColorFilter(adjustContrast),colorize$1=function(ir,adjustR,adjustG,adjustB){return colorFilter(ir,adjustColors([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],adjustR,adjustG,adjustB))},sharpen$1=basicConvolutionFilter([0,-1,0,-1,5,-1,0,-1,0]),gamma$1=functionColorFilter((function(color,value){return 255*Math.pow(color/255,1-value)})),scale=function(image,dW,dH){var sW=getWidth$1(image),sH=getHeight$1(image),wRatio=dW/sW,hRatio=dH/sH,scaleCapped=!1;(wRatio<.5||wRatio>2)&&(wRatio=wRatio<.5?.5:2,scaleCapped=!0),(hRatio<.5||hRatio>2)&&(hRatio=hRatio<.5?.5:2,scaleCapped=!0);var scaled=_scale(image,wRatio,hRatio);return scaleCapped?scaled.then((function(tCanvas){return scale(tCanvas,dW,dH)})):scaled},_scale=function(image,wRatio,hRatio){return new Promise$1((function(resolve){var sW=getWidth$1(image),sH=getHeight$1(image),dW=Math.floor(sW*wRatio),dH=Math.floor(sH*hRatio),canvas=create$3(dW,dH),context;get2dContext(canvas).drawImage(image,0,0,sW,sH,0,0,dW,dH),resolve(canvas)}))},ceilWithPrecision=function(num,precision){void 0===precision&&(precision=2);var mul=Math.pow(10,precision),upper=Math.round(num*mul);return Math.ceil(upper/mul)},rotate$1=function(ir,angle){return ir.toCanvas().then((function(canvas){return applyRotate(canvas,ir.getType(),angle)}))},applyRotate=function(image,type,angle){var degrees,rad=(angle<0?360+angle:angle)*Math.PI/180,width=image.width,height=image.height,sin=Math.sin(rad),cos=Math.cos(rad),newWidth=ceilWithPrecision(Math.abs(width*cos)+Math.abs(height*sin)),newHeight=ceilWithPrecision(Math.abs(width*sin)+Math.abs(height*cos)),canvas=create$3(newWidth,newHeight),context=get2dContext(canvas);return context.translate(newWidth/2,newHeight/2),context.rotate(rad),context.drawImage(image,-width/2,-height/2),fromCanvas(canvas,type)},flip$1=function(ir,axis){return ir.toCanvas().then((function(canvas){return applyFlip(canvas,ir.getType(),axis)}))},applyFlip=function(image,type,axis){var canvas=create$3(image.width,image.height),context=get2dContext(canvas);return"v"===axis?(context.scale(1,-1),context.drawImage(image,0,-canvas.height)):(context.scale(-1,1),context.drawImage(image,-canvas.width,0)),fromCanvas(canvas,type)},crop$1=function(ir,x,y,w,h){return ir.toCanvas().then((function(canvas){return applyCrop(canvas,ir.getType(),x,y,w,h)}))},applyCrop=function(image,type,x,y,w,h){var canvas=create$3(w,h),context;return get2dContext(canvas).drawImage(image,-x,-y),fromCanvas(canvas,type)},resize$2=function(ir,w,h){return ir.toCanvas().then((function(canvas){return scale(canvas,w,h).then((function(newCanvas){return fromCanvas(newCanvas,ir.getType())}))}))},invert=function(ir){return invert$1(ir)},sharpen=function(ir){return sharpen$1(ir)},gamma=function(ir,value){return gamma$1(ir,value)},colorize=function(ir,adjustR,adjustG,adjustB){return colorize$1(ir,adjustR,adjustG,adjustB)},brightness=function(ir,adjust){return brightness$1(ir,adjust)},contrast=function(ir,adjust){return contrast$1(ir,adjust)},flip=function(ir,axis){return flip$1(ir,axis)},crop=function(ir,x,y,w,h){return crop$1(ir,x,y,w,h)},resize$1=function(ir,w,h){return resize$2(ir,w,h)},rotate=function(ir,angle){return rotate$1(ir,angle)},renderIcon=function(iconName,iconsProvider,behaviours){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-tbtn__icon-wrap"],behaviours:behaviours},iconsProvider)},renderIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[])},renderReplacableIconFromPack=function(iconName,iconsProvider){return renderIcon(iconName,iconsProvider,[Replacing.config({})])},renderLabel$1=function(text,prefix,providersBackstage){return{dom:{tag:"span",innerHtml:providersBackstage.translate(text),classes:[prefix+"__select-label"]},behaviours:derive$1([Replacing.config({})])}},_a,internalToolbarButtonExecute=generate$6("toolbar.button.execute"),onToolbarButtonExecute=function(info){return runOnExecute$1((function(comp,_simulatedEvent){runWithApi(info,comp)((function(itemApi){emitWith(comp,internalToolbarButtonExecute,{buttonApi:itemApi}),info.onAction(itemApi)}))}))},toolbarButtonEventOrder=((_a={})[execute$5()]=["disabling","alloy.base.behaviour","toggling","toolbar-button-events"],_a),updateMenuText=generate$6("update-menu-text"),updateMenuIcon=generate$6("update-menu-icon"),renderCommonDropdown=function(spec,prefix,sharedBackstage){var editorOffCell=Cell(noop),optMemDisplayText=spec.text.map((function(text){return record(renderLabel$1(text,prefix,sharedBackstage.providers))})),optMemDisplayIcon=spec.icon.map((function(iconName){return record(renderReplacableIconFromPack(iconName,sharedBackstage.providers.icons))})),onLeftOrRightInMenu=function(comp,se){var dropdown=Representing.getValue(comp);return Focusing.focus(dropdown),emitWith(dropdown,"keydown",{raw:se.event.raw}),Dropdown.close(dropdown),Optional.some(!0)},role=spec.role.fold((function(){return{}}),(function(role){return{role:role}})),tooltipAttributes=spec.tooltip.fold((function(){return{}}),(function(tooltip){var translatedTooltip=sharedBackstage.providers.translate(tooltip);return{title:translatedTooltip,"aria-label":translatedTooltip}})),iconSpec=render$3("chevron-down",{tag:"div",classes:[prefix+"__select-chevron"]},sharedBackstage.providers.icons),memDropdown;return record(Dropdown.sketch(__assign(__assign(__assign({},spec.uid?{uid:spec.uid}:{}),role),{dom:{tag:"button",classes:[prefix,prefix+"--select"].concat(map$2(spec.classes,(function(c){return prefix+"--"+c}))),attributes:__assign({},tooltipAttributes)},components:componentRenderPipeline([optMemDisplayIcon.map((function(mem){return mem.asSpec()})),optMemDisplayText.map((function(mem){return mem.asSpec()})),Optional.some(iconSpec)]),matchWidth:!0,useMinWidth:!0,dropdownBehaviours:derive$1(__spreadArray(__spreadArray([],spec.dropdownBehaviours,!0),[DisablingConfigs_button((function(){return spec.disabled||sharedBackstage.providers.isDisabled()})),receivingConfig(),Unselecting.config({}),Replacing.config({}),config("dropdown-events",[onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell)]),config("menubutton-update-display-text",[run$1(updateMenuText,(function(comp,se){optMemDisplayText.bind((function(mem){return mem.getOpt(comp)})).each((function(displayText){Replacing.set(displayText,[text(sharedBackstage.providers.translate(se.event.text))])}))})),run$1(updateMenuIcon,(function(comp,se){optMemDisplayIcon.bind((function(mem){return mem.getOpt(comp)})).each((function(displayIcon){Replacing.set(displayIcon,[renderReplacableIconFromPack(se.event.icon,sharedBackstage.providers.icons)])}))}))])],!1)),eventOrder:deepMerge(toolbarButtonEventOrder,{mousedown:["focusing","alloy.base.behaviour","item-type-events","normal-dropdown-events"]}),sandboxBehaviours:derive$1([Keying.config({mode:"special",onLeft:onLeftOrRightInMenu,onRight:onLeftOrRightInMenu})]),lazySink:sharedBackstage.getSink,toggleClass:prefix+"--active",parts:{menu:part(!1,spec.columns,spec.presets)},fetch:function(comp){return Future_nu(curry(spec.fetch,comp))}}))).asSpec()},isMenuItemReference=function(item){return isString(item)},isSeparator$1=function(item){return"separator"===item.type},isExpandingMenuItem=function(item){return has$2(item,"getSubmenuItems")},separator$2={type:"separator"},unwrapReferences=function(items,menuItems){var realItems=foldl(items,(function(acc,item){return isMenuItemReference(item)?""===item?acc:"|"===item?acc.length>0&&!isSeparator$1(acc[acc.length-1])?acc.concat([separator$2]):acc:has$2(menuItems,item.toLowerCase())?acc.concat([menuItems[item.toLowerCase()]]):acc:acc.concat([item])}),[]);return realItems.length>0&&isSeparator$1(realItems[realItems.length-1])&&realItems.pop(),realItems},getFromExpandingItem=function(item,menuItems){var submenuItems=item.getSubmenuItems(),rest=expand(submenuItems,menuItems),newMenus,newExpansions;return{item:item,menus:deepMerge(rest.menus,wrap$1(item.value,rest.items)),expansions:deepMerge(rest.expansions,wrap$1(item.value,item.value))}},getFromItem=function(item,menuItems){return isExpandingMenuItem(item)?getFromExpandingItem(item,menuItems):{item:item,menus:{},expansions:{}}},generateValueIfRequired=function(item){if(isSeparator$1(item))return item;var itemValue=get$e(item,"value").getOrThunk((function(){return generate$6("generated-menu-item")}));return deepMerge({value:itemValue},item)},expand=function(items,menuItems){var realItems=unwrapReferences(isString(items)?items.split(" "):items,menuItems);return foldr(realItems,(function(acc,item){var itemWithValue=generateValueIfRequired(item),newData=getFromItem(itemWithValue,menuItems);return{menus:deepMerge(acc.menus,newData.menus),items:[newData.item].concat(acc.items),expansions:deepMerge(acc.expansions,newData.expansions)}}),{menus:{},expansions:{},items:[]})},build=function(items,itemResponse,backstage,isHorizontalMenu){var primary=generate$6("primary-menu"),data=expand(items,backstage.shared.providers.menuItems());if(0===data.items.length)return Optional.none();var mainMenu=createPartialMenu(primary,data.items,itemResponse,backstage,isHorizontalMenu),submenus=map$1(data.menus,(function(menuItems,menuName){return createPartialMenu(menuName,menuItems,itemResponse,backstage,!1)})),menus=deepMerge(submenus,wrap$1(primary,mainMenu));return Optional.from(tieredMenu.tieredData(primary,menus,data.expansions))},getMenuButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)},setActive:function(state){var elm=component.element;state?(add$2(elm,"tox-tbtn--enabled"),set$8(elm,"aria-pressed",!0)):(remove$2(elm,"tox-tbtn--enabled"),remove$7(elm,"aria-pressed"))},isActive:function(){return has(component.element,"tox-tbtn--enabled")}}},renderMenuButton=function(spec,prefix,backstage,role){return renderCommonDropdown({text:spec.text,icon:spec.icon,tooltip:spec.tooltip,role:role,fetch:function(_comp,callback){spec.fetch((function(items){callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))}))},onSetup:spec.onSetup,getApi:getMenuButtonApi,columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({})]},prefix,backstage.shared)},getFetch=function(items,getButton,backstage){var getMenuItemAction=function(item){return function(api){var newValue=!api.isActive();api.setActive(newValue),item.storage.set(newValue),backstage.shared.getSink().each((function(sink){getButton().getOpt(sink).each((function(orig){focus$3(orig.element),emitWith(orig,formActionEvent,{name:item.name,value:item.storage.get()})}))}))}},getMenuItemSetup=function(item){return function(api){api.setActive(item.storage.get())}};return function(success){success(map$2(items,(function(item){var text=item.text.fold((function(){return{}}),(function(text){return{text:text}}));return __assign(__assign({type:item.type,active:!1},text),{onAction:getMenuItemAction(item),onSetup:getMenuItemSetup(item)})})))}},renderCommonSpec=function(spec,actionOpt,extraBehaviours,dom,components,providersBackstage){void 0===extraBehaviours&&(extraBehaviours=[]);var action=actionOpt.fold((function(){return{}}),(function(action){return{action:action}})),common=__assign({buttonBehaviours:derive$1([DisablingConfigs_button((function(){return spec.disabled||providersBackstage.isDisabled()})),receivingConfig(),Tabstopping.config({}),config("button press",[preventDefault("click"),preventDefault("mousedown")])].concat(extraBehaviours)),eventOrder:{click:["button press","alloy.base.behaviour"],mousedown:["button press","alloy.base.behaviour"]}},action),domFinal=deepMerge(common,{dom:dom});return deepMerge(domFinal,{components:components})},renderIconButtonSpec=function(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);var tooltipAttributes,dom={tag:"button",classes:["tox-tbtn"],attributes:spec.tooltip.map((function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}})).getOr({})},icon=spec.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),components=componentRenderPipeline([icon]);return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage)},renderIconButton=function(spec,action,providersBackstage,extraBehaviours){void 0===extraBehaviours&&(extraBehaviours=[]);var iconButtonSpec=renderIconButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours);return Button.sketch(iconButtonSpec)},renderButtonSpec=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);var translatedText=providersBackstage.translate(spec.text),icon=spec.icon?spec.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})):Optional.none(),components=icon.isSome()?componentRenderPipeline([icon]):[],innerHtml=icon.isSome()?{}:{innerHtml:translatedText},classes=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],spec.primary||spec.borderless?["tox-button"]:["tox-button","tox-button--secondary"],!0),icon.isSome()?["tox-button--icon"]:[],!0),spec.borderless?["tox-button--naked"]:[],!0),extraClasses,!0),dom=__assign(__assign({tag:"button",classes:classes},innerHtml),{attributes:{title:translatedText}});return renderCommonSpec(spec,action,extraBehaviours,dom,components,providersBackstage)},renderButton=function(spec,action,providersBackstage,extraBehaviours,extraClasses){void 0===extraBehaviours&&(extraBehaviours=[]),void 0===extraClasses&&(extraClasses=[]);var buttonSpec=renderButtonSpec(spec,Optional.some(action),providersBackstage,extraBehaviours,extraClasses);return Button.sketch(buttonSpec)},getAction=function(name,buttonType){return function(comp){"custom"===buttonType?emitWith(comp,formActionEvent,{name:name,value:{}}):"submit"===buttonType?emit(comp,formSubmitEvent):"cancel"===buttonType?emit(comp,formCancelEvent):console.error("Unknown button type: ",buttonType)}},isMenuFooterButtonSpec=function(spec,buttonType){return"menu"===buttonType},isNormalFooterButtonSpec=function(spec,buttonType){return"custom"===buttonType||"cancel"===buttonType||"submit"===buttonType},renderFooterButton=function(spec,buttonType,backstage){if(isMenuFooterButtonSpec(spec,buttonType)){var getButton=function(){return memButton_1},menuButtonSpec=spec,fixedSpec=__assign(__assign({},spec),{onSetup:function(api){return api.setDisabled(spec.disabled),noop},fetch:getFetch(menuButtonSpec.items,getButton,backstage)}),memButton_1=record(renderMenuButton(fixedSpec,"tox-tbtn",backstage,Optional.none()));return memButton_1.asSpec()}if(isNormalFooterButtonSpec(spec,buttonType)){var action=getAction(spec.name,buttonType),buttonSpec=__assign(__assign({},spec),{borderless:!1});return renderButton(buttonSpec,action,backstage.shared.providers,[])}console.error("Unknown footer button type: ",buttonType)},renderDialogButton=function(spec,providersBackstage){var action=getAction(spec.name,"custom");return renderFormField(Optional.none(),FormField.parts.field(__assign({factory:Button},renderButtonSpec(spec,Optional.some(action),providersBackstage,[RepresentingConfigs_memory(""),ComposingConfigs_self()]))))},schema$h=constant$1([defaulted("field1Name","field1"),defaulted("field2Name","field2"),onStrictHandler("onLockedChange"),markers$1(["lockClass"]),defaulted("locked",!1),SketchBehaviours_field("coupledFieldBehaviours",[Composing,Representing])]),getField=function(comp,detail,partName){return getPart(comp,detail,partName).bind(Composing.getCurrent)},coupledPart=function(selfName,otherName){return required({factory:FormField,name:selfName,overrides:function(detail){return{fieldBehaviours:derive$1([config("coupled-input-behaviour",[run$1(input(),(function(me){getField(me,detail,otherName).each((function(other){getPart(me,detail,"lock").each((function(lock){Toggling.isOn(lock)&&detail.onLockedChange(me,other,lock)}))}))}))])])}}})},parts$c=constant$1([coupledPart("field1","field2"),coupledPart("field2","field1"),required({factory:Button,schema:[required$1("dom")],name:"lock",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({selected:detail.locked,toggleClass:detail.markers.lockClass,aria:{mode:"pressed"}})])}}})]),factory$f=function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:SketchBehaviours_augment(detail.coupledFieldBehaviours,[Composing.config({find:Optional.some}),Representing.config({store:{mode:"manual",getValue:function(comp){var _a,parts=getPartsOrDie(comp,detail,["field1","field2"]);return(_a={})[detail.field1Name]=Representing.getValue(parts.field1()),_a[detail.field2Name]=Representing.getValue(parts.field2()),_a},setValue:function(comp,value){var parts=getPartsOrDie(comp,detail,["field1","field2"]);hasNonNullableKey(value,detail.field1Name)&&Representing.setValue(parts.field1(),value[detail.field1Name]),hasNonNullableKey(value,detail.field2Name)&&Representing.setValue(parts.field2(),value[detail.field2Name])}}})]),apis:{getField1:function(component){return getPart(component,detail,"field1")},getField2:function(component){return getPart(component,detail,"field2")},getLock:function(component){return getPart(component,detail,"lock")}}}},FormCoupledInputs=composite({name:"FormCoupledInputs",configFields:schema$h(),partFields:parts$c(),factory:factory$f,apis:{getField1:function(apis,component){return apis.getField1(component)},getField2:function(apis,component){return apis.getField2(component)},getLock:function(apis,component){return apis.getLock(component)}}}),formatSize=function(size){var unitDec={"":0,px:0,pt:1,mm:1,pc:2,ex:2,em:2,ch:2,rem:2,cm:3,in:4,"%":4},maxDecimal=function(unit){return unit in unitDec?unitDec[unit]:1},numText=size.value.toFixed(maxDecimal(size.unit));return-1!==numText.indexOf(".")&&(numText=numText.replace(/\.?0*$/,"")),numText+size.unit},parseSize=function(sizeText){var numPattern,match=/^\s*(\d+(?:\.\d+)?)\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\s*$/.exec(sizeText);if(null!==match){var value=parseFloat(match[1]),unit=match[2];return Result.value({value:value,unit:unit})}return Result.error(sizeText)},convertUnit=function(size,unit){var inInch={"":96,px:96,pt:72,cm:2.54,pc:12,mm:25.4,in:1},supported=function(u){return has$2(inInch,u)};return size.unit===unit?Optional.some(size.value):supported(size.unit)&&supported(unit)?inInch[size.unit]===inInch[unit]?Optional.some(size.value):Optional.some(size.value/inInch[size.unit]*inInch[unit]):Optional.none()},noSizeConversion=function(_input){return Optional.none()},ratioSizeConversion=function(scale,unit){return function(size){return convertUnit(size,unit).map((function(value){return{value:value*scale,unit:unit}}))}},makeRatioConverter=function(currentFieldText,otherFieldText){var cValue=parseSize(currentFieldText).toOptional(),oValue=parseSize(otherFieldText).toOptional();return lift2(cValue,oValue,(function(cSize,oSize){return convertUnit(cSize,oSize.unit).map((function(val){return oSize.value/val})).map((function(r){return ratioSizeConversion(r,oSize.unit)})).getOr(noSizeConversion)})).getOr(noSizeConversion)},renderSizeInput=function(spec,providersBackstage){var converter=noSizeConversion,ratioEvent=generate$6("ratio-event"),makeIcon=function(iconName){return render$3(iconName,{tag:"span",classes:["tox-icon","tox-lock-icon__"+iconName]},providersBackstage.icons)},pLock=FormCoupledInputs.parts.lock({dom:{tag:"button",classes:["tox-lock","tox-button","tox-button--naked","tox-button--icon"],attributes:{title:providersBackstage.translate(spec.label.getOr("Constrain proportions"))}},components:[makeIcon("lock"),makeIcon("unlock")],buttonBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({})])}),formGroup=function(components){return{dom:{tag:"div",classes:["tox-form__group"]},components:components}},getFieldPart=function(isField1){return FormField.parts.field({factory:Input,inputClasses:["tox-textfield"],inputBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Tabstopping.config({}),config("size-input-events",[run$1(focusin(),(function(component,_simulatedEvent){emitWith(component,ratioEvent,{isField1:isField1})})),run$1(change(),(function(component,_simulatedEvent){emitWith(component,formChangeEvent,{name:spec.name})}))])]),selectOnFocus:!1})},getLabel=function(label){return{dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}},widthField=FormCoupledInputs.parts.field1(formGroup([FormField.parts.label(getLabel("Width")),getFieldPart(!0)])),heightField=FormCoupledInputs.parts.field2(formGroup([FormField.parts.label(getLabel("Height")),getFieldPart(!1)]));return FormCoupledInputs.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:[{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:[widthField,heightField,formGroup([getLabel("&nbsp;"),pLock])]}],field1Name:"width",field2Name:"height",locked:!0,markers:{lockClass:"tox-locked"},onLockedChange:function(current,other,_lock){parseSize(Representing.getValue(current)).each((function(size){converter(size).each((function(newSize){Representing.setValue(other,formatSize(newSize))}))}))},coupledFieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable),FormCoupledInputs.getLock(comp).each(Disabling.disable)},onEnabled:function(comp){FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable),FormCoupledInputs.getLock(comp).each(Disabling.enable)}}),receivingConfig(),config("size-input-events2",[run$1(ratioEvent,(function(component,simulatedEvent){var isField1=simulatedEvent.event.isField1,optCurrent=isField1?FormCoupledInputs.getField1(component):FormCoupledInputs.getField2(component),optOther=isField1?FormCoupledInputs.getField2(component):FormCoupledInputs.getField1(component),value1=optCurrent.map(Representing.getValue).getOr(""),value2=optOther.map(Representing.getValue).getOr("");converter=makeRatioConverter(value1,value2)}))])])})},undo,redo,zoom,back,apply,swap,transform$1,tempTransform,transformApply,internal={undo:constant$1(generate$6("undo")),redo:constant$1(generate$6("redo")),zoom:constant$1(generate$6("zoom")),back:constant$1(generate$6("back")),apply:constant$1(generate$6("apply")),swap:constant$1(generate$6("swap")),transform:constant$1(generate$6("transform")),tempTransform:constant$1(generate$6("temp-transform")),transformApply:constant$1(generate$6("transform-apply"))},saveState=constant$1("save-state"),disable=constant$1("disable"),enable=constant$1("enable"),external={formActionEvent:formActionEvent,saveState:saveState,disable:disable,enable:enable},renderEditPanel=function(imagePanel,providersBackstage){var createButton=function(text,action,disabled,primary){return record(renderButton({name:text,text:text,disabled:disabled,primary:primary,icon:Optional.none(),borderless:!1},action,providersBackstage))},createIconButton=function(icon,tooltip,action,disabled){return record(renderIconButton({name:icon,icon:Optional.some(icon),tooltip:Optional.some(tooltip),disabled:disabled,primary:!1,borderless:!1},action,providersBackstage))},disableAllComponents=function(comps,eventcomp){comps.map((function(mem){var component=mem.get(eventcomp);component.hasConfigured(Disabling)&&Disabling.disable(component)}))},enableAllComponents=function(comps,eventcomp){comps.map((function(mem){var component=mem.get(eventcomp);component.hasConfigured(Disabling)&&Disabling.enable(component)}))},panelDom={tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools-edit-panel"]},noop$1=noop,emit$1=function(comp,event,data){emitWith(comp,event,data)},emitDisable=function(component){return emit(component,external.disable())},emitEnable=function(component){return emit(component,external.enable())},emitTransform=function(comp,transform){emitDisable(comp),emit$1(comp,internal.transform(),{transform:transform}),emitEnable(comp)},emitTempTransform=function(comp,transform){emitDisable(comp),emit$1(comp,internal.tempTransform(),{transform:transform}),emitEnable(comp)},getBackSwap=function(anyInSystem){return function(){memContainer.getOpt(anyInSystem).each((function(container){Replacing.set(container,[ButtonPanel])}))}},emitTransformApply=function(comp,transform){emitDisable(comp),emit$1(comp,internal.transformApply(),{transform:transform,swap:getBackSwap(comp)}),emitEnable(comp)},createBackButton=function(){return createButton("Back",(function(button){return emit$1(button,internal.back(),{swap:getBackSwap(button)})}),!1,!1)},createSpacer=function(){return record({dom:{tag:"div",classes:["tox-spacer"]},behaviours:derive$1([Disabling.config({})])})},createApplyButton=function(){return createButton("Apply",(function(button){return emit$1(button,internal.apply(),{swap:getBackSwap(button)})}),!0,!0)},makeCropTransform=function(){return function(ir){var rect=imagePanel.getRect();return crop(ir,rect.x,rect.y,rect.w,rect.h)}},cropPanelComponents=[createBackButton(),createSpacer(),createButton("Apply",(function(button){var transform=makeCropTransform();emitTransformApply(button,transform),imagePanel.hideCrop()}),!1,!0)],CropPanel=Container.sketch({dom:panelDom,components:cropPanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-crop-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(cropPanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(cropPanelComponents,comp)}))])])}),memSize=record(renderSizeInput({name:"size",label:Optional.none(),constrain:!0,disabled:!1},providersBackstage)),makeResizeTransform=function(width,height){return function(ir){return resize$1(ir,width,height)}},resizePanelComponents=[createBackButton(),createSpacer(),memSize,createSpacer(),createButton("Apply",(function(button){memSize.getOpt(button).each((function(sizeInput){var value=Representing.getValue(sizeInput),width=parseInt(value.width,10),height=parseInt(value.height,10),transform=makeResizeTransform(width,height);emitTransformApply(button,transform)}))}),!1,!0)],ResizePanel=Container.sketch({dom:panelDom,components:resizePanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-resize-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(resizePanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(resizePanelComponents,comp)}))])])}),makeValueTransform=function(transform,value){return function(ir){return transform(ir,value)}},horizontalFlip=makeValueTransform(flip,"h"),verticalFlip=makeValueTransform(flip,"v"),counterclockwiseRotate=makeValueTransform(rotate,-90),clockwiseRotate=makeValueTransform(rotate,90),flipRotateOnAction=function(comp,operation){emitTempTransform(comp,operation)},flipRotateComponents=[createBackButton(),createSpacer(),createIconButton("flip-horizontally","Flip horizontally",(function(button){flipRotateOnAction(button,horizontalFlip)}),!1),createIconButton("flip-vertically","Flip vertically",(function(button){flipRotateOnAction(button,verticalFlip)}),!1),createIconButton("rotate-left","Rotate counterclockwise",(function(button){flipRotateOnAction(button,counterclockwiseRotate)}),!1),createIconButton("rotate-right","Rotate clockwise",(function(button){flipRotateOnAction(button,clockwiseRotate)}),!1),createSpacer(),createApplyButton()],FlipRotatePanel=Container.sketch({dom:panelDom,components:flipRotateComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-fliprotate-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(flipRotateComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(flipRotateComponents,comp)}))])])}),makeSlider=function(label,onChoose,min,value,max){var labelPart=Slider.parts.label({dom:{tag:"label",classes:["tox-label"],innerHtml:providersBackstage.translate(label)}}),spectrum=Slider.parts.spectrum({dom:{tag:"div",classes:["tox-slider__rail"],attributes:{role:"presentation"}}}),thumb=Slider.parts.thumb({dom:{tag:"div",classes:["tox-slider__handle"],attributes:{role:"presentation"}}});return record(Slider.sketch({dom:{tag:"div",classes:["tox-slider"],attributes:{role:"presentation"}},model:{mode:"x",minX:min,maxX:max,getInitialValue:constant$1({x:value})},components:[labelPart,spectrum,thumb],sliderBehaviours:derive$1([Focusing.config({})]),onChoose:onChoose}))},makeVariableSlider=function(label,transform,min,value,max){var onChoose;return makeSlider(label,(function(slider,_thumb,value){var valTransform=makeValueTransform(transform,value.x/100);emitTransform(slider,valTransform)}),min,value,max)},variableFilterPanelComponents=function(label,transform,min,value,max){return[createBackButton(),makeVariableSlider(label,transform,min,value,max),createApplyButton()]},createVariableFilterPanel=function(label,transform,min,value,max){var filterPanelComponents=variableFilterPanelComponents(label,transform,min,value,max);return Container.sketch({dom:panelDom,components:filterPanelComponents.map((function(mem){return mem.asSpec()})),containerBehaviours:derive$1([config("image-tools-filter-panel-buttons-events",[run$1(external.disable(),(function(comp,_se){disableAllComponents(filterPanelComponents,comp)})),run$1(external.enable(),(function(comp,_se){enableAllComponents(filterPanelComponents,comp)}))])])})},filterPanelComponents=[createBackButton(),createSpacer(),createApplyButton()],FilterPanel=Container.sketch({dom:panelDom,components:filterPanelComponents.map((function(mem){return mem.asSpec()}))}),BrightnessPanel=createVariableFilterPanel("Brightness",brightness,-100,0,100),ContrastPanel=createVariableFilterPanel("Contrast",contrast,-100,0,100),GammaPanel=createVariableFilterPanel("Gamma",gamma,-100,0,100),makeColorTransform=function(red,green,blue){return function(ir){return colorize(ir,red,green,blue)}},makeColorSlider=function(label){var onChoose;return makeSlider(label,(function(slider,_thumb,_value){var redOpt=memRed.getOpt(slider),blueOpt=memBlue.getOpt(slider),greenOpt=memGreen.getOpt(slider);redOpt.each((function(red){blueOpt.each((function(blue){greenOpt.each((function(green){var r=Representing.getValue(red).x/100,g=Representing.getValue(green).x/100,b=Representing.getValue(blue).x/100,transform=makeColorTransform(r,g,b);emitTransform(slider,transform)}))}))}))}),0,100,200)},memRed=makeColorSlider("R"),memGreen=makeColorSlider("G"),memBlue=makeColorSlider("B"),colorizePanelComponents=[createBackButton(),memRed,memGreen,memBlue,createApplyButton()],ColorizePanel=Container.sketch({dom:panelDom,components:colorizePanelComponents.map((function(mem){return mem.asSpec()}))}),getTransformPanelEvent=function(panel,transform,update){return function(button){var swap=function(){memContainer.getOpt(button).each((function(container){Replacing.set(container,[panel]),update(container)}))};emit$1(button,internal.swap(),{transform:transform,swap:swap})}},cropPanelUpdate=function(_anyInSystem){imagePanel.showCrop()},resizePanelUpdate=function(anyInSystem){memSize.getOpt(anyInSystem).each((function(sizeInput){var measurements=imagePanel.getMeasurements(),width=measurements.width,height=measurements.height;Representing.setValue(sizeInput,{width:width,height:height})}))},sharpenTransform=Optional.some(sharpen),invertTransform=Optional.some(invert),buttonPanelComponents=[createIconButton("crop","Crop",getTransformPanelEvent(CropPanel,Optional.none(),cropPanelUpdate),!1),createIconButton("resize","Resize",getTransformPanelEvent(ResizePanel,Optional.none(),resizePanelUpdate),!1),createIconButton("orientation","Orientation",getTransformPanelEvent(FlipRotatePanel,Optional.none(),noop$1),!1),createIconButton("brightness","Brightness",getTransformPanelEvent(BrightnessPanel,Optional.none(),noop$1),!1),createIconButton("sharpen","Sharpen",getTransformPanelEvent(FilterPanel,sharpenTransform,noop$1),!1),createIconButton("contrast","Contrast",getTransformPanelEvent(ContrastPanel,Optional.none(),noop$1),!1),createIconButton("color-levels","Color levels",getTransformPanelEvent(ColorizePanel,Optional.none(),noop$1),!1),createIconButton("gamma","Gamma",getTransformPanelEvent(GammaPanel,Optional.none(),noop$1),!1),createIconButton("invert","Invert",getTransformPanelEvent(FilterPanel,invertTransform,noop$1),!1)],ButtonPanel=Container.sketch({dom:panelDom,components:buttonPanelComponents.map((function(mem){return mem.asSpec()}))}),container=Container.sketch({dom:{tag:"div"},components:[ButtonPanel],containerBehaviours:derive$1([Replacing.config({})])}),memContainer=record(container),getApplyButton=function(anyInSystem){return memContainer.getOpt(anyInSystem).map((function(container){var panel=container.components()[0];return panel.components()[panel.components().length-1]}))};return{memContainer:memContainer,getApplyButton:getApplyButton}},global$4=tinymce.util.Tools.resolve("tinymce.geom.Rect"),global$3=tinymce.util.Tools.resolve("tinymce.util.Observable"),global$2=tinymce.util.Tools.resolve("tinymce.util.VK"),getDocumentSize=function(doc){var max=Math.max,documentElement=doc.documentElement,body=doc.body,scrollWidth=max(documentElement.scrollWidth,body.scrollWidth),clientWidth=max(documentElement.clientWidth,body.clientWidth),offsetWidth=max(documentElement.offsetWidth,body.offsetWidth),scrollHeight=max(documentElement.scrollHeight,body.scrollHeight),clientHeight=max(documentElement.clientHeight,body.clientHeight),offsetHeight;return{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<max(documentElement.offsetHeight,body.offsetHeight)?clientHeight:scrollHeight}},isTouchEvent$1=function(e){return isNonNullable(e.changedTouches)},updateWithTouchData=function(e){if(isTouchEvent$1(e))for(var keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]};function DragHelper(id,settings){var _a,_b,_c,eventOverlay,handleEvents=[],overlayEvents=[],doc=null!==(_a=settings.document)&&void 0!==_a?_a:document,root=null!==(_b=settings.root)&&void 0!==_b?_b:doc,sugarDoc=SugarElement.fromDom(doc),downButton,startX,startY,handleElement=SugarElement.fromDom(root.getElementById(null!==(_c=settings.handle)&&void 0!==_c?_c:id)),start=function(e){var rawEvent=e.raw,docSize=getDocumentSize(doc);updateWithTouchData(rawEvent),e.prevent(),downButton=rawEvent.button,startX=rawEvent.screenX,startY=rawEvent.screenY;var cursor=get$c(handleElement,"cursor");eventOverlay=SugarElement.fromTag("div",doc),setAll(eventOverlay,{position:"absolute",top:"0",left:"0",width:docSize.width+"px",height:docSize.height+"px","z-index":"2147483647",opacity:"0.0001",cursor:cursor}),append$2(getBody(sugarDoc),eventOverlay),overlayEvents.push(bind(sugarDoc,"mousemove",drag),bind(sugarDoc,"touchmove",drag),bind(sugarDoc,"mouseup",stop),bind(sugarDoc,"touchend",stop)),settings.start(rawEvent)},drag=function(e){var rawEvent=e.raw;if(updateWithTouchData(rawEvent),rawEvent.button!==downButton)return stop(e);rawEvent.deltaX=rawEvent.screenX-startX,rawEvent.deltaY=rawEvent.screenY-startY,e.prevent(),settings.drag(rawEvent)},stop=function(e){updateWithTouchData(e.raw),each$1(overlayEvents,(function(e){return e.unbind()})),overlayEvents=[],remove$5(eventOverlay),settings.stop&&settings.stop(e.raw)},destroy=function(){each$1(overlayEvents.concat(handleEvents),(function(e){return e.unbind()})),overlayEvents=[],handleEvents=[],isNonNullable(eventOverlay)&&remove$5(eventOverlay)};return handleEvents.push(bind(handleElement,"mousedown",start),bind(handleElement,"touchstart",start)),{destroy:destroy}}var count=0,create$1,CropRect_create=function(currentRect,viewPortRect,clampRect,containerElm,action){var dragHelpers,events=[],prefix="tox-",id="tox-crid-"+count++,container=SugarElement.fromDom(containerElm),handles=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],blockers=["top","right","bottom","left"],getAbsoluteRect=function(outerRect,relativeRect){return{x:relativeRect.x+outerRect.x,y:relativeRect.y+outerRect.y,w:relativeRect.w,h:relativeRect.h}},getRelativeRect=function(outerRect,innerRect){return{x:innerRect.x-outerRect.x,y:innerRect.y-outerRect.y,w:innerRect.w,h:innerRect.h}},getInnerRect=function(){return getRelativeRect(clampRect,currentRect)},moveRect=function(handle,startRect,deltaX,deltaY){var x=startRect.x+deltaX*handle.deltaX,y=startRect.y+deltaY*handle.deltaY,w=Math.max(20,startRect.w+deltaX*handle.deltaW),h=Math.max(20,startRect.h+deltaY*handle.deltaH),rect=currentRect=global$4.clamp({x:x,y:y,w:w,h:h},clampRect,"move"===handle.name);rect=getRelativeRect(clampRect,rect),instance.fire("updateRect",{rect:rect}),setInnerRect(rect)},render=function(){var createDragHelper=function(handle){var startRect;return DragHelper(id,{document:containerElm.ownerDocument,root:getRootNode(container).dom,handle:id+"-"+handle.name,start:function(){startRect=currentRect},drag:function(e){moveRect(handle,startRect,e.deltaX,e.deltaY)}})},cropContainer=SugarElement.fromTag("div");setAll$1(cropContainer,{id:id,class:"tox-croprect-container",role:"grid","aria-dropeffect":"execute"}),append$2(container,cropContainer),each$1(blockers,(function(blocker){descendant(container,"#"+id).each((function(blockerElm){var cropBlocker=SugarElement.fromTag("div");setAll$1(cropBlocker,{id:id+"-"+blocker,class:"tox-croprect-block","data-mce-bogus":"all"}),set$7(cropBlocker,"display","none"),append$2(blockerElm,cropBlocker)}))})),each$1(handles,(function(handle){descendant(container,"#"+id).each((function(handleElm){var cropHandle=SugarElement.fromTag("div");setAll$1(cropHandle,{id:id+"-"+handle.name,"aria-label":handle.label,"aria-grabbed":"false","data-mce-bogus":"all",role:"gridcell",tabindex:"-1",title:handle.label}),add$1(cropHandle,["tox-croprect-handle","tox-croprect-handle-"+handle.name]),set$7(cropHandle,"display","none"),append$2(handleElm,cropHandle)}))})),dragHelpers=map$2(handles,createDragHelper),repaint(currentRect);var handleFocus=function(e){set$8(e.target,"aria-grabbed","focus"===e.raw.type?"true":"false")},handleKeydown=function(e){var activeHandle;each$1(handles,(function(handle){if(get$d(e.target,"id")===id+"-"+handle.name)return activeHandle=handle,!1}));var moveAndBlock=function(evt,handle,startRect,deltaX,deltaY){evt.stopPropagation(),evt.preventDefault(),moveRect(activeHandle,startRect,deltaX,deltaY)};switch(e.raw.keyCode){case global$2.LEFT:moveAndBlock(e,activeHandle,currentRect,-10,0);break;case global$2.RIGHT:moveAndBlock(e,activeHandle,currentRect,10,0);break;case global$2.UP:moveAndBlock(e,activeHandle,currentRect,0,-10);break;case global$2.DOWN:moveAndBlock(e,activeHandle,currentRect,0,10);break;case global$2.ENTER:case global$2.SPACEBAR:e.prevent(),action()}};events.push(bind(container,"focusin",handleFocus),bind(container,"focusout",handleFocus),bind(container,"keydown",handleKeydown))},toggleVisibility=function(state){var selectors=__spreadArray(__spreadArray([],map$2(handles,(function(handle){return"#"+id+"-"+handle.name})),!0),map$2(blockers,(function(blocker){return"#"+id+"-"+blocker})),!0).join(","),elems=descendants(container,selectors);each$1(elems,state?function(elm){return remove$6(elm,"display")}:function(elm){return set$7(elm,"display","none")})},repaint=function(rect){var updateElementRect=function(name,newRect){descendant(container,"#"+id+"-"+name).each((function(elm){setAll(elm,{left:newRect.x+"px",top:newRect.y+"px",width:Math.max(0,newRect.w)+"px",height:Math.max(0,newRect.h)+"px"})}))};each$1(handles,(function(handle){descendant(container,"#"+id+"-"+handle.name).each((function(elm){setAll(elm,{left:rect.w*handle.xMul+rect.x+"px",top:rect.h*handle.yMul+rect.y+"px"})}))})),updateElementRect("top",{x:viewPortRect.x,y:viewPortRect.y,w:viewPortRect.w,h:rect.y-viewPortRect.y}),updateElementRect("right",{x:rect.x+rect.w,y:rect.y,w:viewPortRect.w-rect.x-rect.w+viewPortRect.x,h:rect.h}),updateElementRect("bottom",{x:viewPortRect.x,y:rect.y+rect.h,w:viewPortRect.w,h:viewPortRect.h-rect.y-rect.h+viewPortRect.y}),updateElementRect("left",{x:viewPortRect.x,y:rect.y,w:rect.x-viewPortRect.x,h:rect.h}),updateElementRect("move",rect)},setRect=function(rect){repaint(currentRect=rect)},setViewPortRect=function(rect){viewPortRect=rect,repaint(currentRect)},setInnerRect=function(rect){setRect(getAbsoluteRect(clampRect,rect))},setClampRect=function(rect){clampRect=rect,repaint(currentRect)},destroy=function(){each$1(dragHelpers,(function(helper){return helper.destroy()})),dragHelpers=[],each$1(events,(function(e){return e.unbind()})),events=[]};render();var instance=__assign(__assign({},global$3),{toggleVisibility:toggleVisibility,setClampRect:setClampRect,setRect:setRect,getInnerRect:getInnerRect,setInnerRect:setInnerRect,setViewPortRect:setViewPortRect,destroy:destroy});return instance},loadImage=function(image){return new global$c((function(resolve){var loaded=function(){image.removeEventListener("load",loaded),resolve(image)};image.complete?resolve(image):image.addEventListener("load",loaded)}))},renderImagePanel=function(initialUrl){var memBg=record({dom:{tag:"div",classes:["tox-image-tools__image-bg"],attributes:{role:"presentation"}}}),zoomState=Cell(1),cropRect=api$1(),rectState=Cell({x:0,y:0,w:1,h:1}),viewRectState=Cell({x:0,y:0,w:1,h:1}),repaintImg=function(anyInSystem,img){memContainer.getOpt(anyInSystem).each((function(panel){var zoom=zoomState.get(),panelW=get$a(panel.element),panelH=get$b(panel.element),width=img.dom.naturalWidth*zoom,height=img.dom.naturalHeight*zoom,left=Math.max(0,panelW/2-width/2),top=Math.max(0,panelH/2-height/2),css={left:left.toString()+"px",top:top.toString()+"px",width:width.toString()+"px",height:height.toString()+"px",position:"absolute"};setAll(img,css),memBg.getOpt(panel).each((function(bg){setAll(bg.element,css)})),cropRect.run((function(cRect){var rect=rectState.get();cRect.setRect({x:rect.x*zoom+left,y:rect.y*zoom+top,w:rect.w*zoom,h:rect.h*zoom}),cRect.setClampRect({x:left,y:top,w:width,h:height}),cRect.setViewPortRect({x:0,y:0,w:panelW,h:panelH})}))}))},zoomFit=function(anyInSystem,img){memContainer.getOpt(anyInSystem).each((function(panel){var panelW=get$a(panel.element),panelH=get$b(panel.element),width=img.dom.naturalWidth,height=img.dom.naturalHeight,zoom=Math.min(panelW/width,panelH/height);zoom>=1?zoomState.set(1):zoomState.set(zoom)}))},updateSrc=function(anyInSystem,url){var img=SugarElement.fromTag("img");return set$8(img,"src",url),loadImage(img.dom).then((function(){anyInSystem.getSystem().isConnected()&&memContainer.getOpt(anyInSystem).map((function(panel){var aImg=external$2({element:img});Replacing.replaceAt(panel,1,Optional.some(aImg));var lastViewRect=viewRectState.get(),viewRect={x:0,y:0,w:img.dom.naturalWidth,h:img.dom.naturalHeight};viewRectState.set(viewRect);var rect=global$4.inflate(viewRect,-20,-20);rectState.set(rect),lastViewRect.w===viewRect.w&&lastViewRect.h===viewRect.h||zoomFit(panel,img),repaintImg(panel,img)}))}))},zoom=function(anyInSystem,direction){var currentZoom=zoomState.get(),newZoom=direction>0?Math.min(2,currentZoom+.1):Math.max(.1,currentZoom-.1);zoomState.set(newZoom),memContainer.getOpt(anyInSystem).each((function(panel){var img=panel.components()[1].element;repaintImg(panel,img)}))},showCrop=function(){cropRect.run((function(cRect){cRect.toggleVisibility(!0)}))},hideCrop=function(){cropRect.run((function(cRect){cRect.toggleVisibility(!1)}))},getRect=function(){return rectState.get()},container=Container.sketch({dom:{tag:"div",classes:["tox-image-tools__image"]},components:[memBg.asSpec(),{dom:{tag:"img",attributes:{src:initialUrl}}},{dom:{tag:"div"},behaviours:derive$1([config("image-panel-crop-events",[runOnAttached((function(comp){memContainer.getOpt(comp).each((function(container){var el=container.element.dom,cRect=CropRect_create({x:10,y:10,w:100,h:100},{x:0,y:0,w:200,h:200},{x:0,y:0,w:200,h:200},el,noop);cRect.toggleVisibility(!1),cRect.on("updateRect",(function(e){var rect=e.rect,zoom=zoomState.get(),newRect={x:Math.round(rect.x/zoom),y:Math.round(rect.y/zoom),w:Math.round(rect.w/zoom),h:Math.round(rect.h/zoom)};rectState.set(newRect)})),cropRect.set(cRect)}))})),runOnDetached((function(){cropRect.clear()}))])])}],containerBehaviours:derive$1([Replacing.config({}),config("image-panel-events",[runOnAttached((function(comp){updateSrc(comp,initialUrl)}))])])}),memContainer=record(container),getMeasurements;return{memContainer:memContainer,updateSrc:updateSrc,zoom:zoom,showCrop:showCrop,hideCrop:hideCrop,getRect:getRect,getMeasurements:function(){var viewRect=viewRectState.get();return{width:viewRect.w,height:viewRect.h}}}},createButton=function(innerHtml,icon,disabled,action,providersBackstage){return renderIconButton({name:innerHtml,icon:Optional.some(icon),disabled:disabled,tooltip:Optional.some(innerHtml),primary:!1,borderless:!1},action,providersBackstage)},setButtonEnabled=function(button,enabled){enabled?Disabling.enable(button):Disabling.disable(button)},renderSideBar=function(providersBackstage){var updateButtonUndoStates=function(anyInSystem,undoEnabled,redoEnabled){memUndo.getOpt(anyInSystem).each((function(undo){setButtonEnabled(undo,undoEnabled)})),memRedo.getOpt(anyInSystem).each((function(redo){setButtonEnabled(redo,redoEnabled)}))},memUndo=record(createButton("Undo","undo",!0,(function(button){emitWith(button,internal.undo(),{direction:1})}),providersBackstage)),memRedo=record(createButton("Redo","redo",!0,(function(button){emitWith(button,internal.redo(),{direction:1})}),providersBackstage)),container;return{container:Container.sketch({dom:{tag:"div",classes:["tox-image-tools__toolbar","tox-image-tools__sidebar"]},components:[memUndo.asSpec(),memRedo.asSpec(),createButton("Zoom in","zoom-in",!1,(function(button){emitWith(button,internal.zoom(),{direction:1})}),providersBackstage),createButton("Zoom out","zoom-out",!1,(function(button){emitWith(button,internal.zoom(),{direction:-1})}),providersBackstage)]}),updateButtonUndoStates:updateButtonUndoStates}};function UndoStack(){var data=[],index=-1,add=function(state){var removed=data.splice(++index);return data.push(state),{state:state,removed:removed}},undo=function(){if(canUndo())return data[--index]},redo=function(){if(canRedo())return data[++index]},canUndo=function(){return index>0},canRedo=function(){return-1!==index&&index<data.length-1};return{data:data,add:add,undo:undo,redo:redo,canUndo:canUndo,canRedo:canRedo}}var makeState=function(initialState){var blobState=Cell(initialState),tempState=value$1(),undoStack=UndoStack();undoStack.add(initialState);var getBlobState,setBlobState=function(state){blobState.set(state)},getTempState,updateTempState=function(blob){var newTempState=createState(blob);return destroyTempState(),tempState.set(newTempState),newTempState.url},createState=function(blob){return{blob:blob,url:URL.createObjectURL(blob)}},destroyState=function(state){URL.revokeObjectURL(state.url)},destroyStates=function(states){global$5.each(states,destroyState)},destroyTempState=function(){tempState.on(destroyState),tempState.clear()},addBlobState=function(blob){var newState=createState(blob);setBlobState(newState);var removed=undoStack.add(newState).removed;return destroyStates(removed),newState.url},addTempState,applyTempState=function(postApply){return tempState.get().fold(noop,(function(temp){addBlobState(temp.blob),postApply()}))},undo=function(){var currentState=undoStack.undo();return setBlobState(currentState),currentState.url},redo=function(){var currentState=undoStack.redo();return setBlobState(currentState),currentState.url},getHistoryStates;return{getBlobState:function(){return blobState.get()},setBlobState:setBlobState,addBlobState:addBlobState,getTempState:function(){return tempState.get().getOrThunk(blobState.get)},updateTempState:updateTempState,addTempState:function(blob){var newState=createState(blob);return tempState.set(newState),newState.url},applyTempState:applyTempState,destroyTempState:destroyTempState,undo:undo,redo:redo,getHistoryStates:function(){var undoEnabled,redoEnabled;return{undoEnabled:undoStack.canUndo(),redoEnabled:undoStack.canRedo()}}}},renderImageTools=function(detail,providersBackstage){var state=makeState(detail.currentState),zoom=function(anyInSystem,simulatedEvent){var direction=simulatedEvent.event.direction;imagePanel.zoom(anyInSystem,direction)},updateButtonUndoStates=function(anyInSystem){var historyStates=state.getHistoryStates();sideBar.updateButtonUndoStates(anyInSystem,historyStates.undoEnabled,historyStates.redoEnabled),emitWith(anyInSystem,external.formActionEvent,{name:external.saveState(),value:historyStates.undoEnabled})},disableUndoRedo=function(anyInSystem){sideBar.updateButtonUndoStates(anyInSystem,!1,!1)},undo=function(anyInSystem,_simulatedEvent){var url=state.undo();updateSrc(anyInSystem,url).then((function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)}))},redo=function(anyInSystem,_simulatedEvent){var url=state.redo();updateSrc(anyInSystem,url).then((function(_oImg){unblock(anyInSystem),updateButtonUndoStates(anyInSystem)}))},imageResultToBlob=function(ir){return ir.toBlob()},block=function(anyInSystem){emitWith(anyInSystem,external.formActionEvent,{name:external.disable(),value:{}})},unblock=function(anyInSystem){editPanel.getApplyButton(anyInSystem).each((function(applyButton){Disabling.enable(applyButton)})),emitWith(anyInSystem,external.formActionEvent,{name:external.enable(),value:{}})},updateSrc=function(anyInSystem,src){return block(anyInSystem),imagePanel.updateSrc(anyInSystem,src)},blobManipulate=function(anyInSystem,blob,filter,action,swap){block(anyInSystem),blobToImageResult(blob).then(filter).then(imageResultToBlob).then(action).then((function(url){return updateSrc(anyInSystem,url)})).then((function(){updateButtonUndoStates(anyInSystem),swap(),unblock(anyInSystem)})).catch((function(err){console.log(err),anyInSystem.getSystem().isConnected()&&unblock(anyInSystem)}))},manipulate=function(anyInSystem,filter,swap){var blob=state.getBlobState().blob,action;blobManipulate(anyInSystem,blob,filter,(function(blob){return state.updateTempState(blob)}),swap)},tempManipulate=function(anyInSystem,filter){var blob=state.getTempState().blob,action;blobManipulate(anyInSystem,blob,filter,(function(blob){return state.addTempState(blob)}),noop)},manipulateApply=function(anyInSystem,filter,swap){var blob=state.getBlobState().blob,action;blobManipulate(anyInSystem,blob,filter,(function(blob){var url=state.addBlobState(blob);return destroyTempState(anyInSystem),url}),swap)},apply=function(anyInSystem,simulatedEvent){var postApply=function(){var swap;destroyTempState(anyInSystem),(0,simulatedEvent.event.swap)()};state.applyTempState(postApply)},destroyTempState=function(anyInSystem){var currentUrl=state.getBlobState().url;return state.destroyTempState(),updateButtonUndoStates(anyInSystem),currentUrl},cancel=function(anyInSystem){var currentUrl=destroyTempState(anyInSystem);updateSrc(anyInSystem,currentUrl).then((function(_oImg){unblock(anyInSystem)}))},back=function(anyInSystem,simulatedEvent){var swap;cancel(anyInSystem),(0,simulatedEvent.event.swap)(),imagePanel.hideCrop()},transform=function(anyInSystem,simulatedEvent){return manipulate(anyInSystem,simulatedEvent.event.transform,noop)},tempTransform=function(anyInSystem,simulatedEvent){return tempManipulate(anyInSystem,simulatedEvent.event.transform)},transformApply=function(anyInSystem,simulatedEvent){return manipulateApply(anyInSystem,simulatedEvent.event.transform,simulatedEvent.event.swap)},imagePanel=renderImagePanel(detail.currentState.url),sideBar=renderSideBar(providersBackstage),editPanel=renderEditPanel(imagePanel,providersBackstage),swap=function(anyInSystem,simulatedEvent){disableUndoRedo(anyInSystem);var transform=simulatedEvent.event.transform,swap=simulatedEvent.event.swap;transform.fold((function(){swap()}),(function(transform){manipulate(anyInSystem,transform,swap)}))};return{dom:{tag:"div",attributes:{role:"presentation"}},components:[editPanel.memContainer.asSpec(),imagePanel.memContainer.asSpec(),sideBar.container],behaviours:derive$1([Representing.config({store:{mode:"manual",getValue:function(){return state.getBlobState()}}}),config("image-tools-events",[run$1(internal.undo(),undo),run$1(internal.redo(),redo),run$1(internal.zoom(),zoom),run$1(internal.back(),back),run$1(internal.apply(),apply),run$1(internal.transform(),transform),run$1(internal.tempTransform(),tempTransform),run$1(internal.transformApply(),transformApply),run$1(internal.swap(),swap)]),ComposingConfigs_self()])}},renderLabel=function(spec,backstageShared){var label={dom:{tag:"label",innerHtml:backstageShared.providers.translate(spec.label),classes:["tox-label"]}},comps=map$2(spec.items,backstageShared.interpreter);return{dom:{tag:"div",classes:["tox-form__group"]},components:[label].concat(comps),behaviours:derive$1([ComposingConfigs_self(),Replacing.config({}),RepresentingConfigs_domHtml(Optional.none()),Keying.config({mode:"acyclic"})])}},isSingleListItem=function(item){return!has$2(item,"items")},dataAttribute="data-value",fetchItems=function(dropdownComp,name,items,selectedValue){return map$2(items,(function(item){return isSingleListItem(item)?{type:"togglemenuitem",text:item.text,value:item.value,active:item.value===selectedValue,onAction:function(){Representing.setValue(dropdownComp,item.value),emitWith(dropdownComp,formChangeEvent,{name:name}),Focusing.focus(dropdownComp)}}:{type:"nestedmenuitem",text:item.text,getSubmenuItems:function(){return fetchItems(dropdownComp,name,item.items,selectedValue)}}}))},findItemByValue=function(items,value){return findMap(items,(function(item){return isSingleListItem(item)?someIf(item.value===value,item):findItemByValue(item.items,value)}))},renderListBox=function(spec,backstage){var providersBackstage=backstage.shared.providers,initialItem=head(spec.items).filter(isSingleListItem),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField,listBoxWrap={dom:{tag:"div",classes:["tox-listboxfield"]},components:[FormField.parts.field({dom:{},factory:{sketch:function(sketchSpec){return renderCommonDropdown({uid:sketchSpec.uid,text:initialItem.map((function(item){return item.text})),icon:Optional.none(),tooltip:spec.label,role:Optional.none(),fetch:function(comp,callback){var items=fetchItems(comp,spec.name,spec.items,Representing.getValue(comp));callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))},onSetup:constant$1(noop),getApi:constant$1({}),columns:1,presets:"normal",classes:[],dropdownBehaviours:[Tabstopping.config({}),Representing.config({store:{mode:"manual",initialValue:initialItem.map((function(item){return item.value})).getOr(""),getValue:function(comp){return get$d(comp.element,"data-value")},setValue:function(comp,data){findItemByValue(spec.items,data).each((function(item){set$8(comp.element,"data-value",item.value),emitWith(comp,updateMenuText,{text:item.text})}))}}})]},"tox-listbox",backstage.shared)}}})]};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[listBoxWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:constant$1(spec.disabled),onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}})])})},renderPanel=function(spec,backstage){return{dom:{tag:"div",classes:spec.classes},components:map$2(spec.items,backstage.shared.interpreter)}},factory$e=function(detail,_spec){var options=map$2(detail.options,(function(option){return{dom:{tag:"option",value:option.value,innerHtml:option.text}}})),initialValues=detail.data.map((function(v){return wrap$1("initialValue",v)})).getOr({});return{uid:detail.uid,dom:{tag:"select",classes:detail.selectClasses,attributes:detail.selectAttributes},components:options,behaviours:augment(detail.selectBehaviours,[Focusing.config({}),Representing.config({store:__assign({mode:"manual",getValue:function(select){return get$5(select.element)},setValue:function(select,newValue){var found;find$5(detail.options,(function(opt){return opt.value===newValue})).isSome()&&set$4(select.element,newValue)}},initialValues)})])}},HtmlSelect=single({name:"HtmlSelect",configFields:[required$1("options"),field("selectBehaviours",[Focusing,Representing]),defaulted("selectClasses",[]),defaulted("selectAttributes",{}),option("data")],factory:factory$e}),renderSelectBox=function(spec,providersBackstage){var translatedOptions=map$2(spec.items,(function(item){return{text:providersBackstage.translate(item.text),value:item.value}})),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),pField=FormField.parts.field({dom:{},selectAttributes:{size:spec.size},options:translatedOptions,factory:HtmlSelect,selectBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("selectbox-change",[run$1(change(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))])])}),chevron=spec.size>1?Optional.none():Optional.some(render$3("chevron-down",{tag:"div",classes:["tox-selectfield__icon-js"]},providersBackstage.icons)),selectWrap={dom:{tag:"div",classes:["tox-selectfield"]},components:flatten([[pField],chevron.toArray()])};return FormField.sketch({dom:{tag:"div",classes:["tox-form__group"]},components:flatten([pLabel.toArray(),[selectWrap]]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})},renderTable=function(spec,providersBackstage){var renderTh=function(text){return{dom:{tag:"th",innerHtml:providersBackstage.translate(text)}}},renderHeader,renderTd=function(text){return{dom:{tag:"td",innerHtml:providersBackstage.translate(text)}}},renderTr=function(row){return{dom:{tag:"tr"},components:map$2(row,renderTd)}},renderRows=function(rows){return{dom:{tag:"tbody"},components:map$2(rows,renderTr)}};return{dom:{tag:"table",classes:["tox-dialog__table"]},components:[function(header){return{dom:{tag:"thead"},components:[{dom:{tag:"tr"},components:map$2(header,renderTh)}]}}(spec.header),renderRows(spec.cells)],behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}},renderTextField=function(spec,providersBackstage){var pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),baseInputBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),receivingConfig(),Keying.config({mode:"execution",useEnter:!0!==spec.multiline,useControlEnter:!0===spec.multiline,execute:function(comp){return emit(comp,formSubmitEvent),Optional.some(!0)}}),config("textfield-change",[run$1(input(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})})),run$1(postPaste(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))]),Tabstopping.config({})],validatingBehaviours=spec.validation.map((function(vl){return Invalidating.config({getRoot:function(input){return parent(input.element)},invalidClass:"tox-invalid",validator:{validate:function(input){var v=Representing.getValue(input),result=vl.validator(v);return Future_pure(!0===result?Result.value(v):Result.error(result))},validateOnLoad:vl.validateOnLoad}})})).toArray(),placeholder=spec.placeholder.fold(constant$1({}),(function(p){return{placeholder:providersBackstage.translate(p)}})),inputMode=spec.inputMode.fold(constant$1({}),(function(mode){return{inputmode:mode}})),inputAttributes=__assign(__assign({},placeholder),inputMode),pField=FormField.parts.field({tag:!0===spec.multiline?"textarea":"input",inputAttributes:inputAttributes,inputClasses:[spec.classname],inputBehaviours:derive$1(flatten([baseInputBehaviours,validatingBehaviours])),selectOnFocus:!1,factory:Input}),extraClasses,extraClasses2=(spec.flex?["tox-form__group--stretched"]:[]).concat(spec.maximized?["tox-form-group--maximize"]:[]),extraBehaviours=[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()];return renderFormFieldWith(pLabel,pField,extraClasses2,extraBehaviours)},renderInput=function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!1,label:spec.label,inputMode:spec.inputMode,placeholder:spec.placeholder,flex:!1,disabled:spec.disabled,classname:"tox-textfield",validation:Optional.none(),maximized:spec.maximized},providersBackstage)},renderTextarea=function(spec,providersBackstage){return renderTextField({name:spec.name,multiline:!0,label:spec.label,inputMode:Optional.none(),placeholder:spec.placeholder,flex:!0,disabled:spec.disabled,classname:"tox-textarea",validation:Optional.none(),maximized:spec.maximized},providersBackstage)},events$6=function(streamConfig,streamState){var streams,processor=streamConfig.stream.streams.setup(streamConfig,streamState);return derive$2([run$1(streamConfig.event,processor),runOnDetached((function(){return streamState.cancel()}))].concat(streamConfig.cancelEvent.map((function(e){return[run$1(e,(function(){return streamState.cancel()}))]})).getOr([])))},ActiveStreaming=Object.freeze({__proto__:null,events:events$6}),throttle=function(_config){var state=Cell(null),readState,setTimer,cancel;return nu$8({readState:function(){return{timer:null!==state.get()?"set":"unset"}},setTimer:function(t){state.set(t)},cancel:function(){var t=state.get();null!==t&&t.cancel()}})},init$9=function(spec){return spec.stream.streams.state(spec)},StreamingState=Object.freeze({__proto__:null,throttle:throttle,init:init$9}),setup$c=function(streamInfo,streamState){var sInfo=streamInfo.stream,throttler=last(streamInfo.onStream,sInfo.delay);return streamState.setTimer(throttler),function(component,simulatedEvent){throttler.throttle(component,simulatedEvent),sInfo.stopEvent&&simulatedEvent.stop()}},StreamingSchema=[requiredOf("stream",choose$1("mode",{throttle:[required$1("delay"),defaulted("stopEvent",!0),output$1("streams",{setup:setup$c,state:throttle})]})),defaulted("event","input"),option("cancelEvent"),onStrictHandler("onStream")],Streaming=create$7({fields:StreamingSchema,name:"streaming",active:ActiveStreaming,state:StreamingState}),setValueFromItem=function(model,input,item){var itemData=Representing.getValue(item);Representing.setValue(input,itemData),setCursorAtEnd(input)},setSelectionOn=function(input,f){var el=input.element,value=get$5(el),node=el.dom;"number"!==get$d(el,"type")&&f(node,value)},setCursorAtEnd=function(input){setSelectionOn(input,(function(node,value){return node.setSelectionRange(value.length,value.length)}))},setSelectionToEnd=function(input,startOffset){setSelectionOn(input,(function(node,value){return node.setSelectionRange(startOffset,value.length)}))},attemptSelectOver=function(model,input,item){if(model.selectsOver){var currentValue=Representing.getValue(input),inputDisplay_1=model.getDisplayText(currentValue),itemValue=Representing.getValue(item),itemDisplay;return 0===model.getDisplayText(itemValue).indexOf(inputDisplay_1)?Optional.some((function(){setValueFromItem(model,input,item),setSelectionToEnd(input,inputDisplay_1.length)})):Optional.none()}return Optional.none()},itemExecute=constant$1("alloy.typeahead.itemexecute"),make$3=function(detail,components,spec,externals){var navigateList=function(comp,simulatedEvent,highlighter){detail.previewing.set(!1);var sandbox=Coupling.getCoupled(comp,"sandbox");if(Sandboxing.isOpen(sandbox))Composing.getCurrent(sandbox).each((function(menu){Highlighting.getHighlighted(menu).fold((function(){highlighter(menu)}),(function(){dispatchEvent(sandbox,menu.element,"keydown",simulatedEvent)}))}));else{var onOpenSync=function(sandbox){Composing.getCurrent(sandbox).each(highlighter)};open(detail,mapFetch(comp),comp,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop)}},focusBehaviours$1=focusBehaviours(detail),mapFetch=function(comp){return function(tdata){return tdata.map((function(data){var menus=values(data.menus),items=bind$3(menus,(function(menu){return filter$2(menu.items,(function(item){return"item"===item.type}))})),repState;return Representing.getState(comp).update(map$2(items,(function(item){return item.data}))),data}))}},behaviours=[Focusing.config({}),Representing.config({onSetValue:detail.onSetValue,store:__assign({mode:"dataset",getDataKey:function(comp){return get$5(comp.element)},getFallbackEntry:function(itemString){return{value:itemString,meta:{}}},setValue:function(comp,data){set$4(comp.element,detail.model.getDisplayText(data))}},detail.initialData.map((function(d){return wrap$1("initialValue",d)})).getOr({}))}),Streaming.config({stream:{mode:"throttle",delay:detail.responseTime,stopEvent:!1},onStream:function(component,_simulatedEvent){var sandbox=Coupling.getCoupled(component,"sandbox"),focusInInput;if(Focusing.isFocused(component)&&get$5(component.element).length>=detail.minChars){var previousValue_1=Composing.getCurrent(sandbox).bind((function(menu){return Highlighting.getHighlighted(menu).map(Representing.getValue)}));detail.previewing.set(!0);var onOpenSync=function(_sandbox){Composing.getCurrent(sandbox).each((function(menu){previousValue_1.fold((function(){detail.model.selectsOver&&Highlighting.highlightFirst(menu)}),(function(pv){Highlighting.highlightBy(menu,(function(item){var itemData;return Representing.getValue(item).value===pv.value})),Highlighting.getHighlighted(menu).orThunk((function(){return Highlighting.highlightFirst(menu),Optional.none()}))}))}))};open(detail,mapFetch(component),component,sandbox,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop)}},cancelEvent:typeaheadCancel()}),Keying.config({mode:"special",onDown:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightFirst),Optional.some(!0)},onEscape:function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox");return Sandboxing.isOpen(sandbox)?(Sandboxing.close(sandbox),Optional.some(!0)):Optional.none()},onUp:function(comp,simulatedEvent){return navigateList(comp,simulatedEvent,Highlighting.highlightLast),Optional.some(!0)},onEnter:function(comp){var sandbox=Coupling.getCoupled(comp,"sandbox"),sandboxIsOpen=Sandboxing.isOpen(sandbox);if(sandboxIsOpen&&!detail.previewing.get())return Composing.getCurrent(sandbox).bind((function(menu){return Highlighting.getHighlighted(menu)})).map((function(item){return emitWith(comp,itemExecute(),{item:item}),!0}));var currentValue=Representing.getValue(comp);return emit(comp,typeaheadCancel()),detail.onExecute(sandbox,comp,currentValue),sandboxIsOpen&&Sandboxing.close(sandbox),Optional.some(!0)}}),Toggling.config({toggleClass:detail.markers.openClass,aria:{mode:"expanded"}}),Coupling.config({others:{sandbox:function(hotspot){return makeSandbox$1(detail,hotspot,{onOpen:function(){return Toggling.on(hotspot)},onClose:function(){return Toggling.off(hotspot)}})}}}),config("typeaheadevents",[runOnExecute$1((function(comp){var onOpenSync=noop;togglePopup(detail,mapFetch(comp),comp,externals,onOpenSync,HighlightOnOpen.HighlightFirst).get(noop)})),run$1(itemExecute(),(function(comp,se){var sandbox=Coupling.getCoupled(comp,"sandbox");setValueFromItem(detail.model,comp,se.event.item),emit(comp,typeaheadCancel()),detail.onItemExecute(comp,sandbox,se.event.item,Representing.getValue(comp)),Sandboxing.close(sandbox),setCursorAtEnd(comp)}))].concat(detail.dismissOnBlur?[run$1(postBlur(),(function(typeahead){var sandbox=Coupling.getCoupled(typeahead,"sandbox");search(sandbox.element).isNone()&&Sandboxing.close(sandbox)}))]:[]))];return{uid:detail.uid,dom:dom(deepMerge(detail,{inputAttributes:{role:"combobox","aria-autocomplete":"list","aria-haspopup":"true"}})),behaviours:__assign(__assign({},focusBehaviours$1),augment(detail.typeaheadBehaviours,behaviours)),eventOrder:detail.eventOrder}},schema$g=constant$1([option("lazySink"),required$1("fetch"),defaulted("minChars",5),defaulted("responseTime",1e3),onHandler("onOpen"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),defaulted("layouts",Optional.none()),defaulted("eventOrder",{}),defaultedObjOf("model",{},[defaulted("getDisplayText",(function(itemData){return void 0!==itemData.meta&&void 0!==itemData.meta.text?itemData.meta.text:itemData.value})),defaulted("selectsOver",!0),defaulted("populateFromBrowse",!0)]),onHandler("onSetValue"),onKeyboardHandler("onExecute"),onHandler("onItemExecute"),defaulted("inputClasses",[]),defaulted("inputAttributes",{}),defaulted("inputStyles",{}),defaulted("matchWidth",!0),defaulted("useMinWidth",!1),defaulted("dismissOnBlur",!0),markers$1(["openClass"]),option("initialData"),field("typeaheadBehaviours",[Focusing,Representing,Streaming,Keying,Toggling,Coupling]),customField("previewing",(function(){return Cell(!0)}))].concat(schema$k()).concat(sandboxFields())),parts$b=constant$1([external$1({schema:[tieredMenuMarkers()],name:"menu",overrides:function(detail){return{fakeFocus:!0,onHighlight:function(menu,item){detail.previewing.get()?menu.getSystem().getByUid(detail.uid).each((function(input){attemptSelectOver(detail.model,input,item).fold((function(){return Highlighting.dehighlight(menu,item)}),(function(fn){return fn()}))})):menu.getSystem().getByUid(detail.uid).each((function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)})),detail.previewing.set(!1)},onExecute:function(menu,item){return menu.getSystem().getByUid(detail.uid).toOptional().map((function(typeahead){return emitWith(typeahead,itemExecute(),{item:item}),!0}))},onHover:function(menu,item){detail.previewing.set(!1),menu.getSystem().getByUid(detail.uid).each((function(input){detail.model.populateFromBrowse&&setValueFromItem(detail.model,input,item)}))}}}})]),Typeahead=composite({name:"Typeahead",configFields:schema$g(),partFields:parts$b(),factory:make$3}),wrap=function(delegate){var toCached=function(){return wrap(delegate.toCached())},bindFuture=function(f){return wrap(delegate.bind((function(resA){return resA.fold((function(err){return Future_pure(Result.error(err))}),(function(a){return f(a)}))})))},bindResult=function(f){return wrap(delegate.map((function(resA){return resA.bind(f)})))},mapResult=function(f){return wrap(delegate.map((function(resA){return resA.map(f)})))},mapError=function(f){return wrap(delegate.map((function(resA){return resA.mapError(f)})))},foldResult=function(whenError,whenValue){return delegate.map((function(res){return res.fold(whenError,whenValue)}))},withTimeout=function(timeout,errorThunk){return wrap(Future_nu((function(callback){var timedOut=!1,timer=setTimeout((function(){timedOut=!0,callback(Result.error(errorThunk()))}),timeout);delegate.get((function(result){timedOut||(clearTimeout(timer),callback(result))}))})))};return __assign(__assign({},delegate),{toCached:toCached,bindFuture:bindFuture,bindResult:bindResult,mapResult:mapResult,mapError:mapError,foldResult:foldResult,withTimeout:withTimeout})},nu$1=function(worker){return wrap(Future_nu(worker))},value=function(value){return wrap(Future_pure(Result.value(value)))},error=function(error){return wrap(Future_pure(Result.error(error)))},fromResult=function(result){return wrap(Future_pure(result))},fromFuture=function(future){return wrap(future.map(Result.value))},fromPromise=function(promise){return nu$1((function(completer){promise.then((function(value){completer(Result.value(value))}),(function(error){completer(Result.error(error))}))}))},FutureResult_nu=nu$1,FutureResult_wrap=wrap,FutureResult_pure=value,FutureResult_value=value,FutureResult_error=error,FutureResult_fromResult=fromResult,FutureResult_fromFuture=fromFuture,FutureResult_fromPromise=fromPromise,separator$1={type:"separator"},toMenuItem=function(target){return{type:"menuitem",value:target.url,text:target.title,meta:{attach:target.attach},onAction:noop}},staticMenuItem=function(title,url){return{type:"menuitem",value:url,text:title,meta:{attach:void 0},onAction:noop}},toMenuItems=function(targets){return map$2(targets,toMenuItem)},filterLinkTargets=function(type,targets){return filter$2(targets,(function(target){return target.type===type}))},filteredTargets=function(type,targets){return toMenuItems(filterLinkTargets(type,targets))},headerTargets=function(linkInfo){return filteredTargets("header",linkInfo.targets)},anchorTargets=function(linkInfo){return filteredTargets("anchor",linkInfo.targets)},anchorTargetTop=function(linkInfo){return Optional.from(linkInfo.anchorTop).map((function(url){return staticMenuItem("<top>",url)})).toArray()},anchorTargetBottom=function(linkInfo){return Optional.from(linkInfo.anchorBottom).map((function(url){return staticMenuItem("<bottom>",url)})).toArray()},historyTargets=function(history){return map$2(history,(function(url){return staticMenuItem(url,url)}))},joinMenuLists=function(items){return foldl(items,(function(a,b){var bothEmpty;return 0===a.length||0===b.length?a.concat(b):a.concat(separator$1,b)}),[])},filterByQuery=function(term,menuItems){var lowerCaseTerm=term.toLowerCase();return filter$2(menuItems,(function(item){var text=void 0!==item.meta&&void 0!==item.meta.text?item.meta.text:item.text;return contains$1(text.toLowerCase(),lowerCaseTerm)||contains$1(item.value.toLowerCase(),lowerCaseTerm)}))},getItems=function(fileType,input,urlBackstage){var urlInputValue=Representing.getValue(input),term=void 0!==urlInputValue.meta.text?urlInputValue.meta.text:urlInputValue.value,info;return urlBackstage.getLinkInformation().fold((function(){return[]}),(function(linkInfo){var history=filterByQuery(term,historyTargets(urlBackstage.getHistory(fileType)));return"file"===fileType?joinMenuLists([history,filterByQuery(term,headerTargets(linkInfo)),filterByQuery(term,flatten([anchorTargetTop(linkInfo),anchorTargets(linkInfo),anchorTargetBottom(linkInfo)]))]):history}))},errorId=generate$6("aria-invalid"),renderUrlInput=function(spec,backstage,urlBackstage){var _a,providersBackstage=backstage.shared.providers,updateHistory=function(component){var urlEntry=Representing.getValue(component);urlBackstage.addToHistory(urlEntry.value,spec.filetype)},pField=FormField.parts.field({factory:Typeahead,dismissOnBlur:!0,inputClasses:["tox-textfield"],sandboxClasses:["tox-dialog__popups"],inputAttributes:{"aria-errormessage":errorId,type:"url"},minChars:0,responseTime:0,fetch:function(input){var items=getItems(spec.filetype,input,urlBackstage),tdata=build(items,ItemResponse$1.BUBBLE_TO_SANDBOX,backstage,!1);return Future_pure(tdata)},getHotspot:function(comp){return memUrlBox.getOpt(comp)},onSetValue:function(comp,_newValue){comp.hasConfigured(Invalidating)&&Invalidating.run(comp).get(noop)},typeaheadBehaviours:derive$1(flatten([urlBackstage.getValidationHandler().map((function(handler){return Invalidating.config({getRoot:function(comp){return parent(comp.element)},invalidClass:"tox-control-wrap--status-invalid",notify:{onInvalid:function(comp,err){memInvalidIcon.getOpt(comp).each((function(invalidComp){set$8(invalidComp.element,"title",providersBackstage.translate(err))}))}},validator:{validate:function(input){var urlEntry=Representing.getValue(input);return FutureResult_nu((function(completer){handler({type:spec.filetype,url:urlEntry.value},(function(validation){if("invalid"===validation.status){var err=Result.error(validation.message);completer(err)}else{var val=Result.value(validation.message);completer(val)}}))}))},validateOnLoad:!1}})})).toArray(),[Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}}),Tabstopping.config({}),config("urlinput-events",flatten(["file"===spec.filetype?[run$1(input(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name})}))]:[],[run$1(change(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)})),run$1(postPaste(),(function(comp){emitWith(comp,formChangeEvent,{name:spec.name}),updateHistory(comp)}))]]))]])),eventOrder:(_a={},_a[input()]=["streaming","urlinput-events","invalidating"],_a),model:{getDisplayText:function(itemData){return itemData.value},selectsOver:!1,populateFromBrowse:!1},markers:{openClass:"tox-textfield--popup-open"},lazySink:backstage.shared.getSink,parts:{menu:part(!1,1,"normal")},onExecute:function(_menu,component,_entry){emitWith(component,formSubmitEvent,{})},onItemExecute:function(typeahead,_sandbox,_item,_value){updateHistory(typeahead),emitWith(typeahead,formChangeEvent,{name:spec.name})}}),pLabel=spec.label.map((function(label){return renderLabel$2(label,providersBackstage)})),makeIcon,memInvalidIcon=record(function(name,errId,icon,label){return void 0===icon&&(icon=name),void 0===label&&(label=name),render$3(icon,{tag:"div",classes:["tox-icon","tox-control-wrap__status-icon-"+name],attributes:__assign({title:providersBackstage.translate(label),"aria-live":"polite"},errId.fold((function(){return{}}),(function(id){return{id:id}})))},providersBackstage.icons)}("invalid",Optional.some(errorId),"warning")),memStatus=record({dom:{tag:"div",classes:["tox-control-wrap__status-icon-wrap"]},components:[memInvalidIcon.asSpec()]}),optUrlPicker=urlBackstage.getUrlPicker(spec.filetype),browseUrlEvent=generate$6("browser.url.event"),memUrlBox=record({dom:{tag:"div",classes:["tox-control-wrap"]},components:[pField,memStatus.asSpec()],behaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()}})])}),memUrlPickerButton=record(renderButton({name:spec.name,icon:Optional.some("browse"),text:spec.label.getOr(""),disabled:spec.disabled,primary:!1,borderless:!0},(function(component){return emit(component,browseUrlEvent)}),providersBackstage,[],["tox-browse-url"])),controlHWrapper=function(){return{dom:{tag:"div",classes:["tox-form__controls-h-stack"]},components:flatten([[memUrlBox.asSpec()],optUrlPicker.map((function(){return memUrlPickerButton.asSpec()})).toArray()])}},openUrlPicker=function(comp){Composing.getCurrent(comp).each((function(field){var componentData=Representing.getValue(field),urlData=__assign({fieldname:spec.name},componentData);optUrlPicker.each((function(picker){picker(urlData).get((function(chosenData){Representing.setValue(field,chosenData),emitWith(comp,formChangeEvent,{name:spec.name})}))}))}))};return FormField.sketch({dom:renderFormFieldDom(),components:pLabel.toArray().concat([controlHWrapper()]),fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providersBackstage.isDisabled()},onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable),memUrlPickerButton.getOpt(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable),memUrlPickerButton.getOpt(comp).each(Disabling.enable)}}),receivingConfig(),config("url-input-events",[run$1(browseUrlEvent,openUrlPicker)])])})},renderAlertBanner=function(spec,providersBackstage){return Container.sketch({dom:{tag:"div",attributes:{role:"alert"},classes:["tox-notification","tox-notification--in","tox-notification--"+spec.level]},components:[{dom:{tag:"div",classes:["tox-notification__icon"]},components:[Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--naked","tox-button--icon"],innerHtml:get$1(spec.icon,providersBackstage.icons),attributes:{title:providersBackstage.translate(spec.iconTooltip)}},action:function(comp){emitWith(comp,formActionEvent,{name:"alert-banner",value:spec.url})},buttonBehaviours:derive$1([addFocusableBehaviour()])})]},{dom:{tag:"div",classes:["tox-notification__body"],innerHtml:providersBackstage.translate(spec.text)}}]})},renderCheckbox=function(spec,providerBackstage){var repBehaviour=Representing.config({store:{mode:"manual",getValue:function(comp){var el;return comp.element.dom.checked},setValue:function(comp,value){var el;comp.element.dom.checked=value}}}),toggleCheckboxHandler=function(comp){return comp.element.dom.click(),Optional.some(!0)},pField=FormField.parts.field({factory:{sketch:identity$1},dom:{tag:"input",classes:["tox-checkbox__input"],attributes:{type:"checkbox"}},behaviours:derive$1([ComposingConfigs_self(),Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()}}),Tabstopping.config({}),Focusing.config({}),repBehaviour,Keying.config({mode:"special",onEnter:toggleCheckboxHandler,onSpace:toggleCheckboxHandler,stopSpaceKeyup:!0}),config("checkbox-events",[run$1(change(),(function(component,_){emitWith(component,formChangeEvent,{name:spec.name})}))])])}),pLabel=FormField.parts.label({dom:{tag:"span",classes:["tox-checkbox__label"],innerHtml:providerBackstage.translate(spec.label)},behaviours:derive$1([Unselecting.config({})])}),makeIcon=function(className){var iconName;return render$3("checked"===className?"selected":"unselected",{tag:"span",classes:["tox-icon","tox-checkbox-icon__"+className]},providerBackstage.icons)},memIcons=record({dom:{tag:"div",classes:["tox-checkbox__icons"]},components:[makeIcon("checked"),makeIcon("unchecked")]});return FormField.sketch({dom:{tag:"label",classes:["tox-checkbox"]},components:[pField,memIcons.asSpec(),pLabel],fieldBehaviours:derive$1([Disabling.config({disabled:function(){return spec.disabled||providerBackstage.isDisabled()},disableClass:"tox-checkbox--disabled",onDisabled:function(comp){FormField.getField(comp).each(Disabling.disable)},onEnabled:function(comp){FormField.getField(comp).each(Disabling.enable)}}),receivingConfig()])})},renderHtmlPanel=function(spec){return"presentation"===spec.presets?Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html}}):Container.sketch({dom:{tag:"div",classes:["tox-form__group"],innerHtml:spec.html,attributes:{role:"document"}},containerBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})},make$2=function(render){return function(parts,spec,backstage){return get$e(spec,"name").fold((function(){return render(spec,backstage)}),(function(fieldName){return parts.field(fieldName,render(spec,backstage))}))}},makeIframe=function(render){return function(parts,spec,backstage){var iframeSpec=deepMerge(spec,{source:"dynamic"});return make$2(render)(parts,iframeSpec,backstage)}},factories={bar:make$2((function(spec,backstage){return renderBar(spec,backstage.shared)})),collection:make$2((function(spec,backstage){return renderCollection(spec,backstage.shared.providers)})),alertbanner:make$2((function(spec,backstage){return renderAlertBanner(spec,backstage.shared.providers)})),input:make$2((function(spec,backstage){return renderInput(spec,backstage.shared.providers)})),textarea:make$2((function(spec,backstage){return renderTextarea(spec,backstage.shared.providers)})),label:make$2((function(spec,backstage){return renderLabel(spec,backstage.shared)})),iframe:makeIframe((function(spec,backstage){return renderIFrame(spec,backstage.shared.providers)})),button:make$2((function(spec,backstage){return renderDialogButton(spec,backstage.shared.providers)})),checkbox:make$2((function(spec,backstage){return renderCheckbox(spec,backstage.shared.providers)})),colorinput:make$2((function(spec,backstage){return renderColorInput(spec,backstage.shared,backstage.colorinput)})),colorpicker:make$2(renderColorPicker),dropzone:make$2((function(spec,backstage){return renderDropZone(spec,backstage.shared.providers)})),grid:make$2((function(spec,backstage){return renderGrid(spec,backstage.shared)})),listbox:make$2((function(spec,backstage){return renderListBox(spec,backstage)})),selectbox:make$2((function(spec,backstage){return renderSelectBox(spec,backstage.shared.providers)})),sizeinput:make$2((function(spec,backstage){return renderSizeInput(spec,backstage.shared.providers)})),urlinput:make$2((function(spec,backstage){return renderUrlInput(spec,backstage,backstage.urlinput)})),customeditor:make$2(renderCustomEditor),htmlpanel:make$2(renderHtmlPanel),imagetools:make$2((function(spec,backstage){return renderImageTools(spec,backstage.shared.providers)})),table:make$2((function(spec,backstage){return renderTable(spec,backstage.shared.providers)})),panel:make$2((function(spec,backstage){return renderPanel(spec,backstage)}))},noFormParts={field:function(_name,spec){return spec}},interpretInForm=function(parts,spec,oldBackstage){var newBackstage=deepMerge(oldBackstage,{shared:{interpreter:function(childSpec){return interpretParts(parts,childSpec,newBackstage)}}});return interpretParts(parts,spec,newBackstage)},interpretParts=function(parts,spec,backstage){return get$e(factories,spec.type).fold((function(){return console.error('Unknown factory type "'+spec.type+'", defaulting to container: ',spec),spec}),(function(factory){return factory(parts,spec,backstage)}))},interpretWithoutForm=function(spec,backstage){var parts;return interpretParts(noFormParts,spec,backstage)},bubbleAlignments$2={valignCentre:[],alignCentre:[],alignLeft:[],alignRight:[],right:[],left:[],bottom:[],top:[]},getInlineDialogAnchor=function(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var bubbleSize=12,overrides={maxHeightFunction:expandable$1()},editableAreaAnchor=function(){return{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),bubble:nu$5(12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[northeast]},onLtr:function(){return[northwest]}},overrides:overrides}},standardAnchor=function(){return{type:"hotspot",hotspot:lazyAnchorbar(),bubble:nu$5(-12,12,bubbleAlignments$2),layouts:{onRtl:function(){return[southeast$2]},onLtr:function(){return[southwest$2]}},overrides:overrides}};return function(){return lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor()}},getBannerAnchor=function(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor){var editableAreaAnchor=function(){return{type:"node",root:getContentContainer(contentAreaElement()),node:Optional.from(contentAreaElement()),layouts:{onRtl:function(){return[north]},onLtr:function(){return[north]}}}},standardAnchor=function(){return{type:"hotspot",hotspot:lazyAnchorbar(),layouts:{onRtl:function(){return[south$2]},onLtr:function(){return[south$2]}}}};return function(){return lazyUseEditableAreaAnchor()?editableAreaAnchor():standardAnchor()}},getCursorAnchor=function(editor,bodyElement){return function(){return{type:"selection",root:bodyElement(),getSelection:function(){var rng=editor.selection.getRng();return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer),rng.startOffset,SugarElement.fromDom(rng.endContainer),rng.endOffset))}}}},getNodeAnchor$1=function(bodyElement){return function(element){return{type:"node",root:bodyElement(),node:element}}},getAnchors=function(editor,lazyAnchorbar,isToolbarTop){var useFixedToolbarContainer=useFixedContainer(editor),bodyElement=function(){return SugarElement.fromDom(editor.getBody())},contentAreaElement=function(){return SugarElement.fromDom(editor.getContentAreaContainer())},lazyUseEditableAreaAnchor=function(){return useFixedToolbarContainer||!isToolbarTop()};return{inlineDialog:getInlineDialogAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),banner:getBannerAnchor(contentAreaElement,lazyAnchorbar,lazyUseEditableAreaAnchor),cursor:getCursorAnchor(editor,bodyElement),node:getNodeAnchor$1(bodyElement)}},colorPicker=function(editor){return function(callback,value){var dialog;colorPickerDialog(editor)(callback,value)}},hasCustomColors=function(editor){return function(){return hasCustomColors$1(editor)}},getColors=function(editor){return function(){return getColors$2(editor)}},getColorCols=function(editor){return function(){return getColorCols$1(editor)}},ColorInputBackstage=function(editor){return{colorPicker:colorPicker(editor),hasCustomColors:hasCustomColors(editor),getColors:getColors(editor),getColorCols:getColorCols(editor)}},isDraggableModal=function(editor){return function(){return isDraggableModal$1(editor)}},DialogBackstage=function(editor){return{isDraggableModal:isDraggableModal(editor)}},HeaderBackstage=function(editor){var mode=Cell(isToolbarLocationBottom(editor)?"bottom":"top");return{isPositionedAtTop:function(){return"top"===mode.get()},getDockingMode:mode.get,setDockingMode:mode.set}},defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",format:"alignjustify"}]}],isNestedFormat=function(format){return has$2(format,"items")},isBlockFormat=function(format){return has$2(format,"block")},isInlineFormat=function(format){return has$2(format,"inline")},isSelectorFormat=function(format){return has$2(format,"selector")},mapFormats=function(userFormats){return foldl(userFormats,(function(acc,fmt){if(isNestedFormat(fmt)){var result=mapFormats(fmt.items);return{customFormats:acc.customFormats.concat(result.customFormats),formats:acc.formats.concat([{title:fmt.title,items:result.formats}])}}if(isInlineFormat(fmt)||isBlockFormat(fmt)||isSelectorFormat(fmt)){var formatName,formatNameWithPrefix="custom-"+(isString(fmt.name)?fmt.name:fmt.title.toLowerCase());return{customFormats:acc.customFormats.concat([{name:formatNameWithPrefix,format:fmt}]),formats:acc.formats.concat([{title:fmt.title,format:formatNameWithPrefix,icon:fmt.icon}])}}return __assign(__assign({},acc),{formats:acc.formats.concat(fmt)})}),{customFormats:[],formats:[]})},registerCustomFormats=function(editor,userFormats){var result=mapFormats(userFormats),registerFormats=function(customFormats){each$1(customFormats,(function(fmt){editor.formatter.has(fmt.name)||editor.formatter.register(fmt.name,fmt.format)}))};return editor.formatter?registerFormats(result.customFormats):editor.on("init",(function(){registerFormats(result.customFormats)})),result.formats},getStyleFormats=function(editor){return getUserStyleFormats(editor).map((function(userFormats){var registeredUserFormats=registerCustomFormats(editor,userFormats);return isMergeStyleFormats(editor)?defaultStyleFormats.concat(registeredUserFormats):registeredUserFormats})).getOr(defaultStyleFormats)},processBasic=function(item,isSelectedFor,getPreviewFor){var formatterSpec={type:"formatter",isSelected:isSelectedFor(item.format),getStylePreview:getPreviewFor(item.format)};return deepMerge(item,formatterSpec)},register$8=function(editor,formats,isSelectedFor,getPreviewFor){var enrichSupported=function(item){return processBasic(item,isSelectedFor,getPreviewFor)},enrichMenu=function(item){var submenuSpec;return deepMerge(item,{type:"submenu"})},enrichCustom=function(item){var formatName=isString(item.name)?item.name:generate$6(item.title),formatNameWithPrefix="custom-"+formatName,customSpec={type:"formatter",format:formatNameWithPrefix,isSelected:isSelectedFor(formatNameWithPrefix),getStylePreview:getPreviewFor(formatNameWithPrefix)},newItem=deepMerge(item,customSpec);return editor.formatter.register(formatName,newItem),newItem},doEnrich=function(items){return map$2(items,(function(item){var keys$1=keys(item);if(hasNonNullableKey(item,"items")){var newItems=doEnrich(item.items);return deepMerge(enrichMenu(item),{getStyleItems:constant$1(newItems)})}return hasNonNullableKey(item,"format")?enrichSupported(item):1===keys$1.length&&contains$2(keys$1,"title")?deepMerge(item,{type:"separator"}):enrichCustom(item)}))};return doEnrich(formats)},init$8=function(editor){var isSelectedFor=function(format){return function(){return editor.formatter.match(format)}},getPreviewFor=function(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}},flatten=function(fmt){var subs=fmt.items;return void 0!==subs&&subs.length>0?bind$3(subs,flatten):[fmt.format]},settingsFormats=Cell([]),settingsFlattenedFormats=Cell([]),eventsFormats=Cell([]),eventsFlattenedFormats=Cell([]),replaceSettings=Cell(!1),getData,getFlattenedKeys;return editor.on("PreInit",(function(_e){var formats=getStyleFormats(editor),enriched=register$8(editor,formats,isSelectedFor,getPreviewFor);settingsFormats.set(enriched),settingsFlattenedFormats.set(bind$3(enriched,flatten))})),editor.on("addStyleModifications",(function(e){var modifications=register$8(editor,e.items,isSelectedFor,getPreviewFor);eventsFormats.set(modifications),replaceSettings.set(e.replace),eventsFlattenedFormats.set(bind$3(modifications,flatten))})),{getData:function(){var fromSettings=replaceSettings.get()?[]:settingsFormats.get(),fromEvents=eventsFormats.get();return fromSettings.concat(fromEvents)},getFlattenedKeys:function(){var fromSettings=replaceSettings.get()?[]:settingsFlattenedFormats.get(),fromEvents=eventsFlattenedFormats.get();return fromSettings.concat(fromEvents)}}},isElement=function(node){return isNonNullable(node)&&1===node.nodeType},trim=global$5.trim,hasContentEditableState=function(value){return function(node){if(isElement(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}},isContentEditableTrue=hasContentEditableState("true"),isContentEditableFalse=hasContentEditableState("false"),create=function(type,title,url,level,attach){return{type:type,title:title,url:url,level:level,attach:attach}},isChildOfContentEditableTrue=function(node){for(;node=node.parentNode;){var value=node.contentEditable;if(value&&"inherit"!==value)return isContentEditableTrue(node)}return!1},select=function(selector,root){return map$2(descendants(SugarElement.fromDom(root),selector),(function(element){return element.dom}))},getElementText=function(elm){return elm.innerText||elm.textContent},getOrGenerateId=function(elm){return elm.id?elm.id:generate$6("h")},isAnchor=function(elm){return elm&&"A"===elm.nodeName&&void 0!==(elm.id||elm.name)},isValidAnchor=function(elm){return isAnchor(elm)&&isEditable(elm)},isHeader=function(elm){return elm&&/^(H[1-6])$/.test(elm.nodeName)},isEditable=function(elm){return isChildOfContentEditableTrue(elm)&&!isContentEditableFalse(elm)},isValidHeader=function(elm){return isHeader(elm)&&isEditable(elm)},getLevel=function(elm){return isHeader(elm)?parseInt(elm.nodeName.substr(1),10):0},headerTarget=function(elm){var headerId=getOrGenerateId(elm),attach=function(){elm.id=headerId};return create("header",getElementText(elm),"#"+headerId,getLevel(elm),attach)},anchorTarget=function(elm){var anchorId=elm.id||elm.name,anchorText=getElementText(elm);return create("anchor",anchorText||"#"+anchorId,"#"+anchorId,0,noop)},getHeaderTargets=function(elms){return map$2(filter$2(elms,isValidHeader),headerTarget)},getAnchorTargets=function(elms){return map$2(filter$2(elms,isValidAnchor),anchorTarget)},getTargetElements=function(elm){var elms;return select("h1,h2,h3,h4,h5,h6,a:not([href])",elm)},hasTitle=function(target){return trim(target.title).length>0},find=function(elm){var elms=getTargetElements(elm);return filter$2(getHeaderTargets(elms).concat(getAnchorTargets(elms)),hasTitle)},LinkTargets_find=find,STORAGE_KEY="tinymce-url-history",HISTORY_LENGTH=5,isHttpUrl=function(url){return isString(url)&&/^https?/.test(url)},isArrayOfUrl=function(a){return isArray(a)&&a.length<=5&&forall(a,isHttpUrl)},isRecordOfUrlArray=function(r){return isObject(r)&&find$4(r,(function(value){return!isArrayOfUrl(value)})).isNone()},getAllHistory=function(){var unparsedHistory=global$8.getItem(STORAGE_KEY),history;if(null===unparsedHistory)return{};try{history=JSON.parse(unparsedHistory)}catch(e){if(e instanceof SyntaxError)return console.log("Local storage "+STORAGE_KEY+" was not valid JSON",e),{};throw e}return isRecordOfUrlArray(history)?history:(console.log("Local storage "+STORAGE_KEY+" was not valid format",history),{})},setAllHistory=function(history){if(!isRecordOfUrlArray(history))throw new Error("Bad format for history:\n"+JSON.stringify(history));global$8.setItem(STORAGE_KEY,JSON.stringify(history))},getHistory=function(fileType){var history=getAllHistory();return get$e(history,fileType).getOr([])},addToHistory=function(url,fileType){if(isHttpUrl(url)){var history=getAllHistory(),items=get$e(history,fileType).getOr([]),itemsWithoutUrl=filter$2(items,(function(item){return item!==url}));history[fileType]=[url].concat(itemsWithoutUrl).slice(0,5),setAllHistory(history)}},isTruthy=function(value){return!!value},makeMap=function(value){return map$1(global$5.makeMap(value,/[, ]/),isTruthy)},getPicker=function(editor){return Optional.from(getFilePickerCallback(editor)).filter(isFunction)},getPickerTypes=function(editor){var optFileTypes=Optional.some(getFilePickerTypes(editor)).filter(isTruthy),optLegacyTypes=Optional.some(getFileBrowserCallbackTypes(editor)).filter(isTruthy),optTypes=optFileTypes.or(optLegacyTypes).map(makeMap);return getPicker(editor).fold(never,(function(_picker){return optTypes.fold(always,(function(types){return keys(types).length>0&&types}))}))},getPickerSetting=function(editor,filetype){var pickerTypes=getPickerTypes(editor);return isBoolean(pickerTypes)?pickerTypes?getPicker(editor):Optional.none():pickerTypes[filetype]?getPicker(editor):Optional.none()},getUrlPicker=function(editor,filetype){return getPickerSetting(editor,filetype).map((function(picker){return function(entry){return Future_nu((function(completer){var handler=function(value,meta){if(!isString(value))throw new Error("Expected value to be string");if(void 0!==meta&&!isObject(meta))throw new Error("Expected meta to be a object");var r;completer({value:value,meta:meta})},meta=__assign({filetype:filetype,fieldname:entry.fieldname},Optional.from(entry.meta).getOr({}));picker.call(editor,handler,entry.value,meta)}))}}))},getTextSetting=function(value){return Optional.from(value).filter(isString).getOrUndefined()},getLinkInformation=function(editor){return noTypeaheadUrls(editor)?Optional.none():Optional.some({targets:LinkTargets_find(editor.getBody()),anchorTop:getTextSetting(getAnchorTop(editor)),anchorBottom:getTextSetting(getAnchorBottom(editor))})},getValidationHandler=function(editor){return Optional.from(getFilePickerValidatorHandler(editor))},UrlInputBackstage=function(editor){return{getHistory:getHistory,addToHistory:addToHistory,getLinkInformation:function(){return getLinkInformation(editor)},getValidationHandler:function(){return getValidationHandler(editor)},getUrlPicker:function(filetype){return getUrlPicker(editor,filetype)}}},init$7=function(sink,editor,lazyAnchorbar){var contextMenuState=Cell(!1),toolbar=HeaderBackstage(editor),backstage={shared:{providers:{icons:function(){return editor.ui.registry.getAll().icons},menuItems:function(){return editor.ui.registry.getAll().menuItems},translate:global$e.translate,isDisabled:function(){return editor.mode.isReadOnly()||editor.ui.isDisabled()},getSetting:editor.getParam.bind(editor)},interpreter:function(s){return interpretWithoutForm(s,backstage)},anchors:getAnchors(editor,lazyAnchorbar,toolbar.isPositionedAtTop),header:toolbar,getSink:function(){return Result.value(sink)}},urlinput:UrlInputBackstage(editor),styleselect:init$8(editor),colorinput:ColorInputBackstage(editor),dialog:DialogBackstage(editor),isContextMenuOpen:function(){return contextMenuState.get()},setContextMenuState:function(state){return contextMenuState.set(state)}};return backstage},setup$b=function(editor,mothership,uiMothership){var broadcastEvent=function(name,evt){each$1([mothership,uiMothership],(function(ship){ship.broadcastEvent(name,evt)}))},broadcastOn=function(channel,message){each$1([mothership,uiMothership],(function(ship){ship.broadcastOn([channel],message)}))},fireDismissPopups=function(evt){return broadcastOn(dismissPopups(),{target:evt.target})},doc=getDocument(),onTouchstart=bind(doc,"touchstart",fireDismissPopups),onTouchmove=bind(doc,"touchmove",(function(evt){return broadcastEvent(documentTouchmove(),evt)})),onTouchend=bind(doc,"touchend",(function(evt){return broadcastEvent(documentTouchend(),evt)})),onMousedown=bind(doc,"mousedown",fireDismissPopups),onMouseup=bind(doc,"mouseup",(function(evt){0===evt.raw.button&&broadcastOn(mouseReleased(),{target:evt.target})})),onContentClick=function(raw){return broadcastOn(dismissPopups(),{target:SugarElement.fromDom(raw.target)})},onContentMouseup=function(raw){0===raw.button&&broadcastOn(mouseReleased(),{target:SugarElement.fromDom(raw.target)})},onContentMousedown=function(){each$1(editor.editorManager.get(),(function(loopEditor){editor!==loopEditor&&loopEditor.fire("DismissPopups",{relatedTarget:editor})}))},onWindowScroll=function(evt){return broadcastEvent(windowScroll(),fromRawEvent(evt))},onWindowResize=function(evt){broadcastOn(repositionPopups(),{}),broadcastEvent(windowResize(),fromRawEvent(evt))},onEditorResize=function(){return broadcastOn(repositionPopups(),{})},onEditorProgress=function(evt){evt.state&&broadcastOn(dismissPopups(),{target:SugarElement.fromDom(editor.getContainer())})},onDismissPopups=function(event){broadcastOn(dismissPopups(),{target:SugarElement.fromDom(event.relatedTarget.getContainer())})};editor.on("PostRender",(function(){editor.on("click",onContentClick),editor.on("tap",onContentClick),editor.on("mouseup",onContentMouseup),editor.on("mousedown",onContentMousedown),editor.on("ScrollWindow",onWindowScroll),editor.on("ResizeWindow",onWindowResize),editor.on("ResizeEditor",onEditorResize),editor.on("AfterProgressState",onEditorProgress),editor.on("DismissPopups",onDismissPopups)})),editor.on("remove",(function(){editor.off("click",onContentClick),editor.off("tap",onContentClick),editor.off("mouseup",onContentMouseup),editor.off("mousedown",onContentMousedown),editor.off("ScrollWindow",onWindowScroll),editor.off("ResizeWindow",onWindowResize),editor.off("ResizeEditor",onEditorResize),editor.off("AfterProgressState",onEditorProgress),editor.off("DismissPopups",onDismissPopups),onMousedown.unbind(),onTouchstart.unbind(),onTouchmove.unbind(),onTouchend.unbind(),onMouseup.unbind()})),editor.on("detach",(function(){detachSystem(mothership),detachSystem(uiMothership),mothership.destroy(),uiMothership.destroy()}))},parts$a=AlloyParts,partType=PartType,schema$f=constant$1([defaulted("shell",!1),required$1("makeItem"),defaulted("setupItem",noop),SketchBehaviours_field("listBehaviours",[Replacing])]),customListDetail=function(){return{behaviours:derive$1([Replacing.config({})])}},itemsPart=optional({name:"items",overrides:customListDetail}),parts$9=constant$1([itemsPart]),name=constant$1("CustomList"),factory$d=function(detail,components,_spec,_external){var setItems=function(list,items){getListContainer(list).fold((function(){throw console.error("Custom List was defined to not be a shell, but no item container was specified in components"),new Error("Custom List was defined to not be a shell, but no item container was specified in components")}),(function(container){var itemComps=Replacing.contents(container),numListsRequired=items.length,numListsToAdd=numListsRequired-itemComps.length,itemsToAdd=numListsToAdd>0?range$2(numListsToAdd,(function(){return detail.makeItem()})):[],itemsToRemove=itemComps.slice(numListsRequired);each$1(itemsToRemove,(function(item){return Replacing.remove(container,item)})),each$1(itemsToAdd,(function(item){return Replacing.append(container,item)}));var builtLists=Replacing.contents(container);each$1(builtLists,(function(item,i){detail.setupItem(list,item,items[i],i)}))}))},extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components},getListContainer=function(component){return detail.shell?Optional.some(component):getPart(component,detail,"items")};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.listBehaviours,extra.behaviours),apis:{setItems:setItems}}},CustomList=composite({name:name(),configFields:schema$f(),partFields:parts$9(),factory:factory$d,apis:{setItems:function(apis,list,items){apis.setItems(list,items)}}}),schema$e=constant$1([required$1("dom"),defaulted("shell",!0),field("toolbarBehaviours",[Replacing])]),enhanceGroups=function(){return{behaviours:derive$1([Replacing.config({})])}},parts$8=constant$1([optional({name:"groups",overrides:enhanceGroups})]),factory$c=function(detail,components,_spec,_externals){var setGroups=function(toolbar,groups){getGroupContainer(toolbar).fold((function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")}),(function(container){Replacing.set(container,groups)}))},getGroupContainer=function(component){return detail.shell?Optional.some(component):getPart(component,detail,"groups")},extra=detail.shell?{behaviours:[Replacing.config({})],components:[]}:{behaviours:[],components:components};return{uid:detail.uid,dom:detail.dom,components:extra.components,behaviours:augment(detail.toolbarBehaviours,extra.behaviours),apis:{setGroups:setGroups},domModification:{attributes:{role:"group"}}}},Toolbar=composite({name:"Toolbar",configFields:schema$e(),partFields:parts$8(),factory:factory$c,apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)}}}),setup$a=noop,isDocked$2=never,getBehaviours$1=constant$1([]),StaticHeader=Object.freeze({__proto__:null,setup:setup$a,isDocked:isDocked$2,getBehaviours:getBehaviours$1}),getOffsetParent=function(element){var isFixed,offsetParent$1;return(is$1(getRaw(element,"position"),"fixed")?Optional.none():offsetParent(element)).orThunk((function(){var marker=SugarElement.fromTag("span");return parent(element).bind((function(parent){append$2(parent,marker);var offsetParent$1=offsetParent(marker);return remove$5(marker),offsetParent$1}))}))},getOrigin=function(element){return getOffsetParent(element).map(absolute$3).getOrThunk((function(){return SugarPosition(0,0)}))},morphAdt=Adt_generate([{static:[]},{absolute:["positionCss"]},{fixed:["positionCss"]}]),appear=function(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeOutClass),add$2(elem,contextualInfo.fadeInClass),contextualInfo.onShow(component)},disappear=function(component,contextualInfo){var elem=component.element;add$2(elem,contextualInfo.transitionClass),remove$2(elem,contextualInfo.fadeInClass),add$2(elem,contextualInfo.fadeOutClass),contextualInfo.onHide(component)},isPartiallyVisible=function(box,viewport){return box.y<viewport.bottom&&box.bottom>viewport.y},isTopCompletelyVisible=function(box,viewport){return box.y>=viewport.y},isBottomCompletelyVisible=function(box,viewport){return box.bottom<=viewport.bottom},isVisibleForModes=function(modes,box,viewport){return forall(modes,(function(mode){switch(mode){case"bottom":return isBottomCompletelyVisible(box,viewport);case"top":return isTopCompletelyVisible(box,viewport)}}))},getPrior=function(elem,state){return state.getInitialPos().map((function(pos){return bounds(pos.bounds.x,pos.bounds.y,get$a(elem),get$b(elem))}))},storePrior=function(elem,box,state){state.setInitialPos({style:getAllRaw(elem),position:get$c(elem,"position")||"static",bounds:box})},revertToOriginal=function(elem,box,state){return state.getInitialPos().bind((function(position){switch(state.clearInitialPos(),position.position){case"static":return Optional.some(morphAdt.static());case"absolute":var offsetBox_1=getOffsetParent(elem).map(box$1).getOrThunk((function(){return box$1(body())}));return Optional.some(morphAdt.absolute(NuPositionCss("absolute",get$e(position.style,"left").map((function(_left){return box.x-offsetBox_1.x})),get$e(position.style,"top").map((function(_top){return box.y-offsetBox_1.y})),get$e(position.style,"right").map((function(_right){return offsetBox_1.right-box.right})),get$e(position.style,"bottom").map((function(_bottom){return offsetBox_1.bottom-box.bottom})))));default:return Optional.none()}}))},morphToOriginal=function(elem,viewport,state){return getPrior(elem,state).filter((function(box){return isVisibleForModes(state.getModes(),box,viewport)})).bind((function(box){return revertToOriginal(elem,box,state)}))},morphToFixed=function(elem,viewport,state){var box=box$1(elem);if(isVisibleForModes(state.getModes(),box,viewport))return Optional.none();storePrior(elem,box,state);var winBox=win(),left=box.x-winBox.x,top_1=viewport.y-winBox.y,bottom=winBox.bottom-viewport.bottom,isTop=box.y<=viewport.y;return Optional.some(morphAdt.fixed(NuPositionCss("fixed",Optional.some(left),isTop?Optional.some(top_1):Optional.none(),Optional.none(),isTop?Optional.none():Optional.some(bottom))))},getMorph=function(component,viewport,state){var elem=component.element,isDocked;return is$1(getRaw(elem,"position"),"fixed")?morphToOriginal(elem,viewport,state):morphToFixed(elem,viewport,state)},getMorphToOriginal=function(component,state){var elem=component.element;return getPrior(elem,state).bind((function(box){return revertToOriginal(elem,box,state)}))},morphToStatic=function(component,config,state){state.setDocked(!1),each$1(["left","right","top","bottom","position"],(function(prop){return remove$6(component.element,prop)})),config.onUndocked(component)},morphToCoord=function(component,config,state,position){var isDocked="fixed"===position.position,method;state.setDocked(isDocked),applyPositionCss(component.element,position),(isDocked?config.onDocked:config.onUndocked)(component)},updateVisibility=function(component,config,state,viewport,morphToDocked){void 0===morphToDocked&&(morphToDocked=!1),config.contextual.each((function(contextInfo){contextInfo.lazyContext(component).each((function(box){var isVisible=isPartiallyVisible(box,viewport),method;isVisible!==state.isVisible()&&(state.setVisible(isVisible),morphToDocked&&!isVisible?(add$1(component.element,[contextInfo.fadeOutClass]),contextInfo.onHide(component)):(isVisible?appear:disappear)(component,contextInfo))}))}))},refreshInternal=function(component,config,state){var viewport=config.lazyViewport(component),isDocked;state.isDocked()&&updateVisibility(component,config,state,viewport),getMorph(component,viewport,state).each((function(morph){morph.fold((function(){return morphToStatic(component,config,state)}),(function(position){return morphToCoord(component,config,state,position)}),(function(position){updateVisibility(component,config,state,viewport,!0),morphToCoord(component,config,state,position)}))}))},resetInternal=function(component,config,state){var elem=component.element;state.setDocked(!1),getMorphToOriginal(component,state).each((function(morph){morph.fold((function(){return morphToStatic(component,config,state)}),(function(position){return morphToCoord(component,config,state,position)}),noop)})),state.setVisible(!0),config.contextual.each((function(contextInfo){remove$1(elem,[contextInfo.fadeInClass,contextInfo.fadeOutClass,contextInfo.transitionClass]),contextInfo.onShow(component)})),refresh$4(component,config,state)},refresh$4=function(component,config,state){component.getSystem().isConnected()&&refreshInternal(component,config,state)},reset=function(component,config,state){state.isDocked()&&resetInternal(component,config,state)},isDocked$1=function(component,config,state){return state.isDocked()},setModes=function(component,config,state,modes){return state.setModes(modes)},getModes=function(component,config,state){return state.getModes()},DockingApis=Object.freeze({__proto__:null,refresh:refresh$4,reset:reset,isDocked:isDocked$1,getModes:getModes,setModes:setModes}),events$5=function(dockInfo,dockState){return derive$2([runOnSource(transitionend(),(function(component,simulatedEvent){dockInfo.contextual.each((function(contextInfo){var notify;has(component.element,contextInfo.transitionClass)&&(remove$1(component.element,[contextInfo.transitionClass,contextInfo.fadeInClass]),(dockState.isVisible()?contextInfo.onShown:contextInfo.onHidden)(component));simulatedEvent.stop()}))})),run$1(windowScroll(),(function(component,_){refresh$4(component,dockInfo,dockState)})),run$1(windowResize(),(function(component,_){reset(component,dockInfo,dockState)}))])},ActiveDocking=Object.freeze({__proto__:null,events:events$5}),DockingSchema=[optionObjOf("contextual",[requiredString("fadeInClass"),requiredString("fadeOutClass"),requiredString("transitionClass"),requiredFunction("lazyContext"),onHandler("onShow"),onHandler("onShown"),onHandler("onHide"),onHandler("onHidden")]),defaultedFunction("lazyViewport",win),defaultedArrayOf("modes",["top","bottom"],string),onHandler("onDocked"),onHandler("onUndocked")],init$6=function(spec){var docked=Cell(!1),visible=Cell(!0),initialBounds=value$1(),modes=Cell(spec.modes),readState=function(){return"docked:  "+docked.get()+", visible: "+visible.get()+", modes: "+modes.get().join(",")};return nu$8({isDocked:docked.get,setDocked:docked.set,getInitialPos:initialBounds.get,setInitialPos:initialBounds.set,clearInitialPos:initialBounds.clear,isVisible:visible.get,setVisible:visible.set,getModes:modes.get,setModes:modes.set,readState:readState})},DockingState,Docking=create$7({fields:DockingSchema,name:"docking",active:ActiveDocking,apis:DockingApis,state:Object.freeze({__proto__:null,init:init$6})}),toolbarHeightChange=constant$1(generate$6("toolbar-height-change")),visibility={fadeInClass:"tox-editor-dock-fadein",fadeOutClass:"tox-editor-dock-fadeout",transitionClass:"tox-editor-dock-transition"},editorStickyOnClass="tox-tinymce--toolbar-sticky-on",editorStickyOffClass="tox-tinymce--toolbar-sticky-off",scrollFromBehindHeader=function(e,containerHeader){var doc=owner$4(containerHeader),viewHeight=doc.dom.defaultView.innerHeight,scrollPos=get$9(doc),markerElement=SugarElement.fromDom(e.elm),markerPos=absolute$2(markerElement),markerHeight=get$b(markerElement),markerTop=markerPos.y,markerBottom=markerTop+markerHeight,editorHeaderPos=absolute$3(containerHeader),editorHeaderHeight=get$b(containerHeader),editorHeaderTop=editorHeaderPos.top,editorHeaderBottom=editorHeaderTop+editorHeaderHeight,editorHeaderDockedAtTop=Math.abs(editorHeaderTop-scrollPos.top)<2,editorHeaderDockedAtBottom=Math.abs(editorHeaderBottom-(scrollPos.top+viewHeight))<2;if(editorHeaderDockedAtTop&&markerTop<editorHeaderBottom)to(scrollPos.left,markerTop-editorHeaderHeight,doc);else if(editorHeaderDockedAtBottom&&markerBottom>editorHeaderTop){var y=markerTop-viewHeight+markerHeight+editorHeaderHeight;to(scrollPos.left,y,doc)}},isDockedMode=function(header,mode){return contains$2(Docking.getModes(header),mode)},updateIframeContentFlow=function(header){var getOccupiedHeight=function(elm){return getOuter$2(elm)+(parseInt(get$c(elm,"margin-top"),10)||0)+(parseInt(get$c(elm,"margin-bottom"),10)||0)},elm=header.element;parent(elm).each((function(parentElem){var padding="padding-"+Docking.getModes(header)[0];if(Docking.isDocked(header)){var parentWidth=get$a(parentElem);set$7(elm,"width",parentWidth+"px"),set$7(parentElem,padding,getOccupiedHeight(elm)+"px")}else remove$6(elm,"width"),remove$6(parentElem,padding)}))},updateSinkVisibility=function(sinkElem,visible){visible?(remove$2(sinkElem,visibility.fadeOutClass),add$1(sinkElem,[visibility.transitionClass,visibility.fadeInClass])):(remove$2(sinkElem,visibility.fadeInClass),add$1(sinkElem,[visibility.fadeOutClass,visibility.transitionClass]))},updateEditorClasses=function(editor,docked){var editorContainer=SugarElement.fromDom(editor.getContainer());docked?(add$2(editorContainer,editorStickyOnClass),remove$2(editorContainer,editorStickyOffClass)):(add$2(editorContainer,editorStickyOffClass),remove$2(editorContainer,editorStickyOnClass))},restoreFocus=function(headerElem,focusedElem){var ownerDoc=owner$4(focusedElem);active(ownerDoc).filter((function(activeElm){return!eq(focusedElem,activeElm)})).filter((function(activeElm){return eq(activeElm,SugarElement.fromDom(ownerDoc.dom.body))||contains(headerElem,activeElm)})).each((function(){return focus$3(focusedElem)}))},findFocusedElem=function(rootElm,lazySink){return search(rootElm).orThunk((function(){return lazySink().toOptional().bind((function(sink){return search(sink.element)}))}))},setup$9=function(editor,sharedBackstage,lazyHeader){editor.inline||(sharedBackstage.header.isPositionedAtTop()||editor.on("ResizeEditor",(function(){lazyHeader().each(Docking.reset)})),editor.on("ResizeWindow ResizeEditor",(function(){lazyHeader().each(updateIframeContentFlow)})),editor.on("SkinLoaded",(function(){lazyHeader().each((function(comp){Docking.isDocked(comp)?Docking.reset(comp):Docking.refresh(comp)}))})),editor.on("FullscreenStateChanged",(function(){lazyHeader().each(Docking.reset)}))),editor.on("AfterScrollIntoView",(function(e){lazyHeader().each((function(header){Docking.refresh(header);var headerElem=header.element;isVisible(headerElem)&&scrollFromBehindHeader(e,headerElem)}))})),editor.on("PostRender",(function(){updateEditorClasses(editor,!1)}))},isDocked=function(lazyHeader){return lazyHeader().map(Docking.isDocked).getOr(!1)},getIframeBehaviours=function(){var _a;return[Receiving.config({channels:(_a={},_a[toolbarHeightChange()]={onReceive:updateIframeContentFlow},_a)})]},getBehaviours=function(editor,sharedBackstage){var focusedElm=value$1(),lazySink=sharedBackstage.getSink,runOnSinkElement=function(f){lazySink().each((function(sink){return f(sink.element)}))},onDockingSwitch=function(comp){editor.inline||updateIframeContentFlow(comp),updateEditorClasses(editor,Docking.isDocked(comp)),comp.getSystem().broadcastOn([repositionPopups()],{}),lazySink().each((function(sink){return sink.getSystem().broadcastOn([repositionPopups()],{})}))},additionalBehaviours=editor.inline?[]:getIframeBehaviours();return __spreadArray([Focusing.config({}),Docking.config({contextual:__assign({lazyContext:function(comp){var headerHeight=getOuter$2(comp.element),container=editor.inline?editor.getContentAreaContainer():editor.getContainer(),box=box$1(SugarElement.fromDom(container)),boxHeight=box.height-headerHeight,topBound=box.y+(isDockedMode(comp,"top")?0:headerHeight);return Optional.some(bounds(box.x,topBound,box.width,boxHeight))},onShow:function(){runOnSinkElement((function(elem){return updateSinkVisibility(elem,!0)}))},onShown:function(comp){runOnSinkElement((function(elem){return remove$1(elem,[visibility.transitionClass,visibility.fadeInClass])})),focusedElm.get().each((function(elem){restoreFocus(comp.element,elem),focusedElm.clear()}))},onHide:function(comp){findFocusedElem(comp.element,lazySink).fold(focusedElm.clear,focusedElm.set),runOnSinkElement((function(elem){return updateSinkVisibility(elem,!1)}))},onHidden:function(){runOnSinkElement((function(elem){return remove$1(elem,[visibility.transitionClass])}))}},visibility),lazyViewport:function(comp){var win$1=win(),offset=getStickyToolbarOffset(editor),top=win$1.y+(isDockedMode(comp,"top")?offset:0),height=win$1.height-(isDockedMode(comp,"bottom")?offset:0);return bounds(win$1.x,top,win$1.width,height)},modes:[sharedBackstage.header.getDockingMode()],onDocked:onDockingSwitch,onUndocked:onDockingSwitch})],additionalBehaviours,!0)},StickyHeader=Object.freeze({__proto__:null,setup:setup$9,isDocked:isDocked,getBehaviours:getBehaviours}),renderHeader=function(spec){var editor=spec.editor,getBehaviours$2=spec.sticky?getBehaviours:getBehaviours$1;return{uid:spec.uid,dom:spec.dom,components:spec.components,behaviours:derive$1(getBehaviours$2(editor,spec.sharedBackstage))}},groupToolbarButtonSchema=objOf([requiredString("type"),requiredOf("items",oneOf([arrOfObj([requiredString("name"),requiredArrayOf("items",string)]),string]))].concat(baseToolbarButtonFields)),createGroupToolbarButton=function(spec){return asRaw("GroupToolbarButton",groupToolbarButtonSchema,spec)},baseMenuButtonFields=[optionString("text"),optionString("tooltip"),optionString("icon"),requiredFunction("fetch"),defaultedFunction("onSetup",(function(){return noop}))],MenuButtonSchema=objOf(__spreadArray([requiredString("type")],baseMenuButtonFields,!0)),createMenuButton=function(spec){return asRaw("menubutton",MenuButtonSchema,spec)},splitButtonSchema=objOf([requiredString("type"),optionString("tooltip"),optionString("icon"),optionString("text"),optionFunction("select"),requiredFunction("fetch"),defaultedFunction("onSetup",(function(){return noop})),defaultedStringEnum("presets","normal",["normal","color","listpreview"]),defaulted("columns",1),requiredFunction("onAction"),requiredFunction("onItemAction")]),createSplitButton=function(spec){return asRaw("SplitButton",splitButtonSchema,spec)},factory$b,SilverMenubar=single({factory:function(detail,spec){var setMenus=function(comp,menus){var newMenus=map$2(menus,(function(m){var buttonSpec={type:"menubutton",text:m.text,fetch:function(callback){callback(m.getItems())}},internal=createMenuButton(buttonSpec).mapError((function(errInfo){return formatError(errInfo)})).getOrDie();return renderMenuButton(internal,"tox-mbtn",spec.backstage,Optional.some("menuitem"))}));Replacing.set(comp,newMenus)},apis={focus:Keying.focusIn,setMenus:setMenus};return{uid:detail.uid,dom:detail.dom,components:[],behaviours:derive$1([Replacing.config({}),config("menubar-events",[runOnAttached((function(component){detail.onSetup(component)})),run$1(mouseover(),(function(comp,se){descendant(comp.element,".tox-mbtn--active").each((function(activeButton){closest$1(se.event.target,".tox-mbtn").each((function(hoveredButton){eq(activeButton,hoveredButton)||comp.getSystem().getByDom(activeButton).each((function(activeComp){comp.getSystem().getByDom(hoveredButton).each((function(hoveredComp){Dropdown.expand(hoveredComp),Dropdown.close(activeComp),Focusing.focus(hoveredComp)}))}))}))}))})),run$1(focusShifted(),(function(comp,se){se.event.prevFocus.bind((function(prev){return comp.getSystem().getByDom(prev).toOptional()})).each((function(prev){se.event.newFocus.bind((function(nu){return comp.getSystem().getByDom(nu).toOptional()})).each((function(nu){Dropdown.isOpen(prev)&&(Dropdown.expand(nu),Dropdown.close(prev))}))}))}))]),Keying.config({mode:"flow",selector:".tox-mbtn",onEscape:function(comp){return detail.onEscape(comp),Optional.some(!0)}}),Tabstopping.config({})]),apis:apis,domModification:{attributes:{role:"menubar"}}}},name:"silver.Menubar",configFields:[required$1("dom"),required$1("uid"),required$1("onEscape"),required$1("backstage"),defaulted("onSetup",noop)],apis:{focus:function(apis,comp){apis.focus(comp)},setMenus:function(apis,comp,menus){apis.setMenus(comp,menus)}}}),getAnimationRoot=function(component,slideConfig){return slideConfig.getAnimationRoot.fold((function(){return component.element}),(function(get){return get(component)}))},getDimensionProperty=function(slideConfig){return slideConfig.dimension.property},getDimension=function(slideConfig,elem){return slideConfig.dimension.getDimension(elem)},disableTransitions=function(component,slideConfig){var root=getAnimationRoot(component,slideConfig);remove$1(root,[slideConfig.shrinkingClass,slideConfig.growingClass])},setShrunk=function(component,slideConfig){remove$2(component.element,slideConfig.openClass),add$2(component.element,slideConfig.closedClass),set$7(component.element,getDimensionProperty(slideConfig),"0px"),reflow(component.element)},setGrown=function(component,slideConfig){remove$2(component.element,slideConfig.closedClass),add$2(component.element,slideConfig.openClass),remove$6(component.element,getDimensionProperty(slideConfig))},doImmediateShrink=function(component,slideConfig,slideState,_calculatedSize){slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),getDimension(slideConfig,component.element)),reflow(component.element),disableTransitions(component,slideConfig),setShrunk(component,slideConfig),slideConfig.onStartShrink(component),slideConfig.onShrunk(component)},doStartShrink=function(component,slideConfig,slideState,calculatedSize){var size=calculatedSize.getOrThunk((function(){return getDimension(slideConfig,component.element)}));slideState.setCollapsed(),set$7(component.element,getDimensionProperty(slideConfig),size),reflow(component.element);var root=getAnimationRoot(component,slideConfig);remove$2(root,slideConfig.growingClass),add$2(root,slideConfig.shrinkingClass),setShrunk(component,slideConfig),slideConfig.onStartShrink(component)},doStartSmartShrink=function(component,slideConfig,slideState){var size=getDimension(slideConfig,component.element),shrinker;("0px"===size?doImmediateShrink:doStartShrink)(component,slideConfig,slideState,Optional.some(size))},doStartGrow=function(component,slideConfig,slideState){var root=getAnimationRoot(component,slideConfig),wasShrinking=has(root,slideConfig.shrinkingClass),beforeSize=getDimension(slideConfig,component.element);setGrown(component,slideConfig);var fullSize=getDimension(slideConfig,component.element),startPartialGrow,startCompleteGrow,setStartSize;(wasShrinking?function(){set$7(component.element,getDimensionProperty(slideConfig),beforeSize),reflow(component.element)}:function(){setShrunk(component,slideConfig)})(),remove$2(root,slideConfig.shrinkingClass),add$2(root,slideConfig.growingClass),setGrown(component,slideConfig),set$7(component.element,getDimensionProperty(slideConfig),fullSize),slideState.setExpanded(),slideConfig.onStartGrow(component)},refresh$3=function(component,slideConfig,slideState){if(slideState.isExpanded()){remove$6(component.element,getDimensionProperty(slideConfig));var fullSize=getDimension(slideConfig,component.element);set$7(component.element,getDimensionProperty(slideConfig),fullSize)}},grow=function(component,slideConfig,slideState){slideState.isExpanded()||doStartGrow(component,slideConfig,slideState)},shrink=function(component,slideConfig,slideState){slideState.isExpanded()&&doStartSmartShrink(component,slideConfig,slideState)},immediateShrink=function(component,slideConfig,slideState){slideState.isExpanded()&&doImmediateShrink(component,slideConfig,slideState)},hasGrown=function(component,slideConfig,slideState){return slideState.isExpanded()},hasShrunk=function(component,slideConfig,slideState){return slideState.isCollapsed()},isGrowing=function(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return!0===has(root,slideConfig.growingClass)},isShrinking=function(component,slideConfig,_slideState){var root=getAnimationRoot(component,slideConfig);return!0===has(root,slideConfig.shrinkingClass)},isTransitioning=function(component,slideConfig,slideState){return isGrowing(component,slideConfig)||isShrinking(component,slideConfig)},toggleGrow=function(component,slideConfig,slideState){var f;(slideState.isExpanded()?doStartSmartShrink:doStartGrow)(component,slideConfig,slideState)},SlidingApis=Object.freeze({__proto__:null,refresh:refresh$3,grow:grow,shrink:shrink,immediateShrink:immediateShrink,hasGrown:hasGrown,hasShrunk:hasShrunk,isGrowing:isGrowing,isShrinking:isShrinking,isTransitioning:isTransitioning,toggleGrow:toggleGrow,disableTransitions:disableTransitions}),exhibit=function(base,slideConfig,_slideState){var expanded=slideConfig.expanded;return nu$7(expanded?{classes:[slideConfig.openClass],styles:{}}:{classes:[slideConfig.closedClass],styles:wrap$1(slideConfig.dimension.property,"0px")})},events$4=function(slideConfig,slideState){return derive$2([runOnSource(transitionend(),(function(component,simulatedEvent){var raw,notify;simulatedEvent.event.raw.propertyName===slideConfig.dimension.property&&(disableTransitions(component,slideConfig),slideState.isExpanded()&&remove$6(component.element,slideConfig.dimension.property),(slideState.isExpanded()?slideConfig.onGrown:slideConfig.onShrunk)(component))}))])},ActiveSliding=Object.freeze({__proto__:null,exhibit:exhibit,events:events$4}),SlidingSchema=[required$1("closedClass"),required$1("openClass"),required$1("shrinkingClass"),required$1("growingClass"),option("getAnimationRoot"),onHandler("onShrunk"),onHandler("onStartShrink"),onHandler("onGrown"),onHandler("onStartGrow"),defaulted("expanded",!1),requiredOf("dimension",choose$1("property",{width:[output$1("property","width"),output$1("getDimension",(function(elem){return get$a(elem)+"px"}))],height:[output$1("property","height"),output$1("getDimension",(function(elem){return get$b(elem)+"px"}))]}))],init$5=function(spec){var state=Cell(spec.expanded),readState=function(){return"expanded: "+state.get()};return nu$8({isExpanded:function(){return!0===state.get()},isCollapsed:function(){return!1===state.get()},setCollapsed:curry(state.set,!1),setExpanded:curry(state.set,!0),readState:readState})},SlidingState,Sliding=create$7({fields:SlidingSchema,name:"sliding",active:ActiveSliding,apis:SlidingApis,state:Object.freeze({__proto__:null,init:init$5})}),owner="container",schema$d=[field("slotBehaviours",[])],getPartName=function(name){return"<alloy.field."+name+">"},sketch=function(sSpec){var parts=function(){var record=[],slot;return{slot:function(name,config){return record.push(name),generateOne$1(owner,getPartName(name),config)},record:constant$1(record)}}(),spec=sSpec(parts),partNames=parts.record(),fieldParts=map$2(partNames,(function(n){return required({name:n,pname:getPartName(n)})}));return composite$1(owner,schema$d,fieldParts,make$1,spec)},make$1=function(detail,components){var getSlotNames=function(_){return getAllPartNames(detail)},getSlot=function(container,key){return getPart(container,detail,key)},onSlot=function(f,def){return function(container,key){return getPart(container,detail,key).map((function(slot){return f(slot,key)})).getOr(def)}},onSlots=function(f){return function(container,keys){each$1(keys,(function(key){return f(container,key)}))}},doShowing=function(comp,_key){return"true"!==get$d(comp.element,"aria-hidden")},doShow=function(comp,key){if(!doShowing(comp)){var element=comp.element;remove$6(element,"display"),remove$7(element,"aria-hidden"),emitWith(comp,slotVisibility(),{name:key,visible:!0})}},doHide=function(comp,key){if(doShowing(comp)){var element=comp.element;set$7(element,"display","none"),set$8(element,"aria-hidden","true"),emitWith(comp,slotVisibility(),{name:key,visible:!1})}},isShowing=onSlot(doShowing,!1),hideSlot=onSlot(doHide),hideSlots=onSlots(hideSlot),hideAllSlots=function(container){return hideSlots(container,getSlotNames())},showSlot=onSlot(doShow),apis={getSlotNames:getSlotNames,getSlot:getSlot,isShowing:isShowing,hideSlot:hideSlot,hideAllSlots:hideAllSlots,showSlot:showSlot};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.slotBehaviours),apis:apis}},slotApis=map$1({getSlotNames:function(apis,c){return apis.getSlotNames(c)},getSlot:function(apis,c,key){return apis.getSlot(c,key)},isShowing:function(apis,c,key){return apis.isShowing(c,key)},hideSlot:function(apis,c,key){return apis.hideSlot(c,key)},hideAllSlots:function(apis,c){return apis.hideAllSlots(c)},showSlot:function(apis,c,key){return apis.showSlot(c,key)}},(function(value){return makeApi(value)})),SlotContainer=__assign(__assign({},slotApis),{sketch:sketch}),sidebarSchema=objOf([optionString("icon"),optionString("tooltip"),defaultedFunction("onShow",noop),defaultedFunction("onHide",noop),defaultedFunction("onSetup",(function(){return noop}))]),createSidebar=function(spec){return asRaw("sidebar",sidebarSchema,spec)},setup$8=function(editor){var sidebars=editor.ui.registry.getAll().sidebars;each$1(keys(sidebars),(function(name){var spec=sidebars[name],isActive=function(){return is$1(Optional.from(editor.queryCommandValue("ToggleSidebar")),name)};editor.ui.registry.addToggleButton(name,{icon:spec.icon,tooltip:spec.tooltip,onAction:function(buttonApi){editor.execCommand("ToggleSidebar",!1,name),buttonApi.setActive(isActive())},onSetup:function(buttonApi){var handleToggle=function(){return buttonApi.setActive(isActive())};return editor.on("ToggleSidebar",handleToggle),function(){editor.off("ToggleSidebar",handleToggle)}}})}))},getApi=function(comp){return{element:function(){return comp.element.dom}}},makePanels=function(parts,panelConfigs){var specs=map$2(keys(panelConfigs),(function(name){var spec=panelConfigs[name],bridged=getOrDie(createSidebar(spec));return{name:name,getApi:getApi,onSetup:bridged.onSetup,onShow:bridged.onShow,onHide:bridged.onHide}}));return map$2(specs,(function(spec){var editorOffCell=Cell(noop);return parts.slot(spec.name,{dom:{tag:"div",classes:["tox-sidebar__pane"]},behaviours:SimpleBehaviours_unnamedEvents([onControlAttached(spec,editorOffCell),onControlDetached(spec,editorOffCell),run$1(slotVisibility(),(function(sidepanel,se){var data=se.event,optSidePanelSpec;find$5(specs,(function(config){return config.name===data.name})).each((function(sidePanelSpec){var handler;(data.visible?sidePanelSpec.onShow:sidePanelSpec.onHide)(sidePanelSpec.getApi(sidepanel))}))}))])})}))},makeSidebar=function(panelConfigs){return SlotContainer.sketch((function(parts){return{dom:{tag:"div",classes:["tox-sidebar__pane-container"]},components:makePanels(parts,panelConfigs),slotBehaviours:SimpleBehaviours_unnamedEvents([runOnAttached((function(slotContainer){return SlotContainer.hideAllSlots(slotContainer)}))])}}))},setSidebar=function(sidebar,panelConfigs){var optSlider;Composing.getCurrent(sidebar).each((function(slider){return Replacing.set(slider,[makeSidebar(panelConfigs)])}))},toggleSidebar=function(sidebar,name){var optSlider;Composing.getCurrent(sidebar).each((function(slider){var optSlotContainer;Composing.getCurrent(slider).each((function(slotContainer){Sliding.hasGrown(slider)?SlotContainer.isShowing(slotContainer,name)?Sliding.shrink(slider):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name)):(SlotContainer.hideAllSlots(slotContainer),SlotContainer.showSlot(slotContainer,name),Sliding.grow(slider))}))}))},whichSidebar=function(sidebar){var optSlider;return Composing.getCurrent(sidebar).bind((function(slider){var sidebarOpen,optSlotContainer;return Sliding.isGrowing(slider)||Sliding.hasGrown(slider)?Composing.getCurrent(slider).bind((function(slotContainer){return find$5(SlotContainer.getSlotNames(slotContainer),(function(name){return SlotContainer.isShowing(slotContainer,name)}))})):Optional.none()}))},fixSize=generate$6("FixSizeEvent"),autoSize=generate$6("AutoSizeEvent"),renderSidebar=function(spec){return{uid:spec.uid,dom:{tag:"div",classes:["tox-sidebar"],attributes:{role:"complementary"}},components:[{dom:{tag:"div",classes:["tox-sidebar__slider"]},components:[],behaviours:derive$1([Tabstopping.config({}),Focusing.config({}),Sliding.config({dimension:{property:"width"},closedClass:"tox-sidebar--sliding-closed",openClass:"tox-sidebar--sliding-open",shrinkingClass:"tox-sidebar--sliding-shrinking",growingClass:"tox-sidebar--sliding-growing",onShrunk:function(slider){var optSlotContainer;Composing.getCurrent(slider).each(SlotContainer.hideAllSlots),emit(slider,autoSize)},onGrown:function(slider){emit(slider,autoSize)},onStartGrow:function(slider){emitWith(slider,fixSize,{width:getRaw(slider.element,"width").getOr("")})},onStartShrink:function(slider){emitWith(slider,fixSize,{width:get$a(slider.element)+"px"})}}),Replacing.config({}),Composing.config({find:function(comp){var children=Replacing.contents(comp);return head(children)}})])}],behaviours:derive$1([ComposingConfigs_childAt(0),config("sidebar-sliding-events",[run$1(fixSize,(function(comp,se){set$7(comp.element,"width",se.event.width)})),run$1(autoSize,(function(comp,_se){remove$6(comp.element,"width")}))])])}},block=function(component,config,state,getBusySpec){set$8(component.element,"aria-busy",!0);var root=config.getRoot(component).getOr(component),blockerBehaviours=derive$1([Keying.config({mode:"special",onTab:function(){return Optional.some(!0)},onShiftTab:function(){return Optional.some(!0)}}),Focusing.config({})]),blockSpec=getBusySpec(root,blockerBehaviours),blocker=root.getSystem().build(blockSpec);Replacing.append(root,premade(blocker)),blocker.hasConfigured(Keying)&&config.focus&&Keying.focusIn(blocker),state.isBlocked()||config.onBlock(component),state.blockWith((function(){return Replacing.remove(root,blocker)}))},unblock=function(component,config,state){remove$7(component.element,"aria-busy"),state.isBlocked()&&config.onUnblock(component),state.clear()},BlockingApis=Object.freeze({__proto__:null,block:block,unblock:unblock}),BlockingSchema=[defaultedFunction("getRoot",Optional.none),defaultedBoolean("focus",!0),onHandler("onBlock"),onHandler("onUnblock")],init$4=function(){var blocker=destroyable(),blockWith=function(destroy){blocker.set({destroy:destroy})};return nu$8({readState:blocker.isSet,blockWith:blockWith,clear:blocker.clear,isBlocked:blocker.isSet})},BlockingState,Blocking=create$7({fields:BlockingSchema,name:"blocking",apis:BlockingApis,state:Object.freeze({__proto__:null,init:init$4})}),getAttrs=function(elem){var attributes=void 0!==elem.dom.attributes?elem.dom.attributes:[];return foldl(attributes,(function(b,attr){var _a;return"class"===attr.name?b:__assign(__assign({},b),((_a={})[attr.name]=attr.value,_a))}),{})},getClasses=function(elem){return Array.prototype.slice.call(elem.dom.classList,0)},fromHtml=function(html){var elem=SugarElement.fromHtml(html),children$1=children(elem),attrs=getAttrs(elem),classes=getClasses(elem),contents=0===children$1.length?{}:{innerHtml:get$7(elem)};return __assign({tag:name$2(elem),classes:classes,attributes:attrs},contents)},getBusySpec$1=function(providerBackstage){return function(_root,_behaviours){return{dom:{tag:"div",attributes:{"aria-label":providerBackstage.translate("Loading..."),tabindex:"0"},classes:["tox-throbber__busy-spinner"]},components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}}},focusBusyComponent=function(throbber){return Composing.getCurrent(throbber).each((function(comp){return focus$3(comp.element)}))},toggleEditorTabIndex=function(editor,state){var tabIndexAttr="tabindex",dataTabIndexAttr="data-mce-tabindex";Optional.from(editor.iframeElement).map(SugarElement.fromDom).each((function(iframe){state?(getOpt(iframe,"tabindex").each((function(tabIndex){return set$8(iframe,dataTabIndexAttr,tabIndex)})),set$8(iframe,"tabindex",-1)):(remove$7(iframe,"tabindex"),getOpt(iframe,dataTabIndexAttr).each((function(tabIndex){set$8(iframe,"tabindex",tabIndex),remove$7(iframe,dataTabIndexAttr)})))}))},toggleThrobber=function(editor,comp,state,providerBackstage){var element=comp.element;if(toggleEditorTabIndex(editor,state),state)Blocking.block(comp,getBusySpec$1(providerBackstage)),remove$6(element,"display"),remove$7(element,"aria-hidden"),editor.hasFocus()&&focusBusyComponent(comp);else{var throbberFocus=Composing.getCurrent(comp).exists((function(busyComp){return hasFocus(busyComp.element)}));Blocking.unblock(comp),set$7(element,"display","none"),set$8(element,"aria-hidden","true"),throbberFocus&&editor.focus()}},renderThrobber=function(spec){return{uid:spec.uid,dom:{tag:"div",attributes:{"aria-hidden":"true"},classes:["tox-throbber"],styles:{display:"none"}},behaviours:derive$1([Replacing.config({}),Blocking.config({focus:!1}),Composing.config({find:function(comp){return head(comp.components())}})]),components:[]}},isFocusEvent=function(event){return"focusin"===event.type},isPasteBinTarget=function(event){var node;return!!isFocusEvent(event)&&(event.composed?head(event.composedPath()):Optional.from(event.target)).map(SugarElement.fromDom).filter(isElement$2).exists((function(targetElm){return has(targetElm,"mce-pastebin")}))},setup$7=function(editor,lazyThrobber,sharedBackstage){var throbberState=Cell(!1),timer=value$1(),stealFocus=function(e){throbberState.get()&&!isPasteBinTarget(e)&&(e.preventDefault(),focusBusyComponent(lazyThrobber()),editor.editorManager.setActive(editor))};editor.inline||editor.on("PreInit",(function(){editor.dom.bind(editor.getWin(),"focusin",stealFocus),editor.on("BeforeExecCommand",(function(e){"mcefocus"===e.command.toLowerCase()&&!0!==e.value&&stealFocus(e)}))}));var toggle=function(state){state!==throbberState.get()&&(throbberState.set(state),toggleThrobber(editor,lazyThrobber(),state,sharedBackstage.providers),editor.fire("AfterProgressState",{state:state}))};editor.on("ProgressState",(function(e){if(timer.on(global$f.clearTimeout),isNumber(e.time)){var timerId=global$f.setEditorTimeout(editor,(function(){return toggle(e.state)}),e.time);timer.set(timerId)}else toggle(e.state),timer.clear()}))},generate$1=function(xs,f){var init,r;return foldl(xs,(function(b,a){var value;return f(a,b.len).fold(constant$1(b),(function(v){return{len:v.finish,list:b.list.concat([v])}}))}),{len:0,list:[]}).list},output=function(within,extra,withinWidth){return{within:within,extra:extra,withinWidth:withinWidth}},apportion=function(units,total,len){var parray=generate$1(units,(function(unit,current){var width=len(unit);return Optional.some({element:unit,start:current,finish:current+width,width:width})})),within=filter$2(parray,(function(unit){return unit.finish<=total})),withinWidth=foldr(within,(function(acc,el){return acc+el.width}),0),extra;return{within:within,extra:parray.slice(within.length),withinWidth:withinWidth}},toUnit=function(parray){return map$2(parray,(function(unit){return unit.element}))},fitLast=function(within,extra,withinWidth){var fits=toUnit(within.concat(extra));return output(fits,[],withinWidth)},overflow=function(within,extra,overflower,withinWidth){var fits=toUnit(within).concat([overflower]);return output(fits,toUnit(extra),withinWidth)},fitAll=function(within,extra,withinWidth){return output(toUnit(within),[],withinWidth)},tryFit=function(total,units,len){var divide=apportion(units,total,len);return 0===divide.extra.length?Optional.some(divide):Optional.none()},partition=function(total,units,len,overflower){var divide=tryFit(total,units,len).getOrThunk((function(){return apportion(units,total-len(overflower),len)})),within=divide.within,extra=divide.extra,withinWidth=divide.withinWidth;return 1===extra.length&&extra[0].width<=len(overflower)?fitLast(within,extra,withinWidth):extra.length>=1?overflow(within,extra,overflower,withinWidth):fitAll(within,extra,withinWidth)},setGroups$1=function(toolbar,storedGroups){var bGroups=map$2(storedGroups,(function(g){return premade(g)}));Toolbar.setGroups(toolbar,bGroups)},findFocusedComp=function(comps){return findMap(comps,(function(comp){return search(comp.element).bind((function(focusedElm){return comp.getSystem().getByDom(focusedElm).toOptional()}))}))},refresh$2=function(toolbar,detail,setOverflow){var builtGroups=detail.builtGroups.get();if(0!==builtGroups.length){var primary=getPartOrDie(toolbar,detail,"primary"),overflowGroup=Coupling.getCoupled(toolbar,"overflowGroup");set$7(primary.element,"visibility","hidden");var groups=builtGroups.concat([overflowGroup]),focusedComp=findFocusedComp(groups);setOverflow([]),setGroups$1(primary,groups);var availableWidth=get$a(primary.element),overflows=partition(availableWidth,detail.builtGroups.get(),(function(comp){return get$a(comp.element)}),overflowGroup);0===overflows.extra.length?(Replacing.remove(primary,overflowGroup),setOverflow([])):(setGroups$1(primary,overflows.within),setOverflow(overflows.extra)),remove$6(primary.element,"visibility"),reflow(primary.element),focusedComp.each(Focusing.focus)}},schema$c=constant$1([field("splitToolbarBehaviours",[Coupling]),customField("builtGroups",(function(){return Cell([])}))]),schema$b=constant$1([markers$1(["overflowToggledClass"]),optionFunction("getOverflowBounds"),required$1("lazySink"),customField("overflowGroups",(function(){return Cell([])}))].concat(schema$c())),parts$7=constant$1([required({factory:Toolbar,schema:schema$e(),name:"primary"}),external$1({schema:schema$e(),name:"overflow"}),external$1({name:"overflow-button"}),external$1({name:"overflow-group"})]),expandable=constant$1((function(element,available){setMax(element,Math.floor(available))})),schema$a=constant$1([markers$1(["toggledClass"]),required$1("lazySink"),requiredFunction("fetch"),optionFunction("getBounds"),optionObjOf("fireDismissalEventInstead",[defaulted("event",dismissRequested())]),schema$y()]),parts$6=constant$1([external$1({name:"button",overrides:function(detail){return{dom:{attributes:{"aria-haspopup":"true"}},buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.toggledClass,aria:{mode:"expanded"},toggleOnExecute:!1})])}}}),external$1({factory:Toolbar,schema:schema$e(),name:"toolbar",overrides:function(detail){return{toolbarBehaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(comp){return getPart(comp,detail,"button").each(Focusing.focus),Optional.none()}})])}}})]),toggle=function(button,externals){var toolbarSandbox=Coupling.getCoupled(button,"toolbarSandbox");Sandboxing.isOpen(toolbarSandbox)?Sandboxing.close(toolbarSandbox):Sandboxing.open(toolbarSandbox,externals.toolbar())},position=function(button,toolbar,detail,layouts){var bounds=detail.getBounds.map((function(bounder){return bounder()})),sink=detail.lazySink(button).getOrDie();Positioning.positionWithinBounds(sink,toolbar,{anchor:{type:"hotspot",hotspot:button,layouts:layouts,overrides:{maxWidthFunction:expandable()}}},bounds)},setGroups=function(button,toolbar,detail,layouts,groups){Toolbar.setGroups(toolbar,groups),position(button,toolbar,detail,layouts),Toggling.on(button)},makeSandbox=function(button,spec,detail){var ariaOwner=manager(),onOpen=function(sandbox,toolbar){detail.fetch().get((function(groups){setGroups(button,toolbar,detail,spec.layouts,groups),ariaOwner.link(button.element),Keying.focusIn(toolbar)}))},onClose=function(){Toggling.off(button),Focusing.focus(button),ariaOwner.unlink(button.element)};return{dom:{tag:"div",attributes:{id:ariaOwner.id}},behaviours:derive$1([Keying.config({mode:"special",onEscape:function(comp){return Sandboxing.close(comp),Optional.some(!0)}}),Sandboxing.config({onOpen:onOpen,onClose:onClose,isPartOf:function(container,data,queryElem){return isPartOf$1(data,queryElem)||isPartOf$1(button,queryElem)},getAttachPoint:function(){return detail.lazySink(button).getOrDie()}}),Receiving.config({channels:__assign(__assign({},receivingChannel$1(__assign({isExtraPart:never},detail.fireDismissalEventInstead.map((function(fe){return{fireEventInstead:{event:fe.event}}})).getOr({})))),receivingChannel({doReposition:function(){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){position(button,toolbar,detail,spec.layouts)}))}}))})])}},factory$a,FloatingToolbarButton=composite({name:"FloatingToolbarButton",factory:function(detail,components,spec,externals){return __assign(__assign({},Button.sketch(__assign(__assign({},externals.button()),{action:function(button){toggle(button,externals)},buttonBehaviours:SketchBehaviours_augment({dump:externals.button().buttonBehaviours},[Coupling.config({others:{toolbarSandbox:function(button){return makeSandbox(button,spec,detail)}}})])}))),{apis:{setGroups:function(button,groups){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){setGroups(button,toolbar,detail,spec.layouts,groups)}))},reposition:function(button){Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox")).each((function(toolbar){position(button,toolbar,detail,spec.layouts)}))},toggle:function(button){toggle(button,externals)},getToolbar:function(button){return Sandboxing.getState(Coupling.getCoupled(button,"toolbarSandbox"))},isOpen:function(button){return Sandboxing.isOpen(Coupling.getCoupled(button,"toolbarSandbox"))}}})},configFields:schema$a(),partFields:parts$6(),apis:{setGroups:function(apis,button,groups){apis.setGroups(button,groups)},reposition:function(apis,button){apis.reposition(button)},toggle:function(apis,button){apis.toggle(button)},getToolbar:function(apis,button){return apis.getToolbar(button)},isOpen:function(apis,button){return apis.isOpen(button)}}}),schema$9=constant$1([required$1("items"),markers$1(["itemSelector"]),field("tgroupBehaviours",[Keying])]),parts$5=constant$1([group({name:"items",unit:"item"})]),factory$9=function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.tgroupBehaviours,[Keying.config({mode:"flow",selector:detail.markers.itemSelector})]),domModification:{attributes:{role:"toolbar"}}}},ToolbarGroup=composite({name:"ToolbarGroup",configFields:schema$9(),partFields:parts$5(),factory:factory$9}),buildGroups=function(comps){return map$2(comps,(function(g){return premade(g)}))},refresh$1=function(toolbar,memFloatingToolbarButton,detail){refresh$2(toolbar,detail,(function(overflowGroups){detail.overflowGroups.set(overflowGroups),memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.setGroups(floatingToolbarButton,buildGroups(overflowGroups))}))}))},factory$8=function(detail,components,spec,externals){var memFloatingToolbarButton=record(FloatingToolbarButton.sketch({fetch:function(){return Future_nu((function(resolve){resolve(buildGroups(detail.overflowGroups.get()))}))},layouts:{onLtr:function(){return[southwest$2,southeast$2]},onRtl:function(){return[southeast$2,southwest$2]},onBottomLtr:function(){return[northwest$2,northeast$2]},onBottomRtl:function(){return[northeast$2,northwest$2]}},getBounds:spec.getOverflowBounds,lazySink:detail.lazySink,fireDismissalEventInstead:{},markers:{toggledClass:detail.markers.overflowToggledClass},parts:{button:externals["overflow-button"](),toolbar:externals.overflow()}}));return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[memFloatingToolbarButton.asSpec()]}))}}})]),apis:{setGroups:function(toolbar,groups){detail.builtGroups.set(map$2(groups,toolbar.getSystem().build)),refresh$1(toolbar,memFloatingToolbarButton,detail)},refresh:function(toolbar){return refresh$1(toolbar,memFloatingToolbarButton,detail)},toggle:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.toggle(floatingToolbarButton)}))},isOpen:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(!1)},reposition:function(toolbar){memFloatingToolbarButton.getOpt(toolbar).each((function(floatingToolbarButton){FloatingToolbarButton.reposition(floatingToolbarButton)}))},getOverflow:function(toolbar){return memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar)}},domModification:{attributes:{role:"group"}}}},SplitFloatingToolbar=composite({name:"SplitFloatingToolbar",configFields:schema$b(),partFields:parts$7(),factory:factory$8,apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},reposition:function(apis,toolbar){apis.reposition(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)},getOverflow:function(apis,toolbar){return apis.getOverflow(toolbar)}}}),schema$8=constant$1([markers$1(["closedClass","openClass","shrinkingClass","growingClass","overflowToggledClass"]),onHandler("onOpened"),onHandler("onClosed")].concat(schema$c())),parts$4=constant$1([required({factory:Toolbar,schema:schema$e(),name:"primary"}),required({factory:Toolbar,schema:schema$e(),name:"overflow",overrides:function(detail){return{toolbarBehaviours:derive$1([Sliding.config({dimension:{property:"height"},closedClass:detail.markers.closedClass,openClass:detail.markers.openClass,shrinkingClass:detail.markers.shrinkingClass,growingClass:detail.markers.growingClass,onShrunk:function(comp){getPart(comp,detail,"overflow-button").each((function(button){Toggling.off(button),Focusing.focus(button)})),detail.onClosed(comp)},onGrown:function(comp){Keying.focusIn(comp),detail.onOpened(comp)},onStartGrow:function(comp){getPart(comp,detail,"overflow-button").each(Toggling.on)}}),Keying.config({mode:"acyclic",onEscape:function(comp){return getPart(comp,detail,"overflow-button").each(Focusing.focus),Optional.some(!0)}})])}}}),external$1({name:"overflow-button",overrides:function(detail){return{buttonBehaviours:derive$1([Toggling.config({toggleClass:detail.markers.overflowToggledClass,aria:{mode:"pressed"},toggleOnExecute:!1})])}}}),external$1({name:"overflow-group"})]),isOpen=function(toolbar,detail){return getPart(toolbar,detail,"overflow").map(Sliding.hasGrown).getOr(!1)},toggleToolbar=function(toolbar,detail){getPart(toolbar,detail,"overflow-button").bind((function(){return getPart(toolbar,detail,"overflow")})).each((function(overf){refresh(toolbar,detail),Sliding.toggleGrow(overf)}))},refresh=function(toolbar,detail){getPart(toolbar,detail,"overflow").each((function(overflow){refresh$2(toolbar,detail,(function(groups){var builtGroups=map$2(groups,(function(g){return premade(g)}));Toolbar.setGroups(overflow,builtGroups)})),getPart(toolbar,detail,"overflow-button").each((function(button){Sliding.hasGrown(overflow)&&Toggling.on(button)})),Sliding.refresh(overflow)}))},factory$7=function(detail,components,spec,externals){var toolbarToggleEvent="alloy.toolbar.toggle",doSetGroups=function(toolbar,groups){var built=map$2(groups,toolbar.getSystem().build);detail.builtGroups.set(built)};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:augment(detail.splitToolbarBehaviours,[Coupling.config({others:{overflowGroup:function(toolbar){return ToolbarGroup.sketch(__assign(__assign({},externals["overflow-group"]()),{items:[Button.sketch(__assign(__assign({},externals["overflow-button"]()),{action:function(_button){emit(toolbar,toolbarToggleEvent)}}))]}))}}}),config("toolbar-toggle-events",[run$1(toolbarToggleEvent,(function(toolbar){toggleToolbar(toolbar,detail)}))])]),apis:{setGroups:function(toolbar,groups){doSetGroups(toolbar,groups),refresh(toolbar,detail)},refresh:function(toolbar){return refresh(toolbar,detail)},toggle:function(toolbar){return toggleToolbar(toolbar,detail)},isOpen:function(toolbar){return isOpen(toolbar,detail)}},domModification:{attributes:{role:"group"}}}},SplitSlidingToolbar=composite({name:"SplitSlidingToolbar",configFields:schema$8(),partFields:parts$4(),factory:factory$7,apis:{setGroups:function(apis,toolbar,groups){apis.setGroups(toolbar,groups)},refresh:function(apis,toolbar){apis.refresh(toolbar)},toggle:function(apis,toolbar){apis.toggle(toolbar)},isOpen:function(apis,toolbar){return apis.isOpen(toolbar)}}}),renderToolbarGroupCommon=function(toolbarGroup){var attributes=toolbarGroup.title.fold((function(){return{}}),(function(title){return{attributes:{title:title}}}));return{dom:__assign({tag:"div",classes:["tox-toolbar__group"]},attributes),components:[ToolbarGroup.parts.items({})],items:toolbarGroup.items,markers:{itemSelector:"*:not(.tox-split-button) > .tox-tbtn:not([disabled]), .tox-split-button:not([disabled]), .tox-toolbar-nav-js:not([disabled])"},tgroupBehaviours:derive$1([Tabstopping.config({}),Focusing.config({})])}},renderToolbarGroup=function(toolbarGroup){return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup))},getToolbarbehaviours=function(toolbarSpec,modeName){var onAttached=runOnAttached((function(component){var groups=map$2(toolbarSpec.initGroups,renderToolbarGroup);Toolbar.setGroups(component,groups)}));return derive$1([DisablingConfigs_toolbarButton(toolbarSpec.providers.isDisabled),receivingConfig(),Keying.config({mode:modeName,onEscape:toolbarSpec.onEscape,selector:".tox-toolbar__group"}),config("toolbar-events",[onAttached])])},renderMoreToolbarCommon=function(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return{uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar-overlord"]},parts:{"overflow-group":renderToolbarGroupCommon({title:Optional.none(),items:[]}),"overflow-button":renderIconButtonSpec({name:"more",icon:Optional.some("more-drawer"),disabled:!1,tooltip:Optional.some("More..."),primary:!1,borderless:!1},Optional.none(),toolbarSpec.providers)},splitToolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)}},renderFloatingMoreToolbar=function(toolbarSpec){var baseSpec=renderMoreToolbarCommon(toolbarSpec),overflowXOffset=4,primary=SplitFloatingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}});return SplitFloatingToolbar.sketch(__assign(__assign({},baseSpec),{lazySink:toolbarSpec.getSink,getOverflowBounds:function(){var headerElem=toolbarSpec.moreDrawerData.lazyHeader().element,headerBounds=absolute$2(headerElem),docElem=documentElement(headerElem),docBounds=absolute$2(docElem),height=Math.max(docElem.dom.scrollHeight,docBounds.height);return bounds(headerBounds.x+4,docBounds.y,headerBounds.width-8,height)},parts:__assign(__assign({},baseSpec.parts),{overflow:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:toolbarSpec.attributes}}}),components:[primary],markers:{overflowToggledClass:"tox-tbtn--enabled"}}))},renderSlidingMoreToolbar=function(toolbarSpec){var primary=SplitSlidingToolbar.parts.primary({dom:{tag:"div",classes:["tox-toolbar__primary"]}}),overflow=SplitSlidingToolbar.parts.overflow({dom:{tag:"div",classes:["tox-toolbar__overflow"]}}),baseSpec=renderMoreToolbarCommon(toolbarSpec);return SplitSlidingToolbar.sketch(__assign(__assign({},baseSpec),{components:[primary,overflow],markers:{openClass:"tox-toolbar__overflow--open",closedClass:"tox-toolbar__overflow--closed",growingClass:"tox-toolbar__overflow--growing",shrinkingClass:"tox-toolbar__overflow--shrinking",overflowToggledClass:"tox-tbtn--enabled"},onOpened:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"opened"})},onClosed:function(comp){comp.getSystem().broadcastOn([toolbarHeightChange()],{type:"closed"})}}))},renderToolbar=function(toolbarSpec){var modeName=toolbarSpec.cyclicKeying?"cyclic":"acyclic";return Toolbar.sketch({uid:toolbarSpec.uid,dom:{tag:"div",classes:["tox-toolbar"].concat(toolbarSpec.type===ToolbarMode.scrolling?["tox-toolbar--scrolling"]:[])},components:[Toolbar.parts.groups({})],toolbarBehaviours:getToolbarbehaviours(toolbarSpec,modeName)})},factory$6=function(detail,components,_spec){var apis={getSocket:function(comp){return parts$a.getPart(comp,detail,"socket")},setSidebar:function(comp,panelConfigs){parts$a.getPart(comp,detail,"sidebar").each((function(sidebar){return setSidebar(sidebar,panelConfigs)}))},toggleSidebar:function(comp,name){parts$a.getPart(comp,detail,"sidebar").each((function(sidebar){return toggleSidebar(sidebar,name)}))},whichSidebar:function(comp){return parts$a.getPart(comp,detail,"sidebar").bind(whichSidebar).getOrNull()},getHeader:function(comp){return parts$a.getPart(comp,detail,"header")},getToolbar:function(comp){return parts$a.getPart(comp,detail,"toolbar")},setToolbar:function(comp,groups){parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){toolbar.getApis().setGroups(toolbar,groups)}))},setToolbars:function(comp,toolbars){parts$a.getPart(comp,detail,"multiple-toolbar").each((function(mToolbar){CustomList.setItems(mToolbar,toolbars)}))},refreshToolbar:function(comp){var toolbar;parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){return toolbar.getApis().refresh(toolbar)}))},toggleToolbarDrawer:function(comp){parts$a.getPart(comp,detail,"toolbar").each((function(toolbar){mapFrom(toolbar.getApis().toggle,(function(toggle){return toggle(toolbar)}))}))},isToolbarDrawerToggled:function(comp){return parts$a.getPart(comp,detail,"toolbar").bind((function(toolbar){return Optional.from(toolbar.getApis().isOpen).map((function(isOpen){return isOpen(toolbar)}))})).getOr(!1)},getThrobber:function(comp){return parts$a.getPart(comp,detail,"throbber")},focusToolbar:function(comp){var optToolbar;parts$a.getPart(comp,detail,"toolbar").orThunk((function(){return parts$a.getPart(comp,detail,"multiple-toolbar")})).each((function(toolbar){Keying.focusIn(toolbar)}))},setMenubar:function(comp,menus){parts$a.getPart(comp,detail,"menubar").each((function(menubar){SilverMenubar.setMenus(menubar,menus)}))},focusMenubar:function(comp){parts$a.getPart(comp,detail,"menubar").each((function(menubar){SilverMenubar.focus(menubar)}))}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,behaviours:detail.behaviours}},partMenubar=partType.optional({factory:SilverMenubar,name:"menubar",schema:[required$1("backstage")]}),toolbarFactory=function(spec){return spec.type===ToolbarMode.sliding?renderSlidingMoreToolbar:spec.type===ToolbarMode.floating?renderFloatingMoreToolbar:renderToolbar},partMultipleToolbar=partType.optional({factory:{sketch:function(spec){return CustomList.sketch({uid:spec.uid,dom:spec.dom,listBehaviours:derive$1([Keying.config({mode:"acyclic",selector:".tox-toolbar"})]),makeItem:function(){return renderToolbar({type:spec.type,uid:generate$6("multiple-toolbar-item"),cyclicKeying:!1,initGroups:[],providers:spec.providers,onEscape:function(){return spec.onEscape(),Optional.some(!0)}})},setupItem:function(_mToolbar,tc,data,_index){Toolbar.setGroups(tc,data)},shell:!0})}},name:"multiple-toolbar",schema:[required$1("dom"),required$1("onEscape")]}),partToolbar=partType.optional({factory:{sketch:function(spec){var renderer,toolbarSpec;return toolbarFactory(spec)({type:spec.type,uid:spec.uid,onEscape:function(){return spec.onEscape(),Optional.some(!0)},cyclicKeying:!1,initGroups:[],getSink:spec.getSink,providers:spec.providers,moreDrawerData:{lazyToolbar:spec.lazyToolbar,lazyMoreButton:spec.lazyMoreButton,lazyHeader:spec.lazyHeader},attributes:spec.attributes})}},name:"toolbar",schema:[required$1("dom"),required$1("onEscape"),required$1("getSink")]}),partHeader=partType.optional({factory:{sketch:renderHeader},name:"header",schema:[required$1("dom")]}),partSocket=partType.optional({name:"socket",schema:[required$1("dom")]}),partSidebar=partType.optional({factory:{sketch:renderSidebar},name:"sidebar",schema:[required$1("dom")]}),partThrobber=partType.optional({factory:{sketch:renderThrobber},name:"throbber",schema:[required$1("dom")]}),OuterContainer=composite({name:"OuterContainer",factory:factory$6,configFields:[required$1("dom"),required$1("behaviours")],partFields:[partHeader,partMenubar,partToolbar,partMultipleToolbar,partSocket,partSidebar,partThrobber],apis:{getSocket:function(apis,comp){return apis.getSocket(comp)},setSidebar:function(apis,comp,panelConfigs){apis.setSidebar(comp,panelConfigs)},toggleSidebar:function(apis,comp,name){apis.toggleSidebar(comp,name)},whichSidebar:function(apis,comp){return apis.whichSidebar(comp)},getHeader:function(apis,comp){return apis.getHeader(comp)},getToolbar:function(apis,comp){return apis.getToolbar(comp)},setToolbar:function(apis,comp,grps){var groups=map$2(grps,(function(grp){return renderToolbarGroup(grp)}));apis.setToolbar(comp,groups)},setToolbars:function(apis,comp,ts){var renderedToolbars=map$2(ts,(function(g){return map$2(g,renderToolbarGroup)}));apis.setToolbars(comp,renderedToolbars)},refreshToolbar:function(apis,comp){return apis.refreshToolbar(comp)},toggleToolbarDrawer:function(apis,comp){apis.toggleToolbarDrawer(comp)},isToolbarDrawerToggled:function(apis,comp){return apis.isToolbarDrawerToggled(comp)},getThrobber:function(apis,comp){return apis.getThrobber(comp)},setMenubar:function(apis,comp,menus){apis.setMenubar(comp,menus)},focusMenubar:function(apis,comp){apis.focusMenubar(comp)},focusToolbar:function(apis,comp){apis.focusToolbar(comp)}}}),defaultMenubar="file edit view insert format tools table help",defaultMenus={file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"},help:{title:"Help",items:"help"}},make=function(menu,registry,editor){var removedMenuItems=getRemovedMenuItems(editor).split(/[ ,]/);return{text:menu.title,getItems:function(){return bind$3(menu.items,(function(i){var itemName=i.toLowerCase();return 0===itemName.trim().length||exists(removedMenuItems,(function(removedMenuItem){return removedMenuItem===itemName}))?[]:"separator"===itemName||"|"===itemName?[{type:"separator"}]:registry.menuItems[itemName]?[registry.menuItems[itemName]]:[]}))}}},parseItemsString=function(items){return"string"==typeof items?items.split(" "):items},identifyMenus=function(editor,registry){var rawMenuData=__assign(__assign({},defaultMenus),registry.menus),userDefinedMenus=keys(registry.menus).length>0,menubar=void 0===registry.menubar||!0===registry.menubar?parseItemsString(defaultMenubar):parseItemsString(!1===registry.menubar?"":registry.menubar),validMenus=filter$2(menubar,(function(menuName){var isDefaultMenu=has$2(defaultMenus,menuName);return userDefinedMenus?isDefaultMenu||get$e(registry.menus,menuName).exists((function(menu){return has$2(menu,"items")})):isDefaultMenu})),menus=map$2(validMenus,(function(menuName){var menuData=rawMenuData[menuName];return make({title:menuData.title,items:parseItemsString(menuData.items)},registry,editor)}));return filter$2(menus,(function(menu){var isNotSeparator=function(item){return"separator"!==item.type};return menu.getItems().length>0&&exists(menu.getItems(),isNotSeparator)}))},fireSkinLoaded=function(editor){var done=function(){editor._skinLoaded=!0,fireSkinLoaded$1(editor)};return function(){editor.initialized?done():editor.on("init",done)}},fireSkinLoadError=function(editor,err){return function(){return fireSkinLoadError$1(editor,{message:err})}},loadStylesheet=function(editor,stylesheetUrl,styleSheetLoader){return new global$c((function(resolve,reject){styleSheetLoader.load(stylesheetUrl,resolve,reject),editor.on("remove",(function(){return styleSheetLoader.unload(stylesheetUrl)}))}))},loadUiSkins=function(editor,skinUrl){var skinUiCss;return loadStylesheet(editor,skinUrl+"/skin.min.css",editor.ui.styleSheetLoader)},loadShadowDomUiSkins=function(editor,skinUrl){var isInShadowRoot$1,shadowDomSkinCss;return isInShadowRoot(SugarElement.fromDom(editor.getElement()))?loadStylesheet(editor,skinUrl+"/skin.shadowdom.min.css",global$b.DOM.styleSheetLoader):global$c.resolve()},loadSkin=function(isInline,editor){var skinUrl=getSkinUrl(editor);skinUrl&&editor.contentCSS.push(skinUrl+(isInline?"/content.inline":"/content")+".min.css"),!1===isSkinDisabled(editor)&&isString(skinUrl)?global$c.all([loadUiSkins(editor,skinUrl),loadShadowDomUiSkins(editor,skinUrl)]).then(fireSkinLoaded(editor),fireSkinLoadError(editor,"Skin could not be loaded")):fireSkinLoaded(editor)()},iframe=curry(loadSkin,!1),inline=curry(loadSkin,!0),onSetupFormatToggle=function(editor,name){return function(api){var boundCallback=unbindable(),init=function(){api.setActive(editor.formatter.match(name));var binding=editor.formatter.formatChanged(name,api.setActive);boundCallback.set(binding)};return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),boundCallback.clear()}}},onSetupEvent=function(editor,event,f){return function(api){var handleEvent=function(){return f(api)},init=function(){f(api),editor.on(event,handleEvent)};return editor.initialized?init():editor.once("init",init),function(){editor.off("init",init),editor.off(event,handleEvent)}}},onActionToggleFormat$1=function(editor){return function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("mceToggleFormat",!1,rawItem.format)}))}}},onActionExecCommand=function(editor,command){return function(){return editor.execCommand(command)}},generateSelectItems=function(_editor,backstage,spec){var generateItem=function(rawItem,response,disabled,value){var translatedText=backstage.shared.providers.translate(rawItem.title);if("separator"===rawItem.type)return Optional.some({type:"separator",text:translatedText});if("submenu"===rawItem.type){var items=bind$3(rawItem.getStyleItems(),(function(si){return validate(si,response,value)}));return 0===response&&items.length<=0?Optional.none():Optional.some({type:"nestedmenuitem",text:translatedText,disabled:items.length<=0,getSubmenuItems:function(){return bind$3(rawItem.getStyleItems(),(function(si){return validate(si,response,value)}))}})}return Optional.some(__assign({type:"togglemenuitem",text:translatedText,icon:rawItem.icon,active:rawItem.isSelected(value),disabled:disabled,onAction:spec.onAction(rawItem)},rawItem.getStylePreview().fold((function(){return{}}),(function(preview){return{meta:{style:preview}}}))))},validate=function(item,response,value){var invalid="formatter"===item.type&&spec.isInvalid(item);return 0===response?invalid?[]:generateItem(item,response,!1,value).toArray():generateItem(item,response,invalid,value).toArray()},validateItems=function(preItems){var value=spec.getCurrentValue(),response=spec.shouldHide?0:1;return bind$3(preItems,(function(item){return validate(item,response,value)}))},getFetch=function(backstage,getStyleItems){return function(comp,callback){var preItems=getStyleItems(),items=validateItems(preItems),menu;callback(build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1))}};return{validateItems:validateItems,getFetch:getFetch}},createMenuItems=function(editor,backstage,spec){var dataset=spec.dataset,getStyleItems="basic"===dataset.type?function(){return map$2(dataset.data,(function(d){return processBasic(d,spec.isSelectedFor,spec.getPreviewFor)}))}:dataset.getData;return{items:generateSelectItems(editor,backstage,spec),getStyleItems:getStyleItems}},createSelectButton=function(editor,backstage,spec){var _a=createMenuItems(editor,backstage,spec),items=_a.items,getStyleItems=_a.getStyleItems,getApi=function(comp){return{getComponent:constant$1(comp)}},onSetup=onSetupEvent(editor,"NodeChange",(function(api){var comp=api.getComponent();spec.updateText(comp)}));return renderCommonDropdown({text:spec.icon.isSome()?Optional.none():spec.text,icon:spec.icon,tooltip:Optional.from(spec.tooltip),role:Optional.none(),fetch:items.getFetch(backstage,getStyleItems),onSetup:onSetup,getApi:getApi,columns:1,presets:"normal",classes:spec.icon.isSome()?[]:["bespoke"],dropdownBehaviours:[]},"tox-tbtn",backstage.shared)},process=function(rawFormats){return map$2(rawFormats,(function(item){var title=item,format=item,values=item.split("=");return values.length>1&&(title=values[0],format=values[1]),{title:title,format:format}}))},buildBasicStaticDataset=function(data){return{type:"basic",data:data}},Delimiter;!function(Delimiter){Delimiter[Delimiter.SemiColon=0]="SemiColon",Delimiter[Delimiter.Space=1]="Space"}(Delimiter||(Delimiter={}));var split=function(rawFormats,delimiter){return delimiter===Delimiter.SemiColon?rawFormats.replace(/;$/,"").split(";"):rawFormats.split(" ")},buildBasicSettingsDataset=function(editor,settingName,defaults,delimiter){var rawFormats=editor.getParam(settingName,defaults,"string"),data;return{type:"basic",data:process(split(rawFormats,delimiter))}},alignMenuItems=[{title:"Left",icon:"align-left",format:"alignleft",command:"JustifyLeft"},{title:"Center",icon:"align-center",format:"aligncenter",command:"JustifyCenter"},{title:"Right",icon:"align-right",format:"alignright",command:"JustifyRight"},{title:"Justify",icon:"align-justify",format:"alignjustify",command:"JustifyFull"}],getSpec$4=function(editor){var getMatchingValue=function(){return find$5(alignMenuItems,(function(item){return editor.formatter.match(item.format)}))},isSelectedFor=function(format){return function(){return editor.formatter.match(format)}},getPreviewFor=function(_format){return Optional.none},updateSelectMenuIcon=function(comp){var match,alignment=getMatchingValue().fold(constant$1("left"),(function(item){return item.title.toLowerCase()}));emitWith(comp,updateMenuIcon,{icon:"align-"+alignment})},dataset=buildBasicStaticDataset(alignMenuItems),onAction=function(rawItem){return function(){return find$5(alignMenuItems,(function(item){return item.format===rawItem.format})).each((function(item){return editor.execCommand(item.command)}))}};return{tooltip:"Align",text:Optional.none(),icon:Optional.some("align-left"),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onAction,updateText:updateSelectMenuIcon,dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}},createAlignSelect=function(editor,backstage){return createSelectButton(editor,backstage,getSpec$4(editor))},alignSelectMenu=function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$4(editor));editor.ui.registry.addNestedMenuItem("align",{text:backstage.shared.providers.translate("Align"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})},defaultFontsFormats="Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats",systemStackFonts=["-apple-system","Segoe UI","Roboto","Helvetica Neue","sans-serif"],splitFonts=function(fontFamily){var fonts=fontFamily.split(/\s*,\s*/);return map$2(fonts,(function(font){return font.replace(/^['"]+|['"]+$/g,"")}))},isSystemFontStack=function(fontFamily){var matchesSystemStack=function(){var fonts=splitFonts(fontFamily.toLowerCase());return forall(systemStackFonts,(function(font){return fonts.indexOf(font.toLowerCase())>-1}))};return 0===fontFamily.indexOf("-apple-system")&&matchesSystemStack()},getSpec$3=function(editor){var systemFont="System Font",getMatchingValue=function(){var getFirstFont=function(fontFamily){return fontFamily?splitFonts(fontFamily)[0]:""},fontFamily=editor.queryCommandValue("FontName"),items=dataset.data,font=fontFamily?fontFamily.toLowerCase():"",matchOpt;return{matchOpt:find$5(items,(function(item){var format=item.format;return format.toLowerCase()===font||getFirstFont(format).toLowerCase()===getFirstFont(font).toLowerCase()})).orThunk((function(){return someIf(isSystemFontStack(font),{title:systemFont,format:font})})),font:fontFamily}},isSelectedFor=function(item){return function(valueOpt){return valueOpt.exists((function(value){return value.format===item}))}},getCurrentValue=function(){var matchOpt;return getMatchingValue().matchOpt},getPreviewFor=function(item){return function(){return Optional.some({tag:"div",styles:-1===item.indexOf("dings")?{"font-family":item}:{}})}},onAction=function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("FontName",!1,rawItem.format)}))}},updateSelectMenuText=function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,font=_a.font,text=matchOpt.fold(constant$1(font),(function(item){return item.title}));emitWith(comp,updateMenuText,{text:text})},dataset=buildBasicSettingsDataset(editor,"font_formats",defaultFontsFormats,Delimiter.SemiColon);return{tooltip:"Fonts",text:Optional.some(systemFont),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:getCurrentValue,getPreviewFor:getPreviewFor,onAction:onAction,updateText:updateSelectMenuText,dataset:dataset,shouldHide:!1,isInvalid:never}},createFontSelect=function(editor,backstage){return createSelectButton(editor,backstage,getSpec$3(editor))},fontSelectMenu=function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$3(editor));editor.ui.registry.addNestedMenuItem("fontformats",{text:backstage.shared.providers.translate("Fonts"),getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})},defaultFontsizeFormats="8pt 10pt 12pt 14pt 18pt 24pt 36pt",legacyFontSizes={"8pt":"1","10pt":"2","12pt":"3","14pt":"4","18pt":"5","24pt":"6","36pt":"7"},keywordFontSizes={"xx-small":"7pt","x-small":"8pt",small:"10pt",medium:"12pt",large:"14pt","x-large":"18pt","xx-large":"24pt"},round=function(number,precision){var factor=Math.pow(10,precision);return Math.round(number*factor)/factor},toPt=function(fontSize,precision){return/[0-9.]+px$/.test(fontSize)?round(72*parseInt(fontSize,10)/96,precision||0)+"pt":get$e(keywordFontSizes,fontSize).getOr(fontSize)},toLegacy=function(fontSize){return get$e(legacyFontSizes,fontSize).getOr("")},getSpec$2=function(editor){var getMatchingValue=function(){var matchOpt=Optional.none(),items=dataset.data,fontSize=editor.queryCommandValue("FontSize");if(fontSize)for(var _loop_1=function(precision){var pt=toPt(fontSize,precision),legacy=toLegacy(pt);matchOpt=find$5(items,(function(item){return item.format===fontSize||item.format===pt||item.format===legacy}))},precision=3;matchOpt.isNone()&&precision>=0;precision--)_loop_1(precision);return{matchOpt:matchOpt,size:fontSize}},isSelectedFor=function(item){return function(valueOpt){return valueOpt.exists((function(value){return value.format===item}))}},getCurrentValue=function(){var matchOpt;return getMatchingValue().matchOpt},getPreviewFor=constant$1(Optional.none),onAction=function(rawItem){return function(){editor.undoManager.transact((function(){editor.focus(),editor.execCommand("FontSize",!1,rawItem.format)}))}},updateSelectMenuText=function(comp){var _a=getMatchingValue(),matchOpt=_a.matchOpt,size=_a.size,text=matchOpt.fold(constant$1(size),(function(match){return match.title}));emitWith(comp,updateMenuText,{text:text})},dataset=buildBasicSettingsDataset(editor,"fontsize_formats",defaultFontsizeFormats,Delimiter.Space);return{tooltip:"Font sizes",text:Optional.some("12pt"),icon:Optional.none(),isSelectedFor:isSelectedFor,getPreviewFor:getPreviewFor,getCurrentValue:getCurrentValue,onAction:onAction,updateText:updateSelectMenuText,dataset:dataset,shouldHide:!1,isInvalid:never}},createFontsizeSelect=function(editor,backstage){return createSelectButton(editor,backstage,getSpec$2(editor))},fontsizeSelectMenu=function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$2(editor));editor.ui.registry.addNestedMenuItem("fontsizes",{text:"Font sizes",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})},findNearest=function(editor,getStyles){var styles=getStyles(),formats=map$2(styles,(function(style){return style.format}));return Optional.from(editor.formatter.closest(formats)).bind((function(fmt){return find$5(styles,(function(data){return data.format===fmt}))})).orThunk((function(){return someIf(editor.formatter.match("p"),{title:"Paragraph",format:"p"})}))},defaultBlocks="Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre",getSpec$1=function(editor){var fallbackFormat="Paragraph",isSelectedFor=function(format){return function(){return editor.formatter.match(format)}},getPreviewFor=function(format){return function(){var fmt=editor.formatter.get(format);return Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))})}},updateSelectMenuText=function(comp){var detectedFormat,text=findNearest(editor,(function(){return dataset.data})).fold(constant$1("Paragraph"),(function(fmt){return fmt.title}));emitWith(comp,updateMenuText,{text:text})},dataset=buildBasicSettingsDataset(editor,"block_formats",defaultBlocks,Delimiter.SemiColon);return{tooltip:"Blocks",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,dataset:dataset,shouldHide:!1,isInvalid:function(item){return!editor.formatter.canApply(item.format)}}},createFormatSelect=function(editor,backstage){return createSelectButton(editor,backstage,getSpec$1(editor))},formatSelectMenu=function(editor,backstage){var menuItems=createMenuItems(editor,backstage,getSpec$1(editor));editor.ui.registry.addNestedMenuItem("blockformats",{text:"Blocks",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})},getSpec=function(editor,dataset){var fallbackFormat="Paragraph",isSelectedFor=function(format){return function(){return editor.formatter.match(format)}},getPreviewFor=function(format){return function(){var fmt=editor.formatter.get(format);return void 0!==fmt?Optional.some({tag:fmt.length>0&&(fmt[0].inline||fmt[0].block)||"div",styles:editor.dom.parseStyle(editor.formatter.getCssText(format))}):Optional.none()}},updateSelectMenuText=function(comp){var getFormatItems=function(fmt){var subs=fmt.items;return void 0!==subs&&subs.length>0?bind$3(subs,getFormatItems):[{title:fmt.title,format:fmt.format}]},flattenedItems=bind$3(getStyleFormats(editor),getFormatItems),detectedFormat,text=findNearest(editor,constant$1(flattenedItems)).fold(constant$1("Paragraph"),(function(fmt){return fmt.title}));emitWith(comp,updateMenuText,{text:text})};return{tooltip:"Formats",text:Optional.some("Paragraph"),icon:Optional.none(),isSelectedFor:isSelectedFor,getCurrentValue:Optional.none,getPreviewFor:getPreviewFor,onAction:onActionToggleFormat$1(editor),updateText:updateSelectMenuText,shouldHide:editor.getParam("style_formats_autohide",!1,"boolean"),isInvalid:function(item){return!editor.formatter.canApply(item.format)},dataset:dataset}},createStyleSelect=function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect);return createSelectButton(editor,backstage,getSpec(editor,dataset))},styleSelectMenu=function(editor,backstage){var dataset=__assign({type:"advanced"},backstage.styleselect),menuItems=createMenuItems(editor,backstage,getSpec(editor,dataset));editor.ui.registry.addNestedMenuItem("formats",{text:"Formats",getSubmenuItems:function(){return menuItems.items.validateItems(menuItems.getStyleItems())}})},events$3=function(reflectingConfig,reflectingState){var update=function(component,data){reflectingConfig.updateState.each((function(updateState){var newState=updateState(component,data);reflectingState.set(newState)})),reflectingConfig.renderComponents.each((function(renderComponents){var newComponents=renderComponents(data,reflectingState.get()),newChildren=map$2(newComponents,component.getSystem().build);replaceChildren(component,newChildren)}))};return derive$2([run$1(receive(),(function(component,message){var receivingData=message;if(!receivingData.universal){var channel=reflectingConfig.channel;contains$2(receivingData.channels,channel)&&update(component,receivingData.data)}})),runOnAttached((function(comp,_se){reflectingConfig.initialData.each((function(rawData){update(comp,rawData)}))}))])},ActiveReflecting=Object.freeze({__proto__:null,events:events$3}),getState=function(component,replaceConfig,reflectState){return reflectState},ReflectingApis=Object.freeze({__proto__:null,getState:getState}),ReflectingSchema=[required$1("channel"),option("renderComponents"),option("updateState"),option("initialData")],init$3=function(){var cell=Cell(Optional.none()),clear=function(){return cell.set(Optional.none())},readState;return{readState:function(){return cell.get().getOr("none")},get:cell.get,set:cell.set,clear:clear}},ReflectingState=Object.freeze({__proto__:null,init:init$3}),Reflecting=create$7({fields:ReflectingSchema,name:"reflecting",active:ActiveReflecting,apis:ReflectingApis,state:ReflectingState}),schema$7=constant$1([required$1("toggleClass"),required$1("fetch"),onStrictHandler("onExecute"),defaulted("getHotspot",Optional.some),defaulted("getAnchorOverrides",constant$1({})),schema$y(),onStrictHandler("onItemExecute"),option("lazySink"),required$1("dom"),onHandler("onOpen"),field("splitDropdownBehaviours",[Coupling,Keying,Focusing]),defaulted("matchWidth",!1),defaulted("useMinWidth",!1),defaulted("eventOrder",{}),option("role")].concat(sandboxFields())),arrowPart=required({factory:Button,schema:[required$1("dom")],name:"arrow",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(arrow){arrow.getSystem().getByUid(detail.uid).each(emitExecute)},buttonBehaviours:derive$1([Toggling.config({toggleOnExecute:!1,toggleClass:detail.toggleClass})])}}}),buttonPart=required({factory:Button,schema:[required$1("dom")],name:"button",defaults:function(){return{buttonBehaviours:derive$1([Focusing.revoke()])}},overrides:function(detail){return{dom:{tag:"span",attributes:{role:"presentation"}},action:function(btn){btn.getSystem().getByUid(detail.uid).each((function(splitDropdown){detail.onExecute(splitDropdown,btn)}))}}}}),parts$3=constant$1([arrowPart,buttonPart,optional({factory:{sketch:function(spec){return{uid:spec.uid,dom:{tag:"span",styles:{display:"none"},attributes:{"aria-hidden":"true"},innerHtml:spec.text}}}},schema:[required$1("text")],name:"aria-descriptor"}),external$1({schema:[tieredMenuMarkers()],name:"menu",defaults:function(detail){return{onExecute:function(tmenu,item){tmenu.getSystem().getByUid(detail.uid).each((function(splitDropdown){detail.onItemExecute(splitDropdown,tmenu,item)}))}}}}),partType$1()]),factory$5=function(detail,components,spec,externals){var _a,switchToMenu=function(sandbox){Composing.getCurrent(sandbox).each((function(current){Highlighting.highlightFirst(current),Keying.focusIn(current)}))},action=function(component){var onOpenSync;togglePopup(detail,identity$1,component,externals,switchToMenu,HighlightOnOpen.HighlightFirst).get(noop)},openMenu=function(comp){return action(comp),Optional.some(!0)},executeOnButton=function(comp){var button=getPartOrDie(comp,detail,"button");return emitExecute(button),Optional.some(!0)},buttonEvents=__assign(__assign({},derive$2([runOnAttached((function(component,_simulatedEvent){var ariaDescriptor;getPart(component,detail,"aria-descriptor").each((function(descriptor){var descriptorId=generate$6("aria");set$8(descriptor.element,"id",descriptorId),set$8(component.element,"aria-describedby",descriptorId)}))}))])),events$a(Optional.some(action))),apis={repositionMenus:function(comp){Toggling.isOn(comp)&&repositionMenus(comp)}};return{uid:detail.uid,dom:detail.dom,components:components,apis:apis,eventOrder:__assign(__assign({},detail.eventOrder),(_a={},_a[execute$5()]=["disabling","toggling","alloy.base.behaviour"],_a)),events:buttonEvents,behaviours:augment(detail.splitDropdownBehaviours,[Coupling.config({others:{sandbox:function(hotspot){var arrow=getPartOrDie(hotspot,detail,"arrow"),extras;return makeSandbox$1(detail,hotspot,{onOpen:function(){Toggling.on(arrow),Toggling.on(hotspot)},onClose:function(){Toggling.off(arrow),Toggling.off(hotspot)}})}}}),Keying.config({mode:"special",onSpace:executeOnButton,onEnter:executeOnButton,onDown:openMenu}),Focusing.config({}),Toggling.config({toggleOnExecute:!1,aria:{mode:"expanded"}})]),domModification:{attributes:{role:detail.role.getOr("button"),"aria-haspopup":!0}}}},SplitDropdown=composite({name:"SplitDropdown",configFields:schema$7(),partFields:parts$3(),factory:factory$5,apis:{repositionMenus:function(apis,comp){return apis.repositionMenus(comp)}}}),getButtonApi=function(component){return{isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getToggleApi=function(component){return{setActive:function(state){Toggling.set(component,state)},isActive:function(){return Toggling.isOn(component)},isDisabled:function(){return Disabling.isDisabled(component)},setDisabled:function(state){return Disabling.set(component,state)}}},getTooltipAttributes=function(tooltip,providersBackstage){return tooltip.map((function(tooltip){return{"aria-label":providersBackstage.translate(tooltip),title:providersBackstage.translate(tooltip)}})).getOr({})},focusButtonEvent=generate$6("focus-button"),renderCommonStructure=function(icon,text,tooltip,receiver,behaviours,providersBackstage){var _d;return{dom:{tag:"button",classes:["tox-tbtn"].concat(text.isSome()?["tox-tbtn--select"]:[]),attributes:getTooltipAttributes(tooltip,providersBackstage)},components:componentRenderPipeline([icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),text.map((function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)}))]),eventOrder:(_d={},_d[mousedown()]=["focusing","alloy.base.behaviour","common-button-display-events"],_d),buttonBehaviours:derive$1([DisablingConfigs_toolbarButton(providersBackstage.isDisabled),receivingConfig(),config("common-button-display-events",[run$1(mousedown(),(function(button,se){se.event.prevent(),emit(button,focusButtonEvent)}))])].concat(receiver.map((function(r){return Reflecting.config({channel:r,initialData:{icon:icon,text:text},renderComponents:function(data,_state){return componentRenderPipeline([data.icon.map((function(iconName){return renderIconFromPack(iconName,providersBackstage.icons)})),data.text.map((function(text){return renderLabel$1(text,"tox-tbtn",providersBackstage)}))])}})})).toArray()).concat(behaviours.getOr([])))}},renderFloatingToolbarButton=function(spec,backstage,identifyButtons,attributes){var sharedBackstage=backstage.shared;return FloatingToolbarButton.sketch({lazySink:sharedBackstage.getSink,fetch:function(){return Future_nu((function(resolve){resolve(map$2(identifyButtons(spec.items),renderToolbarGroup))}))},markers:{toggledClass:"tox-tbtn--enabled"},parts:{button:renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),sharedBackstage.providers),toolbar:{dom:{tag:"div",classes:["tox-toolbar__overflow"],attributes:attributes}}}})},renderCommonToolbarButton=function(spec,specialisation,providersBackstage){var editorOffCell=Cell(noop),structure=renderCommonStructure(spec.icon,spec.text,spec.tooltip,Optional.none(),Optional.none(),providersBackstage);return Button.sketch({dom:structure.dom,components:structure.components,eventOrder:toolbarButtonEventOrder,buttonBehaviours:derive$1([config("toolbar-button-events",[onToolbarButtonExecute({onAction:spec.onAction,getApi:specialisation.getApi}),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),DisablingConfigs_toolbarButton((function(){return spec.disabled||providersBackstage.isDisabled()})),receivingConfig()].concat(specialisation.toolbarButtonBehaviours))})},renderToolbarButton=function(spec,providersBackstage){return renderToolbarButtonWith(spec,providersBackstage,[])},renderToolbarButtonWith=function(spec,providersBackstage,bonusEvents){return renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[].concat(bonusEvents.length>0?[config("toolbarButtonWith",bonusEvents)]:[]),getApi:getButtonApi,onSetup:spec.onSetup},providersBackstage)},renderToolbarToggleButton=function(spec,providersBackstage){return renderToolbarToggleButtonWith(spec,providersBackstage,[])},renderToolbarToggleButtonWith=function(spec,providersBackstage,bonusEvents){return deepMerge(renderCommonToolbarButton(spec,{toolbarButtonBehaviours:[Replacing.config({}),Toggling.config({toggleClass:"tox-tbtn--enabled",aria:{mode:"pressed"},toggleOnExecute:!1})].concat(bonusEvents.length>0?[config("toolbarToggleButtonWith",bonusEvents)]:[]),getApi:getToggleApi,onSetup:spec.onSetup},providersBackstage))},fetchChoices=function(getApi,spec,providersBackstage){return function(comp){return Future_nu((function(callback){return spec.fetch(callback)})).map((function(items){return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$6("menu-value"),items,(function(value){spec.onItemAction(getApi(comp),value)}),spec.columns,spec.presets,ItemResponse$1.CLOSE_ON_EXECUTE,spec.select.getOr(never),providersBackstage),{movement:deriveMenuMovement(spec.columns,spec.presets),menuBehaviours:SimpleBehaviours_unnamedEvents("auto"!==spec.columns?[]:[runOnAttached((function(comp,_se){detectSize(comp,4,classForPreset(spec.presets)).each((function(_d){var numRows=_d.numRows,numColumns=_d.numColumns;Keying.setGridSize(comp,numRows,numColumns)}))}))])})))}))}},renderSplitButton=function(spec,sharedBackstage){var _d,displayChannel=generate$6("channel-update-split-dropdown-display"),getApi=function(comp){return{isDisabled:function(){return Disabling.isDisabled(comp)},setDisabled:function(state){return Disabling.set(comp,state)},setIconFill:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each((function(underlinePath){set$8(underlinePath,"fill",value)}))},setIconStroke:function(id,value){descendant(comp.element,'svg path[id="'+id+'"], rect[id="'+id+'"]').each((function(underlinePath){set$8(underlinePath,"stroke",value)}))},setActive:function(state){set$8(comp.element,"aria-pressed",state),descendant(comp.element,"span").each((function(button){comp.getSystem().getByDom(button).each((function(buttonComp){return Toggling.set(buttonComp,state)}))}))},isActive:function(){return descendant(comp.element,"span").exists((function(button){return comp.getSystem().getByDom(button).exists(Toggling.isOn)}))}}},editorOffCell=Cell(noop),specialisation={getApi:getApi,onSetup:spec.onSetup};return SplitDropdown.sketch({dom:{tag:"div",classes:["tox-split-button"],attributes:__assign({"aria-pressed":!1},getTooltipAttributes(spec.tooltip,sharedBackstage.providers))},onExecute:function(button){spec.onAction(getApi(button))},onItemExecute:function(_a,_b,_c){},splitDropdownBehaviours:derive$1([DisablingConfigs_splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),config("split-dropdown-events",[run$1(focusButtonEvent,Focusing.focus),onControlAttached(specialisation,editorOffCell),onControlDetached(specialisation,editorOffCell)]),Unselecting.config({})]),eventOrder:(_d={},_d[attachedToDom()]=["alloy.base.behaviour","split-dropdown-events"],_d),toggleClass:"tox-tbtn--enabled",lazySink:sharedBackstage.getSink,fetch:fetchChoices(getApi,spec,sharedBackstage.providers),parts:{menu:part(!1,spec.columns,spec.presets)},components:[SplitDropdown.parts.button(renderCommonStructure(spec.icon,spec.text,Optional.none(),Optional.some(displayChannel),Optional.some([Toggling.config({toggleClass:"tox-tbtn--enabled",toggleOnExecute:!1})]),sharedBackstage.providers)),SplitDropdown.parts.arrow({dom:{tag:"button",classes:["tox-tbtn","tox-split-button__chevron"],innerHtml:get$1("chevron-down",sharedBackstage.providers.icons)},buttonBehaviours:derive$1([DisablingConfigs_splitButton(sharedBackstage.providers.isDisabled),receivingConfig(),addFocusableBehaviour()])}),SplitDropdown.parts["aria-descriptor"]({text:sharedBackstage.providers.translate("To open the popup, press Shift+Enter")})]})},defaultToolbar=[{name:"history",items:["undo","redo"]},{name:"styles",items:["styleselect"]},{name:"formatting",items:["bold","italic"]},{name:"alignment",items:["alignleft","aligncenter","alignright","alignjustify"]},{name:"indentation",items:["outdent","indent"]},{name:"permanent pen",items:["permanentpen"]},{name:"comments",items:["addcomment"]}],renderFromBridge=function(bridgeBuilder,render){return function(spec,extras,editor){var internal=bridgeBuilder(spec).mapError((function(errInfo){return formatError(errInfo)})).getOrDie();return render(internal,extras,editor)}},types={button:renderFromBridge(createToolbarButton,(function(s,extras){return renderToolbarButton(s,extras.backstage.shared.providers)})),togglebutton:renderFromBridge(createToggleButton,(function(s,extras){return renderToolbarToggleButton(s,extras.backstage.shared.providers)})),menubutton:renderFromBridge(createMenuButton,(function(s,extras){return renderMenuButton(s,"tox-tbtn",extras.backstage,Optional.none())})),splitbutton:renderFromBridge(createSplitButton,(function(s,extras){return renderSplitButton(s,extras.backstage.shared)})),grouptoolbarbutton:renderFromBridge(createGroupToolbarButton,(function(s,extras,editor){var _a,buttons=editor.ui.registry.getAll().buttons,identify=function(toolbar){return identifyButtons(editor,{buttons:buttons,toolbar:toolbar,allowToolbarGroups:!1},extras,Optional.none())},attributes=((_a={})[Attribute]=extras.backstage.shared.header.isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop,_a);switch(getToolbarMode(editor)){case ToolbarMode.floating:return renderFloatingToolbarButton(s,extras.backstage,identify,attributes);default:throw new Error("Toolbar groups are only supported when using floating toolbar mode")}})),styleSelectButton:function(editor,extras){return createStyleSelect(editor,extras.backstage)},fontsizeSelectButton:function(editor,extras){return createFontsizeSelect(editor,extras.backstage)},fontSelectButton:function(editor,extras){return createFontSelect(editor,extras.backstage)},formatButton:function(editor,extras){return createFormatSelect(editor,extras.backstage)},alignMenuButton:function(editor,extras){return createAlignSelect(editor,extras.backstage)}},extractFrom=function(spec,extras,editor){return get$e(types,spec.type).fold((function(){return console.error("skipping button defined by",spec),Optional.none()}),(function(render){return Optional.some(render(spec,extras,editor))}))},bespokeButtons={styleselect:types.styleSelectButton,fontsizeselect:types.fontsizeSelectButton,fontselect:types.fontSelectButton,formatselect:types.formatButton,align:types.alignMenuButton},removeUnusedDefaults=function(buttons){var filteredItemGroups=map$2(defaultToolbar,(function(group){var items=filter$2(group.items,(function(subItem){return has$2(buttons,subItem)||has$2(bespokeButtons,subItem)}));return{name:group.name,items:items}}));return filter$2(filteredItemGroups,(function(group){return group.items.length>0}))},convertStringToolbar=function(strToolbar){var groupsStrings=strToolbar.split("|");return map$2(groupsStrings,(function(g){return{items:g.trim().split(" ")}}))},isToolbarGroupSettingArray=function(toolbar){return isArrayOf(toolbar,(function(t){return has$2(t,"name")&&has$2(t,"items")}))},createToolbar=function(toolbarConfig){var toolbar=toolbarConfig.toolbar,buttons=toolbarConfig.buttons;return!1===toolbar?[]:void 0===toolbar||!0===toolbar?removeUnusedDefaults(buttons):isString(toolbar)?convertStringToolbar(toolbar):isToolbarGroupSettingArray(toolbar)?toolbar:(console.error("Toolbar type should be string, string[], boolean or ToolbarGroup[]"),[])},lookupButton=function(editor,buttons,toolbarItem,allowToolbarGroups,extras,prefixes){return get$e(buttons,toolbarItem.toLowerCase()).orThunk((function(){return prefixes.bind((function(ps){return findMap(ps,(function(prefix){return get$e(buttons,prefix+toolbarItem.toLowerCase())}))}))})).fold((function(){return get$e(bespokeButtons,toolbarItem.toLowerCase()).map((function(r){return r(editor,extras)})).orThunk((function(){return Optional.none()}))}),(function(spec){return"grouptoolbarbutton"!==spec.type||allowToolbarGroups?extractFrom(spec,extras,editor):(console.warn("Ignoring the '"+toolbarItem+"' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested."),Optional.none())}))},identifyButtons=function(editor,toolbarConfig,extras,prefixes){var toolbarGroups=createToolbar(toolbarConfig),groups=map$2(toolbarGroups,(function(group){var items=bind$3(group.items,(function(toolbarItem){return 0===toolbarItem.trim().length?[]:lookupButton(editor,toolbarConfig.buttons,toolbarItem,toolbarConfig.allowToolbarGroups,extras,prefixes).toArray()}));return{title:Optional.from(editor.translate(group.name)),items:items}}));return filter$2(groups,(function(group){return group.items.length>0}))},setToolbar=function(editor,uiComponents,rawUiConfig,backstage){var comp=uiComponents.outerContainer,toolbarConfig=rawUiConfig.toolbar,toolbarButtonsConfig=rawUiConfig.buttons;if(isArrayOf(toolbarConfig,isString)){var toolbars=toolbarConfig.map((function(t){var config={toolbar:t,buttons:toolbarButtonsConfig,allowToolbarGroups:rawUiConfig.allowToolbarGroups};return identifyButtons(editor,config,{backstage:backstage},Optional.none())}));OuterContainer.setToolbars(comp,toolbars)}else OuterContainer.setToolbar(comp,identifyButtons(editor,rawUiConfig,{backstage:backstage},Optional.none()))},detection=detect$1(),isiOS12=detection.os.isiOS()&&detection.os.version.major<=12,setupEvents$1=function(editor,uiComponents){var dom=editor.dom,contentWindow=editor.getWin(),initialDocEle=editor.getDoc().documentElement,lastWindowDimensions=Cell(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),lastDocumentDimensions=Cell(SugarPosition(initialDocEle.offsetWidth,initialDocEle.offsetHeight)),resizeWindow=function(){var outer=lastWindowDimensions.get();outer.left===contentWindow.innerWidth&&outer.top===contentWindow.innerHeight||(lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth,contentWindow.innerHeight)),fireResizeContent(editor))},resizeDocument=function(){var docEle=editor.getDoc().documentElement,inner=lastDocumentDimensions.get();inner.left===docEle.offsetWidth&&inner.top===docEle.offsetHeight||(lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth,docEle.offsetHeight)),fireResizeContent(editor))},scroll=function(e){return fireScrollContent(editor,e)};dom.bind(contentWindow,"resize",resizeWindow),dom.bind(contentWindow,"scroll",scroll);var elementLoad=capture(SugarElement.fromDom(editor.getBody()),"load",resizeDocument),mothership=uiComponents.uiMothership.element;editor.on("hide",(function(){set$7(mothership,"display","none")})),editor.on("show",(function(){remove$6(mothership,"display")})),editor.on("NodeChange",resizeDocument),editor.on("remove",(function(){elementLoad.unbind(),dom.unbind(contentWindow,"resize",resizeWindow),dom.unbind(contentWindow,"scroll",scroll),contentWindow=null}))},render$1=function(editor,uiComponents,rawUiConfig,backstage,args){var lastToolbarWidth=Cell(0),outerContainer=uiComponents.outerContainer;iframe(editor);var eTargetNode=SugarElement.fromDom(args.targetNode),uiRoot=getContentContainer(getRootNode(eTargetNode));attachSystemAfter(eTargetNode,uiComponents.mothership),attachSystem(uiRoot,uiComponents.uiMothership),editor.on("PostRender",(function(){setToolbar(editor,uiComponents,rawUiConfig,backstage),lastToolbarWidth.set(editor.getWin().innerWidth),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),OuterContainer.setSidebar(outerContainer,rawUiConfig.sidebar),setupEvents$1(editor,uiComponents)}));var socket=OuterContainer.getSocket(outerContainer).getOrDie("Could not find expected socket element");if(isiOS12){setAll(socket.element,{overflow:"scroll","-webkit-overflow-scrolling":"touch"});var limit=first((function(){editor.fire("ScrollContent")}),20),unbinder=bind(socket.element,"scroll",limit.throttle);editor.on("remove",unbinder.unbind)}setupReadonlyModeSwitch(editor,uiComponents),editor.addCommand("ToggleSidebar",(function(_ui,value){OuterContainer.toggleSidebar(outerContainer,value),editor.fire("ToggleSidebar")})),editor.addQueryValueHandler("ToggleSidebar",(function(){return OuterContainer.whichSidebar(outerContainer)}));var toolbarMode=getToolbarMode(editor),refreshDrawer=function(){OuterContainer.refreshToolbar(uiComponents.outerContainer)};toolbarMode!==ToolbarMode.sliding&&toolbarMode!==ToolbarMode.floating||editor.on("ResizeWindow ResizeEditor ResizeContent",(function(){var width=editor.getWin().innerWidth;width!==lastToolbarWidth.get()&&(refreshDrawer(),lastToolbarWidth.set(width))}));var api={enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}};return{iframeContainer:socket.element.dom,editorContainer:outerContainer.element.dom,api:api}},Iframe=Object.freeze({__proto__:null,render:render$1}),parseToInt=function(val){var re;return/^[0-9\.]+(|px)$/i.test(""+val)?Optional.some(parseInt(""+val,10)):Optional.none()},numToPx=function(val){return isNumber(val)?val+"px":val},calcCappedSize=function(size,minSize,maxSize){var minOverride=minSize.filter((function(min){return size<min})),maxOverride=maxSize.filter((function(max){return size>max}));return minOverride.or(maxOverride).getOr(size)},getHeight=function(editor){var baseHeight=getHeightSetting(editor),minHeight=getMinHeightSetting(editor),maxHeight=getMaxHeightSetting(editor);return parseToInt(baseHeight).map((function(height){return calcCappedSize(height,minHeight,maxHeight)}))},getHeightWithFallback=function(editor){var height;return getHeight(editor).getOr(getHeightSetting(editor))},getWidth=function(editor){var baseWidth=getWidthSetting(editor),minWidth=getMinWidthSetting(editor),maxWidth=getMaxWidthSetting(editor);return parseToInt(baseWidth).map((function(width){return calcCappedSize(width,minWidth,maxWidth)}))},getWidthWithFallback=function(editor){var width;return getWidth(editor).getOr(getWidthSetting(editor))},InlineHeader=function(editor,targetElm,uiComponents,backstage,floatContainer){var uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,DOM=global$b.DOM,useFixedToolbarContainer=useFixedContainer(editor),isSticky=isStickyToolbar(editor),editorMaxWidthOpt=getMaxWidthSetting(editor).or(getWidth(editor)),headerBackstage=backstage.shared.header,isPositionedAtTop=headerBackstage.isPositionedAtTop,toolbarMode=getToolbarMode(editor),isSplitToolbar=toolbarMode===ToolbarMode.sliding||toolbarMode===ToolbarMode.floating,visible=Cell(!1),isVisible=function(){return visible.get()&&!editor.removed},calcToolbarOffset=function(toolbar){return isSplitToolbar?toolbar.fold(constant$1(0),(function(tbar){return tbar.components().length>1?get$b(tbar.components()[1].element):0})):0},calcMode=function(container){switch(getToolbarLocation(editor)){case ToolbarLocation.auto:var toolbar_1=OuterContainer.getToolbar(outerContainer),offset=calcToolbarOffset(toolbar_1),toolbarHeight=get$b(container.element)-offset,targetBounds=box$1(targetElm),roomAtTop;if(targetBounds.y>toolbarHeight)return"top";var doc=documentElement(targetElm),docHeight=Math.max(doc.dom.scrollHeight,get$b(doc)),roomAtBottom,winBounds,isRoomAtBottomViewport;return targetBounds.bottom<docHeight-toolbarHeight||win().bottom<targetBounds.bottom-toolbarHeight?"bottom":"top";case ToolbarLocation.bottom:return"bottom";case ToolbarLocation.top:default:return"top"}},setupMode=function(mode){var container=floatContainer.get();Docking.setModes(container,[mode]),headerBackstage.setDockingMode(mode);var verticalDir=isPositionedAtTop()?AttributeValue.TopToBottom:AttributeValue.BottomToTop;set$8(container.element,Attribute,verticalDir)},updateChromeWidth=function(){var maxWidth=editorMaxWidthOpt.getOrThunk((function(){var bodyMargin=parseToInt(get$c(body(),"margin-left")).getOr(0);return get$a(body())-absolute$3(targetElm).left+bodyMargin}));set$7(floatContainer.get().element,"max-width",maxWidth+"px")},updateChromePosition=function(){var toolbar=OuterContainer.getToolbar(outerContainer),offset=calcToolbarOffset(toolbar),targetBounds=box$1(targetElm),top=isPositionedAtTop()?Math.max(targetBounds.y-get$b(floatContainer.get().element)+offset,0):targetBounds.bottom;setAll(outerContainer.element,{position:"absolute",top:Math.round(top)+"px",left:Math.round(targetBounds.x)+"px"})},repositionPopups$1=function(){uiMothership.broadcastOn([repositionPopups()],{})},updateChromeUi=function(resetDocking){if(void 0===resetDocking&&(resetDocking=!1),isVisible()){if(useFixedToolbarContainer||updateChromeWidth(),isSplitToolbar&&OuterContainer.refreshToolbar(outerContainer),useFixedToolbarContainer||updateChromePosition(),isSticky){var floatContainerComp=floatContainer.get();resetDocking?Docking.reset(floatContainerComp):Docking.refresh(floatContainerComp)}repositionPopups$1()}},updateMode=function(updateUi){if(void 0===updateUi&&(updateUi=!0),!useFixedToolbarContainer&&isSticky&&isVisible()){var currentMode=headerBackstage.getDockingMode(),newMode=calcMode(floatContainer.get());newMode!==currentMode&&(setupMode(newMode),updateUi&&updateChromeUi(!0))}},show,hide;return{isVisible:isVisible,isPositionedAtTop:isPositionedAtTop,show:function(){visible.set(!0),set$7(outerContainer.element,"display","flex"),DOM.addClass(editor.getBody(),"mce-edit-focus"),remove$6(uiMothership.element,"display"),updateMode(!1),updateChromeUi()},hide:function(){visible.set(!1),uiComponents.outerContainer&&(set$7(outerContainer.element,"display","none"),DOM.removeClass(editor.getBody(),"mce-edit-focus")),set$7(uiMothership.element,"display","none")},update:updateChromeUi,updateMode:updateMode,repositionPopups:repositionPopups$1}},getTargetPosAndBounds=function(targetElm,isToolbarTop){var bounds=box$1(targetElm);return{pos:isToolbarTop?bounds.y:bounds.bottom,bounds:bounds}},setupEvents=function(editor,targetElm,ui,toolbarPersist){var prevPosAndBounds=Cell(getTargetPosAndBounds(targetElm,ui.isPositionedAtTop())),resizeContent=function(e){var _a=getTargetPosAndBounds(targetElm,ui.isPositionedAtTop()),pos=_a.pos,bounds=_a.bounds,_b=prevPosAndBounds.get(),prevPos=_b.pos,prevBounds=_b.bounds,hasResized=bounds.height!==prevBounds.height||bounds.width!==prevBounds.width;prevPosAndBounds.set({pos:pos,bounds:bounds}),hasResized&&fireResizeContent(editor,e),ui.isVisible()&&(prevPos!==pos?ui.update(!0):hasResized&&(ui.updateMode(),ui.repositionPopups()))};toolbarPersist||(editor.on("activate",ui.show),editor.on("deactivate",ui.hide)),editor.on("SkinLoaded ResizeWindow",(function(){return ui.update(!0)})),editor.on("NodeChange keydown",(function(e){global$f.requestAnimationFrame((function(){return resizeContent(e)}))})),editor.on("ScrollWindow",(function(){return ui.updateMode()}));var elementLoad=unbindable();elementLoad.set(capture(SugarElement.fromDom(editor.getBody()),"load",resizeContent)),editor.on("remove",(function(){elementLoad.clear()}))},render=function(editor,uiComponents,rawUiConfig,backstage,args){var mothership=uiComponents.mothership,uiMothership=uiComponents.uiMothership,outerContainer=uiComponents.outerContainer,floatContainer=Cell(null),targetElm=SugarElement.fromDom(args.targetNode),ui=InlineHeader(editor,targetElm,uiComponents,backstage,floatContainer),toolbarPersist=isToolbarPersist(editor);inline(editor);var render=function(){if(floatContainer.get())ui.show();else{floatContainer.set(OuterContainer.getHeader(outerContainer).getOrDie());var uiContainer=getUiContainer(editor);attachSystem(uiContainer,mothership),attachSystem(uiContainer,uiMothership),setToolbar(editor,uiComponents,rawUiConfig,backstage),OuterContainer.setMenubar(outerContainer,identifyMenus(editor,rawUiConfig)),ui.show(),setupEvents(editor,targetElm,ui,toolbarPersist),editor.nodeChanged()}};editor.on("show",render),editor.on("hide",ui.hide),toolbarPersist||(editor.on("focus",render),editor.on("blur",ui.hide)),editor.on("init",(function(){(editor.hasFocus()||toolbarPersist)&&render()})),setupReadonlyModeSwitch(editor,uiComponents);var api={show:function(){ui.show()},hide:function(){ui.hide()},enable:function(){broadcastReadonly(uiComponents,!1)},disable:function(){broadcastReadonly(uiComponents,!0)},isDisabled:function(){return Disabling.isDisabled(outerContainer)}};return{editorContainer:outerContainer.element.dom,api:api}},Inline=Object.freeze({__proto__:null,render:render}),showContextToolbarEvent="contexttoolbar-show",hideContextToolbarEvent="contexttoolbar-hide",getFormApi=function(input){return{hide:function(){return emit(input,sandboxClose())},getValue:function(){return Representing.getValue(input)}}},runOnExecute=function(memInput,original){return run$1(internalToolbarButtonExecute,(function(comp,se){var input=memInput.get(comp),formApi=getFormApi(input);original.onAction(formApi,se.event.buttonApi)}))},renderContextButton=function(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,["primary"]),bridged=getOrDie(createToolbarButton(__assign(__assign({},rest),{type:"button",onAction:noop})));return renderToolbarButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)])},renderContextToggleButton=function(memInput,button,extras){var _a=button.original;_a.primary;var rest=__rest(_a,["primary"]),bridged=getOrDie(createToggleButton(__assign(__assign({},rest),{type:"togglebutton",onAction:noop})));return renderToolbarToggleButtonWith(bridged,extras.backstage.shared.providers,[runOnExecute(memInput,button)])},generateOne=function(memInput,button,providersBackstage){var extras={backstage:{shared:{providers:providersBackstage}}};return"contextformtogglebutton"===button.type?renderContextToggleButton(memInput,button,extras):renderContextButton(memInput,button,extras)},generate=function(memInput,buttons,providersBackstage){var mementos=map$2(buttons,(function(button){return record(generateOne(memInput,button,providersBackstage))})),asSpecs,findPrimary;return{asSpecs:function(){return map$2(mementos,(function(mem){return mem.asSpec()}))},findPrimary:function(compInSystem){return findMap(buttons,(function(button,i){return button.primary?Optional.from(mementos[i]).bind((function(mem){return mem.getOpt(compInSystem)})).filter(not(Disabling.isDisabled)):Optional.none()}))}}},buildInitGroups=function(ctx,providers){var inputAttributes=ctx.label.fold((function(){return{}}),(function(label){return{"aria-label":label}})),memInput=record(Input.sketch({inputClasses:["tox-toolbar-textfield","tox-toolbar-nav-js"],data:ctx.initValue(),inputAttributes:inputAttributes,selectOnFocus:!0,inputBehaviours:derive$1([Keying.config({mode:"special",onEnter:function(input){return commands.findPrimary(input).map((function(primary){return emitExecute(primary),!0}))},onLeft:function(comp,se){return se.cut(),Optional.none()},onRight:function(comp,se){return se.cut(),Optional.none()}})])})),commands=generate(memInput,ctx.commands,providers);return[{title:Optional.none(),items:[memInput.asSpec()]},{title:Optional.none(),items:commands.asSpecs()}]},renderContextForm,ContextForm_renderContextForm=function(toolbarType,ctx,providers){return renderToolbar({type:toolbarType,uid:generate$6("context-toolbar"),initGroups:buildInitGroups(ctx,providers),onEscape:Optional.none,cyclicKeying:!0,providers:providers})},ContextForm_buildInitGroups=buildInitGroups,isVerticalOverlap=function(a,b,threshold){return void 0===threshold&&(threshold=.01),b.bottom-a.y>=threshold&&a.bottom-b.y>=threshold},getRangeRect=function(rng){var rect=rng.getBoundingClientRect();if(rect.height<=0&&rect.width<=0){var leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset).element,elm;return(isText$1(leaf$1)?parent(leaf$1):Optional.some(leaf$1)).filter(isElement$2).map((function(e){return e.dom.getBoundingClientRect()})).getOr(rect)}return rect},getSelectionBounds=function(editor){var rng=editor.selection.getRng(),rect=getRangeRect(rng);if(editor.inline){var scroll_1=get$9();return bounds(scroll_1.left+rect.left,scroll_1.top+rect.top,rect.width,rect.height)}var bodyPos=absolute$2(SugarElement.fromDom(editor.getBody()));return bounds(bodyPos.x+rect.left,bodyPos.y+rect.top,rect.width,rect.height)},getAnchorElementBounds=function(editor,lastElement){return lastElement.filter(inBody).map(absolute$2).getOrThunk((function(){return getSelectionBounds(editor)}))},getHorizontalBounds=function(contentAreaBox,viewportBounds,margin){var x=Math.max(contentAreaBox.x+margin,viewportBounds.x),right;return{x:x,width:Math.min(contentAreaBox.right-margin,viewportBounds.right)-x}},getVerticalBounds=function(editor,contentAreaBox,viewportBounds,isToolbarLocationTop,toolbarType,margin){var container=SugarElement.fromDom(editor.getContainer()),header=descendant(container,".tox-editor-header").getOr(container),headerBox=box$1(header),isToolbarBelowContentArea=headerBox.y>=contentAreaBox.bottom,isToolbarAbove=isToolbarLocationTop&&!isToolbarBelowContentArea;if(editor.inline&&isToolbarAbove)return{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:viewportBounds.bottom};if(editor.inline&&!isToolbarAbove)return{y:viewportBounds.y,bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)};var containerBounds="line"===toolbarType?box$1(container):contentAreaBox;return isToolbarAbove?{y:Math.max(headerBox.bottom+margin,viewportBounds.y),bottom:Math.min(containerBounds.bottom-margin,viewportBounds.bottom)}:{y:Math.max(containerBounds.y+margin,viewportBounds.y),bottom:Math.min(headerBox.y-margin,viewportBounds.bottom)}},getContextToolbarBounds=function(editor,sharedBackstage,toolbarType,margin){void 0===margin&&(margin=0);var viewportBounds=getBounds$3(window),contentAreaBox=box$1(SugarElement.fromDom(editor.getContentAreaContainer())),toolbarOrMenubarEnabled=isMenubarEnabled(editor)||isToolbarEnabled(editor)||isMultipleToolbars(editor),_a=getHorizontalBounds(contentAreaBox,viewportBounds,margin),x=_a.x,width=_a.width;if(editor.inline&&!toolbarOrMenubarEnabled)return bounds(x,viewportBounds.y,width,viewportBounds.height);var isToolbarTop=sharedBackstage.header.isPositionedAtTop(),_b=getVerticalBounds(editor,contentAreaBox,viewportBounds,isToolbarTop,toolbarType,margin),y=_b.y,bottom=_b.bottom;return bounds(x,y,width,bottom-y)},bubbleSize$1=12,bubbleAlignments$1={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"],inset:["tox-pop--inset"]},anchorOverrides={maxHeightFunction:expandable$1(),maxWidthFunction:expandable()},isEntireElementSelected=function(editor,elem){var rng=editor.selection.getRng(),leaf$1=leaf(SugarElement.fromDom(rng.startContainer),rng.startOffset);return rng.startContainer===rng.endContainer&&rng.startOffset===rng.endOffset-1&&eq(leaf$1.element,elem)},preservePosition=function(elem,position,f){var currentPosition=getRaw(elem,"position");set$7(elem,"position",position);var result=f(elem);return currentPosition.each((function(pos){return set$7(elem,"position",pos)})),result},shouldUseInsetLayouts=function(position){return"node"===position},determineInsetLayout=function(editor,contextbar,elem,data,bounds){var selectionBounds=getSelectionBounds(editor),isSameAnchorElement=data.lastElement().exists((function(prev){return eq(elem,prev)})),yBounds,contextbarHeight;return isEntireElementSelected(editor,elem)?isSameAnchorElement?preserve:north:isSameAnchorElement?preservePosition(contextbar,data.getMode(),(function(){var isOverlapping;return isVerticalOverlap(selectionBounds,box$1(contextbar))&&!data.isReposition()?flip$2:preserve})):("fixed"===data.getMode()?bounds.y+get$9().top:bounds.y)+(get$b(contextbar)+12)<=selectionBounds.y?north:south},getAnchorSpec$2=function(editor,mobile,data,position){var smartInsetLayout=function(elem){return function(anchor,element,bubbles,placee,bounds){var layout=determineInsetLayout(editor,placee,elem,data,bounds),newAnchor=__assign(__assign({},anchor),{y:bounds.y,height:bounds.height});return __assign(__assign({},layout(newAnchor,element,bubbles,placee,bounds)),{alwaysFit:!0})}},getInsetLayouts=function(elem){return shouldUseInsetLayouts(position)?[smartInsetLayout(elem)]:[]},desktopAnchorSpecLayouts,mobileAnchorSpecLayouts;return mobile?{onLtr:function(elem){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2].concat(getInsetLayouts(elem))}}:{onLtr:function(elem){return[north$2,south$2,northeast$2,southeast$2,northwest$2,southwest$2].concat(getInsetLayouts(elem))},onRtl:function(elem){return[north$2,south$2,northwest$2,southwest$2,northeast$2,southeast$2].concat(getInsetLayouts(elem))}}},getAnchorLayout=function(editor,position,isTouch,data){return"line"===position?{bubble:nu$5(12,0,bubbleAlignments$1),layouts:{onLtr:function(){return[east$2]},onRtl:function(){return[west$2]}},overrides:anchorOverrides}:{bubble:nu$5(0,12,bubbleAlignments$1,1/12),layouts:getAnchorSpec$2(editor,isTouch,data,position),overrides:anchorOverrides}},matchTargetWith=function(elem,candidates){var ctxs=filter$2(candidates,(function(toolbarApi){return toolbarApi.predicate(elem.dom)})),_a=partition$3(ctxs,(function(t){return"contexttoolbar"===t.type})),pass,fail;return{contextToolbars:_a.pass,contextForms:_a.fail}},filterByPositionForStartNode=function(toolbars){if(toolbars.length<=1)return toolbars;var doesPositionExist=function(value){return exists(toolbars,(function(t){return t.position===value}))},filterToolbarsByPosition=function(value){return filter$2(toolbars,(function(t){return t.position===value}))},hasSelectionToolbars=doesPositionExist("selection"),hasNodeToolbars=doesPositionExist("node");if(hasSelectionToolbars||hasNodeToolbars){if(hasNodeToolbars&&hasSelectionToolbars){var nodeToolbars=filterToolbarsByPosition("node"),selectionToolbars=map$2(filterToolbarsByPosition("selection"),(function(t){return __assign(__assign({},t),{position:"node"})}));return nodeToolbars.concat(selectionToolbars)}return filterToolbarsByPosition(hasSelectionToolbars?"selection":"node")}return filterToolbarsByPosition("line")},filterByPositionForAncestorNode=function(toolbars){if(toolbars.length<=1)return toolbars;var findPosition_1=function(value){return find$5(toolbars,(function(t){return t.position===value}))},basePosition;return findPosition_1("selection").orThunk((function(){return findPosition_1("node")})).orThunk((function(){return findPosition_1("line")})).map((function(t){return t.position})).fold((function(){return[]}),(function(pos){return filter$2(toolbars,(function(t){return t.position===pos}))}))},matchStartNode=function(elem,nodeCandidates,editorCandidates){var nodeMatches=matchTargetWith(elem,nodeCandidates);if(nodeMatches.contextForms.length>0)return Optional.some({elem:elem,toolbars:[nodeMatches.contextForms[0]]});var editorMatches=matchTargetWith(elem,editorCandidates);if(editorMatches.contextForms.length>0)return Optional.some({elem:elem,toolbars:[editorMatches.contextForms[0]]});if(nodeMatches.contextToolbars.length>0||editorMatches.contextToolbars.length>0){var toolbars=filterByPositionForStartNode(nodeMatches.contextToolbars.concat(editorMatches.contextToolbars));return Optional.some({elem:elem,toolbars:toolbars})}return Optional.none()},matchAncestor=function(isRoot,startNode,scopes){return isRoot(startNode)?Optional.none():ancestor$2(startNode,(function(ancestorElem){if(isElement$2(ancestorElem)){var _a=matchTargetWith(ancestorElem,scopes.inNodeScope),contextToolbars=_a.contextToolbars,contextForms=_a.contextForms,toolbars=contextForms.length>0?contextForms:filterByPositionForAncestorNode(contextToolbars);return toolbars.length>0?Optional.some({elem:ancestorElem,toolbars:toolbars}):Optional.none()}return Optional.none()}),isRoot)},lookup$1=function(scopes,editor){var rootElem=SugarElement.fromDom(editor.getBody()),isRoot=function(elem){return eq(elem,rootElem)},isOutsideRoot=function(startNode){return!isRoot(startNode)&&!contains(rootElem,startNode)},startNode=SugarElement.fromDom(editor.selection.getNode());return isOutsideRoot(startNode)?Optional.none():matchStartNode(startNode,scopes.inNodeScope,scopes.inEditorScope).orThunk((function(){return matchAncestor(isRoot,startNode,scopes)}))},categorise=function(contextToolbars,navigate){var forms={},inNodeScope=[],inEditorScope=[],formNavigators={},lookupTable={},registerForm=function(key,toolbarSpec){var contextForm=getOrDie(createContextForm(toolbarSpec));forms[key]=contextForm,contextForm.launch.map((function(launch){formNavigators["form:"+key]=__assign(__assign({},toolbarSpec.launch),{type:"contextformtogglebutton"===launch.type?"togglebutton":"button",onAction:function(){navigate(contextForm)}})})),"editor"===contextForm.scope?inEditorScope.push(contextForm):inNodeScope.push(contextForm),lookupTable[key]=contextForm},registerToolbar=function(key,toolbarSpec){createContextToolbar(toolbarSpec).each((function(contextToolbar){"editor"===toolbarSpec.scope?inEditorScope.push(contextToolbar):inNodeScope.push(contextToolbar),lookupTable[key]=contextToolbar}))},keys$1=keys(contextToolbars);return each$1(keys$1,(function(key){var toolbarApi=contextToolbars[key];"contextform"===toolbarApi.type?registerForm(key,toolbarApi):"contexttoolbar"===toolbarApi.type&&registerToolbar(key,toolbarApi)})),{forms:forms,inNodeScope:inNodeScope,inEditorScope:inEditorScope,lookupTable:lookupTable,formNavigators:formNavigators}},forwardSlideEvent=generate$6("forward-slide"),backSlideEvent=generate$6("backward-slide"),changeSlideEvent=generate$6("change-slide-event"),resizingClass="tox-pop--resizing",renderContextToolbar=function(spec){var stack=Cell([]);return InlineView.sketch({dom:{tag:"div",classes:["tox-pop"]},fireDismissalEventInstead:{event:"doNotDismissYet"},onShow:function(comp){stack.set([]),InlineView.getContent(comp).each((function(c){remove$6(c.element,"visibility")})),remove$2(comp.element,resizingClass),remove$6(comp.element,"width")},inlineBehaviours:derive$1([config("context-toolbar-events",[runOnSource(transitionend(),(function(comp,se){"width"===se.event.raw.propertyName&&(remove$2(comp.element,resizingClass),remove$6(comp.element,"width"))})),run$1(changeSlideEvent,(function(comp,se){var elem=comp.element;remove$6(elem,"width");var currentWidth=get$a(elem);InlineView.setContent(comp,se.event.contents),add$2(elem,resizingClass);var newWidth=get$a(elem);set$7(elem,"width",currentWidth+"px"),InlineView.getContent(comp).each((function(newContents){se.event.focus.bind((function(f){return focus$3(f),search(elem)})).orThunk((function(){return Keying.focusIn(newContents),active(getRootNode(elem))}))})),global$f.setTimeout((function(){set$7(comp.element,"width",newWidth+"px")}),0)})),run$1(forwardSlideEvent,(function(comp,se){InlineView.getContent(comp).each((function(oldContents){stack.set(stack.get().concat([{bar:oldContents,focus:active(getRootNode(comp.element))}]))})),emitWith(comp,changeSlideEvent,{contents:se.event.forwardContents,focus:Optional.none()})})),run$1(backSlideEvent,(function(comp,_se){last$2(stack.get()).each((function(last){stack.set(stack.get().slice(0,stack.get().length-1)),emitWith(comp,changeSlideEvent,{contents:premade(last.bar),focus:last.focus})}))}))]),Keying.config({mode:"special",onEscape:function(comp){return last$2(stack.get()).fold((function(){return spec.onEscape()}),(function(_){return emit(comp,backSlideEvent),Optional.some(!0)}))}})]),lazySink:function(){return Result.value(spec.sink)}})},transitionClass="tox-pop--transition",register$7=function(editor,registryContextToolbars,sink,extras){var backstage=extras.backstage,sharedBackstage=backstage.shared,isTouch=detect$1().deviceType.isTouch,lastElement=value$1(),lastTrigger=value$1(),lastContextPosition=value$1(),contextbar=build$1(renderContextToolbar({sink:sink,onEscape:function(){return editor.focus(),Optional.some(!0)}})),getBounds=function(){var position=lastContextPosition.get().getOr("node"),margin=shouldUseInsetLayouts(position)?1:0;return getContextToolbarBounds(editor,sharedBackstage,position,margin)},canLaunchToolbar=function(){return!(editor.removed||isTouch()&&backstage.isContextMenuOpen())},isSameLaunchElement=function(elem){return is$1(lift2(elem,lastElement.get(),eq),!0)},shouldContextToolbarHide=function(){if(canLaunchToolbar()){var contextToolbarBounds=getBounds(),anchorBounds=is$1(lastContextPosition.get(),"node")?getAnchorElementBounds(editor,lastElement.get()):getSelectionBounds(editor);return contextToolbarBounds.height<=0||!isVerticalOverlap(anchorBounds,contextToolbarBounds)}return!0},close=function(){lastElement.clear(),lastTrigger.clear(),lastContextPosition.clear(),InlineView.hide(contextbar)},hideOrRepositionIfNecessary=function(){if(InlineView.isOpen(contextbar)){var contextBarEle=contextbar.element;remove$6(contextBarEle,"display"),shouldContextToolbarHide()?set$7(contextBarEle,"display","none"):(lastTrigger.set(0),InlineView.reposition(contextbar))}},wrapInPopDialog=function(toolbarSpec){return{dom:{tag:"div",classes:["tox-pop__dialog"]},components:[toolbarSpec],behaviours:derive$1([Keying.config({mode:"acyclic"}),config("pop-dialog-wrap-events",[runOnAttached((function(comp){editor.shortcuts.add("ctrl+F9","focus statusbar",(function(){return Keying.focusIn(comp)}))})),runOnDetached((function(_comp){editor.shortcuts.remove("ctrl+F9")}))])])}},getScopes=cached((function(){return categorise(registryContextToolbars,(function(toolbarApi){var alloySpec=buildToolbar([toolbarApi]);emitWith(contextbar,forwardSlideEvent,{forwardContents:wrapInPopDialog(alloySpec)})}))})),buildContextToolbarGroups=function(allButtons,ctx){return identifyButtons(editor,{buttons:allButtons,toolbar:ctx.items,allowToolbarGroups:!1},extras,Optional.some(["form:"]))},buildContextFormGroups=function(ctx,providers){return ContextForm_buildInitGroups(ctx,providers)},buildToolbar=function(toolbars){var buttons=editor.ui.registry.getAll().buttons,scopes=getScopes(),allButtons=__assign(__assign({},buttons),scopes.formNavigators),toolbarType=getToolbarMode(editor)===ToolbarMode.scrolling?ToolbarMode.scrolling:ToolbarMode.default,initGroups=flatten(map$2(toolbars,(function(ctx){return"contexttoolbar"===ctx.type?buildContextToolbarGroups(allButtons,ctx):buildContextFormGroups(ctx,sharedBackstage.providers)})));return renderToolbar({type:toolbarType,uid:generate$6("context-toolbar"),initGroups:initGroups,onEscape:Optional.none,cyclicKeying:!0,providers:sharedBackstage.providers})},getAnchor=function(position,element){var anchorage="node"===position?sharedBackstage.anchors.node(element):sharedBackstage.anchors.cursor(),anchorLayout=getAnchorLayout(editor,position,isTouch(),{lastElement:lastElement.get,isReposition:function(){return is$1(lastTrigger.get(),0)},getMode:function(){return Positioning.getMode(sink)}});return deepMerge(anchorage,anchorLayout)},launchContext=function(toolbarApi,elem){if(launchContextToolbar.cancel(),canLaunchToolbar()){var toolbarSpec=buildToolbar(toolbarApi),position=toolbarApi[0].position,anchor=getAnchor(position,elem);lastContextPosition.set(position),lastTrigger.set(1);var contextBarEle=contextbar.element;remove$6(contextBarEle,"display"),isSameLaunchElement(elem)||(remove$2(contextBarEle,transitionClass),Positioning.reset(sink,contextbar)),InlineView.showWithinBounds(contextbar,wrapInPopDialog(toolbarSpec),{anchor:anchor,transition:{classes:[transitionClass],mode:"placement"}},(function(){return Optional.some(getBounds())})),elem.fold(lastElement.clear,lastElement.set),shouldContextToolbarHide()&&set$7(contextBarEle,"display","none")}},launchContextToolbar=last((function(){if(editor.hasFocus()&&!editor.removed)if(has(contextbar.element,transitionClass))launchContextToolbar.throttle();else{var scopes=getScopes();lookup$1(scopes,editor).fold(close,(function(info){launchContext(info.toolbars,Optional.some(info.elem))}))}}),17);editor.on("init",(function(){editor.on("remove",close),editor.on("ScrollContent ScrollWindow ObjectResized ResizeEditor longpress",hideOrRepositionIfNecessary),editor.on("click keyup focus SetContent",launchContextToolbar.throttle),editor.on("contexttoolbar-hide",close),editor.on("contexttoolbar-show",(function(e){var scopes=getScopes();get$e(scopes.lookupTable,e.toolbarKey).each((function(ctx){launchContext([ctx],someIf(e.target!==editor,e.target)),InlineView.getContent(contextbar).each(Keying.focusIn)}))})),editor.on("focusout",(function(_e){global$f.setEditorTimeout(editor,(function(){search(sink.element).isNone()&&search(contextbar.element).isNone()&&close()}),0)})),editor.on("SwitchMode",(function(){editor.mode.isReadOnly()&&close()})),editor.on("AfterProgressState",(function(event){event.state?close():editor.hasFocus()&&launchContextToolbar.throttle()})),editor.on("NodeChange",(function(_e){search(contextbar.element).fold(launchContextToolbar.throttle,noop)}))}))},register$6=function(editor){var alignToolbarButtons;each$1([{name:"alignleft",text:"Align left",cmd:"JustifyLeft",icon:"align-left"},{name:"aligncenter",text:"Align center",cmd:"JustifyCenter",icon:"align-center"},{name:"alignright",text:"Align right",cmd:"JustifyRight",icon:"align-right"},{name:"alignjustify",text:"Justify",cmd:"JustifyFull",icon:"align-justify"}],(function(item){editor.ui.registry.addToggleButton(item.name,{tooltip:item.text,icon:item.icon,onAction:onActionExecCommand(editor,item.cmd),onSetup:onSetupFormatToggle(editor,item.name)})})),editor.ui.registry.addButton("alignnone",{tooltip:"No alignment",icon:"align-none",onAction:onActionExecCommand(editor,"JustifyNone")})},units={unsupportedLength:["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","in","pc","pt","px"],fixed:["px","pt"],relative:["%"],empty:[""]},pattern=(decimalDigits="[0-9]+",signedInteger="[+-]?[0-9]+",exponentPart="[eE][+-]?[0-9]+",dot="\\.",unsignedDecimalLiteral=["Infinity","[0-9]+\\."+(opt=function(input){return"(?:"+input+")?"})("[0-9]+")+opt(exponentPart),"\\.[0-9]+"+opt(exponentPart),"[0-9]+"+opt(exponentPart)].join("|"),new RegExp("^([+-]?(?:"+unsignedDecimalLiteral+"))(.*)$")),decimalDigits,signedInteger,exponentPart,dot,opt,unsignedDecimalLiteral,float,isUnit=function(unit,accepted){return exists(accepted,(function(acc){return exists(units[acc],(function(check){return unit===check}))}))},parse=function(input,accepted){var match;return Optional.from(pattern.exec(input)).bind((function(array){var value=Number(array[1]),unitRaw=array[2];return isUnit(unitRaw,accepted)?Optional.some({value:value,unit:unitRaw}):Optional.none()}))},normalise=function(input,accepted){return parse(input,accepted).map((function(_a){var value,unit;return _a.value+_a.unit}))},registerController=function(editor,spec){var getMenuItems=function(){var options=spec.getOptions(editor),initial=spec.getCurrent(editor).map(spec.hash),current=value$1();return map$2(options,(function(value){return{type:"togglemenuitem",text:spec.display(value),onSetup:function(api){var setActive=function(active){active&&(current.on((function(oldApi){return oldApi.setActive(!1)})),current.set(api)),api.setActive(active)};setActive(is$1(initial,spec.hash(value)));var unbindWatcher=spec.watcher(editor,value,setActive);return function(){current.clear(),unbindWatcher()}},onAction:function(){return spec.setCurrent(editor,value)}}}))};editor.ui.registry.addMenuButton(spec.name,{tooltip:spec.text,icon:spec.icon,fetch:function(callback){return callback(getMenuItems())},onSetup:spec.onToolbarSetup}),editor.ui.registry.addNestedMenuItem(spec.name,{type:"nestedmenuitem",text:spec.text,getSubmenuItems:getMenuItems,onSetup:spec.onMenuSetup})},lineHeightSpec={name:"lineheight",text:"Line height",icon:"line-height",getOptions:getLineHeightFormats,hash:function(input){return normalise(input,["fixed","relative","empty"]).getOr(input)},display:identity$1,watcher:function(editor,value,callback){return editor.formatter.formatChanged("lineheight",callback,!1,{value:value}).unbind},getCurrent:function(editor){return Optional.from(editor.queryCommandValue("LineHeight"))},setCurrent:function(editor,value){return editor.execCommand("LineHeight",!1,value)}},languageSpec=function(editor){var settingsOpt;return Optional.from(getContentLanguages(editor)).map((function(settings){return{name:"language",text:"Language",icon:"language",getOptions:constant$1(settings),hash:function(input){return isUndefined(input.customCode)?input.code:input.code+"/"+input.customCode},display:function(input){return input.title},watcher:function(editor,value,callback){return editor.formatter.formatChanged("lang",callback,!1,{value:value.code,customValue:value.customCode}).unbind},getCurrent:function(editor){var node=SugarElement.fromDom(editor.selection.getNode());return closest$4(node,(function(n){return Optional.some(n).filter(isElement$2).bind((function(ele){var codeOpt;return getOpt(ele,"lang").map((function(code){var customCode;return{code:code,customCode:getOpt(ele,"data-mce-lang").getOrUndefined(),title:""}}))}))}))},setCurrent:function(editor,lang){return editor.execCommand("Lang",!1,lang)},onToolbarSetup:function(api){var unbinder=unbindable();return api.setActive(editor.formatter.match("lang",{},void 0,!0)),unbinder.set(editor.formatter.formatChanged("lang",api.setActive,!0)),unbinder.clear}}}))},register$5=function(editor){registerController(editor,lineHeightSpec),languageSpec(editor).each((function(spec){return registerController(editor,spec)}))},register$4=function(editor,backstage){alignSelectMenu(editor,backstage),fontSelectMenu(editor,backstage),styleSelectMenu(editor,backstage),formatSelectMenu(editor,backstage),fontsizeSelectMenu(editor,backstage)},onSetupOutdentState=function(editor){return onSetupEvent(editor,"NodeChange",(function(api){api.setDisabled(!editor.queryCommandState("outdent"))}))},registerButtons$2=function(editor){editor.ui.registry.addButton("outdent",{tooltip:"Decrease indent",icon:"outdent",onSetup:onSetupOutdentState(editor),onAction:onActionExecCommand(editor,"outdent")}),editor.ui.registry.addButton("indent",{tooltip:"Increase indent",icon:"indent",onAction:onActionExecCommand(editor,"indent")})},register$3=function(editor){registerButtons$2(editor)},onActionToggleFormat=function(editor,fmt){return function(){editor.execCommand("mceToggleFormat",!1,fmt)}},registerFormatButtons=function(editor){global$5.each([{name:"bold",text:"Bold",icon:"bold"},{name:"italic",text:"Italic",icon:"italic"},{name:"underline",text:"Underline",icon:"underline"},{name:"strikethrough",text:"Strikethrough",icon:"strike-through"},{name:"subscript",text:"Subscript",icon:"subscript"},{name:"superscript",text:"Superscript",icon:"superscript"}],(function(btn,_idx){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onSetup:onSetupFormatToggle(editor,btn.name),onAction:onActionToggleFormat(editor,btn.name)})}));for(var i=1;i<=6;i++){var name_1="h"+i;editor.ui.registry.addToggleButton(name_1,{text:name_1.toUpperCase(),tooltip:"Heading "+i,onSetup:onSetupFormatToggle(editor,name_1),onAction:onActionToggleFormat(editor,name_1)})}},registerCommandButtons=function(editor){global$5.each([{name:"cut",text:"Cut",action:"Cut",icon:"cut"},{name:"copy",text:"Copy",action:"Copy",icon:"copy"},{name:"paste",text:"Paste",action:"Paste",icon:"paste"},{name:"help",text:"Help",action:"mceHelp",icon:"help"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all"},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document"},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting"},{name:"remove",text:"Remove",action:"Delete",icon:"remove"}],(function(btn){editor.ui.registry.addButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action)})}))},registerCommandToggleButtons=function(editor){global$5.each([{name:"blockquote",text:"Blockquote",action:"mceBlockQuote",icon:"quote"}],(function(btn){editor.ui.registry.addToggleButton(btn.name,{tooltip:btn.text,icon:btn.icon,onAction:onActionExecCommand(editor,btn.action),onSetup:onSetupFormatToggle(editor,btn.name)})}))},registerButtons$1=function(editor){registerFormatButtons(editor),registerCommandButtons(editor),registerCommandToggleButtons(editor)},registerMenuItems$2=function(editor){global$5.each([{name:"bold",text:"Bold",action:"Bold",icon:"bold",shortcut:"Meta+B"},{name:"italic",text:"Italic",action:"Italic",icon:"italic",shortcut:"Meta+I"},{name:"underline",text:"Underline",action:"Underline",icon:"underline",shortcut:"Meta+U"},{name:"strikethrough",text:"Strikethrough",action:"Strikethrough",icon:"strike-through",shortcut:""},{name:"subscript",text:"Subscript",action:"Subscript",icon:"subscript",shortcut:""},{name:"superscript",text:"Superscript",action:"Superscript",icon:"superscript",shortcut:""},{name:"removeformat",text:"Clear formatting",action:"RemoveFormat",icon:"remove-formatting",shortcut:""},{name:"newdocument",text:"New document",action:"mceNewDocument",icon:"new-document",shortcut:""},{name:"cut",text:"Cut",action:"Cut",icon:"cut",shortcut:"Meta+X"},{name:"copy",text:"Copy",action:"Copy",icon:"copy",shortcut:"Meta+C"},{name:"paste",text:"Paste",action:"Paste",icon:"paste",shortcut:"Meta+V"},{name:"selectall",text:"Select all",action:"SelectAll",icon:"select-all",shortcut:"Meta+A"}],(function(btn){editor.ui.registry.addMenuItem(btn.name,{text:btn.text,icon:btn.icon,shortcut:btn.shortcut,onAction:onActionExecCommand(editor,btn.action)})})),editor.ui.registry.addMenuItem("codeformat",{text:"Code",icon:"sourcecode",onAction:onActionToggleFormat(editor,"code")})},register$2=function(editor){registerButtons$1(editor),registerMenuItems$2(editor)},onSetupUndoRedoState=function(editor,type){return onSetupEvent(editor,"Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",(function(api){api.setDisabled(editor.mode.isReadOnly()||!editor.undoManager[type]())}))},registerMenuItems$1=function(editor){editor.ui.registry.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})},registerButtons=function(editor){editor.ui.registry.addButton("undo",{tooltip:"Undo",icon:"undo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasUndo"),onAction:onActionExecCommand(editor,"undo")}),editor.ui.registry.addButton("redo",{tooltip:"Redo",icon:"redo",disabled:!0,onSetup:onSetupUndoRedoState(editor,"hasRedo"),onAction:onActionExecCommand(editor,"redo")})},register$1=function(editor){registerMenuItems$1(editor),registerButtons(editor)},onSetupVisualAidState=function(editor){return onSetupEvent(editor,"VisualAid",(function(api){api.setActive(editor.hasVisual)}))},registerMenuItems=function(editor){editor.ui.registry.addToggleMenuItem("visualaid",{text:"Visual aids",onSetup:onSetupVisualAidState(editor),onAction:onActionExecCommand(editor,"mceToggleVisualAid")})},registerToolbarButton=function(editor){editor.ui.registry.addButton("visualaid",{tooltip:"Visual aids",text:"Visual aids",onAction:onActionExecCommand(editor,"mceToggleVisualAid")})},register=function(editor){registerToolbarButton(editor),registerMenuItems(editor)},setup$6=function(editor,backstage){register$6(editor),register$2(editor),register$4(editor,backstage),register$1(editor),register$a(editor),register(editor),register$3(editor),register$5(editor)},nu=function(x,y){return{type:"makeshift",x:x,y:y}},transpose=function(pos,dx,dy){return nu(pos.x+dx,pos.y+dy)},isTouchEvent=function(e){return"longpress"===e.type||0===e.type.indexOf("touch")},fromPageXY=function(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.pageX,touch.pageY)}return nu(e.pageX,e.pageY)},fromClientXY=function(e){if(isTouchEvent(e)){var touch=e.touches[0];return nu(touch.clientX,touch.clientY)}return nu(e.clientX,e.clientY)},transposeContentAreaContainer=function(element,pos){var containerPos=global$b.DOM.getPos(element);return transpose(pos,containerPos.x,containerPos.y)},getPointAnchor=function(editor,e){return"contextmenu"===e.type||"longpress"===e.type?editor.inline?fromPageXY(e):transposeContentAreaContainer(editor.getContentAreaContainer(),fromClientXY(e)):getSelectionAnchor(editor)},getSelectionAnchor=function(editor){return{type:"selection",root:SugarElement.fromDom(editor.selection.getNode())}},getNodeAnchor=function(editor){return{type:"node",node:Optional.some(SugarElement.fromDom(editor.selection.getNode())),root:SugarElement.fromDom(editor.getBody())}},getAnchorSpec$1=function(editor,e,anchorType){switch(anchorType){case"node":return getNodeAnchor(editor);case"point":return getPointAnchor(editor,e);case"selection":return getSelectionAnchor(editor)}},initAndShow$1=function(editor,e,buildMenu,backstage,contextmenu,anchorType){var items=buildMenu(),anchorSpec=getAnchorSpec$1(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!1).map((function(menuData){e.preventDefault(),InlineView.showMenuAt(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal")},data:menuData})}))},layouts={onLtr:function(){return[south$2,southeast$2,southwest$2,northeast$2,northwest$2,north$2,north,south,northeast,southeast,northwest,southwest]},onRtl:function(){return[south$2,southwest$2,southeast$2,northwest$2,northeast$2,north$2,north,south,northwest,southwest,northeast,southeast]}},bubbleSize=12,bubbleAlignments={valignCentre:[],alignCentre:[],alignLeft:["tox-pop--align-left"],alignRight:["tox-pop--align-right"],right:["tox-pop--right"],left:["tox-pop--left"],bottom:["tox-pop--bottom"],top:["tox-pop--top"]},isTouchWithinSelection=function(editor,e){var selection=editor.selection;if(selection.isCollapsed()||e.touches.length<1)return!1;var touch_1=e.touches[0],rng=selection.getRng(),rngRectOpt;return getFirstRect(editor.getWin(),SimSelection.domRange(rng)).exists((function(rngRect){return rngRect.left<=touch_1.clientX&&rngRect.right>=touch_1.clientX&&rngRect.top<=touch_1.clientY&&rngRect.bottom>=touch_1.clientY}))},setupiOSOverrides=function(editor){var originalSelection=editor.selection.getRng(),selectionReset=function(){global$f.setEditorTimeout(editor,(function(){editor.selection.setRng(originalSelection)}),10),unbindEventListeners()};editor.once("touchend",selectionReset);var preventMousedown=function(e){e.preventDefault(),e.stopImmediatePropagation()};editor.on("mousedown",preventMousedown,!0);var clearSelectionReset=function(){return unbindEventListeners()};editor.once("longpresscancel",clearSelectionReset);var unbindEventListeners=function(){editor.off("touchend",selectionReset),editor.off("longpresscancel",clearSelectionReset),editor.off("mousedown",preventMousedown)}},getAnchorSpec=function(editor,e,anchorType){var anchorSpec=getAnchorSpec$1(editor,e,anchorType),bubbleYOffset;return __assign({bubble:nu$5(0,"point"===anchorType?12:0,bubbleAlignments),layouts:layouts,overrides:{maxWidthFunction:expandable(),maxHeightFunction:expandable$1()}},anchorSpec)},show=function(editor,e,items,backstage,contextmenu,anchorType,highlightImmediately){var anchorSpec=getAnchorSpec(editor,e,anchorType);build(items,ItemResponse$1.CLOSE_ON_EXECUTE,backstage,!0).map((function(menuData){e.preventDefault(),InlineView.showMenuWithinBounds(contextmenu,{anchor:anchorSpec},{menu:{markers:markers("normal"),highlightImmediately:highlightImmediately},data:menuData,type:"horizontal"},(function(){return Optional.some(getContextToolbarBounds(editor,backstage.shared,"node"===anchorType?"node":"selection"))})),editor.fire("contexttoolbar-hide")}))},initAndShow=function(editor,e,buildMenu,backstage,contextmenu,anchorType){var detection=detect$1(),isiOS=detection.os.isiOS(),isOSX=detection.os.isOSX(),isAndroid=detection.os.isAndroid(),isTouch=detection.deviceType.isTouch(),shouldHighlightImmediately=function(){return!(isAndroid||isiOS||isOSX&&isTouch)},open=function(){var items=buildMenu();show(editor,e,items,backstage,contextmenu,anchorType,shouldHighlightImmediately())};if((isOSX||isiOS)&&"node"!==anchorType){var openiOS_1=function(){setupiOSOverrides(editor),open()};isTouchWithinSelection(editor,e)?openiOS_1():(editor.once("selectionchange",openiOS_1),editor.once("touchend",(function(){return editor.off("selectionchange",openiOS_1)})))}else open()},patchPipeConfig=function(config){return"string"==typeof config?config.split(/[ ,]/):config},shouldNeverUseNative=function(editor){return editor.getParam("contextmenu_never_use_native",!1,"boolean")},getMenuItems=function(editor,name,defaultItems){var contextMenus=editor.ui.registry.getAll().contextMenus;return Optional.from(editor.getParam(name)).map(patchPipeConfig).getOrThunk((function(){return filter$2(patchPipeConfig(defaultItems),(function(item){return has$2(contextMenus,item)}))}))},isContextMenuDisabled=function(editor){return!1===editor.getParam("contextmenu")},getContextMenu=function(editor){return getMenuItems(editor,"contextmenu","link linkchecker image imagetools table spellchecker configurepermanentpen")},getAvoidOverlapSelector=function(editor){return editor.getParam("contextmenu_avoid_overlap","","string")},isSeparator=function(item){return isString(item)?"|"===item:"separator"===item.type},separator={type:"separator"},makeContextItem=function(item){var commonMenuItem=function(item){return{text:item.text,icon:item.icon,disabled:item.disabled,shortcut:item.shortcut}};if(isString(item))return item;switch(item.type){case"separator":return separator;case"submenu":return __assign(__assign({type:"nestedmenuitem"},commonMenuItem(item)),{getSubmenuItems:function(){var items=item.getSubmenuItems();return isString(items)?items:map$2(items,makeContextItem)}});default:return __assign(__assign({type:"menuitem"},commonMenuItem(item)),{onAction:noarg(item.onAction)})}},addContextMenuGroup=function(xs,groupItems){if(0===groupItems.length)return xs;var lastMenuItem,before=last$2(xs).filter((function(item){return!isSeparator(item)})).fold((function(){return[]}),(function(_){return[separator]}));return xs.concat(before).concat(groupItems).concat([separator])},generateContextMenu=function(contextMenus,menuConfig,selectedElement){var sections=foldl(menuConfig,(function(acc,name){return get$e(contextMenus,name.toLowerCase()).map((function(menu){var items=menu.update(selectedElement);if(isString(items))return addContextMenuGroup(acc,items.split(" "));if(items.length>0){var allItems=map$2(items,makeContextItem);return addContextMenuGroup(acc,allItems)}return acc})).getOrThunk((function(){return acc.concat([name])}))}),[]);return sections.length>0&&isSeparator(sections[sections.length-1])&&sections.pop(),sections},isNativeOverrideKeyEvent=function(editor,e){return e.ctrlKey&&!shouldNeverUseNative(editor)},isTriggeredByKeyboard=function(editor,e){return"longpress"!==e.type&&(2!==e.button||e.target===editor.getBody()&&""===e.pointerType)},getSelectedElement=function(editor,e){return isTriggeredByKeyboard(editor,e)?editor.selection.getStart(!0):e.target},getAnchorType=function(editor,e){var selector=getAvoidOverlapSelector(editor),anchorType=isTriggeredByKeyboard(editor,e)?"selection":"point";if(isNotEmpty(selector)){var target=getSelectedElement(editor,e),selectorExists;return closest(SugarElement.fromDom(target),selector)?"node":anchorType}return anchorType},setup$5=function(editor,lazySink,backstage){var detection,isTouch=detect$1().deviceType.isTouch,contextmenu=build$1(InlineView.sketch({dom:{tag:"div"},lazySink:lazySink,onEscape:function(){return editor.focus()},onShow:function(){return backstage.setContextMenuState(!0)},onHide:function(){return backstage.setContextMenuState(!1)},fireDismissalEventInstead:{},inlineBehaviours:derive$1([config("dismissContextMenu",[run$1(dismissRequested(),(function(comp,_se){Sandboxing.close(comp),editor.focus()}))])])})),hideContextMenu=function(_e){return InlineView.hide(contextmenu)},showContextMenu=function(e){if(shouldNeverUseNative(editor)&&e.preventDefault(),!isNativeOverrideKeyEvent(editor,e)&&!isContextMenuDisabled(editor)){var anchorType=getAnchorType(editor,e),buildMenu=function(){var selectedElement=getSelectedElement(editor,e),registry=editor.ui.registry.getAll(),menuConfig=getContextMenu(editor);return generateContextMenu(registry.contextMenus,menuConfig,selectedElement)},initAndShow$2;(isTouch()?initAndShow:initAndShow$1)(editor,e,buildMenu,backstage,contextmenu,anchorType)}};editor.on("init",(function(){var hideEvents="ResizeEditor ScrollContent ScrollWindow longpresscancel"+(isTouch()?"":" ResizeWindow");editor.on(hideEvents,hideContextMenu),editor.on("longpress contextmenu",showContextMenu)}))},adt=Adt_generate([{offset:["x","y"]},{absolute:["x","y"]},{fixed:["x","y"]}]),subtract=function(change){return function(point){return point.translate(-change.left,-change.top)}},add=function(change){return function(point){return point.translate(change.left,change.top)}},transform=function(changes){return function(x,y){return foldl(changes,(function(rest,f){return f(rest)}),SugarPosition(x,y))}},asFixed=function(coord,scroll,origin){return coord.fold(transform([add(origin),subtract(scroll)]),transform([subtract(scroll)]),transform([]))},asAbsolute=function(coord,scroll,origin){return coord.fold(transform([add(origin)]),transform([]),transform([add(scroll)]))},asOffset=function(coord,scroll,origin){return coord.fold(transform([]),transform([subtract(origin)]),transform([add(scroll),subtract(origin)]))},withinRange=function(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin),a2=asAbsolute(coord2,scroll,origin);return Math.abs(a1.left-a2.left)<=xRange&&Math.abs(a1.top-a2.top)<=yRange},getDeltas=function(coord1,coord2,xRange,yRange,scroll,origin){var a1=asAbsolute(coord1,scroll,origin),a2=asAbsolute(coord2,scroll,origin),left=Math.abs(a1.left-a2.left),top=Math.abs(a1.top-a2.top);return SugarPosition(left,top)},toStyles=function(coord,scroll,origin){var stylesOpt=coord.fold((function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}}),(function(x,y){return{position:Optional.some("absolute"),left:Optional.some(x-origin.left+"px"),top:Optional.some(y-origin.top+"px")}}),(function(x,y){return{position:Optional.some("fixed"),left:Optional.some(x+"px"),top:Optional.some(y+"px")}}));return __assign({right:Optional.none(),bottom:Optional.none()},stylesOpt)},translate=function(coord,deltaX,deltaY){return coord.fold((function(x,y){return offset(x+deltaX,y+deltaY)}),(function(x,y){return absolute(x+deltaX,y+deltaY)}),(function(x,y){return fixed(x+deltaX,y+deltaY)}))},absorb=function(partialCoord,originalCoord,scroll,origin){var absorbOne=function(stencil,nu){return function(optX,optY){var original=stencil(originalCoord,scroll,origin);return nu(optX.getOr(original.left),optY.getOr(original.top))}};return partialCoord.fold(absorbOne(asOffset,offset),absorbOne(asAbsolute,absolute),absorbOne(asFixed,fixed))},offset=adt.offset,absolute=adt.absolute,fixed=adt.fixed,parseAttrToInt=function(element,name){var value=get$d(element,name);return isUndefined(value)?NaN:parseInt(value,10)},get=function(component,snapsInfo){var element=component.element,x=parseAttrToInt(element,snapsInfo.leftAttr),y=parseAttrToInt(element,snapsInfo.topAttr);return isNaN(x)||isNaN(y)?Optional.none():Optional.some(SugarPosition(x,y))},set=function(component,snapsInfo,pt){var element=component.element;set$8(element,snapsInfo.leftAttr,pt.left+"px"),set$8(element,snapsInfo.topAttr,pt.top+"px")},clear=function(component,snapsInfo){var element=component.element;remove$7(element,snapsInfo.leftAttr),remove$7(element,snapsInfo.topAttr)},getCoords=function(component,snapInfo,coord,delta){return get(component,snapInfo).fold((function(){return coord}),(function(fixed$1){return fixed(fixed$1.left+delta.left,fixed$1.top+delta.top)}))},moveOrSnap=function(component,snapInfo,coord,delta,scroll,origin){var newCoord=getCoords(component,snapInfo,coord,delta),snap=snapInfo.mustSnap?findClosestSnap(component,snapInfo,newCoord,scroll,origin):findSnap(component,snapInfo,newCoord,scroll,origin),fixedCoord=asFixed(newCoord,scroll,origin);return set(component,snapInfo,fixedCoord),snap.fold((function(){return{coord:fixed(fixedCoord.left,fixedCoord.top),extra:Optional.none()}}),(function(spanned){return{coord:spanned.output,extra:spanned.extra}}))},stopDrag=function(component,snapInfo){clear(component,snapInfo)},findMatchingSnap=function(snaps,newCoord,scroll,origin){return findMap(snaps,(function(snap){var sensor=snap.sensor,inRange;return withinRange(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin)?Optional.some({output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}):Optional.none()}))},findClosestSnap=function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component),matchSnap;return findMatchingSnap(snaps,newCoord,scroll,origin).orThunk((function(){var bestSnap;return foldl(snaps,(function(acc,snap){var sensor=snap.sensor,deltas=getDeltas(newCoord,sensor,snap.range.left,snap.range.top,scroll,origin);return acc.deltas.fold((function(){return{deltas:Optional.some(deltas),snap:Optional.some(snap)}}),(function(bestDeltas){var currAvg,bestAvg;return(deltas.left+deltas.top)/2<=(bestDeltas.left+bestDeltas.top)/2?{deltas:Optional.some(deltas),snap:Optional.some(snap)}:acc}))}),{deltas:Optional.none(),snap:Optional.none()}).snap.map((function(snap){return{output:absorb(snap.output,newCoord,scroll,origin),extra:snap.extra}}))}))},findSnap=function(component,snapInfo,newCoord,scroll,origin){var snaps=snapInfo.getSnapPoints(component);return findMatchingSnap(snaps,newCoord,scroll,origin)},snapTo$1=function(snap,scroll,origin){return{coord:absorb(snap.output,snap.output,scroll,origin),extra:snap.extra}},snapTo=function(component,dragConfig,_state,snap){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element),scroll_1=get$9(doc),origin_1=getOrigin(target),snapPin=snapTo$1(snap,scroll_1,origin_1),styles=toStyles(snapPin.coord,scroll_1,origin_1);setOptions(target,styles)}},DraggingApis=Object.freeze({__proto__:null,snapTo:snapTo}),initialAttribute="data-initial-z-index",resetZIndex=function(blocker){parent(blocker.element).filter(isElement$2).each((function(root){getOpt(root,initialAttribute).fold((function(){return remove$6(root,"z-index")}),(function(zIndex){return set$7(root,"z-index",zIndex)})),remove$7(root,initialAttribute)}))},changeZIndex=function(blocker){parent(blocker.element).filter(isElement$2).each((function(root){getRaw(root,"z-index").each((function(zindex){set$8(root,initialAttribute,zindex)})),set$7(root,"z-index",get$c(blocker.element,"z-index"))}))},instigate=function(anyComponent,blocker){anyComponent.getSystem().addToGui(blocker),changeZIndex(blocker)},discard=function(blocker){resetZIndex(blocker),blocker.getSystem().removeFromGui(blocker)},createComponent=function(component,blockerClass,blockerEvents){return component.getSystem().build(Container.sketch({dom:{styles:{left:"0px",top:"0px",width:"100%",height:"100%",position:"fixed","z-index":"1000000000000000"},classes:[blockerClass]},events:blockerEvents}))},SnapSchema=optionObjOf("snaps",[required$1("getSnapPoints"),onHandler("onSensor"),required$1("leftAttr"),required$1("topAttr"),defaulted("lazyViewport",win),defaulted("mustSnap",!1)]),schema$6=[defaulted("useFixed",never),required$1("blockerClass"),defaulted("getTarget",identity$1),defaulted("onDrag",noop),defaulted("repositionTarget",!0),defaulted("onDrop",noop),defaultedFunction("getBounds",win),SnapSchema],getCurrentCoord=function(target){return lift3(getRaw(target,"left"),getRaw(target,"top"),getRaw(target,"position"),(function(left,top,position){var nu;return("fixed"===position?fixed:offset)(parseInt(left,10),parseInt(top,10))})).getOrThunk((function(){var location=absolute$3(target);return absolute(location.left,location.top)}))},clampCoords=function(component,coords,scroll,origin,startData){var bounds=startData.bounds,absoluteCoord=asAbsolute(coords,scroll,origin),newX=clamp$1(absoluteCoord.left,bounds.x,bounds.x+bounds.width-startData.width),newY=clamp$1(absoluteCoord.top,bounds.y,bounds.y+bounds.height-startData.height),newCoords=absolute(newX,newY);return coords.fold((function(){var offset$1=asOffset(newCoords,scroll,origin);return offset(offset$1.left,offset$1.top)}),constant$1(newCoords),(function(){var fixed$1=asFixed(newCoords,scroll,origin);return fixed(fixed$1.left,fixed$1.top)}))},calcNewCoord=function(component,optSnaps,currentCoord,scroll,origin,delta,startData){var newCoord=optSnaps.fold((function(){var translated=translate(currentCoord,delta.left,delta.top),fixedCoord=asFixed(translated,scroll,origin);return fixed(fixedCoord.left,fixedCoord.top)}),(function(snapInfo){var snapping=moveOrSnap(component,snapInfo,currentCoord,delta,scroll,origin);return snapping.extra.each((function(extra){snapInfo.onSensor(component,extra)})),snapping.coord}));return clampCoords(component,newCoord,scroll,origin,startData)},dragBy=function(component,dragConfig,startData,delta){var target=dragConfig.getTarget(component.element);if(dragConfig.repositionTarget){var doc=owner$4(component.element),scroll_1=get$9(doc),origin_1=getOrigin(target),currentCoord=getCurrentCoord(target),newCoord=calcNewCoord(component,dragConfig.snaps,currentCoord,scroll_1,origin_1,delta,startData),styles=toStyles(newCoord,scroll_1,origin_1);setOptions(target,styles)}dragConfig.onDrag(component,target,delta)},calcStartData=function(dragConfig,comp){return{bounds:dragConfig.getBounds(),height:getOuter$2(comp.element),width:getOuter$1(comp.element)}},move=function(component,dragConfig,dragState,dragMode,event){var delta=dragState.update(dragMode,event),dragStartData=dragState.getStartData().getOrThunk((function(){return calcStartData(dragConfig,component)}));delta.each((function(dlt){dragBy(component,dragConfig,dragStartData,dlt)}))},stop=function(component,blocker,dragConfig,dragState){blocker.each(discard),dragConfig.snaps.each((function(snapInfo){stopDrag(component,snapInfo)}));var target=dragConfig.getTarget(component.element);dragState.reset(),dragConfig.onDrop(component,target)},handlers=function(events){return function(dragConfig,dragState){var updateStartState=function(comp){dragState.setStartData(calcStartData(dragConfig,comp))};return derive$2(__spreadArray([run$1(windowScroll(),(function(comp){dragState.getStartData().each((function(){return updateStartState(comp)}))}))],events(dragConfig,dragState,updateStartState),!0))}},init$2=function(dragApi){return derive$2([run$1(mousedown(),dragApi.forceDrop),run$1(mouseup(),dragApi.drop),run$1(mousemove(),(function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)})),run$1(mouseout(),dragApi.delayDrop)])},getData$1=function(event){return Optional.from(SugarPosition(event.x,event.y))},getDelta$1=function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)},MouseData=Object.freeze({__proto__:null,getData:getData$1,getDelta:getDelta$1}),events$2=function(dragConfig,dragState,updateStartState){return[run$1(mousedown(),(function(component,simulatedEvent){var raw;if(0===simulatedEvent.event.raw.button){simulatedEvent.stop();var stop$1=function(){return stop(component,Optional.some(blocker),dragConfig,dragState)},delayDrop=DelayedFunction(stop$1,200),dragApi={drop:stop$1,delayDrop:delayDrop.schedule,forceDrop:stop$1,move:function(event){delayDrop.cancel(),move(component,dragConfig,dragState,MouseData,event)}},blocker=createComponent(component,dragConfig.blockerClass,init$2(dragApi)),start;(function(){updateStartState(component),instigate(component,blocker)})()}}))]},schema$5=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers(events$2)})],!1),init$1=function(dragApi){return derive$2([run$1(touchstart(),dragApi.forceDrop),run$1(touchend(),dragApi.drop),run$1(touchcancel(),dragApi.drop),run$1(touchmove(),(function(comp,simulatedEvent){dragApi.move(simulatedEvent.event)}))])},getDataFrom=function(touches){var touch=touches[0];return Optional.some(SugarPosition(touch.clientX,touch.clientY))},getData=function(event){var raw,touches=event.raw.touches;return 1===touches.length?getDataFrom(touches):Optional.none()},getDelta=function(old,nu){return SugarPosition(nu.left-old.left,nu.top-old.top)},TouchData=Object.freeze({__proto__:null,getData:getData,getDelta:getDelta}),events$1=function(dragConfig,dragState,updateStartState){var blockerSingleton=value$1(),stopBlocking=function(component){stop(component,blockerSingleton.get(),dragConfig,dragState),blockerSingleton.clear()};return[run$1(touchstart(),(function(component,simulatedEvent){simulatedEvent.stop();var stop=function(){return stopBlocking(component)},dragApi={drop:stop,delayDrop:noop,forceDrop:stop,move:function(event){move(component,dragConfig,dragState,TouchData,event)}},blocker=createComponent(component,dragConfig.blockerClass,init$1(dragApi)),start;blockerSingleton.set(blocker),updateStartState(component),instigate(component,blocker)})),run$1(touchmove(),(function(component,simulatedEvent){simulatedEvent.stop(),move(component,dragConfig,dragState,TouchData,simulatedEvent.event)})),run$1(touchend(),(function(component,simulatedEvent){simulatedEvent.stop(),stopBlocking(component)})),run$1(touchcancel(),stopBlocking)]},schema$4,events=function(dragConfig,dragState,updateStartState){return __spreadArray(__spreadArray([],events$2(dragConfig,dragState,updateStartState),!0),events$1(dragConfig,dragState,updateStartState),!0)},schema$3,mouse=schema$5,touch=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers(events$1)})],!1),mouseOrTouch=__spreadArray(__spreadArray([],schema$6,!0),[output$1("dragger",{handlers:handlers(events)})],!1),DraggingBranches,init=function(){var previous=Optional.none(),startData=Optional.none(),reset=function(){previous=Optional.none(),startData=Optional.none()},calculateDelta=function(mode,nu){var result=previous.map((function(old){return mode.getDelta(old,nu)}));return previous=Optional.some(nu),result},update=function(mode,dragEvent){return mode.getData(dragEvent).bind((function(nuData){return calculateDelta(mode,nuData)}))},setStartData=function(data){startData=Optional.some(data)},getStartData=function(){return startData},readState=constant$1({});return nu$8({readState:readState,reset:reset,update:update,getStartData:getStartData,setStartData:setStartData})},DragState,Dragging=createModes({branchKey:"mode",branches:Object.freeze({__proto__:null,mouse:mouse,touch:touch,mouseOrTouch:mouseOrTouch}),name:"dragging",active:{events:function(dragConfig,dragState){var dragger;return dragConfig.dragger.handlers(dragConfig,dragState)}},extra:{snap:function(sConfig){return{sensor:sConfig.sensor,range:sConfig.range,output:sConfig.output,extra:Optional.from(sConfig.extra)}}},state:Object.freeze({__proto__:null,init:init}),apis:DraggingApis}),snapWidth=40,snapOffset=20,calcSnap=function(selectorOpt,td,x,y,width,height){return selectorOpt.fold((function(){return Dragging.snap({sensor:absolute(x-20,y-20),range:SugarPosition(width,height),output:absolute(Optional.some(x),Optional.some(y)),extra:{td:td}})}),(function(selectorHandle){var sensorLeft=x-20,sensorTop=y-20,sensorWidth=40,sensorHeight=40,rect=selectorHandle.element.dom.getBoundingClientRect();return Dragging.snap({sensor:absolute(sensorLeft,sensorTop),range:SugarPosition(40,40),output:absolute(Optional.some(x-rect.width/2),Optional.some(y-rect.height/2)),extra:{td:td}})}))},getSnapsConfig=function(getSnapPoints,cell,onChange){var isSameCell=function(cellOpt,td){return cellOpt.exists((function(currentTd){return eq(currentTd,td)}))};return{getSnapPoints:getSnapPoints,leftAttr:"data-drag-left",topAttr:"data-drag-top",onSensor:function(component,extra){var td=extra.td;isSameCell(cell.get(),td)||(cell.set(td),onChange(td))},mustSnap:!0}},createSelector=function(snaps){return record(Button.sketch({dom:{tag:"div",classes:["tox-selector"]},buttonBehaviours:derive$1([Dragging.config({mode:"mouseOrTouch",blockerClass:"blocker",snaps:snaps}),Unselecting.config({})]),eventOrder:{mousedown:["dragging","alloy.base.behaviour"],touchstart:["dragging","alloy.base.behaviour"]}}))},setup$4=function(editor,sink){var tlTds=Cell([]),brTds=Cell([]),isVisible=Cell(!1),startCell=value$1(),finishCell=value$1(),getTopLeftSnap=function(td){var box=absolute$2(td);return calcSnap(memTopLeft.getOpt(sink),td,box.x,box.y,box.width,box.height)},getTopLeftSnaps,getBottomRightSnap=function(td){var box=absolute$2(td);return calcSnap(memBottomRight.getOpt(sink),td,box.right,box.bottom,box.width,box.height)},getBottomRightSnaps=function(){return map$2(brTds.get(),(function(td){return getBottomRightSnap(td)}))},topLeftSnaps=getSnapsConfig((function(){return map$2(tlTds.get(),(function(td){return getTopLeftSnap(td)}))}),startCell,(function(start){finishCell.get().each((function(finish){editor.fire("TableSelectorChange",{start:start,finish:finish})}))})),bottomRightSnaps=getSnapsConfig(getBottomRightSnaps,finishCell,(function(finish){startCell.get().each((function(start){editor.fire("TableSelectorChange",{start:start,finish:finish})}))})),memTopLeft=createSelector(topLeftSnaps),memBottomRight=createSelector(bottomRightSnaps),topLeft=build$1(memTopLeft.asSpec()),bottomRight=build$1(memBottomRight.asSpec()),showOrHideHandle=function(selector,cell,isAbove,isBelow){var cellRect=cell.dom.getBoundingClientRect();remove$6(selector.element,"display");var viewportHeight=defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight,aboveViewport=isAbove(cellRect),belowViewport=isBelow(cellRect,viewportHeight);(aboveViewport||belowViewport)&&set$7(selector.element,"display","none")},snapTo=function(selector,cell,getSnapConfig,pos){var snap=getSnapConfig(cell),isAbove,isBelow;Dragging.snapTo(selector,snap),showOrHideHandle(selector,cell,(function(rect){return rect[pos]<0}),(function(rect,viewportHeight){return rect[pos]>viewportHeight}))},snapTopLeft=function(cell){return snapTo(topLeft,cell,getTopLeftSnap,"top")},snapLastTopLeft=function(){return startCell.get().each(snapTopLeft)},snapBottomRight=function(cell){return snapTo(bottomRight,cell,getBottomRightSnap,"bottom")},snapLastBottomRight=function(){return finishCell.get().each(snapBottomRight)};detect$1().deviceType.isTouch()&&(editor.on("TableSelectionChange",(function(e){isVisible.get()||(attach(sink,topLeft),attach(sink,bottomRight),isVisible.set(!0)),startCell.set(e.start),finishCell.set(e.finish),e.otherCells.each((function(otherCells){tlTds.set(otherCells.upOrLeftCells),brTds.set(otherCells.downOrRightCells),snapTopLeft(e.start),snapBottomRight(e.finish)}))})),editor.on("ResizeEditor ResizeWindow ScrollContent",(function(){snapLastTopLeft(),snapLastBottomRight()})),editor.on("TableSelectionClear",(function(){isVisible.get()&&(detach(topLeft),detach(bottomRight),isVisible.set(!1)),startCell.clear(),finishCell.clear()})))},isHidden=function(elm){if(1===elm.nodeType){if("BR"===elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1},renderElementPath=function(editor,settings,providersBackstage){settings.delimiter||(settings.delimiter="");var getDataPath=function(data){var parts,newPathElements=map$2(data||[],(function(part,index){return Button.sketch({dom:{tag:"div",classes:["tox-statusbar__path-item"],attributes:{role:"button","data-index":index,"tab-index":-1,"aria-level":index+1},innerHtml:part.name},action:function(_btn){editor.focus(),editor.selection.select(part.element),editor.nodeChanged()},buttonBehaviours:derive$1([DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig()])})})),divider={dom:{tag:"div",classes:["tox-statusbar__path-divider"],attributes:{"aria-hidden":!0},innerHtml:" "+settings.delimiter+" "}};return foldl(newPathElements.slice(1),(function(acc,element){var newAcc=acc;return newAcc.push(divider),newAcc.push(element),newAcc}),[newPathElements[0]])},updatePath=function(parents){for(var newPath=[],i=parents.length;i-- >0;){var parent_1=parents[i];if(1===parent_1.nodeType&&!isHidden(parent_1)){var args=editor.fire("ResolveName",{name:parent_1.nodeName.toLowerCase(),target:parent_1});if(args.isDefaultPrevented()||newPath.push({name:args.name,element:parent_1}),args.isPropagationStopped())break}}return newPath};return{dom:{tag:"div",classes:["tox-statusbar__path"],attributes:{role:"navigation"}},behaviours:derive$1([Keying.config({mode:"flow",selector:"div[role=button]"}),Disabling.config({disabled:providersBackstage.isDisabled}),receivingConfig(),Tabstopping.config({}),Replacing.config({}),config("elementPathEvents",[runOnAttached((function(comp,_e){editor.shortcuts.add("alt+F11","focus statusbar elementpath",(function(){return Keying.focusIn(comp)})),editor.on("NodeChange",(function(e){var newPath=updatePath(e.parents);newPath.length>0?Replacing.set(comp,getDataPath(newPath)):Replacing.set(comp,[])}))}))])]),components:[]}},ResizeTypes;!function(ResizeTypes){ResizeTypes[ResizeTypes.None=0]="None",ResizeTypes[ResizeTypes.Both=1]="Both",ResizeTypes[ResizeTypes.Vertical=2]="Vertical"}(ResizeTypes||(ResizeTypes={}));var getDimensions=function(editor,deltas,resizeType,originalHeight,originalWidth){var dimensions={};return dimensions.height=calcCappedSize(originalHeight+deltas.top,getMinHeightSetting(editor),getMaxHeightSetting(editor)),resizeType===ResizeTypes.Both&&(dimensions.width=calcCappedSize(originalWidth+deltas.left,getMinWidthSetting(editor),getMaxWidthSetting(editor))),dimensions},resize=function(editor,deltas,resizeType){var container=SugarElement.fromDom(editor.getContainer()),dimensions=getDimensions(editor,deltas,resizeType,get$b(container),get$a(container));each(dimensions,(function(val,dim){return set$7(container,dim,numToPx(val))})),fireResizeEditor(editor)},getResizeType=function(editor){var fallback=!editor.hasPlugin("autoresize"),resize=editor.getParam("resize",fallback);return!1===resize?ResizeTypes.None:"both"===resize?ResizeTypes.Both:ResizeTypes.Vertical},keyboardHandler=function(editor,resizeType,x,y){var scale=20,delta=SugarPosition(20*x,20*y);return resize(editor,delta,resizeType),Optional.some(!0)},renderResizeHandler=function(editor,providersBackstage){var resizeType=getResizeType(editor);return resizeType===ResizeTypes.None?Optional.none():Optional.some(render$3("resize-handle",{tag:"div",classes:["tox-statusbar__resize-handle"],attributes:{title:providersBackstage.translate("Resize")},behaviours:[Dragging.config({mode:"mouse",repositionTarget:!1,onDrag:function(_comp,_target,delta){return resize(editor,delta,resizeType)},blockerClass:"tox-blocker"}),Keying.config({mode:"special",onLeft:function(){return keyboardHandler(editor,resizeType,-1,0)},onRight:function(){return keyboardHandler(editor,resizeType,1,0)},onUp:function(){return keyboardHandler(editor,resizeType,0,-1)},onDown:function(){return keyboardHandler(editor,resizeType,0,1)}}),Tabstopping.config({}),Focusing.config({})]},providersBackstage.icons))},renderWordCount=function(editor,providersBackstage){var _a,replaceCountText=function(comp,count,mode){return Replacing.set(comp,[text(providersBackstage.translate(["{0} "+mode,count[mode]]))])};return Button.sketch({dom:{tag:"button",classes:["tox-statusbar__wordcount"]},components:[],buttonBehaviours:derive$1([DisablingConfigs_button(providersBackstage.isDisabled),receivingConfig(),Tabstopping.config({}),Replacing.config({}),Representing.config({store:{mode:"memory",initialValue:{mode:"words",count:{words:0,characters:0}}}}),config("wordcount-events",[runOnExecute$1((function(comp){var currentVal=Representing.getValue(comp),newMode="words"===currentVal.mode?"characters":"words";Representing.setValue(comp,{mode:newMode,count:currentVal.count}),replaceCountText(comp,currentVal.count,newMode)})),runOnAttached((function(comp){editor.on("wordCountUpdate",(function(e){var mode=Representing.getValue(comp).mode;Representing.setValue(comp,{mode:mode,count:e.wordCount}),replaceCountText(comp,e.wordCount,mode)}))}))])]),eventOrder:(_a={},_a[execute$5()]=["disabling","alloy.base.behaviour","wordcount-events"],_a)})},renderStatusbar=function(editor,providersBackstage){var renderBranding=function(){var label=global$e.translate(["Powered by {0}","Tiny"]),linkHtml;return{dom:{tag:"span",classes:["tox-statusbar__branding"],innerHtml:'<a href="https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5" rel="noopener" target="_blank" tabindex="-1" aria-label="'+label+'">'+label+"</a>"}}},getTextComponents=function(){var components=[];return editor.getParam("elementpath",!0,"boolean")&&components.push(renderElementPath(editor,{},providersBackstage)),editor.hasPlugin("wordcount")&&components.push(renderWordCount(editor,providersBackstage)),editor.getParam("branding",!0,"boolean")&&components.push(renderBranding()),components.length>0?[{dom:{tag:"div",classes:["tox-statusbar__text-container"]},components:components}]:[]},getComponents;return{dom:{tag:"div",classes:["tox-statusbar"]},components:function(){var components=getTextComponents(),resizeHandler=renderResizeHandler(editor,providersBackstage);return components.concat(resizeHandler.toArray())}()}},setup$3=function(editor){var _a,isInline=editor.inline,mode=isInline?Inline:Iframe,header=isStickyToolbar(editor)?StickyHeader:StaticHeader,lazyOuterContainer=Optional.none(),platform=detect$1(),isIE,platformClasses=platform.browser.isIE()?["tox-platform-ie"]:[],isTouch,touchPlatformClass,deviceClasses=platform.deviceType.isTouch()?["tox-platform-touch"]:[],isToolbarBottom=isToolbarLocationBottom(editor),uiContainer=getUiContainer(editor),dirAttributes=global$e.isRtl()?{attributes:{dir:"rtl"}}:{},verticalDirAttributes={attributes:(_a={},_a[Attribute]=isToolbarBottom?AttributeValue.BottomToTop:AttributeValue.TopToBottom,_a)},lazyHeader=function(){return lazyOuterContainer.bind(OuterContainer.getHeader)},isHeaderDocked=function(){return header.isDocked(lazyHeader)},resizeUiMothership=function(){set$7(uiMothership.element,"width",document.body.clientWidth+"px")},makeSinkDefinition,sink=build$1(function(){var isGridUiContainer=eq(body(),uiContainer)&&"grid"===get$c(uiContainer,"display"),sinkSpec={dom:__assign({tag:"div",classes:["tox","tox-silver-sink","tox-tinymce-aux"].concat(platformClasses).concat(deviceClasses)},dirAttributes),behaviours:derive$1([Positioning.config({useFixed:function(){return isHeaderDocked()}})])},reactiveWidthSpec={dom:{styles:{width:document.body.clientWidth+"px"}},events:derive$2([run$1(windowResize(),resizeUiMothership)])};return deepMerge(sinkSpec,isGridUiContainer?reactiveWidthSpec:{})}()),lazySink=function(){return Result.value(sink)},memAnchorBar=record({dom:{tag:"div",classes:["tox-anchorbar"]}}),lazyAnchorBar,lazyToolbar=function(){return lazyOuterContainer.bind((function(container){return OuterContainer.getToolbar(container)})).getOrDie("Could not find more toolbar element")},lazyThrobber=function(){return lazyOuterContainer.bind((function(container){return OuterContainer.getThrobber(container)})).getOrDie("Could not find throbber element")},backstage=init$7(sink,editor,(function(){return lazyOuterContainer.bind((function(container){return memAnchorBar.getOpt(container)})).getOrDie("Could not find a anchor bar element")})),partMenubar=OuterContainer.parts.menubar({dom:{tag:"div",classes:["tox-menubar"]},backstage:backstage,onEscape:function(){editor.focus()}}),toolbarMode=getToolbarMode(editor),partToolbar=OuterContainer.parts.toolbar(__assign({dom:{tag:"div",classes:["tox-toolbar"]},getSink:lazySink,providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode,lazyToolbar:lazyToolbar,lazyHeader:function(){return lazyHeader().getOrDie("Could not find header element")}},verticalDirAttributes)),partMultipleToolbar=OuterContainer.parts["multiple-toolbar"]({dom:{tag:"div",classes:["tox-toolbar-overlord"]},providers:backstage.shared.providers,onEscape:function(){editor.focus()},type:toolbarMode}),partSocket=OuterContainer.parts.socket({dom:{tag:"div",classes:["tox-edit-area"]}}),partSidebar=OuterContainer.parts.sidebar({dom:{tag:"div",classes:["tox-sidebar"]}}),partThrobber=OuterContainer.parts.throbber({dom:{tag:"div",classes:["tox-throbber"]},backstage:backstage}),sb,statusbar=editor.getParam("statusbar",!0,"boolean")&&!isInline?Optional.some(renderStatusbar(editor,backstage.shared.providers)):Optional.none(),socketSidebarContainer={dom:{tag:"div",classes:["tox-sidebar-wrap"]},components:[partSocket,partSidebar]},hasMultipleToolbar=isMultipleToolbars(editor),hasToolbar=isToolbarEnabled(editor),hasMenubar=isMenubarEnabled(editor),getPartToolbar=function(){return hasMultipleToolbar?[partMultipleToolbar]:hasToolbar?[partToolbar]:[]},partHeader=OuterContainer.parts.header({dom:__assign({tag:"div",classes:["tox-editor-header"]},verticalDirAttributes),components:flatten([hasMenubar?[partMenubar]:[],getPartToolbar(),useFixedContainer(editor)?[]:[memAnchorBar.asSpec()]]),sticky:isStickyToolbar(editor),editor:editor,sharedBackstage:backstage.shared}),editorComponents=flatten([isToolbarBottom?[]:[partHeader],isInline?[]:[socketSidebarContainer],isToolbarBottom?[partHeader]:[]]),editorContainer,containerComponents=flatten([[{dom:{tag:"div",classes:["tox-editor-container"]},components:editorComponents}],isInline?[]:statusbar.toArray(),[partThrobber]]),isHidden=isDistractionFree(editor),attributes=__assign(__assign({role:"application"},global$e.isRtl()?{dir:"rtl"}:{}),isHidden?{"aria-hidden":"true"}:{}),outerContainer=build$1(OuterContainer.sketch({dom:{tag:"div",classes:["tox","tox-tinymce"].concat(isInline?["tox-tinymce-inline"]:[]).concat(isToolbarBottom?["tox-tinymce--toolbar-bottom"]:[]).concat(deviceClasses).concat(platformClasses),styles:__assign({visibility:"hidden"},isHidden?{opacity:"0",border:"0"}:{}),attributes:attributes},components:containerComponents,behaviours:derive$1([receivingConfig(),Disabling.config({disableClass:"tox-tinymce--disabled"}),Keying.config({mode:"cyclic",selector:".tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle"})])}));lazyOuterContainer=Optional.some(outerContainer),editor.shortcuts.add("alt+F9","focus menubar",(function(){OuterContainer.focusMenubar(outerContainer)})),editor.shortcuts.add("alt+F10","focus toolbar",(function(){OuterContainer.focusToolbar(outerContainer)})),editor.addCommand("ToggleToolbarDrawer",(function(){OuterContainer.toggleToolbarDrawer(outerContainer)})),editor.addQueryStateHandler("ToggleToolbarDrawer",(function(){return OuterContainer.isToolbarDrawerToggled(outerContainer)}));var mothership=takeover(outerContainer),uiMothership=takeover(sink);setup$b(editor,mothership,uiMothership);var getUi,setEditorSize=function(){var parsedHeight=numToPx(getHeightWithFallback(editor)),parsedWidth=numToPx(getWidthWithFallback(editor));return editor.inline||(isValidValue("div","width",parsedWidth)&&set$7(outerContainer.element,"width",parsedWidth),isValidValue("div","height",parsedHeight)?set$7(outerContainer.element,"height",parsedHeight):set$7(outerContainer.element,"height","200px")),parsedHeight},renderUI;return{mothership:mothership,uiMothership:uiMothership,backstage:backstage,renderUI:function(){header.setup(editor,backstage.shared,lazyHeader),setup$6(editor,backstage),setup$5(editor,lazySink,backstage),setup$8(editor),setup$7(editor,lazyThrobber,backstage.shared),map$1(getToolbarGroups(editor),(function(toolbarGroupButtonConfig,name){editor.ui.registry.addGroupToolbarButton(name,toolbarGroupButtonConfig)}));var _a=editor.ui.registry.getAll(),buttons=_a.buttons,menuItems=_a.menuItems,contextToolbars=_a.contextToolbars,sidebars=_a.sidebars,toolbarOpt=getMultipleToolbarsSetting(editor),rawUiConfig={menuItems:menuItems,menus:getMenus(editor),menubar:getMenubar(editor),toolbar:toolbarOpt.getOrThunk((function(){return getToolbar(editor)})),allowToolbarGroups:toolbarMode===ToolbarMode.floating,buttons:buttons,sidebar:sidebars};register$7(editor,contextToolbars,sink,{backstage:backstage}),setup$4(editor,sink);var elm=editor.getElement(),height=setEditorSize(),uiComponents={mothership:mothership,uiMothership:uiMothership,outerContainer:outerContainer},args={targetNode:elm,height:height};return mode.render(editor,uiComponents,rawUiConfig,backstage,args)},getUi:function(){var channels;return{channels:{broadcastAll:uiMothership.broadcast,broadcastOn:uiMothership.broadcastOn,register:noop}}}}},describedBy=function(describedElement,describeElement){var describeId=Optional.from(get$d(describedElement,"id")).fold((function(){var id=generate$6("dialog-describe");return set$8(describeElement,"id",id),id}),identity$1);set$8(describedElement,"aria-describedby",describeId)},labelledBy=function(labelledElement,labelElement){var labelId=getOpt(labelledElement,"id").fold((function(){var id=generate$6("dialog-label");return set$8(labelElement,"id",id),id}),identity$1);set$8(labelledElement,"aria-labelledby",labelId)},schema$2=constant$1([required$1("lazySink"),option("dragBlockClass"),defaultedFunction("getBounds",win),defaulted("useTabstopAt",always),defaulted("eventOrder",{}),field("modalBehaviours",[Keying]),onKeyboardHandler("onExecute"),onStrictKeyboardHandler("onEscape")]),basic={sketch:identity$1},parts$2=constant$1([optional({name:"draghandle",overrides:function(detail,spec){return{behaviours:derive$1([Dragging.config({mode:"mouse",getTarget:function(handle){return ancestor(handle,'[role="dialog"]').getOr(handle)},blockerClass:detail.dragBlockClass.getOrDie(new Error("The drag blocker class was not specified for a dialog with a drag handle: \n"+JSON.stringify(spec,null,2)).message),getBounds:detail.getDragBounds})])}}}),required({schema:[required$1("dom")],name:"title"}),required({factory:basic,schema:[required$1("dom")],name:"close"}),required({factory:basic,schema:[required$1("dom")],name:"body"}),optional({factory:basic,schema:[required$1("dom")],name:"footer"}),external$1({factory:{sketch:function(spec,detail){return __assign(__assign({},spec),{dom:detail.dom,components:detail.components})}},schema:[defaulted("dom",{tag:"div",styles:{position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px"}}),defaulted("components",[])],name:"blocker"})]),factory$4=function(detail,components,spec,externals){var _a,dialogComp=value$1(),showDialog=function(dialog){dialogComp.set(dialog);var sink=detail.lazySink(dialog).getOrDie(),externalBlocker=externals.blocker(),blocker=sink.getSystem().build(__assign(__assign({},externalBlocker),{components:externalBlocker.components.concat([premade(dialog)]),behaviours:derive$1([Focusing.config({}),config("dialog-blocker-events",[runOnSource(focusin(),(function(){Keying.focusIn(dialog)}))])])}));attach(sink,blocker),Keying.focusIn(dialog)},hideDialog=function(dialog){dialogComp.clear(),parent(dialog.element).each((function(blockerDom){dialog.getSystem().getByDom(blockerDom).each((function(blocker){detach(blocker)}))}))},getDialogBody=function(dialog){return getPartOrDie(dialog,detail,"body")},getDialogFooter=function(dialog){return getPartOrDie(dialog,detail,"footer")},setBusy=function(dialog,getBusySpec){Blocking.block(dialog,getBusySpec)},setIdle=function(dialog){Blocking.unblock(dialog)},modalEventsId=generate$6("modal-events"),eventOrder=__assign(__assign({},detail.eventOrder),((_a={})[attachedToDom()]=[modalEventsId].concat(detail.eventOrder["alloy.system.attached"]||[]),_a));return{uid:detail.uid,dom:detail.dom,components:components,apis:{show:showDialog,hide:hideDialog,getBody:getDialogBody,getFooter:getDialogFooter,setIdle:setIdle,setBusy:setBusy},eventOrder:eventOrder,domModification:{attributes:{role:"dialog","aria-modal":"true"}},behaviours:augment(detail.modalBehaviours,[Replacing.config({}),Keying.config({mode:"cyclic",onEnter:detail.onExecute,onEscape:detail.onEscape,useTabstopAt:detail.useTabstopAt}),Blocking.config({getRoot:dialogComp.get}),config(modalEventsId,[runOnAttached((function(c){labelledBy(c.element,getPartOrDie(c,detail,"title").element),describedBy(c.element,getPartOrDie(c,detail,"body").element)}))])])}},ModalDialog=composite({name:"ModalDialog",configFields:schema$2(),partFields:parts$2(),factory:factory$4,apis:{show:function(apis,dialog){apis.show(dialog)},hide:function(apis,dialog){apis.hide(dialog)},getBody:function(apis,dialog){return apis.getBody(dialog)},getFooter:function(apis,dialog){return apis.getFooter(dialog)},setBusy:function(apis,dialog,getBusySpec){apis.setBusy(dialog,getBusySpec)},setIdle:function(apis,dialog){apis.setIdle(dialog)}}}),dialogToggleMenuItemSchema=objOf([requiredString("type"),requiredString("name")].concat(commonMenuItemFields)),dialogToggleMenuItemDataProcessor=boolean,baseFooterButtonFields=[field$1("name","name",defaultedThunk((function(){return generate$6("button-name")})),string),optionString("icon"),defaultedStringEnum("align","end",["start","end"]),defaultedBoolean("primary",!1),defaultedBoolean("disabled",!1)],dialogFooterButtonFields=__spreadArray(__spreadArray([],baseFooterButtonFields,!0),[requiredString("text")],!1),normalFooterButtonFields=__spreadArray([requiredStringEnum("type",["submit","cancel","custom"])],dialogFooterButtonFields,!0),menuFooterButtonFields=__spreadArray([requiredStringEnum("type",["menu"]),optionString("text"),optionString("tooltip"),optionString("icon"),requiredArrayOf("items",dialogToggleMenuItemSchema)],baseFooterButtonFields,!0),dialogFooterButtonSchema=choose$1("type",{submit:normalFooterButtonFields,cancel:normalFooterButtonFields,custom:normalFooterButtonFields,menu:menuFooterButtonFields}),alertBannerFields=[requiredString("type"),requiredString("text"),requiredStringEnum("level",["info","warn","error","success"]),requiredString("icon"),defaulted("url","")],alertBannerSchema=objOf(alertBannerFields),createBarFields=function(itemsField){return[requiredString("type"),itemsField]},buttonFields=[requiredString("type"),requiredString("text"),defaultedBoolean("disabled",!1),defaultedBoolean("primary",!1),field$1("name","name",defaultedThunk((function(){return generate$6("button-name")})),string),optionString("icon"),defaultedBoolean("borderless",!1)],buttonSchema=objOf(buttonFields),checkboxFields=[requiredString("type"),requiredString("name"),requiredString("label"),defaultedBoolean("disabled",!1)],checkboxSchema=objOf(checkboxFields),checkboxDataProcessor=boolean,formComponentFields=[requiredString("type"),requiredString("name")],formComponentWithLabelFields=formComponentFields.concat([optionString("label")]),collectionFields=formComponentWithLabelFields.concat([defaulted("columns","auto")]),collectionSchema=objOf(collectionFields),collectionDataProcessor=arrOfObj([requiredString("value"),requiredString("text"),requiredString("icon")]),colorInputFields,colorInputSchema=objOf(formComponentWithLabelFields),colorInputDataProcessor=string,colorPickerFields,colorPickerSchema=objOf(formComponentWithLabelFields),colorPickerDataProcessor=string,customEditorFields=formComponentFields.concat([defaultedString("tag","textarea"),requiredString("scriptId"),requiredString("scriptUrl"),defaultedPostMsg("settings",void 0)]),customEditorFieldsOld=formComponentFields.concat([defaultedString("tag","textarea"),requiredFunction("init")]),customEditorSchema=valueOf((function(v){return asRaw("customeditor.old",objOfOnly(customEditorFieldsOld),v).orThunk((function(){return asRaw("customeditor.new",objOfOnly(customEditorFields),v)}))})),customEditorDataProcessor=string,dropZoneFields,dropZoneSchema=objOf(formComponentWithLabelFields),dropZoneDataProcessor=arrOfVal(),createGridFields=function(itemsField){return[requiredString("type"),requiredNumber("columns"),itemsField]},htmlPanelFields=[requiredString("type"),requiredString("html"),defaultedStringEnum("presets","presentation",["presentation","document"])],htmlPanelSchema=objOf(htmlPanelFields),iframeFields=formComponentWithLabelFields.concat([defaultedBoolean("sandboxed",!0)]),iframeSchema=objOf(iframeFields),iframeDataProcessor=string,imageToolsFields=formComponentWithLabelFields.concat([requiredOf("currentState",objOf([required$1("blob"),requiredString("url")]))]),imageToolsSchema=objOf(imageToolsFields),inputFields=formComponentWithLabelFields.concat([optionString("inputMode"),optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),inputSchema=objOf(inputFields),inputDataProcessor=string,createLabelFields=function(itemsField){return[requiredString("type"),requiredString("label"),itemsField]},listBoxSingleItemFields=[requiredString("text"),requiredString("value")],listBoxNestedItemFields=[requiredString("text"),requiredArrayOf("items",thunkOf("items",(function(){return listBoxItemSchema})))],listBoxItemSchema=oneOf([objOf(listBoxSingleItemFields),objOf(listBoxNestedItemFields)]),listBoxFields=formComponentWithLabelFields.concat([requiredArrayOf("items",listBoxItemSchema),defaultedBoolean("disabled",!1)]),listBoxSchema=objOf(listBoxFields),listBoxDataProcessor=string,selectBoxFields=formComponentWithLabelFields.concat([requiredArrayOfObj("items",[requiredString("text"),requiredString("value")]),defaultedNumber("size",1),defaultedBoolean("disabled",!1)]),selectBoxSchema=objOf(selectBoxFields),selectBoxDataProcessor=string,sizeInputFields=formComponentWithLabelFields.concat([defaultedBoolean("constrain",!0),defaultedBoolean("disabled",!1)]),sizeInputSchema=objOf(sizeInputFields),sizeInputDataProcessor=objOf([requiredString("width"),requiredString("height")]),tableFields=[requiredString("type"),requiredArrayOf("header",string),requiredArrayOf("cells",arrOf(string))],tableSchema=objOf(tableFields),textAreaFields=formComponentWithLabelFields.concat([optionString("placeholder"),defaultedBoolean("maximized",!1),defaultedBoolean("disabled",!1)]),textAreaSchema=objOf(textAreaFields),textAreaDataProcessor=string,urlInputFields=formComponentWithLabelFields.concat([defaultedStringEnum("filetype","file",["image","media","file"]),defaulted("disabled",!1)]),urlInputSchema=objOf(urlInputFields),urlInputDataProcessor=objOf([requiredString("value"),defaulted("meta",{})]),createItemsField=function(name){return field$1("items","items",{tag:"required",process:{}},arrOf(valueOf((function(v){return asRaw("Checking item of "+name,itemSchema,v).fold((function(sErr){return Result.error(formatError(sErr))}),(function(passValue){return Result.value(passValue)}))}))))},itemSchema=valueThunk((function(){return choose$2("type",{alertbanner:alertBannerSchema,bar:objOf(createBarFields(createItemsField("bar"))),button:buttonSchema,checkbox:checkboxSchema,colorinput:colorInputSchema,colorpicker:colorPickerSchema,dropzone:dropZoneSchema,grid:objOf(createGridFields(createItemsField("grid"))),iframe:iframeSchema,input:inputSchema,listbox:listBoxSchema,selectbox:selectBoxSchema,sizeinput:sizeInputSchema,textarea:textAreaSchema,urlinput:urlInputSchema,customeditor:customEditorSchema,htmlpanel:htmlPanelSchema,imagetools:imageToolsSchema,collection:collectionSchema,label:objOf(createLabelFields(createItemsField("label"))),table:tableSchema,panel:panelSchema})})),panelFields=[requiredString("type"),defaulted("classes",[]),requiredArrayOf("items",itemSchema)],panelSchema=objOf(panelFields),tabFields=[field$1("name","name",defaultedThunk((function(){return generate$6("tab-name")})),string),requiredString("title"),requiredArrayOf("items",itemSchema)],tabPanelFields=[requiredString("type"),requiredArrayOfObj("tabs",tabFields)],tabPanelSchema=objOf(tabPanelFields),dialogButtonFields=dialogFooterButtonFields,dialogButtonSchema=dialogFooterButtonSchema,dialogSchema=objOf([requiredString("title"),requiredOf("body",choose$2("type",{panel:panelSchema,tabpanel:tabPanelSchema})),defaultedString("size","normal"),requiredArrayOf("buttons",dialogButtonSchema),defaulted("initialData",{}),defaultedFunction("onAction",noop),defaultedFunction("onChange",noop),defaultedFunction("onSubmit",noop),defaultedFunction("onClose",noop),defaultedFunction("onCancel",noop),defaulted("onTabChange",noop)]),createDialog=function(spec){return asRaw("dialog",dialogSchema,spec)},urlDialogButtonSchema=objOf(__spreadArray([requiredStringEnum("type",["cancel","custom"])],dialogButtonFields,!0)),urlDialogSchema=objOf([requiredString("title"),requiredString("url"),optionNumber("height"),optionNumber("width"),optionArrayOf("buttons",urlDialogButtonSchema),defaultedFunction("onAction",noop),defaultedFunction("onCancel",noop),defaultedFunction("onClose",noop),defaultedFunction("onMessage",noop)]),createUrlDialog=function(spec){return asRaw("dialog",urlDialogSchema,spec)},getAllObjects=function(obj){return isObject(obj)?[obj].concat(bind$3(values(obj),getAllObjects)):isArray(obj)?bind$3(obj,getAllObjects):[]},isNamedItem=function(obj){return isString(obj.type)&&isString(obj.name)},dataProcessors={checkbox:checkboxDataProcessor,colorinput:colorInputDataProcessor,colorpicker:colorPickerDataProcessor,dropzone:dropZoneDataProcessor,input:inputDataProcessor,iframe:iframeDataProcessor,sizeinput:sizeInputDataProcessor,selectbox:selectBoxDataProcessor,listbox:listBoxDataProcessor,size:sizeInputDataProcessor,textarea:textAreaDataProcessor,urlinput:urlInputDataProcessor,customeditor:customEditorDataProcessor,collection:collectionDataProcessor,togglemenuitem:dialogToggleMenuItemDataProcessor},getDataProcessor=function(item){return Optional.from(dataProcessors[item.type])},getNamedItems=function(structure){return filter$2(getAllObjects(structure),isNamedItem)},createDataValidator=function(structure){var namedItems=getNamedItems(structure),fields=bind$3(namedItems,(function(item){return getDataProcessor(item).fold((function(){return[]}),(function(schema){return[requiredOf(item.name,schema)]}))}));return objOf(fields)},extract=function(structure){var internalDialog,dataValidator,initialData;return{internalDialog:getOrDie(createDialog(structure)),dataValidator:createDataValidator(structure),initialData:structure.initialData}},DialogManager={open:function(factory,structure){var extraction=extract(structure);return factory(extraction.internalDialog,extraction.initialData,extraction.dataValidator)},openUrl:function(factory,structure){var internalDialog;return factory(getOrDie(createUrlDialog(structure)))},redial:function(structure){return extract(structure)}},toValidValues=function(values){var errors=[],result={};return each(values,(function(value,name){value.fold((function(){errors.push(name)}),(function(v){result[name]=v}))})),errors.length>0?Result.error(errors):Result.value(result)},renderBodyPanel=function(spec,backstage){var memForm=record(Form.sketch((function(parts){return{dom:{tag:"div",classes:["tox-form"].concat(spec.classes)},components:map$2(spec.items,(function(item){return interpretInForm(parts,item,backstage)}))}})));return{dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[memForm.asSpec()]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),ComposingConfigs_memento(memForm),RepresentingConfigs_memento(memForm,{postprocess:function(formValue){return toValidValues(formValue).fold((function(err){return console.error(err),{}}),identity$1)}})])}},factory$3=function(detail,_spec){return{uid:detail.uid,dom:detail.dom,components:detail.components,events:events$a(detail.action),behaviours:augment(detail.tabButtonBehaviours,[Focusing.config({}),Keying.config({mode:"execution",useSpace:!0,useEnter:!0}),Representing.config({store:{mode:"memory",initialValue:detail.value}})]),domModification:detail.domModification}},TabButton=single({name:"TabButton",configFields:[defaulted("uid",void 0),required$1("value"),field$1("dom","dom",mergeWithThunk((function(){return{attributes:{role:"tab",id:generate$6("aria"),"aria-selected":"false"}}})),anyValue()),option("action"),defaulted("domModification",{}),field("tabButtonBehaviours",[Focusing,Keying,Representing]),required$1("view")],factory:factory$3}),schema$1=constant$1([required$1("tabs"),required$1("dom"),defaulted("clickToDismiss",!1),field("tabbarBehaviours",[Highlighting,Keying]),markers$1(["tabClass","selectedClass"])]),tabsPart=group({factory:TabButton,name:"tabs",unit:"tab",overrides:function(barDetail){var dismissTab$1=function(tabbar,button){Highlighting.dehighlight(tabbar,button),emitWith(tabbar,dismissTab(),{tabbar:tabbar,button:button})},changeTab$1=function(tabbar,button){Highlighting.highlight(tabbar,button),emitWith(tabbar,changeTab(),{tabbar:tabbar,button:button})};return{action:function(button){var tabbar=button.getSystem().getByUid(barDetail.uid).getOrDie(),activeButton=Highlighting.isHighlighted(tabbar,button),response;(activeButton&&barDetail.clickToDismiss?dismissTab$1:activeButton?noop:changeTab$1)(tabbar,button)},domModification:{classes:[barDetail.markers.tabClass]}}}}),parts$1=constant$1([tabsPart]),factory$2=function(detail,components,_spec,_externals){return{uid:detail.uid,dom:detail.dom,components:components,"debug.sketcher":"Tabbar",domModification:{attributes:{role:"tablist"}},behaviours:augment(detail.tabbarBehaviours,[Highlighting.config({highlightClass:detail.markers.selectedClass,itemClass:detail.markers.tabClass,onHighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","true")},onDehighlight:function(tabbar,tab){set$8(tab.element,"aria-selected","false")}}),Keying.config({mode:"flow",getInitial:function(tabbar){return Highlighting.getHighlighted(tabbar).map((function(tab){return tab.element}))},selector:"."+detail.markers.tabClass,executeOnMove:!0})])}},Tabbar=composite({name:"Tabbar",configFields:schema$1(),partFields:parts$1(),factory:factory$2}),factory$1=function(detail,_spec){return{uid:detail.uid,dom:detail.dom,behaviours:augment(detail.tabviewBehaviours,[Replacing.config({})]),domModification:{attributes:{role:"tabpanel"}}}},Tabview=single({name:"Tabview",configFields:[field("tabviewBehaviours",[Replacing])],factory:factory$1}),schema=constant$1([defaulted("selectFirst",!0),onHandler("onChangeTab"),onHandler("onDismissTab"),defaulted("tabs",[]),field("tabSectionBehaviours",[])]),barPart=required({factory:Tabbar,schema:[required$1("dom"),requiredObjOf("markers",[required$1("tabClass"),required$1("selectedClass")])],name:"tabbar",defaults:function(detail){return{tabs:detail.tabs}}}),viewPart=required({factory:Tabview,name:"tabview"}),parts=constant$1([barPart,viewPart]),factory=function(detail,components,_spec,_externals){var changeTab$1=function(button){var tabValue=Representing.getValue(button);getPart(button,detail,"tabview").each((function(tabview){var tabWithValue;find$5(detail.tabs,(function(t){return t.value===tabValue})).each((function(tabData){var panel=tabData.view();getOpt(button.element,"id").each((function(id){set$8(tabview.element,"aria-labelledby",id)})),Replacing.set(tabview,panel),detail.onChangeTab(tabview,button,panel)}))}))},changeTabBy=function(section,byPred){getPart(section,detail,"tabbar").each((function(tabbar){byPred(tabbar).each(emitExecute)}))};return{uid:detail.uid,dom:detail.dom,components:components,behaviours:get$2(detail.tabSectionBehaviours),events:derive$2(flatten([detail.selectFirst?[runOnAttached((function(section,_simulatedEvent){changeTabBy(section,Highlighting.getFirst)}))]:[],[run$1(changeTab(),(function(section,simulatedEvent){var button=simulatedEvent.event.button;changeTab$1(button)})),run$1(dismissTab(),(function(section,simulatedEvent){var button=simulatedEvent.event.button;detail.onDismissTab(section,button)}))]])),apis:{getViewItems:function(section){return getPart(section,detail,"tabview").map((function(tabview){return Replacing.contents(tabview)})).getOr([])},showTab:function(section,tabKey){var getTabIfNotActive;changeTabBy(section,(function(tabbar){var candidates=Highlighting.getCandidates(tabbar),optTab;return find$5(candidates,(function(c){return Representing.getValue(c)===tabKey})).filter((function(tab){return!Highlighting.isHighlighted(tabbar,tab)}))}))}}}},TabSection=composite({name:"TabSection",configFields:schema(),partFields:parts(),factory:factory,apis:{getViewItems:function(apis,component){return apis.getViewItems(component)},showTab:function(apis,component,tabKey){apis.showTab(component,tabKey)}}}),measureHeights=function(allTabs,tabview,tabviewComp){return map$2(allTabs,(function(_tab,i){Replacing.set(tabviewComp,allTabs[i].view());var rect=tabview.dom.getBoundingClientRect();return Replacing.set(tabviewComp,[]),rect.height}))},getMaxHeight=function(heights){return head(sort(heights,(function(a,b){return a>b?-1:a<b?1:0})))},getMaxTabviewHeight=function(dialog,tabview,tablist){var documentElement$1=documentElement(dialog).dom,rootElm=ancestor(dialog,".tox-dialog-wrap").getOr(dialog),isFixed,maxHeight;maxHeight="fixed"===get$c(rootElm,"position")?Math.max(documentElement$1.clientHeight,window.innerHeight):Math.max(documentElement$1.offsetHeight,documentElement$1.scrollHeight);var tabviewHeight=get$b(tabview),isTabListBeside,currentTabHeight=tabview.dom.offsetLeft>=tablist.dom.offsetLeft+get$a(tablist)?Math.max(get$b(tablist),tabviewHeight):tabviewHeight,dialogTopMargin=parseInt(get$c(dialog,"margin-top"),10)||0,dialogBottomMargin=parseInt(get$c(dialog,"margin-bottom"),10)||0,dialogHeight,chromeHeight;return maxHeight-(get$b(dialog)+dialogTopMargin+dialogBottomMargin-currentTabHeight)},showTab=function(allTabs,comp){head(allTabs).each((function(tab){return TabSection.showTab(comp,tab.value)}))},setTabviewHeight=function(tabview,height){set$7(tabview,"height",height+"px"),detect$1().browser.isIE()?remove$6(tabview,"flex-basis"):set$7(tabview,"flex-basis",height+"px")},updateTabviewHeight=function(dialogBody,tabview,maxTabHeight){ancestor(dialogBody,'[role="dialog"]').each((function(dialog){descendant(dialog,'[role="tablist"]').each((function(tablist){maxTabHeight.get().map((function(height){return set$7(tabview,"height","0"),set$7(tabview,"flex-basis","0"),Math.min(height,getMaxTabviewHeight(dialog,tabview,tablist))})).each((function(height){setTabviewHeight(tabview,height)}))}))}))},getTabview=function(dialog){return descendant(dialog,'[role="tabpanel"]')},setMode=function(allTabs){var smartTabHeight,maxTabHeight,extraEvents,selectFirst,naiveTabHeight;return{smartTabHeight:(maxTabHeight=value$1(),selectFirst=!1,{extraEvents:[runOnAttached((function(comp){var dialog=comp.element;getTabview(dialog).each((function(tabview){set$7(tabview,"visibility","hidden"),comp.getSystem().getByDom(tabview).toOptional().each((function(tabviewComp){var heights=measureHeights(allTabs,tabview,tabviewComp),maxTabHeightOpt;getMaxHeight(heights).fold(maxTabHeight.clear,maxTabHeight.set)})),updateTabviewHeight(dialog,tabview,maxTabHeight),remove$6(tabview,"visibility"),showTab(allTabs,comp),global$f.requestAnimationFrame((function(){updateTabviewHeight(dialog,tabview,maxTabHeight)}))}))})),run$1(windowResize(),(function(comp){var dialog=comp.element;getTabview(dialog).each((function(tabview){updateTabviewHeight(dialog,tabview,maxTabHeight)}))})),run$1(formResizeEvent,(function(comp,_se){var dialog=comp.element;getTabview(dialog).each((function(tabview){var oldFocus=active(getRootNode(tabview));set$7(tabview,"visibility","hidden");var oldHeight=getRaw(tabview,"height").map((function(h){return parseInt(h,10)}));remove$6(tabview,"height"),remove$6(tabview,"flex-basis");var newHeight=tabview.dom.getBoundingClientRect().height,hasGrown;oldHeight.forall((function(h){return newHeight>h}))?(maxTabHeight.set(newHeight),updateTabviewHeight(dialog,tabview,maxTabHeight)):oldHeight.each((function(h){setTabviewHeight(tabview,h)})),remove$6(tabview,"visibility"),oldFocus.each(focus$3)}))}))],selectFirst:!1}),naiveTabHeight:function(){var extraEvents,selectFirst=!0;return{extraEvents:[],selectFirst:!0}}()}},SendDataToSectionChannel="send-data-to-section",SendDataToViewChannel="send-data-to-view",renderTabPanel=function(spec,backstage){var storedValue=Cell({}),updateDataWithForm=function(form){var formData=Representing.getValue(form),validData=toValidValues(formData).getOr({}),currentData=storedValue.get(),newData=deepMerge(currentData,validData);storedValue.set(newData)},setDataOnForm=function(form){var tabData=storedValue.get();Representing.setValue(form,tabData)},oldTab=Cell(null),allTabs=map$2(spec.tabs,(function(tab){return{value:tab.name,dom:{tag:"div",classes:["tox-dialog__body-nav-item"],innerHtml:backstage.shared.providers.translate(tab.title)},view:function(){return[Form.sketch((function(parts){return{dom:{tag:"div",classes:["tox-form"]},components:map$2(tab.items,(function(item){return interpretInForm(parts,item,backstage)})),formBehaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)}),config("TabView.form.events",[runOnAttached(setDataOnForm),runOnDetached(updateDataWithForm)]),Receiving.config({channels:wrapAll([{key:"send-data-to-section",value:{onReceive:updateDataWithForm}},{key:"send-data-to-view",value:{onReceive:setDataOnForm}}])})])}}))]}}})),tabMode=setMode(allTabs).smartTabHeight;return TabSection.sketch({dom:{tag:"div",classes:["tox-dialog__body"]},onChangeTab:function(section,button,_viewItems){var name=Representing.getValue(button);emitWith(section,formTabChangeEvent,{name:name,oldName:oldTab.get()}),oldTab.set(name)},tabs:allTabs,components:[TabSection.parts.tabbar({dom:{tag:"div",classes:["tox-dialog__body-nav"]},components:[Tabbar.parts.tabs({})],markers:{tabClass:"tox-tab",selectedClass:"tox-dialog__body-nav-item--active"},tabbarBehaviours:derive$1([Tabstopping.config({})])}),TabSection.parts.tabview({dom:{tag:"div",classes:["tox-dialog__body-content"]}})],selectFirst:tabMode.selectFirst,tabSectionBehaviours:derive$1([config("tabpanel",tabMode.extraEvents),Keying.config({mode:"acyclic"}),Composing.config({find:function(comp){return head(TabSection.getViewItems(comp))}}),Representing.config({store:{mode:"manual",getValue:function(tsection){return tsection.getSystem().broadcastOn(["send-data-to-section"],{}),storedValue.get()},setValue:function(tsection,value){storedValue.set(value),tsection.getSystem().broadcastOn(["send-data-to-view"],{})}}})])})},dialogChannel=generate$6("update-dialog"),titleChannel=generate$6("update-title"),bodyChannel=generate$6("update-body"),footerChannel=generate$6("update-footer"),bodySendMessageChannel=generate$6("body-send-message"),renderBody=function(spec,id,backstage,ariaAttrs){var renderComponents=function(incoming){switch(incoming.body.type){case"tabpanel":return[renderTabPanel(incoming.body,backstage)];default:return[renderBodyPanel(incoming.body,backstage)]}},updateState=function(_comp,incoming){return Optional.some({isTabPanel:function(){return"tabpanel"===incoming.body.type}})},ariaAttributes={"aria-live":"polite"};return{dom:{tag:"div",classes:["tox-dialog__content-js"],attributes:__assign(__assign({},id.map((function(x){return{id:x}})).getOr({})),ariaAttrs?ariaAttributes:{})},components:[],behaviours:derive$1([ComposingConfigs_childAt(0),Reflecting.config({channel:bodyChannel,updateState:updateState,renderComponents:renderComponents,initialData:spec})])}},renderInlineBody=function(spec,contentId,backstage,ariaAttrs){return renderBody(spec,Optional.some(contentId),backstage,ariaAttrs)},renderModalBody=function(spec,backstage){var bodySpec=renderBody(spec,Optional.none(),backstage,!1);return ModalDialog.parts.body(bodySpec)},renderIframeBody=function(spec){var bodySpec={dom:{tag:"div",classes:["tox-dialog__content-js"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-iframe"]},components:[craft({dom:{tag:"iframe",attributes:{src:spec.url}},behaviours:derive$1([Tabstopping.config({}),Focusing.config({})])})]}],behaviours:derive$1([Keying.config({mode:"acyclic",useTabstopAt:not(isPseudoStop)})])};return ModalDialog.parts.body(bodySpec)},isTouch=global$9.deviceType.isTouch(),hiddenHeader=function(title,close){return{dom:{tag:"div",styles:{display:"none"},classes:["tox-dialog__header"]},components:[title,close]}},pClose=function(onClose,providersBackstage){return ModalDialog.parts.close(Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close")}},action:onClose,buttonBehaviours:derive$1([Tabstopping.config({})])}))},pUntitled=function(){return ModalDialog.parts.title({dom:{tag:"div",classes:["tox-dialog__title"],innerHtml:"",styles:{display:"none"}}})},pBodyMessage=function(message,providersBackstage){return ModalDialog.parts.body({dom:{tag:"div",classes:["tox-dialog__body"]},components:[{dom:{tag:"div",classes:["tox-dialog__body-content"]},components:[{dom:fromHtml("<p>"+providersBackstage.translate(message)+"</p>")}]}]})},pFooter=function(buttons){return ModalDialog.parts.footer({dom:{tag:"div",classes:["tox-dialog__footer"]},components:buttons})},pFooterGroup=function(startButtons,endButtons){return[Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-start"]},components:startButtons}),Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-end"]},components:endButtons})]},renderDialog$1=function(spec){var _a,dialogClass="tox-dialog",blockerClass=dialogClass+"-wrap",blockerBackdropClass=blockerClass+"__backdrop",scrollLockClass=dialogClass+"__disable-scroll";return ModalDialog.sketch({lazySink:spec.lazySink,onEscape:function(comp){return spec.onEscape(comp),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)},dom:{tag:"div",classes:[dialogClass].concat(spec.extraClasses),styles:__assign({position:"relative"},spec.extraStyles)},components:__spreadArray([spec.header,spec.body],spec.footer.toArray(),!0),parts:{blocker:{dom:fromHtml('<div class="'+blockerClass+'"></div>'),components:[{dom:{tag:"div",classes:isTouch?[blockerBackdropClass,blockerBackdropClass+"--opaque"]:[blockerBackdropClass]}}]}},dragBlockClass:blockerClass,modalBehaviours:derive$1(__spreadArray([Focusing.config({}),config("dialog-events",spec.dialogEvents.concat([runOnSource(focusin(),(function(comp,_se){Keying.focusIn(comp)}))])),config("scroll-lock",[runOnAttached((function(){add$2(body(),scrollLockClass)})),runOnDetached((function(){remove$2(body(),scrollLockClass)}))])],spec.extraBehaviours,!0)),eventOrder:__assign((_a={},_a[execute$5()]=["dialog-events"],_a[attachedToDom()]=["scroll-lock","dialog-events","alloy.base.behaviour"],_a[detachedFromDom()]=["alloy.base.behaviour","dialog-events","scroll-lock"],_a),spec.eventOrder)})},renderClose=function(providersBackstage){return Button.sketch({dom:{tag:"button",classes:["tox-button","tox-button--icon","tox-button--naked"],attributes:{type:"button","aria-label":providersBackstage.translate("Close"),title:providersBackstage.translate("Close")}},components:[render$3("close",{tag:"div",classes:["tox-icon"]},providersBackstage.icons)],action:function(comp){emit(comp,formCancelEvent)}})},renderTitle=function(spec,id,providersBackstage){var renderComponents=function(data){return[text(providersBackstage.translate(data.title))]};return{dom:{tag:"div",classes:["tox-dialog__title"],attributes:__assign({},id.map((function(x){return{id:x}})).getOr({}))},components:renderComponents(spec),behaviours:derive$1([Reflecting.config({channel:titleChannel,renderComponents:renderComponents})])}},renderDragHandle=function(){return{dom:fromHtml('<div class="tox-dialog__draghandle"></div>')}},renderInlineHeader=function(spec,titleId,providersBackstage){return Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:[renderTitle(spec,Optional.some(titleId),providersBackstage),renderDragHandle(),renderClose(providersBackstage)],containerBehaviours:derive$1([Dragging.config({mode:"mouse",blockerClass:"blocker",getTarget:function(handle){return closest$1(handle,'[role="dialog"]').getOrDie()},snaps:{getSnapPoints:function(){return[]},leftAttr:"data-drag-left",topAttr:"data-drag-top"}})])})},renderModalHeader=function(spec,providersBackstage){var pTitle=ModalDialog.parts.title(renderTitle(spec,Optional.none(),providersBackstage)),pHandle=ModalDialog.parts.draghandle(renderDragHandle()),pClose=ModalDialog.parts.close(renderClose(providersBackstage)),components=[pTitle].concat(spec.draggable?[pHandle]:[]).concat([pClose]);return Container.sketch({dom:fromHtml('<div class="tox-dialog__header"></div>'),components:components})},getHeader=function(title,backstage){return renderModalHeader({title:backstage.shared.providers.translate(title),draggable:backstage.dialog.isDraggableModal()},backstage.shared.providers)},getBusySpec=function(message,bs,providers){return{dom:{tag:"div",classes:["tox-dialog__busy-spinner"],attributes:{"aria-label":providers.translate(message)},styles:{left:"0px",right:"0px",bottom:"0px",top:"0px",position:"absolute"}},behaviours:bs,components:[{dom:fromHtml('<div class="tox-spinner"><div></div><div></div><div></div></div>')}]}},getEventExtras=function(lazyDialog,providers,extra){return{onClose:function(){return extra.closeWindow()},onBlock:function(blockEvent){ModalDialog.setBusy(lazyDialog(),(function(_comp,bs){return getBusySpec(blockEvent.message,bs,providers)}))},onUnblock:function(){ModalDialog.setIdle(lazyDialog())}}},renderModalDialog=function(spec,initialData,dialogEvents,backstage){var _a,updateState=function(_comp,incoming){return Optional.some(incoming)};return build$1(renderDialog$1(__assign(__assign({},spec),{lazySink:backstage.shared.getSink,extraBehaviours:__spreadArray([Reflecting.config({channel:dialogChannel,updateState:updateState,initialData:initialData}),RepresentingConfigs_memory({})],spec.extraBehaviours,!0),onEscape:function(comp){emit(comp,formCancelEvent)},dialogEvents:dialogEvents,eventOrder:(_a={},_a[receive()]=[Reflecting.name(),Receiving.name()],_a[attachedToDom()]=["scroll-lock",Reflecting.name(),"messages","dialog-events","alloy.base.behaviour"],_a[detachedFromDom()]=["alloy.base.behaviour","dialog-events","messages",Reflecting.name(),"scroll-lock"],_a)})))},mapMenuButtons=function(buttons){var mapItems=function(button){var items=map$2(button.items,(function(item){var cell=Cell(!1);return __assign(__assign({},item),{storage:cell})}));return __assign(__assign({},button),{items:items})};return map$2(buttons,(function(button){return"menu"===button.type?mapItems(button):button}))},extractCellsToObject=function(buttons){return foldl(buttons,(function(acc,button){var menuButton;return"menu"===button.type?foldl(button.items,(function(innerAcc,item){return innerAcc[item.name]=item.storage,innerAcc}),acc):acc}),{})},initCommonEvents=function(fireApiEvent,extras){return[runWithTarget(focusin(),onFocus),fireApiEvent(formCloseEvent,(function(_api,spec){extras.onClose(),spec.onClose()})),fireApiEvent(formCancelEvent,(function(api,spec,_event,self){spec.onCancel(api),emit(self,formCloseEvent)})),run$1(formUnblockEvent,(function(_c,_se){return extras.onUnblock()})),run$1(formBlockEvent,(function(_c,se){return extras.onBlock(se.event)}))]},initUrlDialog,initDialog,SilverDialogEvents_initUrlDialog=function(getInstanceApi,extras){var fireApiEvent=function(eventName,f){return run$1(eventName,(function(c,se){withSpec(c,(function(spec,_c){f(getInstanceApi(),spec,se.event,c)}))}))},withSpec=function(c,f){Reflecting.getState(c).get().each((function(currentDialog){f(currentDialog,c)}))};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formActionEvent,(function(api,spec,event){spec.onAction(api,{name:event.name})}))],!1)},SilverDialogEvents_initDialog=function(getInstanceApi,extras,getSink){var fireApiEvent=function(eventName,f){return run$1(eventName,(function(c,se){withSpec(c,(function(spec,_c){f(getInstanceApi(),spec,se.event,c)}))}))},withSpec=function(c,f){Reflecting.getState(c).get().each((function(currentDialogInit){f(currentDialogInit.internalDialog,c)}))};return __spreadArray(__spreadArray([],initCommonEvents(fireApiEvent,extras),!0),[fireApiEvent(formSubmitEvent,(function(api,spec){return spec.onSubmit(api)})),fireApiEvent(formChangeEvent,(function(api,spec,event){spec.onChange(api,{name:event.name})})),fireApiEvent(formActionEvent,(function(api,spec,event,component){var focusIn=function(){return Keying.focusIn(component)},isDisabled=function(focused){return has$1(focused,"disabled")||getOpt(focused,"aria-disabled").exists((function(val){return"true"===val}))},rootNode=getRootNode(component.element),current=active(rootNode);spec.onAction(api,{name:event.name,value:event.value}),active(rootNode).fold(focusIn,(function(focused){isDisabled(focused)||current.exists((function(cur){return contains(focused,cur)&&isDisabled(cur)}))?focusIn():getSink().toOptional().filter((function(sink){return!contains(sink.element,focused)})).each(focusIn)}))})),fireApiEvent(formTabChangeEvent,(function(api,spec,event){spec.onTabChange(api,{newTabName:event.name,oldTabName:event.oldName})})),runOnDetached((function(component){var api=getInstanceApi();Representing.setValue(component,api.getData())}))],!1)},makeButton=function(button,backstage){return renderFooterButton(button,button.type,backstage)},lookup=function(compInSystem,footerButtons,buttonName){return find$5(footerButtons,(function(button){return button.name===buttonName})).bind((function(memButton){return memButton.memento.getOpt(compInSystem)}))},renderComponents=function(_data,state){var footerButtons=state.map((function(s){return s.footerButtons})).getOr([]),buttonGroups=partition$3(footerButtons,(function(button){return"start"===button.align})),makeGroup=function(edge,buttons){return Container.sketch({dom:{tag:"div",classes:["tox-dialog__footer-"+edge]},components:map$2(buttons,(function(button){return button.memento.asSpec()}))})},startButtons,endButtons;return[makeGroup("start",buttonGroups.pass),makeGroup("end",buttonGroups.fail)]},renderFooter=function(initSpec,backstage){var updateState=function(_comp,data){var footerButtons=map$2(data.buttons,(function(button){var memButton=record(makeButton(button,backstage));return{name:button.name,align:button.align,memento:memButton}})),lookupByName=function(compInSystem,buttonName){return lookup(compInSystem,footerButtons,buttonName)};return Optional.some({lookupByName:lookupByName,footerButtons:footerButtons})};return{dom:fromHtml('<div class="tox-dialog__footer"></div>'),components:[],behaviours:derive$1([Reflecting.config({channel:footerChannel,initialData:initSpec,updateState:updateState,renderComponents:renderComponents})])}},renderInlineFooter=function(initSpec,backstage){return renderFooter(initSpec,backstage)},renderModalFooter=function(initSpec,backstage){return ModalDialog.parts.footer(renderFooter(initSpec,backstage))},getCompByName=function(access,name){var root;if(access.getRoot().getSystem().isConnected()){var form_1=Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());return Form.getField(form_1,name).fold((function(){var footer=access.getFooter(),footerState;return Reflecting.getState(footer).get().bind((function(f){return f.lookupByName(form_1,name)}))}),(function(comp){return Optional.some(comp)}))}return Optional.none()},validateData$1=function(access,data){var root=access.getRoot();return Reflecting.getState(root).get().map((function(dialogState){return getOrDie(asRaw("data",dialogState.dataValidator,data))})).getOr(data)},getDialogApi=function(access,doRedial,menuItemStates){var withRoot=function(f){var root=access.getRoot();root.getSystem().isConnected()&&f(root)},getData,setData,disable,enable,focus,block,unblock,showTab,redial,close,instanceApi={getData:function(){var root=access.getRoot(),valueComp=root.getSystem().isConnected()?access.getFormWrapper():root,representedValues=Representing.getValue(valueComp),menuItemCurrentState=map$1(menuItemStates,(function(cell){return cell.get()}));return __assign(__assign({},representedValues),menuItemCurrentState)},setData:function(newData){withRoot((function(_){var prevData=instanceApi.getData(),mergedData=__assign(__assign({},prevData),newData),newInternalData=validateData$1(access,mergedData),form=access.getFormWrapper();Representing.setValue(form,newInternalData),each(menuItemStates,(function(v,k){has$2(mergedData,k)&&v.set(mergedData[k])}))}))},disable:function(name){getCompByName(access,name).each(Disabling.disable)},enable:function(name){getCompByName(access,name).each(Disabling.enable)},focus:function(name){getCompByName(access,name).each(Focusing.focus)},block:function(message){if(!isString(message))throw new Error("The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot((function(root){emitWith(root,formBlockEvent,{message:message})}))},unblock:function(){withRoot((function(root){emit(root,formUnblockEvent)}))},showTab:function(name){withRoot((function(_){var body=access.getBody(),bodyState;Reflecting.getState(body).get().exists((function(b){return b.isTabPanel()}))&&Composing.getCurrent(body).each((function(tabSection){TabSection.showTab(tabSection,name)}))}))},redial:function(d){withRoot((function(root){var dialogInit=doRedial(d);root.getSystem().broadcastOn([dialogChannel],dialogInit),root.getSystem().broadcastOn([titleChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([bodyChannel],dialogInit.internalDialog),root.getSystem().broadcastOn([footerChannel],dialogInit.internalDialog),instanceApi.setData(dialogInit.initialData)}))},close:function(){withRoot((function(root){emit(root,formCloseEvent)}))}};return instanceApi},getDialogSizeClasses=function(size){switch(size){case"large":return["tox-dialog--width-lg"];case"medium":return["tox-dialog--width-md"];default:return[]}},renderDialog=function(dialogInit,extra,backstage){var header=getHeader(dialogInit.internalDialog.title,backstage),body=renderModalBody({body:dialogInit.internalDialog.body},backstage),storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons),objOfCells=extractCellsToObject(storagedMenuButtons),footer=renderModalFooter({buttons:storagedMenuButtons},backstage),dialogEvents=SilverDialogEvents_initDialog((function(){return instanceApi}),getEventExtras((function(){return dialog}),backstage.shared.providers,extra),backstage.shared.getSink),dialogSize=getDialogSizeClasses(dialogInit.internalDialog.size),spec={header:header,body:body,footer:Optional.some(footer),extraClasses:dialogSize,extraBehaviours:[],extraStyles:{}},dialog=renderModalDialog(spec,dialogInit,dialogEvents,backstage),modalAccess=(getForm=function(){var outerForm=ModalDialog.getBody(dialog);return Composing.getCurrent(outerForm).getOr(outerForm)},{getRoot:constant$1(dialog),getBody:function(){return ModalDialog.getBody(dialog)},getFooter:function(){return ModalDialog.getFooter(dialog)},getFormWrapper:getForm}),getForm,instanceApi=getDialogApi(modalAccess,extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi}},renderInlineDialog=function(dialogInit,extra,backstage,ariaAttrs){var _a,_b,dialogLabelId=generate$6("dialog-label"),dialogContentId=generate$6("dialog-content"),updateState=function(_comp,incoming){return Optional.some(incoming)},memHeader=record(renderInlineHeader({title:dialogInit.internalDialog.title,draggable:!0},dialogLabelId,backstage.shared.providers)),memBody=record(renderInlineBody({body:dialogInit.internalDialog.body},dialogContentId,backstage,ariaAttrs)),storagedMenuButtons=mapMenuButtons(dialogInit.internalDialog.buttons),objOfCells=extractCellsToObject(storagedMenuButtons),memFooter=record(renderInlineFooter({buttons:storagedMenuButtons},backstage)),dialogEvents=SilverDialogEvents_initDialog((function(){return instanceApi}),{onBlock:function(event){Blocking.block(dialog,(function(_comp,bs){return getBusySpec(event.message,bs,backstage.shared.providers)}))},onUnblock:function(){Blocking.unblock(dialog)},onClose:function(){return extra.closeWindow()}},backstage.shared.getSink),dialog=build$1({dom:{tag:"div",classes:["tox-dialog","tox-dialog-inline"],attributes:(_a={role:"dialog"},_a["aria-labelledby"]=dialogLabelId,_a["aria-describedby"]=dialogContentId,_a)},eventOrder:(_b={},_b[receive()]=[Reflecting.name(),Receiving.name()],_b[execute$5()]=["execute-on-form"],_b[attachedToDom()]=["reflecting","execute-on-form"],_b),behaviours:derive$1([Keying.config({mode:"cyclic",onEscape:function(c){return emit(c,formCloseEvent),Optional.some(!0)},useTabstopAt:function(elem){return!isPseudoStop(elem)&&("button"!==name$2(elem)||"disabled"!==get$d(elem,"disabled"))}}),Reflecting.config({channel:dialogChannel,updateState:updateState,initialData:dialogInit}),Focusing.config({}),config("execute-on-form",dialogEvents.concat([runOnSource(focusin(),(function(comp,_se){Keying.focusIn(comp)}))])),Blocking.config({getRoot:function(){return Optional.some(dialog)}}),Replacing.config({}),RepresentingConfigs_memory({})]),components:[memHeader.asSpec(),memBody.asSpec(),memFooter.asSpec()]}),instanceApi=getDialogApi({getRoot:constant$1(dialog),getFooter:function(){return memFooter.get(dialog)},getBody:function(){return memBody.get(dialog)},getFormWrapper:function(){var body=memBody.get(dialog);return Composing.getCurrent(body).getOr(body)}},extra.redial,objOfCells);return{dialog:dialog,instanceApi:instanceApi}},global$1=tinymce.util.Tools.resolve("tinymce.util.URI"),getUrlDialogApi=function(root){var withRoot=function(f){root.getSystem().isConnected()&&f(root)},block,unblock,close,sendMessage;return{block:function(message){if(!isString(message))throw new Error("The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument");withRoot((function(root){emitWith(root,formBlockEvent,{message:message})}))},unblock:function(){withRoot((function(root){emit(root,formUnblockEvent)}))},close:function(){withRoot((function(root){emit(root,formCloseEvent)}))},sendMessage:function(data){withRoot((function(root){root.getSystem().broadcastOn([bodySendMessageChannel],data)}))}}},SUPPORTED_MESSAGE_ACTIONS=["insertContent","setContent","execCommand","close","block","unblock"],isSupportedMessage=function(data){return isObject(data)&&-1!==SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction)},isCustomMessage=function(data){return!isSupportedMessage(data)&&isObject(data)&&has$2(data,"mceAction")},handleMessage=function(editor,api,data){switch(data.mceAction){case"insertContent":editor.insertContent(data.content);break;case"setContent":editor.setContent(data.content);break;case"execCommand":var ui=!!isBoolean(data.ui)&&data.ui;editor.execCommand(data.cmd,ui,data.value);break;case"close":api.close();break;case"block":api.block(data.message);break;case"unblock":api.unblock()}},renderUrlDialog=function(internalDialog,extra,editor,backstage){var _a,header=getHeader(internalDialog.title,backstage),body=renderIframeBody(internalDialog),footer=internalDialog.buttons.bind((function(buttons){return 0===buttons.length?Optional.none():Optional.some(renderModalFooter({buttons:buttons},backstage))})),dialogEvents=SilverDialogEvents_initUrlDialog((function(){return instanceApi}),getEventExtras((function(){return dialog}),backstage.shared.providers,extra)),styles=__assign(__assign({},internalDialog.height.fold((function(){return{}}),(function(height){return{height:height+"px","max-height":height+"px"}}))),internalDialog.width.fold((function(){return{}}),(function(width){return{width:width+"px","max-width":width+"px"}}))),classes=internalDialog.width.isNone()&&internalDialog.height.isNone()?["tox-dialog--width-lg"]:[],iframeUri=new global$1(internalDialog.url,{base_uri:new global$1(window.location.href)}),iframeDomain=iframeUri.protocol+"://"+iframeUri.host+(iframeUri.port?":"+iframeUri.port:""),messageHandlerUnbinder=unbindable(),extraBehaviours=[config("messages",[runOnAttached((function(){var unbind=bind(SugarElement.fromDom(window),"message",(function(e){if(iframeUri.isSameOrigin(new global$1(e.raw.origin))){var data=e.raw.data;isSupportedMessage(data)?handleMessage(editor,instanceApi,data):isCustomMessage(data)&&internalDialog.onMessage(instanceApi,data)}}));messageHandlerUnbinder.set(unbind)})),runOnDetached(messageHandlerUnbinder.clear)]),Receiving.config({channels:(_a={},_a[bodySendMessageChannel]={onReceive:function(comp,data){descendant(comp.element,"iframe").each((function(iframeEle){var iframeWin;iframeEle.dom.contentWindow.postMessage(data,iframeDomain)}))}},_a)})],spec,dialog=renderModalDialog({header:header,body:body,footer:footer,extraClasses:classes,extraBehaviours:extraBehaviours,extraStyles:styles},internalDialog,dialogEvents,backstage),instanceApi=getUrlDialogApi(dialog);return{dialog:dialog,instanceApi:instanceApi}},setup$2=function(extras){var sharedBackstage=extras.backstage.shared,open;return{open:function(message,callback){var closeDialog=function(){ModalDialog.hide(alertDialog),callback()},memFooterClose=record(renderFooterButton({name:"close-alert",text:"OK",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage)),titleSpec=pUntitled(),closeSpec=pClose(closeDialog,sharedBackstage.providers),alertDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[memFooterClose.asSpec()]))),onEscape:closeDialog,extraClasses:["tox-alert-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,closeDialog)],eventOrder:{}}));ModalDialog.show(alertDialog);var footerCloseButton=memFooterClose.get(alertDialog);Focusing.focus(footerCloseButton)}}},setup$1=function(extras){var sharedBackstage=extras.backstage.shared,open;return{open:function(message,callback){var closeDialog=function(state){ModalDialog.hide(confirmDialog),callback(state)},memFooterYes=record(renderFooterButton({name:"yes",text:"Yes",primary:!0,align:"end",disabled:!1,icon:Optional.none()},"submit",extras.backstage)),footerNo=renderFooterButton({name:"no",text:"No",primary:!1,align:"end",disabled:!1,icon:Optional.none()},"cancel",extras.backstage),titleSpec=pUntitled(),closeSpec=pClose((function(){return closeDialog(!1)}),sharedBackstage.providers),confirmDialog=build$1(renderDialog$1({lazySink:function(){return sharedBackstage.getSink()},header:hiddenHeader(titleSpec,closeSpec),body:pBodyMessage(message,sharedBackstage.providers),footer:Optional.some(pFooter(pFooterGroup([],[footerNo,memFooterYes.asSpec()]))),onEscape:function(){return closeDialog(!1)},extraClasses:["tox-confirm-dialog"],extraBehaviours:[],extraStyles:{},dialogEvents:[run$1(formCancelEvent,(function(){return closeDialog(!1)})),run$1(formSubmitEvent,(function(){return closeDialog(!0)}))],eventOrder:{}}));ModalDialog.show(confirmDialog);var footerYesButton=memFooterYes.get(confirmDialog);Focusing.focus(footerYesButton)}}},validateData=function(data,validator){return getOrDie(asRaw("data",validator,data))},isAlertOrConfirmDialog=function(target){return closest(target,".tox-alert-dialog")||closest(target,".tox-confirm-dialog")},inlineAdditionalBehaviours=function(editor,isStickyToolbar,isToolbarLocationTop){return isStickyToolbar&&isToolbarLocationTop?[]:[Docking.config({contextual:{lazyContext:function(){return Optional.some(box$1(SugarElement.fromDom(editor.getContentAreaContainer())))},fadeInClass:"tox-dialog-dock-fadein",fadeOutClass:"tox-dialog-dock-fadeout",transitionClass:"tox-dialog-dock-transition"},modes:["top"]})]},setup=function(extras){var backstage=extras.backstage,editor=extras.editor,isStickyToolbar$1=isStickyToolbar(editor),alertDialog=setup$2(extras),confirmDialog=setup$1(extras),open=function(config,params,closeWindow){return void 0!==params&&"toolbar"===params.inline?openInlineDialog(config,backstage.shared.anchors.inlineDialog(),closeWindow,params.ariaAttrs):void 0!==params&&"cursor"===params.inline?openInlineDialog(config,backstage.shared.anchors.cursor(),closeWindow,params.ariaAttrs):openModalDialog(config,closeWindow)},openUrl=function(config,closeWindow){return openModalUrlDialog(config,closeWindow)},openModalUrlDialog=function(config,closeWindow){var factory;return DialogManager.openUrl((function(contents){var dialog=renderUrlDialog(contents,{closeWindow:function(){ModalDialog.hide(dialog.dialog),closeWindow(dialog.instanceApi)}},editor,backstage);return ModalDialog.show(dialog.dialog),dialog.instanceApi}),config)},openModalDialog=function(config,closeWindow){var factory;return DialogManager.open((function(contents,internalInitialData,dataValidator){var initialData=internalInitialData,dialogInit,dialog=renderDialog({dataValidator:dataValidator,initialData:initialData,internalDialog:contents},{redial:DialogManager.redial,closeWindow:function(){ModalDialog.hide(dialog.dialog),closeWindow(dialog.instanceApi)}},backstage);return ModalDialog.show(dialog.dialog),dialog.instanceApi.setData(initialData),dialog.instanceApi}),config)},openInlineDialog=function(config$1,anchor,closeWindow,ariaAttrs){var factory;return DialogManager.open((function(contents,internalInitialData,dataValidator){var initialData=validateData(internalInitialData,dataValidator),inlineDialog=value$1(),isToolbarLocationTop=backstage.shared.header.isPositionedAtTop(),dialogInit,refreshDocking=function(){return inlineDialog.on((function(dialog){InlineView.reposition(dialog),Docking.refresh(dialog)}))},dialogUi=renderInlineDialog({dataValidator:dataValidator,initialData:initialData,internalDialog:contents},{redial:DialogManager.redial,closeWindow:function(){inlineDialog.on(InlineView.hide),editor.off("ResizeEditor",refreshDocking),inlineDialog.clear(),closeWindow(dialogUi.instanceApi)}},backstage,ariaAttrs),inlineDialogComp=build$1(InlineView.sketch(__assign(__assign({lazySink:backstage.shared.getSink,dom:{tag:"div",classes:[]},fireDismissalEventInstead:{}},isToolbarLocationTop?{}:{fireRepositionEventInstead:{}}),{inlineBehaviours:derive$1(__spreadArray([config("window-manager-inline-events",[run$1(dismissRequested(),(function(_comp,_se){emit(dialogUi.dialog,formCancelEvent)}))])],inlineAdditionalBehaviours(editor,isStickyToolbar$1,isToolbarLocationTop),!0)),isExtraPart:function(_comp,target){return isAlertOrConfirmDialog(target)}})));return inlineDialog.set(inlineDialogComp),InlineView.showWithin(inlineDialogComp,premade(dialogUi.dialog),{anchor:anchor},Optional.some(body())),isStickyToolbar$1&&isToolbarLocationTop||(Docking.refresh(inlineDialogComp),editor.on("ResizeEditor",refreshDocking)),dialogUi.instanceApi.setData(initialData),Keying.focusIn(dialogUi.dialog),dialogUi.instanceApi}),config$1)},confirm,alert,close;return{open:open,openUrl:openUrl,alert:function(message,callback){alertDialog.open(message,(function(){callback()}))},close:function(instanceApi){instanceApi.close()},confirm:function(message,callback){confirmDialog.open(message,(function(state){callback(state)}))}}};function Theme(){global$g.add("silver",(function(editor){var _a=setup$3(editor),uiMothership=_a.uiMothership,backstage=_a.backstage,renderUI=_a.renderUI,getUi=_a.getUi;Autocompleter_register(editor,backstage.shared);var windowMgr=setup({editor:editor,backstage:backstage});return{renderUI:renderUI,getWindowManagerImpl:constant$1(windowMgr),getNotificationManagerImpl:function(){return NotificationManagerImpl(editor,{backstage:backstage},uiMothership)},ui:getUi()}}))}Theme()}();